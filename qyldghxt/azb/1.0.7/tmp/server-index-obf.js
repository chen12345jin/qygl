const _0x4f4910=_0x293b;(function(_0x12cd4e,_0x4d9748){const _0x44dbf5=_0x293b,_0x31bd51=_0x12cd4e();while(!![]){try{const _0x384fa1=-parseInt(_0x44dbf5(0x1fe))/0x1+-parseInt(_0x44dbf5(0x27c))/0x2*(parseInt(_0x44dbf5(0x1a8))/0x3)+-parseInt(_0x44dbf5(0x299))/0x4+-parseInt(_0x44dbf5(0x1bd))/0x5+parseInt(_0x44dbf5(0x1a2))/0x6*(parseInt(_0x44dbf5(0x22f))/0x7)+parseInt(_0x44dbf5(0x238))/0x8+parseInt(_0x44dbf5(0x205))/0x9;if(_0x384fa1===_0x4d9748)break;else _0x31bd51['push'](_0x31bd51['shift']());}catch(_0x58c605){_0x31bd51['push'](_0x31bd51['shift']());}}}(_0x580d,0xabf49));import _0xee2d5e from'express';import _0x593012 from'cors';import _0x472215 from'path';import _0x401516 from'fs';import{promises as _0x3aa014}from'fs';import{fileURLToPath}from'url';import{createServer}from'http';import{Server}from'socket.io';import _0x6a2b97 from'multer';import _0x2dbf79 from'dotenv';import _0x4d7aa1 from'axios';import _0x24dc88 from'bcryptjs';import _0x442fb6 from'jsonwebtoken';const __filename=fileURLToPath(import.meta.url),__dirname=_0x472215['dirname'](__filename);_0x2dbf79[_0x4f4910(0xfc)]({'path':_0x472215[_0x4f4910(0x1ff)](__dirname,_0x4f4910(0xdd))});const app=_0xee2d5e(),server=createServer(app),io=new Server(server,{'cors':{'origin':'*','methods':[_0x4f4910(0x24e),'POST',_0x4f4910(0x24f),'DELETE']}}),BACKUP_DIR=_0x472215['join'](__dirname,_0x4f4910(0x228)),UPDATES_DIR=_0x472215[_0x4f4910(0x142)](__dirname,'../public/updates'),SYSTEM_SETTINGS_FILE=_0x472215['join'](__dirname,'../temp_store/system_settings.json'),AUDIT_LOG_FILE=_0x472215['join'](__dirname,_0x4f4910(0x2ac)),DEPARTMENT_TARGETS_FILE=_0x472215['join'](__dirname,_0x4f4910(0x20f)),ANNUAL_WORK_PLANS_FILE=_0x472215['join'](__dirname,_0x4f4910(0x154)),MAJOR_EVENTS_FILE=_0x472215['join'](__dirname,_0x4f4910(0x1f5)),MONTHLY_PROGRESS_FILE=_0x472215[_0x4f4910(0x142)](__dirname,'../temp_store/monthly_progress.json'),ACTION_PLANS_FILE=_0x472215['join'](__dirname,'../temp_store/action_plans.json'),DEPARTMENTS_FILE=_0x472215[_0x4f4910(0x142)](__dirname,'../temp_store/departments.json'),EMPLOYEES_FILE=_0x472215['join'](__dirname,_0x4f4910(0x1c0)),USERS_FILE=_0x472215['join'](__dirname,'../temp_store/users.json'),TARGET_TYPES_FILE=_0x472215['join'](__dirname,'../temp_store/target_types.json'),ROLES_FILE=_0x472215['join'](__dirname,'../temp_store/roles.json'),TEMPLATES_FILE=_0x472215['join'](__dirname,'../temp_store/templates.json'),NOTIFICATIONS_FILE=_0x472215['join'](__dirname,'../temp_store/notifications.json'),COMPANY_INFO_FILE=_0x472215['join'](__dirname,'../temp_store/company_info.json'),upload=_0x6a2b97({'storage':_0x6a2b97[_0x4f4910(0x1c7)]()}),JWT_SECRET=process['env']['JWT_SECRET']||'dev-secret',JWT_EXPIRES_IN=process[_0x4f4910(0x130)]['JWT_EXPIRES_IN']||'2h',PORT=0x138c;!_0x401516[_0x4f4910(0x2df)](BACKUP_DIR)&&_0x401516['mkdirSync'](BACKUP_DIR,{'recursive':!![]});!_0x401516['existsSync'](UPDATES_DIR)&&_0x401516[_0x4f4910(0x185)](UPDATES_DIR,{'recursive':!![]});app[_0x4f4910(0x26f)](_0x593012()),app['use'](_0xee2d5e['json']()),app[_0x4f4910(0x26f)](_0xee2d5e['urlencoded']({'extended':!![]})),app['use'](_0xee2d5e[_0x4f4910(0x136)](_0x472215[_0x4f4910(0x142)](__dirname,'../public'))),app[_0x4f4910(0x26f)]('/backups',_0xee2d5e[_0x4f4910(0x136)](BACKUP_DIR)),app['use'](_0x4f4910(0x25b),_0xee2d5e['static'](UPDATES_DIR)),app['use']((_0x536d92,_0x44376d,_0x3e067b)=>{const _0x1af298=_0x4f4910,_0x5930a5={'FDfyA':function(_0x1e97e6,_0x329909){return _0x1e97e6(_0x329909);},'TySyS':function(_0x272675){return _0x272675();},'GKzwd':'user-agent','DHdzW':_0x1af298(0x1d7),'ZUarI':_0x1af298(0x1ce),'drrTL':_0x1af298(0x20d),'uPMGI':function(_0x28c6b3,_0x59819e){return _0x28c6b3===_0x59819e;},'lZxal':function(_0x15152a,_0x59b2e9){return _0x15152a===_0x59b2e9;},'uNAjf':_0x1af298(0x2d4),'gMdCt':_0x1af298(0x24e),'eelUt':function(_0x48abba,_0x16d974){return _0x48abba!==_0x16d974;},'pPDjK':'HEAD','GNars':function(_0x268dab,_0x5e7370){return _0x268dab===_0x5e7370;},'ayPYF':'QDCJz'};if(!_0x536d92['path']||!_0x536d92[_0x1af298(0x234)]['startsWith'](_0x1af298(0x2de)))return _0x5930a5['TySyS'](_0x3e067b);const _0x4ce7d8=Date[_0x1af298(0x178)](),_0x1f0a63=_0x536d92['method']||'',_0x479e29=_0x536d92['ip'],_0x597715=_0x536d92[_0x1af298(0xe7)]&&_0x536d92['headers']['user-agent']?_0x536d92[_0x1af298(0xe7)][_0x5930a5['GKzwd']]:'',_0x449703=_0x536d92[_0x1af298(0xe7)]&&(_0x536d92[_0x1af298(0xe7)]['x-user-name']||_0x536d92['headers'][_0x5930a5['DHdzW']])||'',_0x415c00=_0x536d92[_0x1af298(0xe7)]&&(_0x536d92[_0x1af298(0xe7)][_0x5930a5['ZUarI']]||_0x536d92['headers'][_0x5930a5[_0x1af298(0x172)]])||'',_0x25d43d=_0x5930a5['uPMGI'](typeof _0x449703,'string')?_0x449703:'',_0x1cc93b=_0x5930a5[_0x1af298(0x2db)](typeof _0x415c00,_0x5930a5['uNAjf'])?_0x415c00:'',_0xa9c768=_0x536d92[_0x1af298(0x287)]||{};let _0xeedda6=null;if(_0x1f0a63!==_0x5930a5['gMdCt']&&_0x5930a5[_0x1af298(0x14c)](_0x1f0a63,_0x5930a5[_0x1af298(0x293)])){if(_0x536d92[_0x1af298(0x234)]==='/api/login'){const _0x5affa4=_0x536d92[_0x1af298(0x1e1)]||{};_0xeedda6={'username':_0x5affa4['username']||''};}else{if(_0x5930a5['GNars'](_0x536d92[_0x1af298(0x234)],'/api/upload')){if('QDCJz'!==_0x5930a5['ayPYF'])_0x5930a5['FDfyA'](_0x586a4c,_0x3e16c6['target_types']);else{const _0x4e569b=_0x536d92[_0x1af298(0x1e1)]||{};_0xeedda6={..._0x4e569b},_0xeedda6['file']&&delete _0xeedda6['file'];}}else _0xeedda6=_0x536d92['body']||{};}}_0x44376d['on'](_0x1af298(0x138),()=>{const _0x4f94f2=_0x1af298;if(_0x44376d[_0x4f94f2(0x1f4)]&&_0x44376d[_0x4f94f2(0x1f4)]['auditLogged'])return;const _0x307748=_0x44376d[_0x4f94f2(0x2c6)]||0xc8,_0x4cba0f=Date[_0x4f94f2(0x178)]()-_0x4ce7d8;appendAuditLog({'username':_0x25d43d,'role':_0x1cc93b,'method':_0x1f0a63,'path':_0x536d92['path']||'','status':_0x307748,'duration_ms':_0x4cba0f,'ip':_0x479e29,'ua':_0x597715,'query':_0xa9c768,'body':_0xeedda6});}),_0x3e067b();});const mockData={'annual_work_plans':[],'major_events':[],'monthly_progress':[],'departments':[{'id':0x1,'name':'技术部','code':'TECH','parent_id':null,'status':'active','created_at':_0x4f4910(0x22e)},{'id':0x2,'name':_0x4f4910(0x297),'code':'SALES','parent_id':null,'status':_0x4f4910(0x26e),'created_at':'2025-01-01T00:00:00.000Z'},{'id':0x3,'name':_0x4f4910(0x24d),'code':'MARKET','parent_id':null,'status':'active','created_at':'2025-01-01T00:00:00.000Z'},{'id':0x4,'name':'人事部','code':'HR','parent_id':null,'status':_0x4f4910(0x26e),'created_at':'2025-01-01T00:00:00.000Z'}],'employees':[],'action_plans':[],'notifications':[],'users':[{'id':0x1,'username':'admin','password':'$2a$10$jGBUZS.KkPpiXRzsHlNDYOizztF6nrRIcp8aYIeBxZEVVuuqaN2wW','role':_0x4f4910(0x1ed),'department':'技术部','status':'启用','lastLogin':_0x4f4910(0x1ee)}],'target_types':[],'templates':[],'roles':[]};function getNextId(_0x1a453c){const _0xc2f79f=_0x4f4910,_0x1196c2={'cFyDk':function(_0x4d2711,_0x26be50){return _0x4d2711===_0x26be50;}};if(!Array[_0xc2f79f(0x1ad)](_0x1a453c)||_0x1196c2['cFyDk'](_0x1a453c[_0xc2f79f(0x2c1)],0x0))return 0x1;return _0x1a453c[_0xc2f79f(0x1f9)]((_0x24a5e7,_0x39ea09)=>_0x39ea09['id']&&_0x39ea09['id']>_0x24a5e7?_0x39ea09['id']:_0x24a5e7,0x0)+0x1;}function maskSensitive(_0x2106d3){const _0x270704=_0x4f4910,_0x3929bd={'lnBEQ':'password','nTvhI':'secret','bUCMR':'***','aFYJL':function(_0x3d9821,_0x402ec5){return _0x3d9821(_0x402ec5);}};if(!_0x2106d3||typeof _0x2106d3!==_0x270704(0x17d))return _0x2106d3;if(Array['isArray'](_0x2106d3))return _0x2106d3[_0x270704(0x122)](_0x5a4834=>maskSensitive(_0x5a4834));const _0x5ed485={};return Object[_0x270704(0x184)](_0x2106d3)['forEach'](_0x166f67=>{const _0x5c01aa=_0x270704,_0x3ab1c8=_0x2106d3[_0x166f67],_0x5b2ffb=_0x166f67['toLowerCase']();if(_0x5b2ffb[_0x5c01aa(0x274)](_0x3929bd[_0x5c01aa(0x15b)])||_0x5b2ffb['includes'](_0x3929bd['nTvhI'])||_0x5b2ffb[_0x5c01aa(0x274)]('token')||_0x5b2ffb['includes']('webhook')||_0x5b2ffb[_0x5c01aa(0x274)]('appkey')){if(_0x5c01aa(0x26c)==='gvKqT'){_0x490a27[_0x5c01aa(0x17b)](0x194)[_0x5c01aa(0x267)]({'error':'Role\x20not\x20found'});return;}else _0x5ed485[_0x166f67]=_0x3ab1c8?_0x3929bd[_0x5c01aa(0x272)]:_0x3ab1c8;}else _0x3ab1c8&&typeof _0x3ab1c8==='object'?_0x5ed485[_0x166f67]=_0x3929bd[_0x5c01aa(0x18d)](maskSensitive,_0x3ab1c8):_0x5ed485[_0x166f67]=_0x3ab1c8;}),_0x5ed485;}function sanitizeSystemSettingItem(_0x2acd9){const _0x12fc8d=_0x4f4910,_0x1fc857={'lPTHU':function(_0x5b87fe,_0x3b4506){return _0x5b87fe!==_0x3b4506;},'fiHOG':function(_0x510205,_0x50d773){return _0x510205===_0x50d773;},'VTsNT':_0x12fc8d(0x1c6),'TStcM':_0x12fc8d(0x175)};if(!_0x2acd9||_0x1fc857['lPTHU'](typeof _0x2acd9,_0x12fc8d(0x17d)))return _0x2acd9;const _0x4b30d6={..._0x2acd9},_0x32aee1=_0x4b30d6[_0x12fc8d(0x11c)];if(!_0x32aee1)return _0x4b30d6;let _0xd28d88=_0x4b30d6['value'];if(typeof _0xd28d88==='string')try{const _0x5af660=JSON['parse'](_0xd28d88);_0xd28d88=_0x5af660;}catch(_0x193d22){}if(_0xd28d88&&typeof _0xd28d88==='object'){if(_0x1fc857[_0x12fc8d(0x1bb)](_0x32aee1,_0x12fc8d(0x2dc))){const _0x5a638f={..._0xd28d88};if(Object[_0x12fc8d(0x1f0)]['hasOwnProperty'][_0x12fc8d(0x277)](_0x5a638f,_0x12fc8d(0xda)))_0x5a638f['dingtalkAppKey']='';if(Object['prototype']['hasOwnProperty'][_0x12fc8d(0x277)](_0x5a638f,'dingtalkAppSecret'))_0x5a638f[_0x12fc8d(0x2d6)]='';if(Object[_0x12fc8d(0x1f0)][_0x12fc8d(0x221)][_0x12fc8d(0x277)](_0x5a638f,'emailPassword'))_0x5a638f['emailPassword']='';_0x4b30d6['value']=_0x5a638f;}else{if(_0x32aee1===_0x1fc857[_0x12fc8d(0x1f2)]){const _0x6a1d9c={..._0xd28d88};if(Object[_0x12fc8d(0x1f0)][_0x12fc8d(0x221)]['call'](_0x6a1d9c,_0x1fc857['TStcM']))_0x6a1d9c[_0x12fc8d(0x175)]='';if(Object['prototype'][_0x12fc8d(0x221)]['call'](_0x6a1d9c,_0x12fc8d(0x137)))_0x6a1d9c['accessToken']='';if(Object[_0x12fc8d(0x1f0)][_0x12fc8d(0x221)]['call'](_0x6a1d9c,_0x12fc8d(0x28e)))_0x6a1d9c['secret']='';_0x4b30d6['value']=_0x6a1d9c;}else _0x4b30d6[_0x12fc8d(0x1a5)]=_0xd28d88;}}return _0x4b30d6;}function sanitizeAuditLogItem(_0x524659){const _0x441b59=_0x4f4910,_0x5736b3={'loVQr':function(_0x34bf63,_0x4deba0){return _0x34bf63!==_0x4deba0;},'oSSJe':'string','NdyAo':'xjzKb'};if(!_0x524659||_0x5736b3['loVQr'](typeof _0x524659,'object'))return _0x524659;const _0x33faa3={..._0x524659};if(_0x33faa3['body']&&typeof _0x33faa3['body']===_0x5736b3['oSSJe'])try{const _0x5820c4=JSON[_0x441b59(0x120)](_0x33faa3['body']),_0x49a4b2=maskSensitive(_0x5820c4);_0x33faa3[_0x441b59(0x1e1)]=JSON['stringify'](_0x49a4b2);}catch(_0x43b0b3){typeof _0x33faa3['path']===_0x5736b3[_0x441b59(0x147)]&&_0x33faa3['path']['indexOf'](_0x441b59(0x252))===0x0&&(_0x33faa3['body']='');}else{if(_0x33faa3['body']&&typeof _0x33faa3['body']==='object'){if(_0x5736b3['NdyAo']!==_0x441b59(0x1e6)){const _0x185e04=maskSensitive(_0x33faa3[_0x441b59(0x1e1)]);_0x33faa3[_0x441b59(0x1e1)]=_0x185e04;}else _0xed80ea[_0x441b59(0x1e0)](_0x441b59(0x2c3));}}return _0x33faa3;}function cleanupSystemData(){const _0x4145b7=_0x4f4910,_0x1a8c84={'wlrUr':function(_0x34aff0,_0x64fae1){return _0x34aff0!==_0x64fae1;},'oqMNw':function(_0x345bba,_0x2aad89){return _0x345bba===_0x2aad89;},'KENan':_0x4145b7(0x109),'GeNRh':function(_0x231474){return _0x231474();},'fYaSs':function(_0xdede2e,_0x1dfdcc){return _0xdede2e!==_0x1dfdcc;},'xOBNc':_0x4145b7(0x10c)},_0x34710f=_0x1a8c84['GeNRh'](loadSystemSettings),_0x307e79=Array['isArray'](_0x34710f)?_0x34710f:[],_0x3d417d={};_0x307e79['forEach'](_0x3347fb=>{const _0xfc7234=_0x4145b7;if(!_0x3347fb||_0x1a8c84[_0xfc7234(0x102)](typeof _0x3347fb,'object'))return;const _0x231703=_0x3347fb['key'];if(!_0x231703)return;const _0xbe12a0=_0x3d417d[_0x231703];if(!_0xbe12a0)_0x3d417d[_0x231703]=_0x3347fb;else{const _0x33830a=new Date(_0xbe12a0[_0xfc7234(0x189)]||0x0)['getTime'](),_0x5e78d7=new Date(_0x3347fb[_0xfc7234(0x189)]||0x0)['getTime']();_0x5e78d7>=_0x33830a&&(_0x3d417d[_0x231703]=_0x3347fb);}});const _0x14da41=Object['values'](_0x3d417d)['map'](_0x59954b=>sanitizeSystemSettingItem(_0x59954b));_0x14da41['sort']((_0x18c305,_0x2a6b6b)=>{const _0x4b9197=_0x4145b7,_0x3035af=_0x1a8c84[_0x4b9197(0x1b8)](typeof _0x18c305['id'],'number')?_0x18c305['id']:0x0,_0x19c23b=typeof _0x2a6b6b['id']===_0x1a8c84['KENan']?_0x2a6b6b['id']:0x0;return _0x3035af-_0x19c23b;}),saveSystemSettings(_0x14da41);const _0x55899a=loadAuditLogs();if(Array[_0x4145b7(0x1ad)](_0x55899a)&&_0x55899a['length']>0x0){if(_0x1a8c84['fYaSs'](_0x1a8c84['xOBNc'],'wFVJT'))_0x57dcf7['log'](_0x4145b7(0x2b3)+_0x20b6a9),_0x1673cb(_0x4b60ef,0x1388);else{const _0x50abf4=_0x55899a[_0x4145b7(0x122)](_0x4ff844=>sanitizeAuditLogItem(_0x4ff844));saveAuditLogs(_0x50abf4);}}}function loadJsonArrayFile(_0x5dcdf7,_0x3a8ed0){const _0x50606c=_0x4f4910;try{if(!_0x401516[_0x50606c(0x2df)](_0x5dcdf7)){if(Array[_0x50606c(0x1ad)](_0x3a8ed0))return[..._0x3a8ed0];return[];}const _0xf4ba32=_0x401516['readFileSync'](_0x5dcdf7,_0x50606c(0x244)),_0x1c0305=JSON['parse'](_0xf4ba32);if(Array[_0x50606c(0x1ad)](_0x1c0305))return _0x1c0305;return[];}catch(_0x849e4a){if(Array['isArray'](_0x3a8ed0))return[..._0x3a8ed0];return[];}}function saveJsonArrayFile(_0x4d3a6c,_0xab71a3){const _0x5cc0a0=_0x4f4910,_0x28a128={'QQgqf':'utf-8'};try{const _0x5036e7=_0x472215[_0x5cc0a0(0x214)](_0x4d3a6c);!_0x401516[_0x5cc0a0(0x2df)](_0x5036e7)&&_0x401516[_0x5cc0a0(0x185)](_0x5036e7,{'recursive':!![]}),_0x401516[_0x5cc0a0(0x271)](_0x4d3a6c,JSON[_0x5cc0a0(0x2ae)](_0xab71a3,null,0x2),_0x28a128['QQgqf']);}catch(_0x528b92){}}function loadSystemSettings(){const _0x470ea6=_0x4f4910;try{if(!_0x401516['existsSync'](SYSTEM_SETTINGS_FILE))return[];const _0x3eb659=_0x401516[_0x470ea6(0x1ac)](SYSTEM_SETTINGS_FILE,'utf-8'),_0x35d113=JSON[_0x470ea6(0x120)](_0x3eb659);return Array[_0x470ea6(0x1ad)](_0x35d113)?_0x35d113:[];}catch(_0x2743e3){return[];}}function saveSystemSettings(_0x2f8908){const _0x4014e3=_0x4f4910;try{const _0x4c9cc0=_0x472215[_0x4014e3(0x214)](SYSTEM_SETTINGS_FILE);!_0x401516[_0x4014e3(0x2df)](_0x4c9cc0)&&_0x401516[_0x4014e3(0x185)](_0x4c9cc0,{'recursive':!![]}),_0x401516[_0x4014e3(0x271)](SYSTEM_SETTINGS_FILE,JSON['stringify'](_0x2f8908,null,0x2),'utf-8');}catch(_0x35fa66){}}function loadAuditLogs(){const _0x2e18b4=_0x4f4910,_0x36d9d1={'JLkpe':'utf-8'};try{if(!_0x401516[_0x2e18b4(0x2df)](AUDIT_LOG_FILE))return[];const _0x441fa1=_0x401516['readFileSync'](AUDIT_LOG_FILE,_0x36d9d1['JLkpe']),_0x352f56=JSON[_0x2e18b4(0x120)](_0x441fa1);return Array['isArray'](_0x352f56)?_0x352f56:[];}catch(_0xe50d39){return[];}}function saveAuditLogs(_0x5e0f23){const _0x4aadcc=_0x4f4910;try{const _0x5f52a4=_0x472215['dirname'](AUDIT_LOG_FILE);!_0x401516['existsSync'](_0x5f52a4)&&_0x401516['mkdirSync'](_0x5f52a4,{'recursive':!![]}),_0x401516[_0x4aadcc(0x271)](AUDIT_LOG_FILE,JSON['stringify'](_0x5e0f23,null,0x2),_0x4aadcc(0x244));}catch(_0x100a18){}}function loadDepartmentTargets(){const _0x546f9b=_0x4f4910;try{if(!_0x401516['existsSync'](DEPARTMENT_TARGETS_FILE))return[];const _0x577e8d=_0x401516[_0x546f9b(0x1ac)](DEPARTMENT_TARGETS_FILE,'utf-8'),_0x653087=JSON['parse'](_0x577e8d);return Array['isArray'](_0x653087)?_0x653087:[];}catch(_0x346333){return[];}}function saveDepartmentTargets(_0x589d02){const _0x2a4c13=_0x4f4910,_0x4d219a={'HoGvF':'utf-8'};try{const _0x2f2f38=_0x472215[_0x2a4c13(0x214)](DEPARTMENT_TARGETS_FILE);!_0x401516[_0x2a4c13(0x2df)](_0x2f2f38)&&_0x401516['mkdirSync'](_0x2f2f38,{'recursive':!![]}),_0x401516[_0x2a4c13(0x271)](DEPARTMENT_TARGETS_FILE,JSON[_0x2a4c13(0x2ae)](_0x589d02,null,0x2),_0x4d219a[_0x2a4c13(0x188)]);}catch(_0x1b1bb3){}}function loadAnnualWorkPlans(){const _0xbc2abb=_0x4f4910;try{if(!_0x401516['existsSync'](ANNUAL_WORK_PLANS_FILE))return[];const _0x20ab17=_0x401516['readFileSync'](ANNUAL_WORK_PLANS_FILE,'utf-8'),_0x275f8e=JSON['parse'](_0x20ab17);return Array[_0xbc2abb(0x1ad)](_0x275f8e)?_0x275f8e:[];}catch(_0x5289a2){return[];}}function saveAnnualWorkPlans(_0x41da0b){const _0x4240f4=_0x4f4910,_0x5ca414={'UFhPf':_0x4240f4(0x244)};try{const _0x2d4688=_0x472215[_0x4240f4(0x214)](ANNUAL_WORK_PLANS_FILE);!_0x401516[_0x4240f4(0x2df)](_0x2d4688)&&_0x401516['mkdirSync'](_0x2d4688,{'recursive':!![]}),_0x401516['writeFileSync'](ANNUAL_WORK_PLANS_FILE,JSON['stringify'](_0x41da0b,null,0x2),_0x5ca414['UFhPf']);}catch(_0x1e1db2){}}function loadMajorEvents(){const _0x5205a3=_0x4f4910,_0x1955b1={'VuoTr':_0x5205a3(0x244)};try{if(!_0x401516['existsSync'](MAJOR_EVENTS_FILE))return[];const _0x4a0c6d=_0x401516['readFileSync'](MAJOR_EVENTS_FILE,_0x1955b1[_0x5205a3(0x176)]),_0x13abca=JSON['parse'](_0x4a0c6d);return Array['isArray'](_0x13abca)?_0x13abca:[];}catch(_0x414704){return[];}}function saveMajorEvents(_0x4e02e9){const _0x5196a8=_0x4f4910,_0x7a1e4e={'KPnNz':_0x5196a8(0x2b5),'KTbjD':_0x5196a8(0x16b)};try{const _0x242754=_0x472215['dirname'](MAJOR_EVENTS_FILE);!_0x401516[_0x5196a8(0x2df)](_0x242754)&&(_0x7a1e4e[_0x5196a8(0x19f)]!=='iisJS'?_0xfdd165['status'](0x1f4)['json']({'error':_0x7a1e4e[_0x5196a8(0x1fd)]}):_0x401516['mkdirSync'](_0x242754,{'recursive':!![]})),_0x401516['writeFileSync'](MAJOR_EVENTS_FILE,JSON['stringify'](_0x4e02e9,null,0x2),_0x5196a8(0x244));}catch(_0x2e4eb4){}}function loadMonthlyProgress(){const _0x4b1ebd=_0x4f4910,_0x324c91={'ikHgO':'AIhQe'};try{if(!_0x401516['existsSync'](MONTHLY_PROGRESS_FILE))return[];const _0x5aa9eb=_0x401516[_0x4b1ebd(0x1ac)](MONTHLY_PROGRESS_FILE,_0x4b1ebd(0x244)),_0x3e02f2=JSON[_0x4b1ebd(0x120)](_0x5aa9eb);return Array[_0x4b1ebd(0x1ad)](_0x3e02f2)?_0x3e02f2:[];}catch(_0x659b2a){if(_0x324c91['ikHgO']===_0x4b1ebd(0x187))return[];else{const _0x3ff1c3=typeof _0x2278da==='string'?_0x393d90['parse'](_0x4f9cf0):_0x1a2827;_0x1de95a=_0x465005(_0x3ff1c3);}}}function saveMonthlyProgress(_0x3041f7){const _0x2d8923=_0x4f4910,_0x51afdc={'vdAis':function(_0x3ce9a3,_0x558c59,_0x5d500d){return _0x3ce9a3(_0x558c59,_0x5d500d);},'CXNGZ':function(_0x4ae0b0,_0x3bace3){return _0x4ae0b0===_0x3bace3;},'vlDTS':_0x2d8923(0x231)};try{if(_0x51afdc[_0x2d8923(0x127)](_0x51afdc[_0x2d8923(0x1a0)],_0x51afdc[_0x2d8923(0x1a0)])){const _0x1bce89=_0x472215[_0x2d8923(0x214)](MONTHLY_PROGRESS_FILE);!_0x401516[_0x2d8923(0x2df)](_0x1bce89)&&_0x401516[_0x2d8923(0x185)](_0x1bce89,{'recursive':!![]}),_0x401516['writeFileSync'](MONTHLY_PROGRESS_FILE,JSON[_0x2d8923(0x2ae)](_0x3041f7,null,0x2),_0x2d8923(0x244));}else{const _0x29f9e2=_0x51afdc['vdAis'](_0x1b9dd7,_0x4443a1,0xa);!_0x3427b7[_0x2d8923(0x1be)](_0x29f9e2)&&(_0x412a51=_0x435a3d[_0x2d8923(0x16f)](_0x3137be=>_0x598cf5(_0x3137be[_0x2d8923(0x10a)])===_0x29f9e2));}}catch(_0xac20f7){}}function loadActionPlans(){const _0x5cf27d=_0x4f4910;try{if(!_0x401516['existsSync'](ACTION_PLANS_FILE))return[];const _0x1e0152=_0x401516[_0x5cf27d(0x1ac)](ACTION_PLANS_FILE,_0x5cf27d(0x244)),_0x2cd1ad=JSON['parse'](_0x1e0152);return Array['isArray'](_0x2cd1ad)?_0x2cd1ad:[];}catch(_0xb256d5){return[];}}function saveActionPlans(_0x11ab65){const _0x2c971a=_0x4f4910;try{const _0x35001e=_0x472215['dirname'](ACTION_PLANS_FILE);!_0x401516[_0x2c971a(0x2df)](_0x35001e)&&_0x401516[_0x2c971a(0x185)](_0x35001e,{'recursive':!![]}),_0x401516['writeFileSync'](ACTION_PLANS_FILE,JSON[_0x2c971a(0x2ae)](_0x11ab65,null,0x2),_0x2c971a(0x244));}catch(_0x4e0dfb){}}function loadDepartmentsStore(){return loadJsonArrayFile(DEPARTMENTS_FILE,mockData['departments']);}function saveDepartmentsStore(_0x1cc4d0){saveJsonArrayFile(DEPARTMENTS_FILE,_0x1cc4d0);}function loadEmployeesStore(){const _0x3bd922={'KjwuE':function(_0x4698f4,_0x445714,_0x7746d7){return _0x4698f4(_0x445714,_0x7746d7);}};return _0x3bd922['KjwuE'](loadJsonArrayFile,EMPLOYEES_FILE,mockData['employees']);}function saveEmployeesStore(_0x35afc8){saveJsonArrayFile(EMPLOYEES_FILE,_0x35afc8);}function loadUsersStore(){return loadJsonArrayFile(USERS_FILE,mockData['users']);}function saveUsersStore(_0x28c4c8){saveJsonArrayFile(USERS_FILE,_0x28c4c8);}function getUserPermissions(_0x1f85dc){const _0x192ffa=_0x4f4910,_0x123dd9={'FwNwk':function(_0x1bac8d,_0xbb9c2b){return _0x1bac8d!==_0xbb9c2b;},'PxLFi':function(_0x44230a,_0x53158b){return _0x44230a===_0x53158b;},'xxWZL':'admin','lbLkf':_0x192ffa(0x2d4)};if(!_0x1f85dc||_0x123dd9[_0x192ffa(0x28f)](typeof _0x1f85dc,'object'))return[];if(Array[_0x192ffa(0x1ad)](_0x1f85dc['permissions'])&&_0x1f85dc[_0x192ffa(0x275)][_0x192ffa(0x2c1)]>0x0)return _0x1f85dc['permissions'];if(_0x123dd9['PxLFi'](_0x1f85dc['username'],_0x192ffa(0x29e)))return[_0x123dd9[_0x192ffa(0x236)]];if(typeof _0x1f85dc['role']===_0x123dd9['lbLkf']){const _0x20072f=_0x1f85dc['role'],_0x31ece8=loadRolesStore(),_0x350039=Array[_0x192ffa(0x1ad)](_0x31ece8)?_0x31ece8[_0x192ffa(0x2c4)](_0x55e407=>_0x55e407&&(_0x55e407[_0x192ffa(0x19b)]===_0x20072f||_0x55e407[_0x192ffa(0x20b)]===_0x20072f)):null;if(_0x350039&&Array[_0x192ffa(0x1ad)](_0x350039[_0x192ffa(0x275)])&&_0x350039['permissions']['length']>0x0)return _0x350039[_0x192ffa(0x275)];}return[];}function _0x580d(){const _0x28f884=['重新加载自动备份设置失败','vVMPO','fXuPc','员工管理','zliEf','AeraK','env','rfaSk','JjVbx','password','dpdZc','xKAgY','static','accessToken','finish','创建系统备份','siEAT','role','kRMGP','templates','txwps','users','PnZor','POST','join','/api/action-plans/:id','WOdfc','qDoIf','BHiMZ','oSSJe','操作部门信息','hjUQf','no-store','/api/admin/backups','eelUt','content','FElKN','/api/department-targets','year','bLfLQ','fhPpH','tWETc','../temp_store/annual_work_plans.json','xtDZE','../index.html','DINGTALK_DEPT_ID','vYJlS','CtZkQ','tZcuD','lnBEQ','setHeader','tVMXV','trim','KnIAr','IXyoL','IBZPF','bGPmA','gJrEy','fzumh','system_settings','qrmvW','hrvDM','/api/major-events','uegGw','/api/system-settings/','iisJS','details','/api/notifications','undefined','filter','unit','/api/target-types/:id','drrTL','system-backup-','department_targets','webhookUrl','VuoTr','未收到备份文件','now','user-online','消息发送失败','status','auditLogged','object','peOoy','hiLLQ','更新系统设置','Template\x20not\x20found','删除备份失败','teWHr','keys','mkdirSync','vOqsZ','AIhQe','HoGvF','created_at','GkOef','mWcoJ','UPDATE','aFYJL','sDJRW','保存大事件数据失败','/api/roles/:id','slice','Qzwlg','when','操作员工信息','/api/admin/cleanup-data','gLSre','XlbhS','action_plans','HxqBS','操作目标类型','name','登录失败：缺少用户名或密码','size','删除大事件数据失败','KTbjD','vlDTS','https://oapi.dingtalk.com/gettoken','6TRtoSw','sort','current_value','value','DELETE','uDmHy','57RIlVih','MzCJY','PXkFc','rpKWD','readFileSync','isArray','get','uLyhQ','缺少Webhook地址','CjogL','planned_date','set','FgwYT','toLowerCase','Target\x20type\x20not\x20found','未知操作','oqMNw','GrrnD','LaqUq','fiHOG','data','51275znmnSW','isNaN','数据清理失败','../temp_store/employees.json','/api/action-plans','department_id','/api/departments','从钉钉同步员工数据','getFullYear','dingtalk_webhook','memoryStorage','系统日志','CREATE','VzvNX','保存部门目标分解数据失败','completion_rate','QWOUv','x-user-role','actual_date','HYaQH','公司信息','JdeLN','post','errmsg','备份文件不存在','DiYXE','x-username','AqvCv','company_info','uYNsL','uOgvs','delete','push','MuIir','TTudx','log','body','WQROf','QhnIL','KhgNM','target_level','mTRzy','部门目标分解记录不存在','bfdxv','BPZQa','IdIkf','target_type','LNKGD','管理员','2025-12-15T00:00:00.000Z','pRNFZ','prototype','Employee\x20not\x20found','VTsNT','VskIN','locals','../temp_store/major_events.json','APhEq','ZyqMi','text','reduce','删除年度工作落地规划记录失败','年度工作落地规划记录不存在','操作角色权限','KPnNz','1208988ezKlPg','resolve','/api/notifications/:id','oYGwW','amAkH','hoHXs','/api/monthly-progress/:id','28065528IRMYWN','parentid','保存行动计划失败','notifications','stat','Cache-Control','code','备份失败','x-role','JSnPG','../temp_store/department_targets.json','/api/system-settings/:id','nETmN','udWiw','quarter','dirname','DxzYv','target_value','未配置钉钉应用Key或Secret','nZxTb','IZNFW','ICCiQ','/api/templates/:id','mLscj','target_types','jIGji','departments','/api/integration/status','hasOwnProperty','responsible_person','删除行动计划失败','User\x20not\x20found','/api/health','行动计划不存在','XPUHQ','../backups','affUg','/login','title','/api/users','操作公司信息','2025-01-01T00:00:00.000Z','861049gtjplh','从未登录','yIcZS','QwUzZ','QGYsq','path','sxyqX','xxWZL','KuoTZ','5487464ZwEZku','XiDNR','SIaMM','email','lErZI','startsWith','SVohR','XECfF','xkdVP','创建备份','钉钉员工','crXuK','utf-8','major_events','oLgFt','fmUyg','oxgRA','parent_id','CWuDi','toString','LOGIN','市场部','GET','PUT','VaicH','A\x20user\x20connected','/api/system-settings','/api/users/:id','hizQY','aCUdw','limit','XzZPr','RIbKZ','ufcwd','zKFqc','/updates','laSfF','oCjIR','PATCH','加载部门目标分解数据失败','joEcZ','put','/api/login','padStart','mobile','pRMRQ','KkbIp','json','Setting\x20not\x20found','DINGTALK_APP_SECRET','params','消息已发送','mLjcS','FCowv','active','use','rhMMw','writeFileSync','bUCMR','jGRFx','includes','permissions','emailPassword','call','user-agent','wrLKl','file','endsWith','70106fjLDtB','getDate','toUpperCase','forEach','用户登录系统','eVhsg','szsbG','qETIU','NBisn','fTOjO','UUNJV','query','NfxPp','SCibR','eGtDd','bWdua','action','rootDeptId','secret','FwNwk','success','appKey','kcLVK','pPDjK','用户名或密码错误','monthly_progress','未收到文件','销售部','getTime','5351012OZNhFD','/api/departments/:id','wBOCX','nxIYS','getMonth','admin','fxcoe','Vdfhx','emit','toISOString','IIDbW','示例公司','HZdEx','数据清理','创建用户失败','priority','/api/company-info','DEPT','同步钉钉部门','../temp_store/audit_logs.json','DingTalk\x20message\x20send\x20failed:','stringify','EQAOV','XLPVg','children','paelo','Server\x20running\x20on\x20http://localhost:','connection','更新部门目标分解数据失败','同步钉钉员工','MGqvv','文件上传','YWnmB','buffer','disconnect','isFinite','VlPxm','JaGQC','同步钉钉部门失败','PuQXg','length','end_date','自动备份已禁用','find','employees','statusCode','***','tZEZw','xpdsF','mJWoe','自动备份失败：','MXjxE','message','operator','大事件记录不存在','DEMO','User\x20disconnected','开始执行自动备份...','缺少有效的Webhook地址','string','hash','dingtalkAppSecret','模板管理','nIEVX','aZqxK','FZqty','lZxal','integration','backupInterval','/api','existsSync','年度工作落地规划','部门目标分解','DKDQi','/api/dingtalk/departments','action_type','TNLUL','XySpD','OIcGs','$2a$','大事件','BOcGQ','HpfDd','LzvZm','Department\x20not\x20found','category','koqOy','dnNOj','inactive','dingtalkAppKey','删除部门目标分解数据失败','UmDhZ','../.env','WxITF','rBjfE','DaNIE','dingtalkDeptId','duration_ms','audit_logs','zLctB','auditLog','HDMSJ','headers','.json','/api/target-types','dRtdg','ZNITU','username','genSalt','/api/notifications/send','lastLogin','无效的日志ID','User\x20joined\x20room:\x20','DqONI','BMoDr','vDhhG','VWsyE','lhYAT','OpHGU','tTfBM','mtEHL','删除月度推进计划记录失败','../config/dingtalk_config.json','config','oGlrr','LlZWB','twyrt','responsible_department','MWwWx','wlrUr','/api/logs','操作用户账号','TfGpp','lekXc','XvydK','WTpSf','number','month','x-user-name','wFVJT','TFTKb','Role\x20not\x20found','ip_address','操作年度工作落地规划','jobnumber','findIndex','/api/annual-work-plans','disabled','department','Tdsfe','getHours','annual_work_plans','yyOck','cLxel','error','key','MxWvq','QZjcq','/api/employees/:id','parse','department_name','map','Qyghl','SDVjR','用户管理','/api/admin/backups/restore','CXNGZ','备份管理','tfaST'];_0x580d=function(){return _0x28f884;};return _0x580d();}function generateJwtToken(_0x27d731){const _0x4fa9cc=_0x4f4910,_0x1b44bd={'UYZjo':function(_0x57911a,_0xa53eb3){return _0x57911a(_0xa53eb3);}},_0x3e0e50={'sub':_0x27d731['id'],'username':_0x27d731['username'],'role':_0x27d731['role'],'department':_0x27d731[_0x4fa9cc(0x115)],'permissions':_0x1b44bd['UYZjo'](getUserPermissions,_0x27d731)};return _0x442fb6['sign'](_0x3e0e50,JWT_SECRET,{'expiresIn':JWT_EXPIRES_IN});}function loadTargetTypesStore(){const _0x3e4a9e=_0x4f4910;return loadJsonArrayFile(TARGET_TYPES_FILE,mockData[_0x3e4a9e(0x21d)]);}function _0x293b(_0x358d8a,_0x1057af){_0x358d8a=_0x358d8a-0xd5;const _0x580d63=_0x580d();let _0x293b17=_0x580d63[_0x358d8a];return _0x293b17;}function saveTargetTypesStore(_0x365515){saveJsonArrayFile(TARGET_TYPES_FILE,_0x365515);}function loadRolesStore(){const _0x278a3a=_0x4f4910,_0x2c6e05={'lhYAT':function(_0x42df98,_0x3ba5d2,_0x4eaef4){return _0x42df98(_0x3ba5d2,_0x4eaef4);}};return _0x2c6e05[_0x278a3a(0xf6)](loadJsonArrayFile,ROLES_FILE,mockData['roles']||[]);}function saveRolesStore(_0x351117){const _0x2ab6d8=_0x4f4910,_0x4e7403={'nETmN':function(_0x50fd3d,_0x1d680f,_0xef580){return _0x50fd3d(_0x1d680f,_0xef580);}};_0x4e7403[_0x2ab6d8(0x211)](saveJsonArrayFile,ROLES_FILE,_0x351117);}function loadTemplatesStore(){const _0x1fd5fc=_0x4f4910,_0x42280a={'ufcwd':function(_0x37f4d0,_0x4f1924,_0x1e38b2){return _0x37f4d0(_0x4f1924,_0x1e38b2);}};return _0x42280a[_0x1fd5fc(0x259)](loadJsonArrayFile,TEMPLATES_FILE,mockData[_0x1fd5fc(0x13d)]);}function saveTemplatesStore(_0x865cab){const _0x4b6946=_0x4f4910,_0x21b773={'xpdsF':function(_0x201ab0,_0x527aad,_0x438044){return _0x201ab0(_0x527aad,_0x438044);}};_0x21b773[_0x4b6946(0x2c9)](saveJsonArrayFile,TEMPLATES_FILE,_0x865cab);}function loadNotificationsStore(){const _0x479660=_0x4f4910,_0x4a2aa2={'paelo':function(_0xa14839,_0x3e7d94,_0x41e34e){return _0xa14839(_0x3e7d94,_0x41e34e);}};return _0x4a2aa2[_0x479660(0x2b2)](loadJsonArrayFile,NOTIFICATIONS_FILE,mockData[_0x479660(0x208)]);}function saveNotificationsStore(_0x72be2e){saveJsonArrayFile(NOTIFICATIONS_FILE,_0x72be2e);}function loadCompanyInfoStore(){const _0x9f7675=_0x4f4910,_0x177a65={'HDMSJ':_0x9f7675(0x244)};try{if(!_0x401516['existsSync'](COMPANY_INFO_FILE))return null;const _0x258576=_0x401516['readFileSync'](COMPANY_INFO_FILE,_0x177a65[_0x9f7675(0xe6)]),_0xbb675d=JSON['parse'](_0x258576);if(_0xbb675d&&typeof _0xbb675d===_0x9f7675(0x17d))return _0xbb675d;return null;}catch(_0x3c9894){return null;}}function saveCompanyInfoStore(_0x56645b){const _0x2a6f9a=_0x4f4910,_0x592c93={'dnNOj':'utf-8'};try{const _0x4ec7d3=_0x472215[_0x2a6f9a(0x214)](COMPANY_INFO_FILE);!_0x401516['existsSync'](_0x4ec7d3)&&_0x401516['mkdirSync'](_0x4ec7d3,{'recursive':!![]}),_0x401516['writeFileSync'](COMPANY_INFO_FILE,JSON['stringify'](_0x56645b||{},null,0x2),_0x592c93[_0x2a6f9a(0xd8)]);}catch(_0x2fda11){}}function shouldWriteAuditLog(){const _0x19c1f5=_0x4f4910,_0x491e35={'fWuSQ':function(_0xe74215,_0x253075){return _0xe74215===_0x253075;},'BMoDr':_0x19c1f5(0xe5)},_0x56cd7f=loadSystemSettings(),_0x5a2897=Array['isArray'](_0x56cd7f)?_0x56cd7f['find'](_0xdaed41=>_0xdaed41&&_0xdaed41['key']==='security'):null;if(!_0x5a2897||!_0x5a2897['value'])return!![];let _0x36d9c0=_0x5a2897[_0x19c1f5(0x1a5)];if(_0x491e35['fWuSQ'](typeof _0x36d9c0,_0x19c1f5(0x2d4)))try{_0x36d9c0=JSON[_0x19c1f5(0x120)](_0x36d9c0);}catch(_0x2c2b8b){_0x36d9c0={};}if(_0x36d9c0&&Object['prototype']['hasOwnProperty']['call'](_0x36d9c0,_0x491e35[_0x19c1f5(0xf3)]))return!!_0x36d9c0[_0x19c1f5(0xe5)];return!![];}const API_PATH_MAPPING={'/api/login':{'action':'用户登录','description':_0x4f4910(0x280)},'/api/annual-work-plans':{'action':_0x4f4910(0x2e0),'description':_0x4f4910(0x110)},'/api/major-events':{'action':_0x4f4910(0x2e9),'description':'操作大事件'},'/api/monthly-progress':{'action':'月度推进计划','description':'操作月度推进计划'},'/api/action-plans':{'action':'行动计划','description':'操作行动计划'},'/api/departments':{'action':'部门管理','description':_0x4f4910(0x148)},'/api/employees':{'action':_0x4f4910(0x12d),'description':_0x4f4910(0x194)},'/api/users':{'action':_0x4f4910(0x125),'description':_0x4f4910(0x104)},'/api/roles':{'action':'角色管理','description':_0x4f4910(0x1fc)},'/api/target-types':{'action':'目标类型','description':_0x4f4910(0x19a)},'/api/department-targets':{'action':_0x4f4910(0x2e1),'description':'操作部门目标分解'},'/api/notifications':{'action':'通知管理','description':'操作系统通知'},'/api/system-settings':{'action':'系统设置','description':'操作系统设置'},'/api/company-info':{'action':_0x4f4910(0x1d1),'description':_0x4f4910(0x22d)},'/api/templates':{'action':_0x4f4910(0x2d7),'description':'操作模板'},'/api/admin/backups':{'action':_0x4f4910(0x128),'description':'操作系统备份'},'/api/admin/backup':{'action':_0x4f4910(0x241),'description':_0x4f4910(0x139)},'/api/admin/cleanup-data':{'action':_0x4f4910(0x2a6),'description':'清理系统数据'},'/api/dingtalk/employees':{'action':_0x4f4910(0x242),'description':'获取钉钉员工列表'},'/api/departments/sync-dingtalk':{'action':_0x4f4910(0x2ab),'description':'从钉钉同步部门数据'},'/api/employees/sync-dingtalk':{'action':_0x4f4910(0x2b6),'description':_0x4f4910(0x1c4)},'/api/upload':{'action':_0x4f4910(0x2b8),'description':'上传文件'},'/api/logs':{'action':_0x4f4910(0x1c8),'description':'操作日志记录'}};function extractKeyInfo(_0x16ac40){const _0x37e643=_0x4f4910,_0x4d1ebd={'wAepa':_0x37e643(0x22b),'qETIU':'role','zllbw':function(_0x2f2c82,_0xb362dc){return _0x2f2c82===_0xb362dc;},'ebZse':function(_0x2d8b77,_0x427709){return _0x2d8b77!==_0x427709;}};if(!_0x16ac40||typeof _0x16ac40!=='object')return'';const _0x577c66=['name',_0x4d1ebd['wAepa'],'username',_0x37e643(0x115),_0x4d1ebd[_0x37e643(0x283)],_0x37e643(0x150),'status'],_0x1b4580=[];for(const _0x12e398 of _0x577c66){_0x16ac40[_0x12e398]&&_0x4d1ebd['zllbw'](typeof _0x16ac40[_0x12e398],'string')&&_0x4d1ebd['ebZse'](_0x16ac40[_0x12e398][_0x37e643(0x15e)](),'')&&_0x1b4580['push'](_0x12e398+':\x20'+_0x16ac40[_0x12e398]);}return _0x1b4580['length']>0x0?'\x20('+_0x1b4580['join'](',\x20')+')':'';}function appendAuditLog(_0x28a6d7){const _0x5328da=_0x4f4910,_0xdf9f9a={'OpHGU':function(_0x2ee8e4,_0x2841f7){return _0x2ee8e4!==_0x2841f7;},'JSnPG':function(_0x187169,_0x2029c7){return _0x187169(_0x2029c7);},'LcnnX':'未知操作','TNLUL':'GET','VWsyE':_0x5328da(0x24f),'aCUdw':_0x5328da(0x25e),'XLPVg':function(_0x2992a0,_0x43b291){return _0x2992a0===_0x43b291;},'vjIzq':_0x5328da(0x2d4)};try{if(_0xdf9f9a[_0x5328da(0xf7)](_0x5328da(0x101),_0x5328da(0x101)))_0x98f53b([]),_0x1874e0[_0x5328da(0x267)]({'success':!![]});else{if(!shouldWriteAuditLog())return;let _0x3a8271=_0x28a6d7['body'];_0x3a8271&&typeof _0x3a8271==='object'&&(_0x3a8271=maskSensitive(_0x3a8271));const _0x209569=loadAuditLogs(),_0x5afd94=_0xdf9f9a[_0x5328da(0x20e)](getNextId,_0x209569),_0x2ad8cf=new Date()['toISOString']();let _0x521137=_0x28a6d7['details'];if(!_0x521137){const _0x540712=(_0x28a6d7['method']||'')[_0x5328da(0x27e)](),_0x45d8bd=_0x28a6d7[_0x5328da(0x234)]||'';let _0x1f8839=_0xdf9f9a['LcnnX'];for(const [_0x5f1b3c,_0x943826]of Object['entries'](API_PATH_MAPPING)){if(_0x45d8bd[_0x5328da(0x23d)](_0x5f1b3c)){_0x1f8839=_0x943826[_0x5328da(0x28c)];break;}}let _0xb9d21c='';switch(_0x540712){case _0xdf9f9a[_0x5328da(0x2e5)]:_0xb9d21c='查看';break;case'POST':_0xb9d21c='创建';break;case _0xdf9f9a[_0x5328da(0xf5)]:case _0xdf9f9a[_0x5328da(0x255)]:_0xb9d21c='更新';break;case _0x5328da(0x1a6):_0xb9d21c='删除';break;default:_0xb9d21c='操作';}let _0x5467b2='';try{const _0x2653f4=_0xdf9f9a[_0x5328da(0x2b0)](typeof _0x3a8271,_0xdf9f9a['vjIzq'])?JSON['parse'](_0x3a8271):_0x3a8271;_0x5467b2=extractKeyInfo(_0x2653f4);}catch(_0x4a58f9){}_0x521137=''+_0xb9d21c+_0x1f8839+_0x5467b2;}const _0x4d007d={'id':_0x5afd94,'created_at':_0x28a6d7[_0x5328da(0x189)]||_0x2ad8cf,'username':_0x28a6d7['username']||'系统','role':_0x28a6d7[_0x5328da(0x13b)]||'','method':_0x28a6d7['method']||'','path':_0x28a6d7['path']||'','status':_0x28a6d7['status']??0xc8,'duration_ms':_0x28a6d7[_0x5328da(0xe2)]??0x0,'ip':_0x28a6d7['ip']||'','ua':_0x28a6d7['ua']||'','query':_0x28a6d7[_0x5328da(0x287)]?_0xdf9f9a['XLPVg'](typeof _0x28a6d7[_0x5328da(0x287)],_0x5328da(0x2d4))?_0x28a6d7[_0x5328da(0x287)]:JSON['stringify'](_0x28a6d7[_0x5328da(0x287)]):'{}','body':_0x3a8271?_0xdf9f9a[_0x5328da(0x2b0)](typeof _0x3a8271,'string')?_0x3a8271:JSON['stringify'](_0x3a8271):'','details':_0x521137};_0x28a6d7[_0x5328da(0x2e4)]&&(_0x4d007d['action_type']=_0x28a6d7[_0x5328da(0x2e4)]),_0x28a6d7[_0x5328da(0x10f)]&&(_0x4d007d[_0x5328da(0x10f)]=_0x28a6d7['ip_address']),_0x209569['unshift'](_0x4d007d),saveAuditLogs(_0x209569);}}catch(_0x4ca814){}}function loadDingTalkConfigFromFile(){const _0x33bb90=_0x4f4910,_0xfaeaa2={'QdCzT':'utf-8','Hhsve':'object'};try{const _0x200e2c=_0x472215['join'](__dirname,_0x33bb90(0xfb));if(!_0x401516['existsSync'](_0x200e2c))return{};const _0x5f0995=_0x401516[_0x33bb90(0x1ac)](_0x200e2c,_0xfaeaa2['QdCzT']),_0x35c3bf=JSON[_0x33bb90(0x120)](_0x5f0995);return _0x35c3bf&&typeof _0x35c3bf===_0xfaeaa2['Hhsve']?_0x35c3bf:{};}catch(_0x5fb9d9){return{};}}function getDingTalkConfig(){const _0x3d7a17=_0x4f4910,_0x1f339c={'FZqty':function(_0xd6037d){return _0xd6037d();},'ARgwV':function(_0x5a3ca7){return _0x5a3ca7();},'IIDbW':function(_0x4441d5,_0x26bb76){return _0x4441d5!==_0x26bb76;},'mfavK':function(_0x64db42,_0x25a2e1){return _0x64db42===_0x25a2e1;},'XvydK':_0x3d7a17(0x2d4)},_0x122a12=_0x1f339c[_0x3d7a17(0x2da)](loadDingTalkConfigFromFile),_0x2d1184=_0x1f339c['ARgwV'](loadSystemSettings),_0x203d3f=Array['isArray'](_0x2d1184)?_0x2d1184[_0x3d7a17(0x2c4)](_0x17b285=>_0x17b285&&_0x17b285['key']===_0x3d7a17(0x2dc)):null;let _0x3fb631={};if(_0x203d3f&&_0x203d3f[_0x3d7a17(0x1a5)]){if(_0x1f339c[_0x3d7a17(0x2a3)](_0x3d7a17(0x1ec),'lwQcM'))try{_0x3fb631=_0x1f339c['mfavK'](typeof _0x203d3f[_0x3d7a17(0x1a5)],_0x1f339c[_0x3d7a17(0x107)])?JSON['parse'](_0x203d3f['value']):_0x203d3f[_0x3d7a17(0x1a5)]||{};}catch(_0x36369a){_0x3fb631={};}else{const _0x4fc725=_0xa6d7f4[_0x3d7a17(0x115)]||_0x3b1d93['department_name']||'';return _0x4fc725===_0x55c141;}}const _0x455725=String(_0x3fb631[_0x3d7a17(0xda)]||process[_0x3d7a17(0x130)]['DINGTALK_APP_KEY']||_0x122a12[_0x3d7a17(0x291)]||'')[_0x3d7a17(0x15e)](),_0x2eed96=String(_0x3fb631[_0x3d7a17(0x2d6)]||process[_0x3d7a17(0x130)][_0x3d7a17(0x269)]||_0x122a12['appSecret']||'')['trim'](),_0x2a3d07=_0x3fb631['dingtalkRootDeptId']||process[_0x3d7a17(0x130)]['DINGTALK_ROOT_DEPT_ID']||_0x122a12['rootDeptId']||0x1,_0x462d62=_0x3fb631[_0x3d7a17(0xe1)]||process[_0x3d7a17(0x130)][_0x3d7a17(0x157)]||_0x122a12['defaultDeptId']||_0x2a3d07||0x1;return{'appKey':_0x455725,'appSecret':_0x2eed96,'rootDeptId':Number(_0x2a3d07)||0x1,'defaultDeptId':Number(_0x462d62)||0x1};}async function getDingTalkAccessToken(){const _0x18625b=_0x4f4910,_0x2bcad8={'tWETc':'删除备份失败','bgenp':function(_0x560d53,_0x295c64){return _0x560d53===_0x295c64;},'DaNIE':_0x18625b(0x1a1)},_0x116c13=getDingTalkConfig();if(!_0x116c13['appKey']||!_0x116c13['appSecret']){if(_0x2bcad8['bgenp']('Bidwz',_0x18625b(0x212)))_0x3b68be['status'](0x1f4)['json']({'error':_0x2bcad8[_0x18625b(0x153)]});else throw new Error(_0x18625b(0x217));}const _0x42ade8=_0x2bcad8[_0x18625b(0xe0)],_0x2c12f0=await _0x4d7aa1['get'](_0x42ade8,{'params':{'appkey':_0x116c13[_0x18625b(0x291)],'appsecret':_0x116c13['appSecret']}}),_0x579dcf=_0x2c12f0['data']||{};if(_0x579dcf['errcode']!==0x0)throw new Error(_0x579dcf['errmsg']||'获取钉钉access_token失败');return{'accessToken':_0x579dcf['access_token'],'config':_0x116c13};}async function fetchDingTalkDepartments(_0xf9830,_0x40129f){const _0x47125c=_0x4f4910,_0x59b180='https://oapi.dingtalk.com/department/list',_0x31e6b3=await _0x4d7aa1[_0x47125c(0x1ae)](_0x59b180,{'params':{'access_token':_0xf9830,'id':_0x40129f,'fetch_child':!![]}}),_0x3195af=_0x31e6b3[_0x47125c(0x1bc)]||{};if(_0x3195af['errcode']!==0x0){if(_0x47125c(0x29f)!=='SzBPl')throw new Error(_0x3195af[_0x47125c(0x1d4)]||'获取钉钉部门列表失败');else return null;}const _0x3a2ba6=Array['isArray'](_0x3195af[_0x47125c(0x115)])?_0x3195af[_0x47125c(0x115)]:[];return _0x3a2ba6;}async function fetchDingTalkEmployees(_0x15898b,_0x56f4ed){const _0x3ed709=_0x4f4910,_0x467ca5={'fXuPc':_0x3ed709(0x21a),'sDJRW':_0x3ed709(0x219)},_0xb7252c='https://oapi.dingtalk.com/user/list',_0xcb11dd=[],_0x2732b3=Array['isArray'](_0x56f4ed)?_0x56f4ed:[];for(const _0x389582 of _0x2732b3){const _0x4b405d=_0x389582&&typeof _0x389582['id']!==_0x3ed709(0x16e)?_0x389582['id']:null;if(!_0x4b405d)continue;const _0x177202=await _0x4d7aa1[_0x3ed709(0x1ae)](_0xb7252c,{'params':{'access_token':_0x15898b,'department_id':_0x4b405d,'offset':0x0,'size':0x64}}),_0x3f6c27=_0x177202[_0x3ed709(0x1bc)]||{};if(_0x3f6c27['errcode']!==0x0)continue;const _0x3234e1=Array['isArray'](_0x3f6c27['userlist'])?_0x3f6c27['userlist']:[];for(const _0x55df9f of _0x3234e1){if(_0x467ca5[_0x3ed709(0x12c)]!==_0x467ca5[_0x3ed709(0x18e)])_0xcb11dd['push'](_0x55df9f);else{const _0x408fe=_0x33be9e[_0x3ed709(0x2c4)](_0xdb1c7=>_0xdb1c7['id']===_0x46b8d1['department_id']);_0x408fe&&_0x408fe['name']&&(_0x363641=_0x408fe[_0x3ed709(0x19b)]);}}}return _0xcb11dd;}async function listBackupFiles(){const _0x26b016=_0x4f4910,_0x1ef860={'GWsBF':function(_0x239a53,_0x59f991){return _0x239a53===_0x59f991;}};try{const _0x432726=await _0x3aa014['readdir'](BACKUP_DIR),_0xfd6fbf=_0x432726['filter'](_0xcff1be=>_0xcff1be[_0x26b016(0x1b5)]()[_0x26b016(0x27b)]('.json')),_0x5345de=[];for(const _0x36416a of _0xfd6fbf){if(_0x1ef860['GWsBF'](_0x26b016(0x1e9),'zZBwv'))_0x3227d1(_0x321937['departments']);else{const _0x40b792=_0x472215[_0x26b016(0x142)](BACKUP_DIR,_0x36416a),_0x5e4c47=await _0x3aa014[_0x26b016(0x209)](_0x40b792);_0x5345de[_0x26b016(0x1dd)]({'name':_0x36416a,'size':_0x5e4c47[_0x26b016(0x19d)],'createdAt':_0x5e4c47['mtime'][_0x26b016(0x2a2)](),'url':'/backups/'+encodeURIComponent(_0x36416a)});}}return _0x5345de[_0x26b016(0x1a3)]((_0x314184,_0xe4d7e8)=>_0x314184['createdAt']<_0xe4d7e8['createdAt']?0x1:-0x1),_0x5345de;}catch(_0x12ab64){return[];}}function applyBackupSnapshot(_0x31fa6e){const _0x5e7689=_0x4f4910,_0x345351={'jIGji':function(_0x1bc659,_0x13dd78){return _0x1bc659!==_0x13dd78;},'oGlrr':function(_0x15d3f2,_0x45fb8c){return _0x15d3f2(_0x45fb8c);},'bwSNz':function(_0xf55e7e,_0x480009){return _0xf55e7e===_0x480009;},'nZxTb':function(_0x3e20f4,_0x326bb9){return _0x3e20f4(_0x326bb9);}};if(!_0x31fa6e||_0x345351[_0x5e7689(0x21e)](typeof _0x31fa6e,_0x5e7689(0x17d)))return;Array[_0x5e7689(0x1ad)](_0x31fa6e[_0x5e7689(0x118)])&&(mockData[_0x5e7689(0x118)]=_0x31fa6e[_0x5e7689(0x118)],saveAnnualWorkPlans(_0x31fa6e['annual_work_plans']));Array['isArray'](_0x31fa6e['major_events'])&&(mockData[_0x5e7689(0x245)]=_0x31fa6e[_0x5e7689(0x245)],saveMajorEvents(_0x31fa6e['major_events']));Array[_0x5e7689(0x1ad)](_0x31fa6e[_0x5e7689(0x295)])&&(mockData['monthly_progress']=_0x31fa6e[_0x5e7689(0x295)],saveMonthlyProgress(_0x31fa6e[_0x5e7689(0x295)]));Array[_0x5e7689(0x1ad)](_0x31fa6e['action_plans'])&&(mockData['action_plans']=_0x31fa6e['action_plans'],saveActionPlans(_0x31fa6e[_0x5e7689(0x198)]));Array[_0x5e7689(0x1ad)](_0x31fa6e[_0x5e7689(0x21f)])&&saveDepartmentsStore(_0x31fa6e[_0x5e7689(0x21f)]);Array[_0x5e7689(0x1ad)](_0x31fa6e['employees'])&&_0x345351['oGlrr'](saveEmployeesStore,_0x31fa6e[_0x5e7689(0x2c5)]);Array[_0x5e7689(0x1ad)](_0x31fa6e['notifications'])&&_0x345351['oGlrr'](saveNotificationsStore,_0x31fa6e[_0x5e7689(0x208)]);Array[_0x5e7689(0x1ad)](_0x31fa6e[_0x5e7689(0x13f)])&&_0x345351[_0x5e7689(0xfd)](saveUsersStore,_0x31fa6e[_0x5e7689(0x13f)]);Array[_0x5e7689(0x1ad)](_0x31fa6e[_0x5e7689(0x21d)])&&saveTargetTypesStore(_0x31fa6e['target_types']);Array[_0x5e7689(0x1ad)](_0x31fa6e['templates'])&&saveTemplatesStore(_0x31fa6e['templates']);Array[_0x5e7689(0x1ad)](_0x31fa6e[_0x5e7689(0x174)])&&saveDepartmentTargets(_0x31fa6e[_0x5e7689(0x174)]);if(Array['isArray'](_0x31fa6e['system_settings'])){if(_0x345351['bwSNz']('KrshY',_0x5e7689(0xd7)))try{const _0x3f5235=_0xe2cc5d['dirname'](_0xbb6a9c);!_0x83e242['existsSync'](_0x3f5235)&&_0xfc461d['mkdirSync'](_0x3f5235,{'recursive':!![]}),_0x4fd566[_0x5e7689(0x271)](_0x1c0d10,_0x385e1d['stringify'](_0x5e5ef7,null,0x2),_0x5e7689(0x244));}catch(_0x4d7a71){}else _0x345351['nZxTb'](saveSystemSettings,_0x31fa6e['system_settings']);}Array[_0x5e7689(0x1ad)](_0x31fa6e[_0x5e7689(0xe3)])&&_0x345351['oGlrr'](saveAuditLogs,_0x31fa6e[_0x5e7689(0xe3)]),_0x31fa6e[_0x5e7689(0x1d9)]&&typeof _0x31fa6e['company_info']==='object'&&_0x345351[_0x5e7689(0x218)](saveCompanyInfoStore,_0x31fa6e[_0x5e7689(0x1d9)]);}app['get']('/api/annual-work-plans',(_0x2f4322,_0x270627)=>{const _0x56fad4=_0x4f4910,_0x31d481={'BvTBF':function(_0x5ba356,_0x4d2692){return _0x5ba356(_0x4d2692);},'HjXKd':function(_0x5a497f,_0x4a4d5d){return _0x5a497f(_0x4a4d5d);},'BZuck':function(_0x441983,_0x1b588a,_0x3db8e9){return _0x441983(_0x1b588a,_0x3db8e9);}},{year:_0x535219,department:_0x75622,category:_0x51b927,status:_0x34de1f,month:_0x52b3f9,priority:_0x1b2db7}=_0x2f4322['query'],_0x24119a=loadAnnualWorkPlans();let _0x2002b4=Array[_0x56fad4(0x1ad)](_0x24119a)?[..._0x24119a]:[];if(_0x535219){const _0x3cb830=_0x31d481['BZuck'](parseInt,_0x535219,0xa);!Number['isNaN'](_0x3cb830)&&(_0x2002b4=_0x2002b4[_0x56fad4(0x16f)](_0x1daffd=>Number(_0x1daffd[_0x56fad4(0x150)])===_0x3cb830));}_0x75622&&(_0x2002b4=_0x2002b4['filter'](_0x11f6fb=>{const _0x220928=_0x56fad4,_0x20c46e=_0x11f6fb['department']||_0x11f6fb[_0x220928(0x121)]||'';return _0x20c46e===_0x75622;}));_0x51b927&&(_0x2002b4=_0x2002b4['filter'](_0x40ee37=>_0x40ee37[_0x56fad4(0xd6)]===_0x51b927));_0x34de1f&&(_0x2002b4=_0x2002b4[_0x56fad4(0x16f)](_0x24f378=>_0x24f378[_0x56fad4(0x17b)]===_0x34de1f));if(_0x52b3f9){const _0x35465b=parseInt(_0x52b3f9,0xa);!Number[_0x56fad4(0x1be)](_0x35465b)&&(_0x2002b4=_0x2002b4[_0x56fad4(0x16f)](_0x425d38=>{const _0x3241e3=_0x56fad4,_0x13a3ee=_0x425d38['start_date']?new Date(_0x425d38['start_date']):null,_0x554120=_0x425d38[_0x3241e3(0x2c2)]?new Date(_0x425d38['end_date']):null;if(_0x13a3ee&&!_0x31d481['BvTBF'](isNaN,_0x13a3ee)&&_0x13a3ee['getMonth']()+0x1===_0x35465b)return!![];if(_0x554120&&!isNaN(_0x554120)&&_0x554120['getMonth']()+0x1===_0x35465b)return!![];if(_0x31d481['HjXKd'](Number,_0x425d38[_0x3241e3(0x10a)])===_0x35465b)return!![];return![];}));}_0x1b2db7&&(_0x2002b4=_0x2002b4['filter'](_0x30f438=>_0x30f438['priority']===_0x1b2db7)),_0x270627['json'](_0x2002b4);}),app[_0x4f4910(0x1d3)](_0x4f4910(0x113),(_0x34faf7,_0x7eacab)=>{const _0x34c1d4=_0x4f4910,_0xf59126={'RMQCq':'Target\x20type\x20not\x20found','LDTtU':function(_0x3204f5,_0x4609b1){return _0x3204f5(_0x4609b1);},'WyRhd':function(_0x25104a,_0xe621a6){return _0x25104a!==_0xe621a6;},'hrvDM':'保存年度工作落地规划失败'};try{const _0x288261=_0x34faf7[_0x34c1d4(0x1e1)]||{},_0xd55675=loadAnnualWorkPlans(),_0x1efba2=getNextId(_0xd55675),_0x54fff9=new Date()[_0x34c1d4(0x2a2)](),_0x42e2a9={'id':_0x1efba2,'created_at':_0x54fff9,..._0x288261};if(_0x288261['year']!==undefined&&_0xf59126['WyRhd'](_0x288261['year'],null)){const _0x2112b9=parseInt(_0x288261[_0x34c1d4(0x150)],0xa);if(!Number[_0x34c1d4(0x1be)](_0x2112b9)){if('nLOvM'!=='nLOvM'){const _0x2a02ca=_0x537b71(_0x1a4eae['params']['id'],0xa),_0x2b54fd=_0x2ed762(),_0x92b3a8=_0x2b54fd[_0x34c1d4(0x112)](_0xd3fd2c=>_0xd3fd2c['id']===_0x2a02ca);if(_0x92b3a8===-0x1){_0x560a88[_0x34c1d4(0x17b)](0x194)[_0x34c1d4(0x267)]({'error':_0xf59126['RMQCq']});return;}const _0x23aa81=_0x394c57[_0x34c1d4(0x1e1)]||{};_0x2b54fd[_0x92b3a8]={..._0x2b54fd[_0x92b3a8],..._0x23aa81},_0xf59126['LDTtU'](_0x2445b0,_0x2b54fd),_0x57f437['json'](_0x2b54fd[_0x92b3a8]);}else _0x42e2a9['year']=_0x2112b9;}}_0xd55675[_0x34c1d4(0x1dd)](_0x42e2a9),saveAnnualWorkPlans(_0xd55675),_0x7eacab[_0x34c1d4(0x267)](_0x42e2a9);}catch(_0x98f559){_0x7eacab['status'](0x1f4)['json']({'error':_0xf59126[_0x34c1d4(0x167)]});}}),app[_0x4f4910(0x261)]('/api/annual-work-plans/:id',(_0x58bc1c,_0x4f0e99)=>{const _0x25480e=_0x4f4910,_0x2dcb98={'nxIYS':function(_0x2c5de2,_0x2c85f7,_0x22632f){return _0x2c5de2(_0x2c85f7,_0x22632f);},'COCKx':function(_0x79db07){return _0x79db07();},'jYYIC':function(_0x1be415,_0x1f2e12){return _0x1be415!==_0x1f2e12;},'hizQY':'sxyqX','dRtdg':function(_0x300d70,_0x8b0b88){return _0x300d70(_0x8b0b88);}};try{const _0x2007b2=_0x2dcb98[_0x25480e(0x29c)](parseInt,_0x58bc1c[_0x25480e(0x26a)]['id'],0xa),_0x1ff558=_0x58bc1c['body']||{},_0x2d87fb=_0x2dcb98['COCKx'](loadAnnualWorkPlans),_0x158a71=_0x2d87fb['findIndex'](_0x26cfe1=>_0x26cfe1['id']===_0x2007b2);if(_0x158a71===-0x1){_0x4f0e99[_0x25480e(0x17b)](0x194)['json']({'error':'年度工作落地规划记录不存在'});return;}const _0x5d6882={..._0x2d87fb[_0x158a71],..._0x1ff558};if(_0x1ff558['year']!==undefined&&_0x2dcb98['jYYIC'](_0x1ff558[_0x25480e(0x150)],null)){const _0x541972=parseInt(_0x1ff558[_0x25480e(0x150)],0xa);!Number['isNaN'](_0x541972)&&(_0x25480e(0x235)===_0x2dcb98[_0x25480e(0x254)]?_0x5d6882['year']=_0x541972:_0x50d9a7(_0x36148a[_0x25480e(0x165)]));}_0x2d87fb[_0x158a71]=_0x5d6882,_0x2dcb98[_0x25480e(0xea)](saveAnnualWorkPlans,_0x2d87fb),_0x4f0e99['json'](_0x5d6882);}catch(_0x5a1145){_0x4f0e99[_0x25480e(0x17b)](0x1f4)['json']({'error':'更新年度工作落地规划失败'});}}),app[_0x4f4910(0x1dc)]('/api/annual-work-plans/:id',(_0x41885b,_0x22140e)=>{const _0x3e684d=_0x4f4910,_0x4a4368={'HxqBS':function(_0x57a0bf,_0x239216){return _0x57a0bf!==_0x239216;},'LbRbu':_0x3e684d(0x1db),'iqVXj':_0x3e684d(0x1fb)};try{const _0x5bb357=parseInt(_0x41885b['params']['id'],0xa),_0x18d522=loadAnnualWorkPlans(),_0x12dff6=_0x18d522['filter'](_0x533322=>_0x533322['id']!==_0x5bb357),_0x4fc8d1=_0x12dff6['length']!==_0x18d522[_0x3e684d(0x2c1)];if(!_0x4fc8d1){if(_0x4a4368[_0x3e684d(0x199)](_0x4a4368['LbRbu'],_0x4a4368['LbRbu']))_0x35cfa1={'msgtype':_0x498f4b,..._0x36284a};else{_0x22140e['status'](0x194)['json']({'success':![],'error':_0x4a4368['iqVXj']});return;}}saveAnnualWorkPlans(_0x12dff6),_0x22140e[_0x3e684d(0x267)]({'success':!![]});}catch(_0x37c2b7){_0x22140e[_0x3e684d(0x17b)](0x1f4)['json']({'success':![],'error':_0x3e684d(0x1fa)});}}),app['get'](_0x4f4910(0xe9),(_0x54a088,_0x1fdf51)=>{const _0x1c1192=loadTargetTypesStore();_0x1fdf51['json'](_0x1c1192);}),app[_0x4f4910(0x1d3)](_0x4f4910(0xe9),(_0x22eb09,_0x42d3cf)=>{const _0x28a9e3=_0x4f4910,_0x7c7fe8={'HjwIc':function(_0x3d4735){return _0x3d4735();},'hGYHe':function(_0x2f2ae4,_0x11d574){return _0x2f2ae4(_0x11d574);}},_0x157748=new Date()[_0x28a9e3(0x2a2)](),_0x168609=_0x22eb09[_0x28a9e3(0x1e1)]||{},_0x2b91e3=_0x7c7fe8['HjwIc'](loadTargetTypesStore),_0x3dddc8=getNextId(_0x2b91e3),_0x820722={'id':_0x3dddc8,'createdAt':_0x157748,'isActive':_0x168609['isActive']!==undefined?!!_0x168609['isActive']:!![],..._0x168609};_0x2b91e3[_0x28a9e3(0x1dd)](_0x820722),_0x7c7fe8['hGYHe'](saveTargetTypesStore,_0x2b91e3),_0x42d3cf['json'](_0x820722);}),app[_0x4f4910(0x261)](_0x4f4910(0x171),(_0x21c559,_0x19ca42)=>{const _0x39059f=_0x4f4910,_0x367d25={'uegGw':_0x39059f(0x1b6)},_0x6cbff7=parseInt(_0x21c559['params']['id'],0xa),_0x46e6cd=loadTargetTypesStore(),_0x1881b6=_0x46e6cd['findIndex'](_0x2766b7=>_0x2766b7['id']===_0x6cbff7);if(_0x1881b6===-0x1){_0x19ca42[_0x39059f(0x17b)](0x194)['json']({'error':_0x367d25[_0x39059f(0x169)]});return;}const _0x10f29a=_0x21c559[_0x39059f(0x1e1)]||{};_0x46e6cd[_0x1881b6]={..._0x46e6cd[_0x1881b6],..._0x10f29a},saveTargetTypesStore(_0x46e6cd),_0x19ca42['json'](_0x46e6cd[_0x1881b6]);}),app[_0x4f4910(0x1dc)](_0x4f4910(0x171),(_0x3c1aca,_0x465d2f)=>{const _0x39d3e1=_0x4f4910,_0x1b3532={'mtEHL':function(_0x19b0cb,_0x288fb1,_0x215145){return _0x19b0cb(_0x288fb1,_0x215145);},'cInda':function(_0x2a4c5d){return _0x2a4c5d();},'QhnIL':function(_0x5c1ed9,_0x4c3c12){return _0x5c1ed9===_0x4c3c12;},'GKyoQ':'vbgsw','affUg':'uaNYY','RSgFH':'Target\x20type\x20not\x20found'},_0xfc5c7a=_0x1b3532[_0x39d3e1(0xf9)](parseInt,_0x3c1aca[_0x39d3e1(0x26a)]['id'],0xa),_0x885048=_0x1b3532['cInda'](loadTargetTypesStore),_0x33f01e=_0x885048[_0x39d3e1(0x16f)](_0x5539dc=>_0x5539dc['id']!==_0xfc5c7a),_0x55e855=_0x33f01e[_0x39d3e1(0x2c1)]!==_0x885048[_0x39d3e1(0x2c1)];if(_0x55e855){if(_0x1b3532[_0x39d3e1(0x1e3)]('bWdua',_0x39d3e1(0x28b)))saveTargetTypesStore(_0x33f01e);else{const _0x4c7527=_0x10d196[_0x39d3e1(0x2c4)](_0x5d1da3=>_0x5d1da3['id']===_0x2aa5a2[_0x39d3e1(0x1c2)]);_0x4c7527&&_0x4c7527[_0x39d3e1(0x19b)]&&(_0x569297=_0x4c7527['name']);}}if(!_0x55e855){if(_0x1b3532['GKyoQ']!==_0x1b3532[_0x39d3e1(0x229)]){_0x465d2f['status'](0x194)[_0x39d3e1(0x267)]({'error':_0x1b3532['RSgFH']});return;}else _0x5562c1=_0xd329aa['filter'](_0x59b3d0=>_0x59b3d0['target_level']===_0x1aeba3);}_0x465d2f['json']({'success':!![]});}),app['get'](_0x4f4910(0x168),(_0x282069,_0x4983c2)=>{const _0x2f4951=_0x4f4910,_0x525e9d={'UfOYz':function(_0x20fb36){return _0x20fb36();}},{year:_0x26cb9c,month:_0x26b80d,event_type:_0x1042bc,importance:_0x584af5,status:_0xfd480f,responsible_department:_0x3ff933}=_0x282069['query'],_0x1de7a0=_0x525e9d['UfOYz'](loadMajorEvents);let _0x4f2fa9=Array[_0x2f4951(0x1ad)](_0x1de7a0)?[..._0x1de7a0]:[];if(_0x26cb9c){const _0x5a0f5d=parseInt(_0x26cb9c,0xa);!Number['isNaN'](_0x5a0f5d)&&(_0x4f2fa9=_0x4f2fa9['filter'](_0x504fc9=>Number(_0x504fc9[_0x2f4951(0x150)])===_0x5a0f5d));}if(_0x26b80d){const _0x5e4388=String(_0x26b80d)[_0x2f4951(0x263)](0x2,'0');_0x4f2fa9=_0x4f2fa9['filter'](_0x35df58=>{const _0x1be8e0=_0x2f4951,_0x4509b8=_0x35df58[_0x1be8e0(0x1b2)]||'',_0x486b1a=_0x35df58[_0x1be8e0(0x1cf)]||'';return _0x4509b8[_0x1be8e0(0x274)]('-'+_0x5e4388+'-')||_0x486b1a['includes']('-'+_0x5e4388+'-');});}_0x1042bc&&(_0x4f2fa9=_0x4f2fa9[_0x2f4951(0x16f)](_0x1d70b0=>_0x1d70b0['event_type']===_0x1042bc)),_0x584af5&&(_0x4f2fa9=_0x4f2fa9[_0x2f4951(0x16f)](_0x205fb9=>_0x205fb9['importance']===_0x584af5)),_0xfd480f&&(_0x4f2fa9=_0x4f2fa9['filter'](_0x3b6dab=>_0x3b6dab[_0x2f4951(0x17b)]===_0xfd480f)),_0x3ff933&&(_0x4f2fa9=_0x4f2fa9['filter'](_0x3c2289=>{const _0x2eb9ad=_0x2f4951,_0x2f64e9=_0x3c2289[_0x2eb9ad(0x100)]||_0x3c2289[_0x2eb9ad(0x121)]||_0x3c2289[_0x2eb9ad(0x115)]||'';return _0x2f64e9===_0x3ff933;})),_0x4983c2[_0x2f4951(0x267)](_0x4f2fa9);}),app[_0x4f4910(0x1d3)]('/api/major-events',(_0x5af539,_0x59f997)=>{const _0x5b76c7=_0x4f4910,_0x9b3629={'UUNJV':function(_0xd14e71){return _0xd14e71();},'rpKWD':function(_0x54ca71,_0x25161c){return _0x54ca71(_0x25161c);},'RxroM':function(_0x3f5f0e,_0x59f8b8,_0x1a306c){return _0x3f5f0e(_0x59f8b8,_0x1a306c);}};try{const _0x5bb9f8=_0x5af539['body']||{},_0x180911=_0x9b3629[_0x5b76c7(0x286)](loadMajorEvents),_0x19842f=_0x9b3629[_0x5b76c7(0x1ab)](getNextId,_0x180911),_0x2715ab=new Date()['toISOString'](),_0x19b747={'id':_0x19842f,'created_at':_0x2715ab,..._0x5bb9f8};if(_0x5bb9f8['year']!==undefined&&_0x5bb9f8['year']!==null){const _0x802025=_0x9b3629['RxroM'](parseInt,_0x5bb9f8[_0x5b76c7(0x150)],0xa);!Number['isNaN'](_0x802025)&&(_0x19b747[_0x5b76c7(0x150)]=_0x802025);}_0x180911[_0x5b76c7(0x1dd)](_0x19b747),saveMajorEvents(_0x180911),_0x59f997[_0x5b76c7(0x267)](_0x19b747);}catch(_0x2fa08c){_0x59f997[_0x5b76c7(0x17b)](0x1f4)[_0x5b76c7(0x267)]({'error':'保存大事件数据失败'});}}),app[_0x4f4910(0x261)]('/api/major-events/:id',(_0x8909b4,_0x175e2b)=>{const _0x378d55=_0x4f4910,_0x349b38={'ZNITU':function(_0x5e8914,_0x33f7e5){return _0x5e8914!==_0x33f7e5;},'IgGRq':function(_0x356eb0,_0x24974a){return _0x356eb0(_0x24974a);},'JdeLN':'更新大事件数据失败'};try{const _0x19b566=parseInt(_0x8909b4[_0x378d55(0x26a)]['id'],0xa),_0x4f39fc=_0x8909b4[_0x378d55(0x1e1)]||{},_0x2b272d=loadMajorEvents(),_0x13a6dc=_0x2b272d['findIndex'](_0xf55899=>_0xf55899['id']===_0x19b566);if(_0x13a6dc===-0x1){_0x175e2b[_0x378d55(0x17b)](0x194)[_0x378d55(0x267)]({'error':_0x378d55(0x2cf)});return;}const _0x48dd06={..._0x2b272d[_0x13a6dc],..._0x4f39fc};if(_0x4f39fc['year']!==undefined&&_0x349b38[_0x378d55(0xeb)](_0x4f39fc[_0x378d55(0x150)],null)){const _0x395f9b=parseInt(_0x4f39fc[_0x378d55(0x150)],0xa);!Number['isNaN'](_0x395f9b)&&(_0x48dd06['year']=_0x395f9b);}_0x2b272d[_0x13a6dc]=_0x48dd06,_0x349b38['IgGRq'](saveMajorEvents,_0x2b272d),_0x175e2b['json'](_0x48dd06);}catch(_0xe83ac9){_0x175e2b[_0x378d55(0x17b)](0x1f4)['json']({'error':_0x349b38[_0x378d55(0x1d2)]});}}),app[_0x4f4910(0x1dc)]('/api/major-events/:id',(_0x50c63b,_0x1b29a6)=>{const _0x4093c8=_0x4f4910,_0x54487f={'rkZgv':function(_0x4e97a8,_0x17e293,_0x10d6bc){return _0x4e97a8(_0x17e293,_0x10d6bc);},'QyUMA':function(_0x3b1f78,_0x581352){return _0x3b1f78!==_0x581352;},'vCJgD':_0x4093c8(0x19e)};try{const _0x25a301=_0x54487f['rkZgv'](parseInt,_0x50c63b[_0x4093c8(0x26a)]['id'],0xa),_0x5b5595=loadMajorEvents(),_0x5e624c=_0x5b5595['filter'](_0x48bae3=>_0x48bae3['id']!==_0x25a301),_0x15b59b=_0x54487f['QyUMA'](_0x5e624c[_0x4093c8(0x2c1)],_0x5b5595['length']);if(!_0x15b59b){_0x1b29a6['status'](0x194)[_0x4093c8(0x267)]({'success':![],'error':_0x4093c8(0x2cf)});return;}saveMajorEvents(_0x5e624c),_0x1b29a6['json']({'success':!![]});}catch(_0x227b5d){_0x1b29a6['status'](0x1f4)['json']({'success':![],'error':_0x54487f['vCJgD']});}}),app['get']('/api/monthly-progress',(_0x3d1961,_0x5b9fb1)=>{const _0x121bea=_0x4f4910,_0x7dfa6a={'DHBsG':function(_0xe9f524){return _0xe9f524();},'QSkNX':function(_0x430b81,_0x21dba6,_0x2c7990){return _0x430b81(_0x21dba6,_0x2c7990);}},{year:_0x4667b0,month:_0x59449e,department:_0x330884,status:_0x53a879}=_0x3d1961['query'],_0x222ac2=_0x7dfa6a['DHBsG'](loadMonthlyProgress);let _0x1b2054=Array[_0x121bea(0x1ad)](_0x222ac2)?[..._0x222ac2]:[];if(_0x4667b0){const _0x36ba8d=_0x7dfa6a['QSkNX'](parseInt,_0x4667b0,0xa);!Number[_0x121bea(0x1be)](_0x36ba8d)&&(_0x1b2054=_0x1b2054[_0x121bea(0x16f)](_0x555d03=>Number(_0x555d03[_0x121bea(0x150)])===_0x36ba8d));}if(_0x59449e){const _0x427786=_0x7dfa6a['QSkNX'](parseInt,_0x59449e,0xa);!Number['isNaN'](_0x427786)&&(_0x1b2054=_0x1b2054[_0x121bea(0x16f)](_0x16b713=>Number(_0x16b713[_0x121bea(0x10a)])===_0x427786));}_0x330884&&(_0x1b2054=_0x1b2054[_0x121bea(0x16f)](_0x5cfad0=>{const _0x2327a9=_0x121bea;if('DTqDi'===_0x2327a9(0x288)){_0x52d875['status'](0x190)[_0x2327a9(0x267)]({'error':_0x2327a9(0x177)});return;}else{const _0x1cab4a=_0x5cfad0[_0x2327a9(0x115)]||_0x5cfad0['department_name']||'';return _0x1cab4a===_0x330884;}})),_0x53a879&&(_0x1b2054=_0x1b2054[_0x121bea(0x16f)](_0x56ade7=>_0x56ade7[_0x121bea(0x17b)]===_0x53a879)),_0x5b9fb1[_0x121bea(0x267)](_0x1b2054);}),app[_0x4f4910(0x1d3)]('/api/monthly-progress',(_0x60e2ad,_0x248071)=>{const _0x53a194=_0x4f4910,_0x2ca1ab={'XiDNR':function(_0xc56e3c,_0x258934){return _0xc56e3c(_0x258934);},'FCowv':'保存月度推进计划失败'};try{const _0xa66a51=new Date()['toISOString'](),_0x435192=_0x60e2ad['body']||{},_0xd1cc19=loadMonthlyProgress(),_0xb65b6f=_0x2ca1ab[_0x53a194(0x239)](getNextId,_0xd1cc19),_0x44dbce={'id':_0xb65b6f,'created_at':_0xa66a51,..._0x435192};if(_0x435192['year']!==undefined&&_0x435192[_0x53a194(0x150)]!==null){if(_0x53a194(0x132)!==_0x53a194(0x135)){const _0x1570d9=parseInt(_0x435192[_0x53a194(0x150)],0xa);!Number['isNaN'](_0x1570d9)&&(_0x44dbce['year']=_0x1570d9);}else _0x2aeed1['year']=_0x387aaa;}!_0x44dbce['status']&&(_0x44dbce[_0x53a194(0x17b)]='in_progress'),_0xd1cc19['push'](_0x44dbce),saveMonthlyProgress(_0xd1cc19),_0x248071['json'](_0x44dbce);}catch(_0x161f67){_0x248071['status'](0x1f4)[_0x53a194(0x267)]({'error':_0x2ca1ab[_0x53a194(0x26d)]});}}),app['put']('/api/monthly-progress/:id',(_0xbe94d8,_0x46d2e2)=>{const _0x3839d7=_0x4f4910,_0x74ff09={'xkdVP':function(_0x530f07,_0x4ef3fe,_0x1be613){return _0x530f07(_0x4ef3fe,_0x1be613);},'rrkYI':function(_0x92b012,_0x41b08b){return _0x92b012!==_0x41b08b;},'XlbhS':'vumuy','NWxgS':function(_0x1a786d,_0x264815){return _0x1a786d(_0x264815);}};try{const _0xcf51af=_0x74ff09[_0x3839d7(0x240)](parseInt,_0xbe94d8['params']['id'],0xa),_0x3431bc=_0xbe94d8['body']||{},_0x17c083=loadMonthlyProgress(),_0xec21d6=_0x17c083['findIndex'](_0x5f1c8d=>_0x5f1c8d['id']===_0xcf51af);if(_0xec21d6===-0x1){_0x46d2e2['status'](0x194)['json']({'error':'月度推进计划记录不存在'});return;}const _0x4c8ec3={..._0x17c083[_0xec21d6],..._0x3431bc};if(_0x74ff09['rrkYI'](_0x3431bc['year'],undefined)&&_0x74ff09['rrkYI'](_0x3431bc['year'],null)){if(_0x3839d7(0x1b4)===_0x74ff09[_0x3839d7(0x197)]){const _0x515f3c=new _0x4e6f66(_0x55bdc1);!_0x295a24[_0x3839d7(0x1be)](_0x515f3c['getTime']())&&(_0x394bea=_0x378729[_0x3839d7(0x16f)](_0x5b8f37=>{const _0x48142e=new _0x20d749(_0x5b8f37['created_at']);return!_0x1fd7fe['isNaN'](_0x48142e['getTime']())&&_0x48142e>=_0x515f3c;}));}else{const _0x3c86f1=parseInt(_0x3431bc['year'],0xa);!Number['isNaN'](_0x3c86f1)&&(_0x4c8ec3['year']=_0x3c86f1);}}_0x17c083[_0xec21d6]=_0x4c8ec3,_0x74ff09['NWxgS'](saveMonthlyProgress,_0x17c083),_0x46d2e2[_0x3839d7(0x267)](_0x4c8ec3);}catch(_0x2c3dcd){_0x46d2e2['status'](0x1f4)['json']({'error':'更新月度推进计划失败'});}}),app['delete'](_0x4f4910(0x204),(_0x4e1788,_0x4088b7)=>{const _0x50252b=_0x4f4910,_0x556299={'wqdtF':function(_0x2c57e9){return _0x2c57e9();},'UmDhZ':function(_0x5ba53b,_0x16dab8){return _0x5ba53b!==_0x16dab8;},'DxzYv':'月度推进计划记录不存在','JRrnR':function(_0x43bacc,_0x14ee66){return _0x43bacc(_0x14ee66);}};try{const _0x4dc230=parseInt(_0x4e1788['params']['id'],0xa),_0x4c2d50=_0x556299['wqdtF'](loadMonthlyProgress),_0xf64b16=_0x4c2d50[_0x50252b(0x16f)](_0x30db93=>_0x30db93['id']!==_0x4dc230),_0x1fead8=_0x556299[_0x50252b(0xdc)](_0xf64b16[_0x50252b(0x2c1)],_0x4c2d50['length']);if(!_0x1fead8){_0x4088b7[_0x50252b(0x17b)](0x194)[_0x50252b(0x267)]({'success':![],'error':_0x556299[_0x50252b(0x215)]});return;}_0x556299['JRrnR'](saveMonthlyProgress,_0xf64b16),_0x4088b7['json']({'success':!![]});}catch(_0x5a1248){_0x4088b7['status'](0x1f4)[_0x50252b(0x267)]({'success':![],'error':_0x50252b(0xfa)});}}),app['get']('/api/employees',(_0x4abdc5,_0x160182)=>{const _0xa4e2f0=_0x4f4910,_0xa6f799=loadEmployeesStore();_0x160182[_0xa4e2f0(0x267)](_0xa6f799);}),app['post']('/api/employees',(_0x4a5ca5,_0xb7f396)=>{const _0x120eb5=_0x4f4910,_0x49a436={'SIaMM':function(_0x4ab03e,_0x378b1a){return _0x4ab03e(_0x378b1a);},'RIbKZ':_0x120eb5(0x26e)},_0x540125=new Date()['toISOString'](),_0x4a0c3b=_0x4a5ca5['body']||{},_0x31ff05=loadEmployeesStore(),_0x1a8216=_0x49a436[_0x120eb5(0x23a)](getNextId,_0x31ff05),_0x31f642={'id':_0x1a8216,'created_at':_0x540125,'status':_0x4a0c3b[_0x120eb5(0x17b)]||_0x49a436[_0x120eb5(0x258)],..._0x4a0c3b};_0x31ff05[_0x120eb5(0x1dd)](_0x31f642),saveEmployeesStore(_0x31ff05),_0xb7f396['json'](_0x31f642);}),app[_0x4f4910(0x261)](_0x4f4910(0x11f),(_0x35fa94,_0x69b369)=>{const _0x3699bb=_0x4f4910,_0x55e66a={'fmUyg':function(_0x5c9344){return _0x5c9344();}},_0x1b2f84=parseInt(_0x35fa94[_0x3699bb(0x26a)]['id'],0xa),_0x2e2714=_0x55e66a[_0x3699bb(0x247)](loadEmployeesStore),_0x45c194=_0x2e2714['findIndex'](_0x3265cf=>_0x3265cf['id']===_0x1b2f84);if(_0x45c194===-0x1){_0x69b369['status'](0x194)[_0x3699bb(0x267)]({'error':_0x3699bb(0x1f1)});return;}const _0x49f95a=_0x35fa94['body']||{};_0x2e2714[_0x45c194]={..._0x2e2714[_0x45c194],..._0x49f95a},saveEmployeesStore(_0x2e2714),_0x69b369['json'](_0x2e2714[_0x45c194]);}),app[_0x4f4910(0x1dc)]('/api/employees/:id',(_0x119ecf,_0x1318aa)=>{const _0x272eb5=_0x4f4910,_0x22ed89={'hoHXs':function(_0x4b3581,_0x2006c0,_0x1bd3d5){return _0x4b3581(_0x2006c0,_0x1bd3d5);},'LaqUq':function(_0x6ffe9a){return _0x6ffe9a();},'CsmXw':'Employee\x20not\x20found'},_0x12992b=_0x22ed89[_0x272eb5(0x203)](parseInt,_0x119ecf['params']['id'],0xa),_0x17c7ec=_0x22ed89[_0x272eb5(0x1ba)](loadEmployeesStore),_0x5385f4=_0x17c7ec['filter'](_0x7f65d3=>_0x7f65d3['id']!==_0x12992b),_0x37fd3c=_0x5385f4[_0x272eb5(0x2c1)]!==_0x17c7ec[_0x272eb5(0x2c1)];_0x37fd3c&&saveEmployeesStore(_0x5385f4);if(!_0x37fd3c){_0x1318aa['status'](0x194)['json']({'error':_0x22ed89['CsmXw']});return;}_0x1318aa['json']({'success':!![]});}),app['get']('/api/dingtalk/employees',async(_0xc25ed4,_0x3f7aab)=>{const _0x15cb60=_0x4f4910,_0x2cf401={'JksFY':function(_0x256702,_0x4d527d){return _0x256702+_0x4d527d;},'fzumh':function(_0x141a4d,_0x4f2af6,_0x40e0c3){return _0x141a4d(_0x4f2af6,_0x40e0c3);},'pRMRQ':'获取钉钉员工失败'};try{const {accessToken:_0x1cd109,config:_0x12dfe9}=await getDingTalkAccessToken(),_0x10e7de=await _0x2cf401[_0x15cb60(0x164)](fetchDingTalkDepartments,_0x1cd109,_0x12dfe9[_0x15cb60(0x28d)]),_0x290202=new Map();_0x10e7de[_0x15cb60(0x27f)](_0x4ed486=>{const _0x5e0b7d=_0x15cb60;_0x4ed486&&typeof _0x4ed486['id']!=='undefined'&&_0x290202[_0x5e0b7d(0x1b3)](_0x4ed486['id'],_0x4ed486);});const _0x5204a1=await fetchDingTalkEmployees(_0x1cd109,_0x10e7de),_0x26f693=[],_0x23d9ef=new Date()[_0x15cb60(0x2a2)]();_0x5204a1['forEach']((_0x1c1c8a,_0x488dd9)=>{const _0x5f4f28=_0x15cb60;if(!_0x1c1c8a)return;const _0x2cdf12=Array[_0x5f4f28(0x1ad)](_0x1c1c8a[_0x5f4f28(0x115)])?_0x1c1c8a[_0x5f4f28(0x115)]:[];let _0x25f709='';if(_0x2cdf12['length']>0x0){const _0x4b2f0b=_0x290202['get'](_0x2cdf12[0x0]);_0x4b2f0b&&_0x4b2f0b['name']&&(_0x25f709=_0x4b2f0b[_0x5f4f28(0x19b)]);}_0x26f693[_0x5f4f28(0x1dd)]({'id':_0x2cf401['JksFY'](_0x488dd9,0x1),'name':_0x1c1c8a[_0x5f4f28(0x19b)]||'','employee_id':_0x1c1c8a['userid']||_0x1c1c8a[_0x5f4f28(0x111)]||'','department':_0x25f709,'position':_0x1c1c8a['position']||'','phone':_0x1c1c8a['mobile']||'','email':_0x1c1c8a[_0x5f4f28(0x23b)]||'','status':_0x1c1c8a[_0x5f4f28(0x26e)]===![]?'inactive':_0x5f4f28(0x26e),'created_at':_0x23d9ef});}),_0x3f7aab['json'](_0x26f693);}catch(_0x31e1d8){_0x3f7aab[_0x15cb60(0x17b)](0x1f4)['json']({'error':_0x31e1d8[_0x15cb60(0x2cd)]||_0x2cf401[_0x15cb60(0x265)]});}}),app['get'](_0x4f4910(0x2e3),async(_0x2ea448,_0x39f14d)=>{const _0x286110=_0x4f4910,_0xb8731b={'WTpSf':function(_0x3106e8,_0x2d9ed6){return _0x3106e8(_0x2d9ed6);},'aGQeq':_0x286110(0x26e),'pDLom':function(_0x103adf){return _0x103adf();},'RIVbI':'获取钉钉部门失败'};try{const {accessToken:_0x440233,config:_0x18e03a}=await _0xb8731b['pDLom'](getDingTalkAccessToken),_0x22b317=await fetchDingTalkDepartments(_0x440233,_0x18e03a[_0x286110(0x28d)]),_0x3b881b=new Date()[_0x286110(0x2a2)](),_0x58bb7b=new Map(),_0x3bf41d=[];_0x22b317[_0x286110(0x27f)]((_0x4665ec,_0x4f4fc4)=>{const _0x3cdb0d=_0x286110;if(!_0x4665ec)return;const _0x5dfd90=_0x4f4fc4+0x1;_0x58bb7b[_0x3cdb0d(0x1b3)](_0x4665ec['id'],_0x5dfd90),_0x3bf41d['push']({'id':_0x5dfd90,'name':_0x4665ec['name']||'','code':_0xb8731b[_0x3cdb0d(0x108)](String,_0x4665ec['id']||''),'parent_id':null,'status':_0xb8731b['aGQeq'],'created_at':_0x3b881b});}),_0x3bf41d['forEach'](_0x30ace1=>{const _0x383bb7=_0x286110,_0x125339=_0x22b317['find'](_0x45cd59=>String(_0x45cd59['id']||'')===_0x30ace1['code']);if(_0x125339&&_0x125339['parentid']){const _0x68ded=_0x58bb7b['get'](_0x125339[_0x383bb7(0x206)])||null;_0x30ace1['parent_id']=_0x68ded;}}),_0x39f14d[_0x286110(0x267)](_0x3bf41d);}catch(_0x5f2599){_0x39f14d['status'](0x1f4)['json']({'error':_0x5f2599['message']||_0xb8731b['RIVbI']});}}),app[_0x4f4910(0x1d3)]('/api/employees/sync-dingtalk',async(_0x384c0c,_0x3c7347)=>{const _0x2ef0ac=_0x4f4910,_0x13d243={'GBheb':_0x2ef0ac(0xd9),'JaGQC':function(_0xf30746){return _0xf30746();},'apvoh':function(_0x16a977,_0x150bd9,_0x2986a2){return _0x16a977(_0x150bd9,_0x2986a2);}};try{const {accessToken:_0x37eff2,config:_0x13334e}=await _0x13d243[_0x2ef0ac(0x2be)](getDingTalkAccessToken),_0x5a8a44=await _0x13d243['apvoh'](fetchDingTalkDepartments,_0x37eff2,_0x13334e[_0x2ef0ac(0x28d)]),_0x22f16=new Map();_0x5a8a44[_0x2ef0ac(0x27f)](_0x58245a=>{const _0xae71b8=_0x2ef0ac;_0x58245a&&typeof _0x58245a['id']!==_0xae71b8(0x16e)&&_0x22f16['set'](_0x58245a['id'],_0x58245a);});const _0x48dc96=await fetchDingTalkEmployees(_0x37eff2,_0x5a8a44),_0x52d492=[],_0x3d4e5f=new Date()['toISOString']();_0x48dc96[_0x2ef0ac(0x27f)]((_0x4a10eb,_0x55d15d)=>{const _0x4b2830=_0x2ef0ac;if(!_0x4a10eb)return;const _0x15ad9d=Array['isArray'](_0x4a10eb[_0x4b2830(0x115)])?_0x4a10eb[_0x4b2830(0x115)]:[];let _0x236c14='';if(_0x15ad9d[_0x4b2830(0x2c1)]>0x0){const _0x16af97=_0x22f16['get'](_0x15ad9d[0x0]);_0x16af97&&_0x16af97[_0x4b2830(0x19b)]&&(_0x236c14=_0x16af97['name']);}_0x52d492[_0x4b2830(0x1dd)]({'id':_0x55d15d+0x1,'name':_0x4a10eb['name']||'','employee_id':_0x4a10eb['userid']||_0x4a10eb['jobnumber']||'','department':_0x236c14,'position':_0x4a10eb['position']||'','phone':_0x4a10eb[_0x4b2830(0x264)]||'','email':_0x4a10eb[_0x4b2830(0x23b)]||'','status':_0x4a10eb['active']===![]?_0x13d243['GBheb']:'active','created_at':_0x3d4e5f});}),saveEmployeesStore(_0x52d492),_0x3c7347['json']({'success':!![],'count':_0x52d492[_0x2ef0ac(0x2c1)],'employees':_0x52d492});}catch(_0x2fb8e4){_0x3c7347[_0x2ef0ac(0x17b)](0x1f4)['json']({'success':![],'error':_0x2fb8e4[_0x2ef0ac(0x2cd)]||'同步钉钉员工失败'});}}),app[_0x4f4910(0x1ae)](_0x4f4910(0x22c),(_0x618952,_0x397371)=>{const _0x2d621e=_0x4f4910,_0x3bb421=loadUsersStore();_0x397371[_0x2d621e(0x267)](_0x3bb421);}),app[_0x4f4910(0x1d3)]('/api/users',async(_0x520c70,_0x1e9fa3)=>{const _0x23f11b=_0x4f4910,_0xfce768={'pFHgA':function(_0x1d9247){return _0x1d9247();},'aUDDC':_0x23f11b(0x230),'FVjZc':_0x23f11b(0x2c7),'laSfF':_0x23f11b(0x2a7)};try{const _0x58fbd5=new Date()['toISOString'](),_0x3fb110=_0x520c70[_0x23f11b(0x1e1)]||{},_0x2432ac=_0xfce768['pFHgA'](loadUsersStore),_0x6d340e=getNextId(_0x2432ac);let _0x59eab7=_0x3fb110['password']||'';if(_0x59eab7){const _0x3cda2d=await _0x24dc88[_0x23f11b(0xed)](0xa);_0x59eab7=await _0x24dc88[_0x23f11b(0x2d5)](_0x59eab7,_0x3cda2d);}const _0x5d70a5={'id':_0x6d340e,'created_at':_0x58fbd5,'lastLogin':_0x3fb110['lastLogin']||_0xfce768['aUDDC'],'status':_0x3fb110[_0x23f11b(0x17b)]||'启用',..._0x3fb110,'password':_0x59eab7};_0x2432ac[_0x23f11b(0x1dd)](_0x5d70a5),saveUsersStore(_0x2432ac);const _0x7311d={..._0x5d70a5};_0x7311d['password']&&(_0x7311d[_0x23f11b(0x133)]=_0xfce768['FVjZc']),_0x1e9fa3[_0x23f11b(0x267)](_0x7311d);}catch(_0x211843){_0x1e9fa3[_0x23f11b(0x17b)](0x1f4)[_0x23f11b(0x267)]({'error':_0xfce768[_0x23f11b(0x25c)]});}}),app[_0x4f4910(0x261)](_0x4f4910(0x253),async(_0x381e8a,_0x5ba40c)=>{const _0x4277bf=_0x4f4910,_0x5c5679={'EnBuk':function(_0xbcda5e){return _0xbcda5e();},'CjogL':_0x4277bf(0x224),'QwUzZ':function(_0x3cac3b,_0x493108){return _0x3cac3b(_0x493108);},'qYfow':'更新用户失败'};try{const _0x5e3bf1=parseInt(_0x381e8a[_0x4277bf(0x26a)]['id'],0xa),_0x5652c9=_0x5c5679['EnBuk'](loadUsersStore),_0x2313ce=_0x5652c9[_0x4277bf(0x112)](_0x36b2a0=>_0x36b2a0['id']===_0x5e3bf1);if(_0x2313ce===-0x1){_0x5ba40c[_0x4277bf(0x17b)](0x194)['json']({'error':_0x5c5679[_0x4277bf(0x1b1)]});return;}const _0x4f6c06=_0x381e8a['body']||{},_0x5d54d7={..._0x5652c9[_0x2313ce],..._0x4f6c06};if(_0x4f6c06[_0x4277bf(0x133)]!==undefined){let _0x148b13=_0x4f6c06[_0x4277bf(0x133)]||'';if(_0x148b13){const _0xa9ed22=await _0x24dc88[_0x4277bf(0xed)](0xa);_0x148b13=await _0x24dc88[_0x4277bf(0x2d5)](_0x148b13,_0xa9ed22);}_0x5d54d7['password']=_0x148b13;}_0x5652c9[_0x2313ce]=_0x5d54d7,_0x5c5679[_0x4277bf(0x232)](saveUsersStore,_0x5652c9);const _0x2a09e2={..._0x5d54d7};_0x2a09e2[_0x4277bf(0x133)]&&(_0x2a09e2[_0x4277bf(0x133)]='***'),_0x5ba40c['json'](_0x2a09e2);}catch(_0x521a8a){_0x5ba40c['status'](0x1f4)[_0x4277bf(0x267)]({'error':_0x5c5679['qYfow']});}}),app[_0x4f4910(0x1dc)](_0x4f4910(0x253),(_0x1556b7,_0x57e7fc)=>{const _0x333f1d=_0x4f4910,_0x1c0bae={'FSuVf':'User\x20not\x20found','DKDQi':function(_0x5c90a7,_0x272bc1){return _0x5c90a7(_0x272bc1);}},_0x3253ac=parseInt(_0x1556b7['params']['id'],0xa),_0x4d6e05=loadUsersStore(),_0x26416c=_0x4d6e05['filter'](_0x3b5c22=>_0x3b5c22['id']!==_0x3253ac),_0x173473=_0x26416c[_0x333f1d(0x2c1)]!==_0x4d6e05['length'];if(!_0x173473){_0x57e7fc[_0x333f1d(0x17b)](0x194)['json']({'error':_0x1c0bae['FSuVf']});return;}_0x1c0bae[_0x333f1d(0x2e2)](saveUsersStore,_0x26416c),_0x57e7fc[_0x333f1d(0x267)]({'success':!![]});}),app['get'](_0x4f4910(0x1c3),(_0x1acc05,_0x5d5ae0)=>{const _0x5dc35a=_0x4f4910,_0x50add5={'zkKna':_0x5dc35a(0x244)},{type:_0x3959d3}=_0x1acc05['query'],_0x517c28=loadDepartmentsStore();let _0x465c9d=_0x517c28;_0x3959d3?_0x465c9d=_0x465c9d[_0x5dc35a(0x122)](_0x3436e9=>({..._0x3436e9,'type':_0x3436e9['type']||'DEPT'}))['filter'](_0x31ac1c=>_0x31ac1c['type']===_0x3959d3):_0x465c9d=_0x465c9d['map'](_0x344cae=>({..._0x344cae,'type':_0x344cae['type']||'DEPT'}));const _0x2e6371=new Map();_0x465c9d[_0x5dc35a(0x27f)](_0x2c5304=>{const _0x15ca17=_0x5dc35a;_0x2e6371[_0x15ca17(0x1b3)](_0x2c5304['id'],_0x2c5304[_0x15ca17(0x19b)]);});const _0xa9603e=_0x465c9d['map'](_0x5acbd1=>{const _0x4aa9ad=_0x5dc35a;let _0x2cb441=null;if(_0x5acbd1['parent_id']&&_0x2e6371['has'](_0x5acbd1['parent_id'])){if('vGMEC'==='vGMEC')_0x2cb441=_0x2e6371[_0x4aa9ad(0x1ae)](_0x5acbd1['parent_id']);else{if(!_0x36f4c4[_0x4aa9ad(0x2df)](_0x4bf518))return[];const _0x1e66af=_0x132c9a['readFileSync'](_0x4c328b,_0x50add5['zkKna']),_0x46eacb=_0x1a668d['parse'](_0x1e66af);return _0x2e1195['isArray'](_0x46eacb)?_0x46eacb:[];}}return{..._0x5acbd1,'parent_name':_0x2cb441};});_0x5d5ae0[_0x5dc35a(0x267)](_0xa9603e);}),app['post']('/api/departments',(_0x46bb7f,_0x1e1e5f)=>{const _0x4643c4=_0x4f4910,_0x4eaf18={'WOdfc':function(_0xbf2a0f,_0x18b4ae){return _0xbf2a0f(_0x18b4ae);},'SVohR':'active'},_0x2df7c5=new Date()[_0x4643c4(0x2a2)](),_0x5f6d3=_0x46bb7f[_0x4643c4(0x1e1)]||{},_0x281aa4=loadDepartmentsStore(),_0x55eaaa=_0x4eaf18[_0x4643c4(0x144)](getNextId,_0x281aa4),_0x1de965={'id':_0x55eaaa,'created_at':_0x2df7c5,'status':_0x5f6d3[_0x4643c4(0x17b)]||_0x4eaf18[_0x4643c4(0x23e)],..._0x5f6d3};_0x281aa4['push'](_0x1de965),saveDepartmentsStore(_0x281aa4),_0x1e1e5f[_0x4643c4(0x267)](_0x1de965);}),app[_0x4f4910(0x261)](_0x4f4910(0x29a),(_0x1772c5,_0x2244cd)=>{const _0x4dcd81=_0x4f4910,_0xadeb80={'Vdfhx':function(_0x4e743e,_0x1af45a,_0x1c2eb3){return _0x4e743e(_0x1af45a,_0x1c2eb3);}},_0x13acf5=_0xadeb80[_0x4dcd81(0x2a0)](parseInt,_0x1772c5['params']['id'],0xa),_0x293df8=loadDepartmentsStore(),_0x33d1d0=_0x293df8[_0x4dcd81(0x112)](_0x4778a=>_0x4778a['id']===_0x13acf5);if(_0x33d1d0===-0x1){_0x2244cd['status'](0x194)['json']({'error':_0x4dcd81(0xd5)});return;}const _0x138f1b=_0x1772c5['body']||{};_0x293df8[_0x33d1d0]={..._0x293df8[_0x33d1d0],..._0x138f1b},saveDepartmentsStore(_0x293df8),_0x2244cd[_0x4dcd81(0x267)](_0x293df8[_0x33d1d0]);}),app[_0x4f4910(0x1dc)](_0x4f4910(0x29a),(_0x269d29,_0x323f54)=>{const _0x3caf10=_0x4f4910,_0x5bc275={'pHprN':function(_0x95ce33){return _0x95ce33();},'KuoTZ':function(_0x43c82f,_0x65c42d){return _0x43c82f!==_0x65c42d;},'kcLVK':function(_0x4604e9,_0x4fb7ab){return _0x4604e9(_0x4fb7ab);},'wjMIN':'Department\x20not\x20found'},_0x53feb1=parseInt(_0x269d29['params']['id'],0xa),_0x46fa71=_0x5bc275['pHprN'](loadDepartmentsStore),_0x122229=_0x46fa71['filter'](_0xeb4fa6=>_0xeb4fa6['id']!==_0x53feb1),_0x27b876=_0x5bc275[_0x3caf10(0x237)](_0x122229[_0x3caf10(0x2c1)],_0x46fa71[_0x3caf10(0x2c1)]);_0x27b876&&_0x5bc275[_0x3caf10(0x292)](saveDepartmentsStore,_0x122229);if(!_0x27b876){_0x323f54[_0x3caf10(0x17b)](0x194)[_0x3caf10(0x267)]({'error':_0x5bc275['wjMIN']});return;}_0x323f54[_0x3caf10(0x267)]({'success':!![]});}),app['post']('/api/departments/sync-dingtalk',async(_0x5bdbef,_0x16b283)=>{const _0xebf486=_0x4f4910,_0x33066e={'QZjcq':function(_0x92c2be,_0x3c2dfe){return _0x92c2be(_0x3c2dfe);},'PXkFc':'active','iLktP':function(_0xeb3780,_0x4a77db,_0x936bb6){return _0xeb3780(_0x4a77db,_0x936bb6);}};try{const {accessToken:_0xb373c4,config:_0x1c7df2}=await getDingTalkAccessToken(),_0x55a8c5=await _0x33066e['iLktP'](fetchDingTalkDepartments,_0xb373c4,_0x1c7df2['rootDeptId']),_0x12ac20=new Map(),_0x3c3a0e=new Date()[_0xebf486(0x2a2)](),_0x36f138=[];_0x55a8c5['forEach']((_0x4f3ddd,_0x3942f4)=>{const _0x366664=_0xebf486;if(!_0x4f3ddd)return;const _0x362a50=_0x3942f4+0x1;_0x12ac20['set'](_0x4f3ddd['id'],_0x362a50),_0x36f138[_0x366664(0x1dd)]({'id':_0x362a50,'name':_0x4f3ddd[_0x366664(0x19b)]||'','code':_0x33066e[_0x366664(0x11e)](String,_0x4f3ddd['id']||''),'parent_id':null,'manager':'','status':_0x33066e[_0x366664(0x1aa)],'created_at':_0x3c3a0e});}),_0x36f138['forEach'](_0x2bd9ae=>{const _0x4d80e6=_0xebf486,_0x29d1b2=_0x55a8c5[_0x4d80e6(0x2c4)](_0x94d4bb=>String(_0x94d4bb['id']||'')===_0x2bd9ae['code']);if(_0x29d1b2&&_0x29d1b2['parentid']){const _0x62fafb=_0x12ac20['get'](_0x29d1b2[_0x4d80e6(0x206)])||null;_0x2bd9ae[_0x4d80e6(0x249)]=_0x62fafb;}}),saveDepartmentsStore(_0x36f138),_0x16b283[_0xebf486(0x267)]({'success':!![],'count':_0x36f138[_0xebf486(0x2c1)],'departments':_0x36f138});}catch(_0x2650bc){_0x16b283[_0xebf486(0x17b)](0x1f4)['json']({'success':![],'error':_0x2650bc[_0xebf486(0x2cd)]||_0xebf486(0x2bf)});}}),app[_0x4f4910(0x1ae)]('/api/roles',(_0x9f865b,_0x2b33a1)=>{const _0x583852=_0x4f4910,_0xb114be=loadRolesStore();_0x2b33a1[_0x583852(0x267)](_0xb114be);}),app['post']('/api/roles',(_0x3c3c04,_0x192ec0)=>{const _0x1aa5d7=_0x4f4910,_0x3c9660={'zLctB':function(_0x58f4b7,_0x39d666){return _0x58f4b7(_0x39d666);}},_0x30b503=new Date()['toISOString'](),_0x3b7871=_0x3c3c04['body']||{},_0x5e1d2f=loadRolesStore(),_0x406c3c=getNextId(_0x5e1d2f),_0x1feee3={'id':_0x406c3c,'created_at':_0x30b503,..._0x3b7871};_0x5e1d2f['push'](_0x1feee3),_0x3c9660[_0x1aa5d7(0xe4)](saveRolesStore,_0x5e1d2f),_0x192ec0['json'](_0x1feee3);}),app['put'](_0x4f4910(0x190),(_0x45dcfd,_0x4b770f)=>{const _0x2ced06=_0x4f4910,_0x46b9ba={'WPFfC':function(_0x53ad01,_0x2d4269,_0x2fa5e1){return _0x53ad01(_0x2d4269,_0x2fa5e1);},'fexDT':function(_0x37a36e){return _0x37a36e();},'zliEf':function(_0x209931,_0x5a4206){return _0x209931===_0x5a4206;}},_0x5a4d8d=_0x46b9ba['WPFfC'](parseInt,_0x45dcfd['params']['id'],0xa),_0x5277f0=_0x46b9ba['fexDT'](loadRolesStore),_0x5ca9cb=_0x5277f0[_0x2ced06(0x112)](_0x2404f1=>_0x2404f1['id']===_0x5a4d8d);if(_0x46b9ba[_0x2ced06(0x12e)](_0x5ca9cb,-0x1)){_0x4b770f[_0x2ced06(0x17b)](0x194)[_0x2ced06(0x267)]({'error':'Role\x20not\x20found'});return;}const _0x15ef61=_0x45dcfd[_0x2ced06(0x1e1)]||{},_0x1cede7={..._0x5277f0[_0x5ca9cb],..._0x15ef61};_0x5277f0[_0x5ca9cb]=_0x1cede7,saveRolesStore(_0x5277f0);const _0x5ba2c6=loadUsersStore(),_0x554207=_0x1cede7['name'],_0x461693=_0x5ba2c6['map'](_0xa10106=>{const _0x5ed816=_0x2ced06;if(_0xa10106[_0x5ed816(0x13b)]===_0x554207)return{..._0xa10106,'permissions':_0x1cede7[_0x5ed816(0x275)]};return _0xa10106;});saveUsersStore(_0x461693),_0x4b770f[_0x2ced06(0x267)](_0x1cede7);}),app['delete'](_0x4f4910(0x190),(_0x18c1e3,_0x5d80e6)=>{const _0x1c6222=_0x4f4910,_0x19baa3={'ogCdj':function(_0x40b0a4,_0x119c1b,_0x29db13){return _0x40b0a4(_0x119c1b,_0x29db13);},'twAft':function(_0x4fa64d,_0x313dcf){return _0x4fa64d!==_0x313dcf;},'ZxlTn':function(_0x3b9905,_0x8e3f8b){return _0x3b9905(_0x8e3f8b);},'CWuDi':_0x1c6222(0x2c0)},_0x468216=_0x19baa3['ogCdj'](parseInt,_0x18c1e3[_0x1c6222(0x26a)]['id'],0xa),_0x178043=loadRolesStore(),_0x4fc363=_0x178043['filter'](_0x1a0350=>_0x1a0350['id']!==_0x468216),_0x575efd=_0x19baa3['twAft'](_0x4fc363[_0x1c6222(0x2c1)],_0x178043[_0x1c6222(0x2c1)]);_0x575efd&&_0x19baa3['ZxlTn'](saveRolesStore,_0x4fc363);if(!_0x575efd){if('Czorm'!==_0x19baa3[_0x1c6222(0x24a)]){_0x5d80e6[_0x1c6222(0x17b)](0x194)[_0x1c6222(0x267)]({'error':_0x1c6222(0x10e)});return;}else _0x42f048=_0x3c812c['filter'](_0x495ad7=>_0x321382(_0x495ad7['year'])===_0xa1ffc9);}_0x5d80e6['json']({'success':!![]});});function mapAuditRecordToLogView(_0x1d8987){const _0x2b4d9c=_0x4f4910,_0x3d1c62={'oYGwW':function(_0x17e5ee,_0x5acab9){return _0x17e5ee>=_0x5acab9;},'oCjIR':function(_0x27ffde,_0x573602){return _0x27ffde===_0x573602;},'Qyghl':'VIEW','hjUQf':function(_0x439a07,_0x3df9c8){return _0x439a07===_0x3df9c8;},'NffZZ':_0x2b4d9c(0x18c),'ANuuU':'DELETE','vYJlS':function(_0x224653,_0x17a902){return _0x224653||_0x17a902;},'RDVJy':_0x2b4d9c(0x1b7),'VskIN':_0x2b4d9c(0x141)};if(!_0x1d8987||typeof _0x1d8987!==_0x2b4d9c(0x17d))return null;const _0x1e6e1a=_0x1d8987[_0x2b4d9c(0x189)]||_0x1d8987['time']||new Date()['toISOString'](),_0x56324f=_0x1d8987[_0x2b4d9c(0xec)]||'系统',_0x4d392c=_0x1d8987[_0x2b4d9c(0x10f)]||_0x1d8987['ip']||'',_0x6e52b3=typeof _0x1d8987['status']===_0x2b4d9c(0x109)?_0x1d8987['status']:0xc8,_0x37b494=_0x3d1c62[_0x2b4d9c(0x201)](_0x6e52b3,0xc8)&&_0x6e52b3<0x12c?_0x2b4d9c(0x290):'fail';let _0x185e3f=_0x1d8987[_0x2b4d9c(0x2e4)];if(!_0x185e3f){const _0x3e23a2=(_0x1d8987['method']||'')[_0x2b4d9c(0x27e)](),_0x38ed6e=_0x1d8987['path']||'';if(_0x38ed6e[_0x2b4d9c(0x274)](_0x2b4d9c(0x22a)))_0x185e3f=_0x2b4d9c(0x24c);else{if(_0x3d1c62['oCjIR'](_0x3e23a2,'GET'))_0x185e3f=_0x3d1c62[_0x2b4d9c(0x123)];else{if(_0x3e23a2===_0x2b4d9c(0x141))_0x185e3f='CREATE';else{if(_0x3e23a2===_0x2b4d9c(0x24f)||_0x3d1c62[_0x2b4d9c(0x149)](_0x3e23a2,'PATCH'))_0x185e3f=_0x3d1c62['NffZZ'];else _0x3e23a2==='DELETE'?_0x185e3f=_0x3d1c62['ANuuU']:_0x185e3f=_0x3d1c62[_0x2b4d9c(0x158)](_0x3e23a2,_0x3d1c62['Qyghl']);}}}}let _0x37fcd7=_0x1d8987[_0x2b4d9c(0x16c)];if(!_0x37fcd7){const _0x4f9555=(_0x1d8987['method']||'')[_0x2b4d9c(0x27e)](),_0x2748aa=_0x1d8987['path']||'';let _0x95aa77=_0x3d1c62['RDVJy'],_0x29c85f='';for(const [_0x570937,_0x1a2921]of Object['entries'](API_PATH_MAPPING)){if(_0x2748aa[_0x2b4d9c(0x23d)](_0x570937)){_0x95aa77=_0x1a2921['action'],_0x29c85f=_0x1a2921['description'];break;}}let _0x110924='';switch(_0x4f9555){case'GET':_0x110924='查看';break;case _0x3d1c62[_0x2b4d9c(0x1f3)]:_0x110924='创建';break;case _0x2b4d9c(0x24f):case'PATCH':_0x110924='更新';break;case _0x2b4d9c(0x1a6):_0x110924='删除';break;default:_0x110924='操作';}let _0xa84765='';try{const _0xde73fc=_0x3d1c62[_0x2b4d9c(0x25d)](typeof _0x1d8987['body'],'string')?JSON['parse'](_0x1d8987['body']):_0x1d8987[_0x2b4d9c(0x1e1)];_0xa84765=extractKeyInfo(_0xde73fc);}catch(_0x186138){}_0x37fcd7=''+_0x110924+_0x95aa77+_0xa84765;}return{'id':_0x1d8987['id'],'created_at':_0x1e6e1a,'username':_0x56324f,'ip_address':_0x4d392c,'action_type':_0x185e3f,'details':_0x37fcd7,'status':_0x37b494};}app['get'](_0x4f4910(0x103),(_0x50d0f0,_0x10ddaf)=>{const _0x31e709=_0x4f4910,_0xedd5f3={'pQnsK':function(_0x2fbcd5,_0x47ae94){return _0x2fbcd5+_0x47ae94;},'sjSBl':'OIcGs','hiLLQ':function(_0x45ceed,_0x213b36){return _0x45ceed>=_0x213b36;},'WxITF':function(_0x2d3be4){return _0x2d3be4();},'gLSre':function(_0x39fa46,_0x3106ca){return _0x39fa46(_0x3106ca);},'ZyqMi':function(_0x4c3d2c,_0x2f0c0f,_0x2b39f7){return _0x4c3d2c(_0x2f0c0f,_0x2b39f7);},'CFfLI':function(_0x4ce868,_0xb31072){return _0x4ce868*_0xb31072;},'aZqxK':function(_0x6f5322,_0x4d1f80){return _0x6f5322-_0x4d1f80;}},{page:_0x4e6192,pageSize:_0x265712,username:_0x61c510,type:_0x46d5b7,startDate:_0x4d2221,endDate:_0x2f42b5}=_0x50d0f0[_0x31e709(0x287)],_0x1fa1c2=_0xedd5f3[_0x31e709(0xde)](loadAuditLogs),_0x1dfe8d=_0x1fa1c2['map'](_0x5132dc=>mapAuditRecordToLogView(_0x5132dc))[_0x31e709(0x16f)](_0x373f10=>_0x373f10&&_0x373f10['id']!==undefined);let _0x3bb94e=_0x1dfe8d;if(_0x61c510&&String(_0x61c510)['trim']()){const _0x4b3ec3=_0xedd5f3['gLSre'](String,_0x61c510)['trim']()[_0x31e709(0x1b5)]();_0x3bb94e=_0x3bb94e[_0x31e709(0x16f)](_0x4c36e6=>String(_0x4c36e6[_0x31e709(0xec)]||'')['toLowerCase']()['includes'](_0x4b3ec3));}if(_0x46d5b7&&_0xedd5f3[_0x31e709(0x196)](String,_0x46d5b7)[_0x31e709(0x15e)]()){const _0x6a5bef=String(_0x46d5b7)['trim']()[_0x31e709(0x27e)]();_0x3bb94e=_0x3bb94e['filter'](_0x2dac51=>String(_0x2dac51[_0x31e709(0x2e4)]||'')[_0x31e709(0x27e)]()===_0x6a5bef);}if(_0x4d2221){const _0x58ab48=new Date(_0x4d2221);!Number[_0x31e709(0x1be)](_0x58ab48['getTime']())&&(_0x3bb94e=_0x3bb94e[_0x31e709(0x16f)](_0x4f86d0=>{const _0x3a9e67=_0x31e709,_0x51e339={'vGKgu':function(_0x252d1d,_0x367929){return _0xedd5f3['pQnsK'](_0x252d1d,_0x367929);}};if(_0x3a9e67(0x2e7)!==_0xedd5f3['sjSBl']){const _0x3673e1={'lUYtf':function(_0x39d661,_0x5aad90){return _0x51e339['vGKgu'](_0x39d661,_0x5aad90);}},_0x3f53f1=_0x4f8411(_0x6ce09b,0xa);!_0x85b932['isNaN'](_0x3f53f1)&&(_0x44b785=_0x1fabea['filter'](_0x373759=>{const _0x313786=_0x3a9e67,_0x41efee=_0x373759['start_date']?new _0x419da9(_0x373759['start_date']):null,_0x28f108=_0x373759[_0x313786(0x2c2)]?new _0x458901(_0x373759['end_date']):null;if(_0x41efee&&!_0x16893f(_0x41efee)&&_0x41efee[_0x313786(0x29d)]()+0x1===_0x3f53f1)return!![];if(_0x28f108&&!_0x16f769(_0x28f108)&&_0x3673e1['lUYtf'](_0x28f108['getMonth'](),0x1)===_0x3f53f1)return!![];if(_0x2c42d6(_0x373759[_0x313786(0x10a)])===_0x3f53f1)return!![];return![];}));}else{const _0x1b59d1=new Date(_0x4f86d0[_0x3a9e67(0x189)]);return!Number['isNaN'](_0x1b59d1[_0x3a9e67(0x298)]())&&_0xedd5f3[_0x3a9e67(0x17f)](_0x1b59d1,_0x58ab48);}}));}if(_0x2f42b5){const _0x596636=new Date(_0x2f42b5);if(!Number['isNaN'](_0x596636[_0x31e709(0x298)]())){const _0x21e69f=new Date(_0x596636['getTime']());_0x21e69f['setHours'](0x17,0x3b,0x3b,0x3e7),_0x3bb94e=_0x3bb94e[_0x31e709(0x16f)](_0x3405e0=>{const _0x1e2132=new Date(_0x3405e0['created_at']);return!Number['isNaN'](_0x1e2132['getTime']())&&_0x1e2132<=_0x21e69f;});}}_0x3bb94e['sort']((_0x141ac4,_0x18fe36)=>{const _0x222d91=_0x31e709,_0x334d41=new Date(_0x141ac4[_0x222d91(0x189)])['getTime'](),_0x822681=new Date(_0x18fe36[_0x222d91(0x189)])[_0x222d91(0x298)]();return _0x822681-_0x334d41;});const _0x43c2d1=parseInt(_0x4e6192,0xa)||0x1,_0x1d5a98=_0xedd5f3[_0x31e709(0x1f7)](parseInt,_0x265712,0xa)||0x14,_0x5d1a69=_0x3bb94e['length'],_0x3428f8=_0xedd5f3['CFfLI'](_0xedd5f3[_0x31e709(0x2d9)](_0x43c2d1,0x1),_0x1d5a98),_0x5cc331=_0x3428f8+_0x1d5a98,_0x20f74a=_0x3bb94e[_0x31e709(0x191)](_0x3428f8,_0x5cc331);_0x10ddaf['json']({'data':_0x20f74a,'total':_0x5d1a69,'page':_0x43c2d1,'pageSize':_0x1d5a98});}),app[_0x4f4910(0x1dc)]('/api/logs/:id',(_0x4a47ca,_0x3e47c6)=>{const _0x5c2526=_0x4f4910,_0x1abca6={'tExfR':function(_0x5c3726,_0x26e266,_0x1e745a){return _0x5c3726(_0x26e266,_0x1e745a);},'AeraK':'日志不存在'},_0x33d5a5=_0x1abca6['tExfR'](parseInt,_0x4a47ca['params']['id'],0xa);if(!_0x33d5a5){_0x3e47c6[_0x5c2526(0x17b)](0x190)['json']({'success':![],'error':_0x5c2526(0xf0)});return;}const _0x26c0c4=loadAuditLogs(),_0x21bfa1=_0x26c0c4[_0x5c2526(0x16f)](_0x298a60=>_0x298a60['id']!==_0x33d5a5),_0x51ee80=_0x21bfa1['length']!==_0x26c0c4['length'];if(!_0x51ee80){_0x3e47c6[_0x5c2526(0x17b)](0x194)['json']({'success':![],'error':_0x1abca6[_0x5c2526(0x12f)]});return;}saveAuditLogs(_0x21bfa1),_0x3e47c6['json']({'success':!![]});}),app[_0x4f4910(0x1dc)](_0x4f4910(0x103),(_0x3c17e3,_0x53ded2)=>{const _0x24b938=_0x4f4910;saveAuditLogs([]),_0x53ded2[_0x24b938(0x267)]({'success':!![]});}),app[_0x4f4910(0x1d3)](_0x4f4910(0x103),(_0x491fcc,_0x470371)=>{const _0x58eecb=_0x4f4910,_0x2865aa={'yjODJ':'/api/logs','JwfAi':_0x58eecb(0x2ea)},_0x468d5a=_0x491fcc[_0x58eecb(0x1e1)]||{},_0x174c40=_0x468d5a['actionType']||'INFO',_0x183036=_0x468d5a[_0x58eecb(0x16c)]||'用户操作';appendAuditLog({'username':_0x491fcc['headers'][_0x58eecb(0x10b)]||'系统','role':_0x491fcc[_0x58eecb(0xe7)][_0x58eecb(0x1ce)]||'','method':'POST','path':_0x2865aa['yjODJ'],'status':0xc8,'ip':_0x491fcc['ip'],'ua':_0x491fcc['headers']['user-agent']||'','query':{},'body':_0x468d5a[_0x58eecb(0x1bc)]||{},'action_type':_0x174c40,'details':_0x183036}),!_0x470371['locals']&&('BOcGQ'===_0x2865aa['JwfAi']?_0x470371[_0x58eecb(0x1f4)]={}:_0x2b0bb1[_0x58eecb(0x185)](_0x21e23c,{'recursive':!![]})),_0x470371[_0x58eecb(0x1f4)][_0x58eecb(0x17c)]=!![],_0x470371[_0x58eecb(0x267)]({'success':!![]});}),app['get']('/api/action-plans',(_0x3afe53,_0x55e4b8)=>{const _0x2af66e=_0x4f4910,_0x44fd86={'Igqqb':function(_0x17e9d0,_0x5b68b6){return _0x17e9d0+_0x5b68b6;},'eGtDd':function(_0x5c486b){return _0x5c486b();},'XgSqw':function(_0x195635,_0x50f48b,_0x303414){return _0x195635(_0x50f48b,_0x303414);}},{year:_0x4ddd38,department:_0x1e51d5,status:_0x14b9b6,priority:_0x1281c1,month:_0x52df83}=_0x3afe53[_0x2af66e(0x287)],_0x5ad435=_0x44fd86[_0x2af66e(0x28a)](loadActionPlans);let _0x183cc0=Array[_0x2af66e(0x1ad)](_0x5ad435)?[..._0x5ad435]:[];if(_0x4ddd38){const _0x99995b=parseInt(_0x4ddd38,0xa);!Number['isNaN'](_0x99995b)&&(_0x183cc0=_0x183cc0[_0x2af66e(0x16f)](_0xa8d05=>Number(_0xa8d05[_0x2af66e(0x150)])===_0x99995b));}_0x1e51d5&&(_0x183cc0=_0x183cc0[_0x2af66e(0x16f)](_0x329ddb=>_0x329ddb['department']===_0x1e51d5));_0x14b9b6&&(_0x183cc0=_0x183cc0['filter'](_0x437614=>_0x437614['status']===_0x14b9b6));_0x1281c1&&(_0x183cc0=_0x183cc0['filter'](_0x4b6e42=>_0x4b6e42[_0x2af66e(0x2a8)]===_0x1281c1));if(_0x52df83){const _0x4fe894=_0x44fd86['XgSqw'](parseInt,_0x52df83,0xa);!Number['isNaN'](_0x4fe894)&&(_0x183cc0=_0x183cc0['filter'](_0x5cece2=>{const _0x28d9bb=_0x2af66e,_0x22945e=_0x5cece2['start_date']?new Date(_0x5cece2['start_date']):null,_0x1ab742=_0x5cece2['end_date']?new Date(_0x5cece2['end_date']):null;if(_0x22945e&&!isNaN(_0x22945e)&&_0x44fd86['Igqqb'](_0x22945e[_0x28d9bb(0x29d)](),0x1)===_0x4fe894)return!![];if(_0x1ab742&&!isNaN(_0x1ab742)&&_0x1ab742[_0x28d9bb(0x29d)]()+0x1===_0x4fe894)return!![];const _0x3fb8e0=_0x5cece2[_0x28d9bb(0x193)];if(_0x3fb8e0){const _0x3e635f=new Date(_0x3fb8e0);if(!isNaN(_0x3e635f)&&_0x3e635f[_0x28d9bb(0x29d)]()+0x1===_0x4fe894)return!![];}return![];}));}_0x55e4b8[_0x2af66e(0x267)](_0x183cc0);}),app['post'](_0x4f4910(0x1c1),(_0x41339d,_0x357726)=>{const _0x26ef9e=_0x4f4910,_0x1db1d9={'iQMOI':function(_0x324697,_0x392cfe){return _0x324697!==_0x392cfe;},'WQROf':'oZYwl'};try{const _0x3e599e=new Date()['toISOString'](),_0x1b6dd6=_0x41339d[_0x26ef9e(0x1e1)]||{},_0x37c44a=loadActionPlans(),_0x572765=getNextId(_0x37c44a),_0x19269={'id':_0x572765,'created_at':_0x3e599e,..._0x1b6dd6};if(_0x1db1d9['iQMOI'](_0x1b6dd6[_0x26ef9e(0x150)],undefined)&&_0x1b6dd6[_0x26ef9e(0x150)]!==null){const _0x289a8e=parseInt(_0x1b6dd6[_0x26ef9e(0x150)],0xa);!Number[_0x26ef9e(0x1be)](_0x289a8e)&&(_0x1db1d9['iQMOI'](_0x26ef9e(0x281),_0x1db1d9[_0x26ef9e(0x1e2)])?_0x19269['year']=_0x289a8e:_0x47bd9d=_0x174d26['filter'](_0x1b02ef=>{const _0x10cb6b=_0x26ef9e,_0x58bf93=_0x1b02ef['department']||_0x1b02ef[_0x10cb6b(0x121)]||'';return _0x58bf93===_0x4875fb;}));}_0x37c44a[_0x26ef9e(0x1dd)](_0x19269),saveActionPlans(_0x37c44a),_0x357726['json'](_0x19269);}catch(_0x4f4cc4){_0x357726['status'](0x1f4)[_0x26ef9e(0x267)]({'error':'保存行动计划失败'});}}),app[_0x4f4910(0x261)](_0x4f4910(0x143),(_0x4b6c99,_0x2af083)=>{const _0x584a20=_0x4f4910,_0x41f735={'siEAT':function(_0x5e397a,_0x58511c,_0x20fffb){return _0x5e397a(_0x58511c,_0x20fffb);},'fwytk':function(_0x1655a1,_0x311025,_0x166170){return _0x1655a1(_0x311025,_0x166170);},'tZEZw':'更新行动计划失败'};try{const _0x11e111=_0x41f735[_0x584a20(0x13a)](parseInt,_0x4b6c99[_0x584a20(0x26a)]['id'],0xa),_0x4f6057=_0x4b6c99[_0x584a20(0x1e1)]||{},_0x15a40f=loadActionPlans(),_0x5dc49d=_0x15a40f[_0x584a20(0x112)](_0x162b0e=>_0x162b0e['id']===_0x11e111);if(_0x5dc49d===-0x1){_0x2af083[_0x584a20(0x17b)](0x194)['json']({'error':_0x584a20(0x226)});return;}const _0x567069={..._0x15a40f[_0x5dc49d],..._0x4f6057};if(_0x4f6057[_0x584a20(0x150)]!==undefined&&_0x4f6057[_0x584a20(0x150)]!==null){const _0x54755f=_0x41f735['fwytk'](parseInt,_0x4f6057['year'],0xa);!Number['isNaN'](_0x54755f)&&(_0x567069[_0x584a20(0x150)]=_0x54755f);}_0x15a40f[_0x5dc49d]=_0x567069,saveActionPlans(_0x15a40f),_0x2af083['json'](_0x567069);}catch(_0x3dfd31){_0x2af083['status'](0x1f4)[_0x584a20(0x267)]({'error':_0x41f735[_0x584a20(0x2c8)]});}}),app['delete']('/api/action-plans/:id',(_0x52847e,_0x2bb9be)=>{const _0x1ce4ab=_0x4f4910,_0x47f19d={'LKVvO':'tgxAQ'};try{const _0xe7524d=parseInt(_0x52847e[_0x1ce4ab(0x26a)]['id'],0xa),_0x41b2b8=loadActionPlans(),_0x875d28=_0x41b2b8['filter'](_0xb12d85=>_0xb12d85['id']!==_0xe7524d),_0x3fbdcb=_0x875d28[_0x1ce4ab(0x2c1)]!==_0x41b2b8[_0x1ce4ab(0x2c1)];if(!_0x3fbdcb){if(_0x1ce4ab(0x1d8)===_0x47f19d['LKVvO'])_0x4621bd={};else{_0x2bb9be['status'](0x194)[_0x1ce4ab(0x267)]({'success':![],'error':'行动计划不存在'});return;}}saveActionPlans(_0x875d28),_0x2bb9be[_0x1ce4ab(0x267)]({'success':!![]});}catch(_0x3dc5f9){_0x2bb9be[_0x1ce4ab(0x17b)](0x1f4)[_0x1ce4ab(0x267)]({'success':![],'error':_0x1ce4ab(0x223)});}}),app['get'](_0x4f4910(0x252),(_0x2863c0,_0x28d316)=>{const _0x2b2fa8=loadSystemSettings();_0x28d316['json'](_0x2b2fa8);}),app[_0x4f4910(0x1d3)]('/api/system-settings',(_0x14afde,_0x5f36f7)=>{const _0x38dea7=_0x4f4910,_0x49a5be={'rBjfE':function(_0x35abee){return _0x35abee();},'pRdCX':function(_0x12464e,_0x723bce){return _0x12464e!==_0x723bce;},'EnrqV':function(_0x327058,_0x56fa1c){return _0x327058(_0x56fa1c);},'NBisn':_0x38dea7(0x252),'LlZWB':_0x38dea7(0x278),'hdBjQ':_0x38dea7(0x1c9),'mWcoJ':'新增系统设置'},_0x250617=_0x49a5be[_0x38dea7(0xdf)](loadSystemSettings),_0x1572fa=_0x14afde[_0x38dea7(0x1e1)]||{},_0x451373=new Date()[_0x38dea7(0x2a2)](),_0x39cb8d=_0x1572fa['key'];let _0x163ca0=null;if(_0x39cb8d){const _0x1da8ab=_0x250617['findIndex'](_0x1d2b08=>_0x1d2b08&&_0x1d2b08[_0x38dea7(0x11c)]===_0x39cb8d);if(_0x49a5be['pRdCX'](_0x1da8ab,-0x1)){const _0x577c3c=_0x250617[_0x1da8ab],_0x498e53={..._0x577c3c,..._0x1572fa};_0x498e53['id']=_0x577c3c['id'],_0x498e53['created_at']=_0x577c3c['created_at']||_0x451373,_0x250617[_0x1da8ab]=_0x498e53,_0x163ca0=_0x498e53;}}if(!_0x163ca0){const _0x508dd5=_0x49a5be['EnrqV'](getNextId,_0x250617);_0x163ca0={'id':_0x508dd5,'created_at':_0x451373,..._0x1572fa},_0x250617['push'](_0x163ca0);}saveSystemSettings(_0x250617),appendAuditLog({'username':_0x1572fa[_0x38dea7(0x2ce)]||'','role':_0x1572fa['role']||'','method':'POST','path':_0x49a5be[_0x38dea7(0x284)],'status':0xc9,'ip':_0x14afde['ip'],'ua':_0x14afde[_0x38dea7(0xe7)][_0x49a5be[_0x38dea7(0xfe)]]||'','query':_0x14afde['query']||{},'body':_0x1572fa,'action_type':_0x49a5be['hdBjQ'],'details':_0x49a5be[_0x38dea7(0x18b)]}),!_0x5f36f7['locals']&&(_0x5f36f7['locals']={}),_0x5f36f7[_0x38dea7(0x1f4)]['auditLogged']=!![],_0x5f36f7[_0x38dea7(0x17b)](0xc9)['json'](_0x163ca0);}),app['put'](_0x4f4910(0x210),(_0x60789a,_0x586bb8)=>{const _0x379c18=_0x4f4910,_0x402c14={'vOqsZ':function(_0x1f4ae6){return _0x1f4ae6();},'vVMPO':function(_0x5014c7,_0x471386,_0x48e453){return _0x5014c7(_0x471386,_0x48e453);},'SCibR':function(_0x4da026,_0x46d8e9){return _0x4da026===_0x46d8e9;},'IBZPF':_0x379c18(0x268),'mLscj':'PUT','PlrzJ':_0x379c18(0x18c)},_0x2aac53=_0x402c14[_0x379c18(0x186)](loadSystemSettings),_0x86a954=_0x402c14[_0x379c18(0x12b)](parseInt,_0x60789a['params']['id'],0xa),_0xabbec3=_0x2aac53['findIndex'](_0x50820a=>_0x50820a['id']===_0x86a954);if(_0x402c14[_0x379c18(0x289)](_0xabbec3,-0x1)){_0x586bb8['status'](0x194)['json']({'error':_0x402c14[_0x379c18(0x161)]});return;}const _0x9699a0=_0x60789a['body']||{};_0x2aac53[_0xabbec3]={..._0x2aac53[_0xabbec3],..._0x9699a0},saveSystemSettings(_0x2aac53),appendAuditLog({'username':_0x9699a0['operator']||'','role':_0x9699a0[_0x379c18(0x13b)]||'','method':_0x402c14[_0x379c18(0x21c)],'path':_0x379c18(0x16a)+_0x86a954,'status':0xc8,'ip':_0x60789a['ip'],'ua':_0x60789a[_0x379c18(0xe7)][_0x379c18(0x278)]||'','query':_0x60789a[_0x379c18(0x287)]||{},'body':_0x9699a0,'action_type':_0x402c14['PlrzJ'],'details':_0x379c18(0x180)}),!_0x586bb8[_0x379c18(0x1f4)]&&(_0x586bb8['locals']={}),_0x586bb8['locals'][_0x379c18(0x17c)]=!![],_0x586bb8[_0x379c18(0x267)](_0x2aac53[_0xabbec3]);}),app[_0x4f4910(0x1dc)](_0x4f4910(0x210),(_0x5d04f3,_0x2112f1)=>{const _0x330a8f=_0x4f4910,_0x35904d={'HZdEx':function(_0x5add49,_0xf0a1af,_0x2fe741){return _0x5add49(_0xf0a1af,_0x2fe741);},'KhgNM':_0x330a8f(0x1a6),'CtZkQ':function(_0x58f9d2,_0x5aab54){return _0x58f9d2!==_0x5aab54;},'qHRHO':_0x330a8f(0x124)},_0xcea6d2=loadSystemSettings(),_0x34e8b6=_0x35904d[_0x330a8f(0x2a5)](parseInt,_0x5d04f3['params']['id'],0xa),_0x3b68de=_0xcea6d2[_0x330a8f(0x16f)](_0x426271=>_0x426271['id']!==_0x34e8b6),_0x5beecb=_0x3b68de[_0x330a8f(0x2c1)]!==_0xcea6d2['length'];if(!_0x5beecb){_0x2112f1[_0x330a8f(0x17b)](0x194)[_0x330a8f(0x267)]({'error':'Setting\x20not\x20found'});return;}saveSystemSettings(_0x3b68de),appendAuditLog({'username':'','role':'','method':_0x35904d[_0x330a8f(0x1e4)],'path':_0x330a8f(0x16a)+_0x34e8b6,'status':0xc8,'ip':_0x5d04f3['ip'],'ua':_0x5d04f3[_0x330a8f(0xe7)][_0x330a8f(0x278)]||'','query':_0x5d04f3[_0x330a8f(0x287)]||{},'body':{},'action_type':_0x330a8f(0x1a6),'details':'删除系统设置'});if(!_0x2112f1[_0x330a8f(0x1f4)]){if(_0x35904d[_0x330a8f(0x159)](_0x35904d['qHRHO'],'SDVjR'))return _0x4a09ec(_0x4746af,_0x616100[_0x330a8f(0x208)]);else _0x2112f1[_0x330a8f(0x1f4)]={};}_0x2112f1['locals']['auditLogged']=!![],_0x2112f1['json']({'success':!![]});}),app[_0x4f4910(0x1ae)](_0x4f4910(0x14f),(_0x216694,_0x233c15)=>{const _0x2451fa=_0x4f4910,_0x9f5ee5={'xtDZE':function(_0x310662){return _0x310662();},'bLfLQ':function(_0x151ce1,_0x1d4c12){return _0x151ce1!==_0x1d4c12;}};try{const _0x12b4de=_0x9f5ee5[_0x2451fa(0x155)](loadDepartmentTargets);let _0xf6348c=Array['isArray'](_0x12b4de)?[..._0x12b4de]:[];const {year:_0x4d162f,department:_0x40cc02,targetType:_0x440b61,target_level:_0x1f43ab,month:_0x23ac46,status:_0x573a70}=_0x216694[_0x2451fa(0x287)]||{};if(_0x4d162f){const _0x250882=parseInt(_0x4d162f,0xa);!Number[_0x2451fa(0x1be)](_0x250882)&&(_0xf6348c=_0xf6348c['filter'](_0x233869=>Number(_0x233869['year'])===_0x250882));}_0x40cc02&&(_0xf6348c=_0xf6348c[_0x2451fa(0x16f)](_0x2c15e9=>{const _0x2991a9=_0x2451fa,_0x1dd2d5=_0x2c15e9[_0x2991a9(0x115)]||_0x2c15e9[_0x2991a9(0x121)]||'';return _0x1dd2d5===_0x40cc02;}));_0x440b61&&(_0xf6348c=_0xf6348c['filter'](_0x160187=>_0x160187[_0x2451fa(0x1eb)]===_0x440b61));_0x1f43ab&&(_0xf6348c=_0xf6348c[_0x2451fa(0x16f)](_0x29151e=>_0x29151e[_0x2451fa(0x1e5)]===_0x1f43ab));if(_0x23ac46){if(_0x9f5ee5[_0x2451fa(0x151)]('IXyoL',_0x2451fa(0x160)))_0x42de59['status'](0x1f4)[_0x2451fa(0x267)]({'error':_0x2451fa(0x207)});else{const _0x5e3b73=parseInt(_0x23ac46,0xa);!Number['isNaN'](_0x5e3b73)&&(_0xf6348c=_0xf6348c['filter'](_0x40cd65=>Number(_0x40cd65['month'])===_0x5e3b73));}}_0x573a70&&(_0x2451fa(0x129)!=='tfaST'?_0x42d4e8[_0x2451fa(0x17b)](0x1f4)[_0x2451fa(0x267)]({'error':_0x2451fa(0x18f)}):_0xf6348c=_0xf6348c['filter'](_0x35191f=>_0x35191f[_0x2451fa(0x17b)]===_0x573a70)),_0x233c15[_0x2451fa(0x267)](_0xf6348c);}catch(_0x3c22c5){_0x233c15['status'](0x1f4)['json']({'error':_0x2451fa(0x25f)});}}),app[_0x4f4910(0x1d3)]('/api/department-targets',(_0x56f94d,_0x4068d5)=>{const _0x3bde0c=_0x4f4910,_0x5734b4={'GkOef':function(_0x4898eb){return _0x4898eb();},'mKaaO':function(_0x5cb539,_0x5c1880){return _0x5cb539(_0x5c1880);},'XySpD':function(_0xb92f27,_0x45f5ec){return _0xb92f27!==_0x45f5ec;},'KnIAr':function(_0x3802d6,_0x56d307){return _0x3802d6(_0x56d307);}};try{const _0x190957=_0x56f94d[_0x3bde0c(0x1e1)]||{},_0x8c549d=loadDepartmentTargets(),_0x5917c5=getNextId(_0x8c549d),_0x41a1c2=new Date()[_0x3bde0c(0x2a2)](),_0x10e440=_0x5734b4[_0x3bde0c(0x18a)](loadDepartmentsStore);let _0x203db6=_0x190957[_0x3bde0c(0x115)]||'';if(!_0x203db6&&_0x190957[_0x3bde0c(0x1c2)]&&Array[_0x3bde0c(0x1ad)](_0x10e440)){const _0x115e1f=_0x10e440['find'](_0x5f21a1=>_0x5f21a1['id']===_0x190957['department_id']);_0x115e1f&&_0x115e1f['name']&&(_0x203db6=_0x115e1f['name']);}const _0x263e08={'id':_0x5917c5,'created_at':_0x41a1c2,'year':_0x190957[_0x3bde0c(0x150)]?parseInt(_0x190957['year'],0xa):null,'department_id':_0x190957[_0x3bde0c(0x1c2)]||null,'department':_0x203db6,'department_name':_0x203db6,'target_level':_0x190957[_0x3bde0c(0x1e5)]||'','target_type':_0x190957['target_type']||'','target_name':_0x190957['target_name']||'','target_value':_0x190957['target_value']!==undefined&&_0x190957['target_value']!==null?Number(_0x190957[_0x3bde0c(0x216)]):null,'unit':_0x190957[_0x3bde0c(0x170)]||'','month':_0x190957[_0x3bde0c(0x10a)]!==undefined&&_0x190957['month']!==null?_0x5734b4['mKaaO'](Number,_0x190957['month']):null,'quarter':_0x190957[_0x3bde0c(0x213)]||'','current_value':_0x5734b4[_0x3bde0c(0x2e6)](_0x190957['current_value'],undefined)&&_0x190957['current_value']!==null?_0x5734b4[_0x3bde0c(0x15f)](Number,_0x190957['current_value']):null,'status':_0x190957[_0x3bde0c(0x17b)]||'','completion_rate':_0x190957[_0x3bde0c(0x1cc)]||'','responsible_person':_0x190957[_0x3bde0c(0x222)]||'','description':_0x190957['description']||''};_0x8c549d['push'](_0x263e08),saveDepartmentTargets(_0x8c549d),_0x4068d5['json'](_0x263e08);}catch(_0x265dbd){_0x4068d5[_0x3bde0c(0x17b)](0x1f4)['json']({'error':_0x3bde0c(0x1cb)});}}),app['put']('/api/department-targets/:id',(_0x1f5382,_0x1efd7d)=>{const _0x2568ee=_0x4f4910,_0x148812={'DiYXE':function(_0x23fd05){return _0x23fd05();},'teWHr':function(_0x58bd1c,_0xe610d1){return _0x58bd1c!==_0xe610d1;},'MxWvq':function(_0x4eb3fc,_0x593594,_0xd933c2){return _0x4eb3fc(_0x593594,_0xd933c2);},'RTnPW':function(_0x5e3128,_0x92ac6e){return _0x5e3128===_0x92ac6e;},'MuIir':'RJiwO','RbXAi':function(_0x53f7c8,_0x50bf0a){return _0x53f7c8!==_0x50bf0a;},'bGPmA':function(_0x2041f9,_0x189466){return _0x2041f9!==_0x189466;},'IthBG':function(_0xee4456,_0x28700a){return _0xee4456!==_0x28700a;},'lErZI':function(_0x562654,_0x115654){return _0x562654(_0x115654);},'xFbtz':function(_0x2e6390,_0x3da03d){return _0x2e6390!==_0x3da03d;}};try{const _0x3f91b4=parseInt(_0x1f5382['params']['id'],0xa),_0x16714a=_0x1f5382[_0x2568ee(0x1e1)]||{},_0x398d99=loadDepartmentTargets(),_0x202c1c=_0x398d99[_0x2568ee(0x112)](_0x3cd008=>_0x3cd008['id']===_0x3f91b4);if(_0x148812['RTnPW'](_0x202c1c,-0x1)){_0x1efd7d['status'](0x194)['json']({'error':_0x2568ee(0x1e7)});return;}const _0x9c805a=_0x148812[_0x2568ee(0x1d6)](loadDepartmentsStore);let _0x2fe94e=_0x16714a[_0x2568ee(0x115)]||_0x398d99[_0x202c1c]['department']||'';if(!_0x2fe94e&&_0x16714a[_0x2568ee(0x1c2)]&&Array['isArray'](_0x9c805a)){const _0x54dae7=_0x9c805a[_0x2568ee(0x2c4)](_0x43973a=>_0x43973a['id']===_0x16714a['department_id']);if(_0x54dae7&&_0x54dae7['name']){if(_0x148812[_0x2568ee(0x1de)]!==_0x2568ee(0x29b))_0x2fe94e=_0x54dae7[_0x2568ee(0x19b)];else{const _0xcdb6bd=_0x59d12b(_0x17faf4[_0x2568ee(0x26a)]['id'],0xa),_0x2fb92e=_0x3627c2[_0x2568ee(0x1e1)]||{},_0x13b4ba=_0x148812[_0x2568ee(0x1d6)](_0x3b7f1c),_0x291d97=_0x13b4ba[_0x2568ee(0x112)](_0x54f141=>_0x54f141['id']===_0xcdb6bd);if(_0x291d97===-0x1){_0x339d79[_0x2568ee(0x17b)](0x194)[_0x2568ee(0x267)]({'error':'大事件记录不存在'});return;}const _0x14a3c1={..._0x13b4ba[_0x291d97],..._0x2fb92e};if(_0x148812[_0x2568ee(0x183)](_0x2fb92e[_0x2568ee(0x150)],_0x513ed8)&&_0x2fb92e['year']!==null){const _0x4a1cbc=_0x148812[_0x2568ee(0x11d)](_0x504b82,_0x2fb92e[_0x2568ee(0x150)],0xa);!_0x1cfa0f[_0x2568ee(0x1be)](_0x4a1cbc)&&(_0x14a3c1['year']=_0x4a1cbc);}_0x13b4ba[_0x291d97]=_0x14a3c1,_0x43ab1d(_0x13b4ba),_0xf1987c[_0x2568ee(0x267)](_0x14a3c1);}}}const _0x2b1e55={..._0x398d99[_0x202c1c],..._0x16714a,'year':_0x148812['RbXAi'](_0x16714a[_0x2568ee(0x150)],undefined)&&_0x16714a['year']!==null?parseInt(_0x16714a['year'],0xa):_0x398d99[_0x202c1c]['year'],'department_id':_0x16714a[_0x2568ee(0x1c2)]!==undefined?_0x16714a[_0x2568ee(0x1c2)]:_0x398d99[_0x202c1c][_0x2568ee(0x1c2)]||null,'department':_0x2fe94e||_0x398d99[_0x202c1c]['department']||'','department_name':_0x2fe94e||_0x398d99[_0x202c1c][_0x2568ee(0x121)]||'','target_value':_0x148812[_0x2568ee(0x162)](_0x16714a['target_value'],undefined)&&_0x148812['IthBG'](_0x16714a['target_value'],null)?_0x148812['lErZI'](Number,_0x16714a['target_value']):_0x398d99[_0x202c1c][_0x2568ee(0x216)],'month':_0x16714a[_0x2568ee(0x10a)]!==undefined&&_0x148812['xFbtz'](_0x16714a[_0x2568ee(0x10a)],null)?Number(_0x16714a['month']):_0x398d99[_0x202c1c][_0x2568ee(0x10a)],'current_value':_0x16714a[_0x2568ee(0x1a4)]!==undefined&&_0x16714a['current_value']!==null?_0x148812[_0x2568ee(0x23c)](Number,_0x16714a['current_value']):_0x398d99[_0x202c1c]['current_value']};_0x398d99[_0x202c1c]=_0x2b1e55,saveDepartmentTargets(_0x398d99),_0x1efd7d['json'](_0x2b1e55);}catch(_0x3ef503){_0x1efd7d['status'](0x1f4)['json']({'error':_0x2568ee(0x2b5)});}}),app['delete']('/api/department-targets/:id',(_0x308201,_0x35724e)=>{const _0x485e10=_0x4f4910,_0x1c1f3d={'MXjxE':function(_0x31a3c0,_0x1087ab,_0xa2d1f2){return _0x31a3c0(_0x1087ab,_0xa2d1f2);},'GrrnD':function(_0x442d61,_0x20daf6){return _0x442d61!==_0x20daf6;},'VlPxm':_0x485e10(0x1e7),'uDmHy':function(_0x554bcf,_0x48f6b5){return _0x554bcf(_0x48f6b5);}};try{const _0x562f90=_0x1c1f3d[_0x485e10(0x2cc)](parseInt,_0x308201[_0x485e10(0x26a)]['id'],0xa),_0xf99143=loadDepartmentTargets(),_0x163037=_0xf99143['filter'](_0x19a301=>_0x19a301['id']!==_0x562f90),_0x56c4f7=_0x1c1f3d[_0x485e10(0x1b9)](_0x163037[_0x485e10(0x2c1)],_0xf99143[_0x485e10(0x2c1)]);if(!_0x56c4f7){_0x35724e[_0x485e10(0x17b)](0x194)['json']({'success':![],'error':_0x1c1f3d[_0x485e10(0x2bd)]});return;}_0x1c1f3d[_0x485e10(0x1a7)](saveDepartmentTargets,_0x163037),_0x35724e[_0x485e10(0x267)]({'success':!![]});}catch(_0x371dd2){_0x35724e[_0x485e10(0x17b)](0x1f4)[_0x485e10(0x267)]({'success':![],'error':_0x485e10(0xdb)});}}),app['get'](_0x4f4910(0x16d),(_0x31bcfc,_0x5f3960)=>{const _0x4e61d1=_0x4f4910,_0x1e5ea8=loadNotificationsStore();_0x5f3960[_0x4e61d1(0x267)](_0x1e5ea8);}),app['post']('/api/notifications',(_0x1bb27b,_0x612df8)=>{const _0x58369e=_0x4f4910,_0x25c36b={'GtWnZ':function(_0x58793,_0x4b17d5){return _0x58793+_0x4b17d5;}},_0x151123=loadNotificationsStore(),_0x3639ae={'id':_0x25c36b['GtWnZ'](_0x151123['length'],0x1),..._0x1bb27b['body'],'created_at':new Date()[_0x58369e(0x2a2)]()};_0x151123['push'](_0x3639ae),saveNotificationsStore(_0x151123),io['to'](_0x58369e(0x208))['emit']('new-notification',_0x3639ae),_0x612df8[_0x58369e(0x267)](_0x3639ae);}),app[_0x4f4910(0x261)]('/api/notifications/:id',(_0x5d53d0,_0x4708fc)=>{const _0x3d027b=_0x4f4910,_0x3543ed={'XECfF':function(_0x32f458,_0x1cae5d){return _0x32f458(_0x1cae5d);},'peOoy':function(_0x3ecbae){return _0x3ecbae();}},_0x48d092=_0x3543ed[_0x3d027b(0x23f)](parseInt,_0x5d53d0[_0x3d027b(0x26a)]['id']),_0x27a67c=_0x3543ed[_0x3d027b(0x17e)](loadNotificationsStore),_0x1747f6=_0x27a67c['findIndex'](_0x953937=>_0x953937['id']===_0x48d092);_0x1747f6!==-0x1?(_0x27a67c[_0x1747f6]={..._0x27a67c[_0x1747f6],..._0x5d53d0['body']},saveNotificationsStore(_0x27a67c),_0x4708fc[_0x3d027b(0x267)](_0x27a67c[_0x1747f6])):_0x4708fc[_0x3d027b(0x17b)](0x194)[_0x3d027b(0x267)]({'error':'Notification\x20not\x20found'});}),app[_0x4f4910(0x1dc)](_0x4f4910(0x200),(_0x2e4cc5,_0x5cbe3d)=>{const _0x3abe3e=_0x4f4910,_0x123cc3={'KkbIp':function(_0x45dcb9,_0x5dc842){return _0x45dcb9(_0x5dc842);}},_0x30b370=_0x123cc3[_0x3abe3e(0x266)](parseInt,_0x2e4cc5[_0x3abe3e(0x26a)]['id']),_0x57c6f5=loadNotificationsStore(),_0x322ebb=_0x57c6f5['filter'](_0x6d1b6e=>_0x6d1b6e['id']!==_0x30b370),_0x226ded=_0x322ebb['length']!==_0x57c6f5['length'];_0x226ded&&_0x123cc3[_0x3abe3e(0x266)](saveNotificationsStore,_0x322ebb),_0x5cbe3d['json']({'success':!![]});}),app[_0x4f4910(0x1d3)](_0x4f4910(0xee),(_0x1249bf,_0x10d1fe)=>{const _0x5c13c8=_0x4f4910,_0x5db00c={'PnZor':function(_0x1c2578){return _0x1c2578();},'kinbZ':'unread','TFTKb':'notifications'},_0x40d47e=_0x5db00c[_0x5c13c8(0x140)](loadNotificationsStore),_0x2a01f1={'id':_0x40d47e[_0x5c13c8(0x2c1)]+0x1,..._0x1249bf[_0x5c13c8(0x1e1)],'status':_0x5db00c['kinbZ'],'created_at':new Date()['toISOString']()};_0x40d47e['push'](_0x2a01f1),saveNotificationsStore(_0x40d47e),io['to'](_0x5db00c[_0x5c13c8(0x10d)])[_0x5c13c8(0x2a1)]('new-notification',_0x2a01f1),_0x10d1fe['json'](_0x2a01f1);}),app['post']('/api/dingtalk/test-connection',async(_0x1437e7,_0xeff1db)=>{const _0x39270b=_0x4f4910,_0x194d41={'KZrzX':_0x39270b(0x1b0),'amAkH':_0x39270b(0x1f8)},_0x27fe45=_0x1437e7[_0x39270b(0x1e1)]||{},_0x504039=_0x27fe45[_0x39270b(0x175)]||'';if(!_0x504039||typeof _0x504039!==_0x39270b(0x2d4)){_0xeff1db[_0x39270b(0x17b)](0x190)['json']({'success':![],'message':'缺少有效的Webhook地址','error':_0x194d41['KZrzX']});return;}try{const _0x259987=await _0x4d7aa1[_0x39270b(0x1d3)](_0x504039,{'msgtype':_0x194d41[_0x39270b(0x202)],'text':{'content':'测试消息：连接成功'}});_0xeff1db[_0x39270b(0x267)]({'success':!![],'message':'连接正常','response':_0x259987[_0x39270b(0x1bc)]});}catch(_0x4a3fba){console[_0x39270b(0x11b)]('DingTalk\x20connection\x20test\x20failed:',_0x4a3fba),_0xeff1db['status'](0x1f4)['json']({'success':![],'message':'连接失败','error':_0x4a3fba['message']});}}),app['post']('/api/dingtalk/send-message',async(_0x23a456,_0x1e02d6)=>{const _0x3faeaf=_0x4f4910,_0x435d48={'zGeCk':function(_0x275317,_0x482b6e){return _0x275317===_0x482b6e;},'XzZPr':_0x3faeaf(0xda),'Kxjph':'emailPassword','YzheZ':function(_0x366833,_0x2d0ee3){return _0x366833===_0x2d0ee3;},'DqONI':'webhookUrl','twyrt':_0x3faeaf(0x2d4),'APhEq':_0x3faeaf(0x1f8),'Qzwlg':'测试消息','ddOjf':_0x3faeaf(0x26b),'FElKN':_0x3faeaf(0x17a)},_0x4133a4=_0x23a456[_0x3faeaf(0x1e1)]||{},_0x460ab3=_0x4133a4[_0x3faeaf(0x175)]||'',_0x29dff4=_0x4133a4['msgtype']||'text';if(!_0x460ab3||typeof _0x460ab3!==_0x435d48[_0x3faeaf(0xff)]){_0x1e02d6['status'](0x190)['json']({'success':![],'message':_0x3faeaf(0x2d3),'error':'缺少Webhook地址'});return;}try{let _0x1be092;if(_0x29dff4===_0x435d48[_0x3faeaf(0x1f6)]){if(_0x4133a4[_0x3faeaf(0x22b)]&&_0x4133a4['content'])_0x1be092={'msgtype':_0x3faeaf(0x1f8),'text':{'content':_0x4133a4['title']+'\x0a'+_0x4133a4[_0x3faeaf(0x14d)]}};else{const _0x1605eb=_0x4133a4['content']||_0x435d48[_0x3faeaf(0x192)];_0x1be092={'msgtype':_0x435d48[_0x3faeaf(0x1f6)],'text':{'content':_0x1605eb}};}}else _0x1be092={'msgtype':_0x29dff4,..._0x4133a4};const _0xfb6e9=await _0x4d7aa1['post'](_0x460ab3,_0x1be092);_0x1e02d6[_0x3faeaf(0x267)]({'success':!![],'message':_0x435d48['ddOjf'],'response':_0xfb6e9[_0x3faeaf(0x1bc)]});}catch(_0x1d95d3){if('rfaSk'===_0x3faeaf(0x131))console['error'](_0x3faeaf(0x2ad),_0x1d95d3),_0x1e02d6[_0x3faeaf(0x17b)](0x1f4)[_0x3faeaf(0x267)]({'success':![],'message':_0x435d48[_0x3faeaf(0x14e)],'error':_0x1d95d3[_0x3faeaf(0x2cd)]});else{if(_0x435d48['zGeCk'](_0x1ccb91,'integration')){const _0x21b3a6={..._0x219752};if(_0x5c398f['prototype']['hasOwnProperty']['call'](_0x21b3a6,_0x435d48[_0x3faeaf(0x257)]))_0x21b3a6['dingtalkAppKey']='';if(_0x187489['prototype']['hasOwnProperty'][_0x3faeaf(0x277)](_0x21b3a6,'dingtalkAppSecret'))_0x21b3a6['dingtalkAppSecret']='';if(_0x47277b[_0x3faeaf(0x1f0)]['hasOwnProperty'][_0x3faeaf(0x277)](_0x21b3a6,_0x435d48['Kxjph']))_0x21b3a6[_0x3faeaf(0x276)]='';_0x524ad9['value']=_0x21b3a6;}else{if(_0x435d48['YzheZ'](_0x41eb5f,'dingtalk_webhook')){const _0x3c40cd={..._0x353fec};if(_0x411777[_0x3faeaf(0x1f0)]['hasOwnProperty']['call'](_0x3c40cd,_0x435d48[_0x3faeaf(0xf2)]))_0x3c40cd[_0x3faeaf(0x175)]='';if(_0x310d5b[_0x3faeaf(0x1f0)]['hasOwnProperty']['call'](_0x3c40cd,'accessToken'))_0x3c40cd[_0x3faeaf(0x137)]='';if(_0x18550f['prototype']['hasOwnProperty']['call'](_0x3c40cd,'secret'))_0x3c40cd['secret']='';_0x4f1317[_0x3faeaf(0x1a5)]=_0x3c40cd;}else _0x3eaedf[_0x3faeaf(0x1a5)]=_0x3fadb4;}}}}),app['post']('/api/upload',upload['single'](_0x4f4910(0x27a)),async(_0x5e4792,_0x5ae1dd)=>{const _0x43a175=_0x4f4910,_0xecc016={'IdIkf':'Thivr'};try{if(!_0x5e4792[_0x43a175(0x27a)]||!_0x5e4792['file'][_0x43a175(0x2ba)])return _0x5ae1dd[_0x43a175(0x17b)](0x190)[_0x43a175(0x267)]({'error':_0x43a175(0x296)});const _0x5b62fc={'filename':_0x5e4792[_0x43a175(0x27a)]['originalname'],'size':_0x5e4792[_0x43a175(0x27a)]['size'],'mimetype':_0x5e4792['file']['mimetype'],'uploadedAt':new Date()['toISOString']()};_0x5ae1dd[_0x43a175(0x267)]({'success':!![],'file':_0x5b62fc});}catch(_0x4804e2){_0xecc016['IdIkf']===_0xecc016[_0x43a175(0x1ea)]?_0x5ae1dd[_0x43a175(0x17b)](0x1f4)[_0x43a175(0x267)]({'error':'文件上传失败'}):_0x39534e=_0x116265[_0x43a175(0x1e1)]||{};}}),app[_0x4f4910(0x1d3)](_0x4f4910(0x262),async(_0x9598d0,_0x6ec312)=>{const _0x4f730c=_0x4f4910,_0x474e5f={'kRMGP':function(_0x1cfbea,_0x3181b9){return _0x1cfbea(_0x3181b9);},'jGRFx':'POST','MzCJY':'LOGIN','fTOjO':_0x4f730c(0x262),'nIEVX':_0x4f730c(0x278),'vKiim':'登录失败：系统中不存在该用户','Tdsfe':'系统中不存在该用户，请联系管理员创建账号','NQgEH':_0x4f730c(0x114),'smMoN':'JGfgW','HpfDd':'$2b$','HYaQH':function(_0x40df3a,_0x575254){return _0x40df3a===_0x575254;},'xlPEG':'登录失败：用户名或密码错误'},{username:_0x50ae03,password:_0x7ab48d}=_0x9598d0['body'];if(!_0x50ae03||!_0x7ab48d)return _0x474e5f[_0x4f730c(0x13c)](appendAuditLog,{'username':_0x50ae03||'','role':'','method':_0x474e5f['jGRFx'],'path':_0x4f730c(0x262),'status':0x190,'ip':_0x9598d0['ip'],'ua':_0x9598d0[_0x4f730c(0xe7)]['user-agent']||'','query':_0x9598d0[_0x4f730c(0x287)]||{},'body':{'username':_0x50ae03},'action_type':_0x474e5f[_0x4f730c(0x1a9)],'details':_0x4f730c(0x19c)}),!_0x6ec312[_0x4f730c(0x1f4)]&&(_0x6ec312['locals']={}),_0x6ec312[_0x4f730c(0x1f4)][_0x4f730c(0x17c)]=!![],_0x6ec312['status'](0x190)[_0x4f730c(0x267)]({'error':'用户名和密码不能为空'});const _0x49d355=loadUsersStore(),_0x2363b3=_0x49d355[_0x4f730c(0x2c4)](_0x5d32b0=>_0x5d32b0[_0x4f730c(0xec)]===_0x50ae03);if(!_0x2363b3)return appendAuditLog({'username':_0x50ae03,'role':'','method':'POST','path':_0x474e5f[_0x4f730c(0x285)],'status':0x191,'ip':_0x9598d0['ip'],'ua':_0x9598d0[_0x4f730c(0xe7)][_0x474e5f[_0x4f730c(0x2d8)]]||'','query':_0x9598d0['query']||{},'body':{'username':_0x50ae03},'action_type':_0x474e5f['MzCJY'],'details':_0x474e5f['vKiim']}),!_0x6ec312['locals']&&(_0x6ec312[_0x4f730c(0x1f4)]={}),_0x6ec312['locals'][_0x4f730c(0x17c)]=!![],_0x6ec312['status'](0x191)['json']({'error':_0x474e5f[_0x4f730c(0x116)]});if(_0x2363b3['status']==='禁用'||_0x2363b3['status']===_0x474e5f['NQgEH']){_0x474e5f[_0x4f730c(0x13c)](appendAuditLog,{'username':_0x50ae03,'role':_0x2363b3['role']||'','method':_0x474e5f[_0x4f730c(0x273)],'path':_0x474e5f['fTOjO'],'status':0x193,'ip':_0x9598d0['ip'],'ua':_0x9598d0['headers'][_0x474e5f[_0x4f730c(0x2d8)]]||'','query':_0x9598d0[_0x4f730c(0x287)]||{},'body':{'username':_0x50ae03},'action_type':'LOGIN','details':'登录失败：用户账号已被禁用'});if(!_0x6ec312[_0x4f730c(0x1f4)]){if(_0x474e5f['smMoN']==='BZjYn'){if(!_0x138b96[_0x4f730c(0x2df)](_0x9e3f3d))return[];const _0x223525=_0x8f63ac['readFileSync'](_0xb2e78b,'utf-8'),_0x432091=_0x1de3b0[_0x4f730c(0x120)](_0x223525);return _0x4bc0ac['isArray'](_0x432091)?_0x432091:[];}else _0x6ec312[_0x4f730c(0x1f4)]={};}return _0x6ec312[_0x4f730c(0x1f4)]['auditLogged']=!![],_0x6ec312[_0x4f730c(0x17b)](0x193)[_0x4f730c(0x267)]({'error':'您的账号已被禁用，请联系管理员'});}let _0x1038d3=![];const _0x4ecbb8=_0x2363b3['password']||'';if(_0x4ecbb8&&(_0x4ecbb8['startsWith'](_0x4f730c(0x2e8))||_0x4ecbb8[_0x4f730c(0x23d)](_0x474e5f[_0x4f730c(0x2eb)])||_0x4ecbb8[_0x4f730c(0x23d)]('$2y$')))try{_0x1038d3=await _0x24dc88['compare'](_0x7ab48d,_0x4ecbb8);}catch(_0x2b4c29){_0x1038d3=![];}else _0x1038d3=_0x474e5f[_0x4f730c(0x1d0)](_0x7ab48d,_0x4ecbb8);if(!_0x1038d3)return appendAuditLog({'username':_0x50ae03,'role':'','method':_0x474e5f[_0x4f730c(0x273)],'path':'/api/login','status':0x191,'ip':_0x9598d0['ip'],'ua':_0x9598d0[_0x4f730c(0xe7)][_0x474e5f[_0x4f730c(0x2d8)]]||'','query':_0x9598d0[_0x4f730c(0x287)]||{},'body':{'username':_0x50ae03},'action_type':_0x4f730c(0x24c),'details':_0x474e5f['xlPEG']}),!_0x6ec312['locals']&&(_0x6ec312['locals']={}),_0x6ec312[_0x4f730c(0x1f4)][_0x4f730c(0x17c)]=!![],_0x6ec312[_0x4f730c(0x17b)](0x191)[_0x4f730c(0x267)]({'error':_0x4f730c(0x294)});const _0x4f3b22=new Date()[_0x4f730c(0x2a2)]();_0x2363b3[_0x4f730c(0xef)]=_0x4f3b22;const _0x5cdf60=_0x49d355[_0x4f730c(0x112)](_0x59a510=>_0x59a510['id']===_0x2363b3['id']);_0x5cdf60!==-0x1&&(_0x49d355[_0x5cdf60]=_0x2363b3,saveUsersStore(_0x49d355));const _0x109db9=generateJwtToken(_0x2363b3),_0x28740c=getUserPermissions(_0x2363b3),_0x43b2d3={'token':_0x109db9,'user':{'id':_0x2363b3['id'],'username':_0x2363b3[_0x4f730c(0xec)],'role':_0x2363b3['role'],'department':_0x2363b3[_0x4f730c(0x115)],'permissions':_0x28740c}};appendAuditLog({'username':_0x2363b3['username'],'role':_0x2363b3[_0x4f730c(0x13b)],'method':'POST','path':_0x474e5f['fTOjO'],'status':0xc8,'ip':_0x9598d0['ip'],'ua':_0x9598d0['headers']['user-agent']||'','query':_0x9598d0[_0x4f730c(0x287)]||{},'body':{'username':_0x2363b3[_0x4f730c(0xec)]},'action_type':_0x4f730c(0x24c),'details':_0x4f730c(0x280)}),!_0x6ec312['locals']&&(_0x6ec312[_0x4f730c(0x1f4)]={}),_0x6ec312[_0x4f730c(0x1f4)][_0x4f730c(0x17c)]=!![],_0x6ec312[_0x4f730c(0x267)](_0x43b2d3);});let onlineUsers=[];io['on'](_0x4f4910(0x2b4),_0x26ca6d=>{const _0x590aff=_0x4f4910,_0x4174c7={'uLyhQ':'xBjzl','kpqJc':_0x590aff(0x1cd),'TTudx':_0x590aff(0x251),'VrzBJ':'data-update','VaicH':_0x590aff(0x2bb)};console['log'](_0x4174c7[_0x590aff(0x1df)]),onlineUsers[_0x590aff(0x1dd)](_0x26ca6d['id']),io[_0x590aff(0x2a1)](_0x590aff(0x179),onlineUsers),_0x26ca6d['on']('join-room',_0x57159d=>{const _0x5dc3d3=_0x590aff,_0x323ef7={'KsAbQ':function(_0x5d8540,_0x4e7fc3){return _0x5d8540(_0x4e7fc3);}};if(_0x4174c7[_0x5dc3d3(0x1af)]===_0x4174c7['kpqJc']){const _0x25d902=new _0x87923()['toISOString'](),_0x33dc95=_0x1dd9da['body']||{},_0x5631b4=_0x57e799(),_0x3d171e=_0x13725e(_0x5631b4),_0x264c67={'id':_0x3d171e,'created_at':_0x25d902,'updated_at':_0x25d902,..._0x33dc95};_0x5631b4['push'](_0x264c67),_0x323ef7['KsAbQ'](_0x4b8b93,_0x5631b4),_0x117225[_0x5dc3d3(0x267)](_0x264c67);}else _0x26ca6d['join'](_0x57159d),console[_0x5dc3d3(0x1e0)](_0x5dc3d3(0xf1)+_0x57159d);}),_0x26ca6d['on'](_0x4174c7['VrzBJ'],_0x229d95=>{const {room:_0x21d2e7,..._0xd4a45c}=_0x229d95;_0x21d2e7&&_0x26ca6d['to'](_0x21d2e7)['emit']('data-updated',_0xd4a45c);}),_0x26ca6d['on'](_0x4174c7[_0x590aff(0x250)],()=>{const _0x2179d3=_0x590aff;console[_0x2179d3(0x1e0)](_0x2179d3(0x2d1)),onlineUsers=onlineUsers[_0x2179d3(0x16f)](_0x58366d=>_0x58366d!==_0x26ca6d['id']),io['emit'](_0x2179d3(0x179),onlineUsers);});}),app[_0x4f4910(0x1ae)](_0x4f4910(0x225),(_0x23e085,_0x1ddb3d)=>{const _0x7a7319=_0x4f4910;_0x1ddb3d[_0x7a7319(0x267)]({'status':'ok','timestamp':Date[_0x7a7319(0x178)]()});}),app[_0x4f4910(0x1ae)](_0x4f4910(0x2a9),(_0x903f5e,_0x11dc8d)=>{const _0x3e0ff4=_0x4f4910,_0x3b9f20={'yltLQ':_0x3e0ff4(0x2a4),'tTfBM':_0x3e0ff4(0x2d0)},_0x28bb78=loadCompanyInfoStore();if(_0x28bb78){_0x11dc8d[_0x3e0ff4(0x267)](_0x28bb78);return;}_0x11dc8d[_0x3e0ff4(0x267)]({'name':_0x3e0ff4(0x2a4),'short_name':_0x3b9f20['yltLQ'],'code':_0x3b9f20[_0x3e0ff4(0xf8)],'address':'','contact':'','phone':'','email':''});}),app[_0x4f4910(0x261)](_0x4f4910(0x2a9),(_0xe07a82,_0x5338ae)=>{const _0x1035f9={'OnvsQ':function(_0x3a0465,_0x3657f2){return _0x3a0465(_0x3657f2);}},_0x36c0ad=_0xe07a82['body']||{};_0x1035f9['OnvsQ'](saveCompanyInfoStore,_0x36c0ad),_0x5338ae['json'](_0x36c0ad);}),app[_0x4f4910(0x1ae)](_0x4f4910(0x220),(_0x4235d2,_0x1bd8b5)=>{_0x1bd8b5['json']({'dingtalkConfigured':![],'dingtalkEnabled':![]});}),app[_0x4f4910(0x1ae)]('/api/organization/tree',(_0x47b2c3,_0x3e275c)=>{const _0x2e477f=_0x4f4910,_0x20a517={'mshpc':function(_0x293c5c,_0x4d4335,_0x27969e){return _0x293c5c(_0x4d4335,_0x27969e);},'smRCe':'大事件记录不存在','fhPpH':function(_0x544484,_0x115b33){return _0x544484(_0x115b33);},'MGqvv':function(_0x511ef6,_0x1a0b51){return _0x511ef6===_0x1a0b51;}},_0x3e41a0=loadDepartmentsStore(),_0x22e33c=_0x3e41a0['map'](_0x558792=>({'id':_0x558792['id'],'name':_0x558792['name'],'code':_0x558792['code'],'parent_id':_0x558792['parent_id']||null,'type':(_0x558792['type']||_0x2e477f(0x2aa))['toUpperCase'](),'manager':_0x558792['manager']||'','status':_0x558792['status']||'active','created_at':_0x558792[_0x2e477f(0x189)]})),_0x3c5996={},_0x3299f3=[];for(const _0x3a806c of _0x22e33c){_0x3c5996[_0x3a806c['id']]={..._0x3a806c,'children':[]};}for(const _0x5e0d5f of _0x22e33c){if(_0x20a517['MGqvv'](_0x2e477f(0x282),_0x2e477f(0x282))){const _0x3ac4d0=_0x5e0d5f['parent_id'];if(_0x3ac4d0&&_0x3c5996[_0x3ac4d0])_0x3c5996[_0x3ac4d0][_0x2e477f(0x2b1)][_0x2e477f(0x1dd)](_0x3c5996[_0x5e0d5f['id']]);else{if(_0x20a517[_0x2e477f(0x2b7)](_0x2e477f(0x1da),_0x2e477f(0x1da)))_0x3299f3['push'](_0x3c5996[_0x5e0d5f['id']]);else return[];}}else try{const _0x1161c2=_0x20a517['mshpc'](_0x2fd99c,_0x2367c0[_0x2e477f(0x26a)]['id'],0xa),_0x2d414c=_0x29e2a7(),_0x3c3c25=_0x2d414c['filter'](_0x2517c9=>_0x2517c9['id']!==_0x1161c2),_0x32b185=_0x3c3c25[_0x2e477f(0x2c1)]!==_0x2d414c[_0x2e477f(0x2c1)];if(!_0x32b185){_0x4c43db['status'](0x194)['json']({'success':![],'error':_0x20a517['smRCe']});return;}_0x20a517[_0x2e477f(0x152)](_0xa2a2ef,_0x3c3c25),_0x1cea0e[_0x2e477f(0x267)]({'success':!![]});}catch(_0x4ddb34){_0x5ce243[_0x2e477f(0x17b)](0x1f4)[_0x2e477f(0x267)]({'success':![],'error':_0x2e477f(0x19e)});}}_0x3e275c['json'](_0x3299f3);}),app['get']('/api/templates',(_0x4f6b68,_0x3fbeb5)=>{const _0xd8fc8e=_0x4f4910,_0x11bb98={'EQAOV':function(_0x341e7f){return _0x341e7f();}},_0x20c7a1=_0x11bb98[_0xd8fc8e(0x2af)](loadTemplatesStore);_0x3fbeb5[_0xd8fc8e(0x267)](_0x20c7a1);}),app['post']('/api/templates',(_0x3baa3e,_0x39458c)=>{const _0x359678=_0x4f4910,_0x274d4a=new Date()['toISOString'](),_0x48f35d=_0x3baa3e['body']||{},_0x1a7b71=loadTemplatesStore(),_0x1f1a9b=getNextId(_0x1a7b71),_0x498f8b={'id':_0x1f1a9b,'created_at':_0x274d4a,'updated_at':_0x274d4a,..._0x48f35d};_0x1a7b71[_0x359678(0x1dd)](_0x498f8b),saveTemplatesStore(_0x1a7b71),_0x39458c['json'](_0x498f8b);}),app[_0x4f4910(0x261)](_0x4f4910(0x21b),(_0x39f8b7,_0x442a33)=>{const _0x5586e1=_0x4f4910,_0x5cbb22={'qrmvW':function(_0x2a4a36,_0xf789b8,_0x2c7944){return _0x2a4a36(_0xf789b8,_0x2c7944);},'MBIDQ':'Template\x20not\x20found'},_0x3f38d6=_0x5cbb22[_0x5586e1(0x166)](parseInt,_0x39f8b7['params']['id'],0xa),_0x3a3796=loadTemplatesStore(),_0x3be446=_0x3a3796['findIndex'](_0x469897=>_0x469897['id']===_0x3f38d6);if(_0x3be446===-0x1){_0x442a33[_0x5586e1(0x17b)](0x194)['json']({'error':_0x5cbb22['MBIDQ']});return;}const _0x4c23c4=_0x39f8b7['body']||{};_0x3a3796[_0x3be446]={..._0x3a3796[_0x3be446],..._0x4c23c4,'updated_at':new Date()[_0x5586e1(0x2a2)]()},saveTemplatesStore(_0x3a3796),_0x442a33[_0x5586e1(0x267)](_0x3a3796[_0x3be446]);}),app['delete']('/api/templates/:id',(_0x4614ea,_0x35113d)=>{const _0x55e72c=_0x4f4910,_0x1e99b0={'bfdxv':function(_0x374d36){return _0x374d36();},'JMmXK':function(_0x39a858,_0x2d2465){return _0x39a858!==_0x2d2465;},'AqEXh':'DDqCf','XPUHQ':_0x55e72c(0x1ca),'nHUeG':_0x55e72c(0x181)},_0x3f7008=parseInt(_0x4614ea[_0x55e72c(0x26a)]['id'],0xa),_0x194be5=_0x1e99b0[_0x55e72c(0x1e8)](loadTemplatesStore),_0x2de24e=_0x194be5['filter'](_0x546b65=>_0x546b65['id']!==_0x3f7008),_0x1b57fe=_0x2de24e['length']!==_0x194be5['length'];_0x1b57fe&&saveTemplatesStore(_0x2de24e);if(!_0x1b57fe){if(_0x1e99b0['JMmXK'](_0x1e99b0['AqEXh'],_0x1e99b0[_0x55e72c(0x227)])){_0x35113d[_0x55e72c(0x17b)](0x194)[_0x55e72c(0x267)]({'error':_0x1e99b0['nHUeG']});return;}else _0x3891fd['status'](0x1f4)[_0x55e72c(0x267)]({'error':'保存部门目标分解数据失败'});}_0x35113d[_0x55e72c(0x267)]({'success':!![]});}),app[_0x4f4910(0x1d3)](_0x4f4910(0x195),(_0x3f14d0,_0x339ae8)=>{const _0x1ff71b=_0x4f4910,_0x246f78={'FTlns':function(_0x2ce5cf,_0x3e7a8a){return _0x2ce5cf===_0x3e7a8a;},'dpdZc':'hMmFS'};try{if(_0x246f78['FTlns'](_0x246f78[_0x1ff71b(0x134)],'hMmFS'))cleanupSystemData(),_0x339ae8['json']({'success':!![]});else{const _0x2fd833=_0x37fc6b();_0x2b0ad3[_0x1ff71b(0x267)](_0x2fd833);}}catch(_0x4368d2){_0x339ae8['status'](0x1f4)[_0x1ff71b(0x267)]({'error':_0x1ff71b(0x1bf)});}}),app[_0x4f4910(0x1ae)](_0x4f4910(0x14b),async(_0x25ff56,_0x1c8eef)=>{const _0x577b70=_0x4f4910,_0xfd35b7={'tZcuD':function(_0x1deb22,_0x93a363,_0x2ff5b1){return _0x1deb22(_0x93a363,_0x2ff5b1);},'zKFqc':function(_0x8a142d){return _0x8a142d();},'bXgVY':function(_0x421f1e,_0x3898f9){return _0x421f1e>_0x3898f9;},'BkAIo':function(_0x270051,_0x1b30cc){return _0x270051+_0x1b30cc;}},_0x4ab7b0=parseInt(_0x25ff56[_0x577b70(0x287)][_0x577b70(0x256)],0xa),_0x1288b6=_0xfd35b7[_0x577b70(0x15a)](parseInt,_0x25ff56['query']['offset'],0xa),_0x5cd499=await _0xfd35b7[_0x577b70(0x25a)](listBackupFiles),_0x43dd4e=Number['isFinite'](_0x1288b6)&&_0xfd35b7['bXgVY'](_0x1288b6,0x0)?_0x1288b6:0x0,_0x152cee=Number[_0x577b70(0x2bc)](_0x4ab7b0)&&_0xfd35b7['bXgVY'](_0x4ab7b0,0x0)?_0xfd35b7['BkAIo'](_0x43dd4e,_0x4ab7b0):undefined,_0x5150e1=_0x5cd499[_0x577b70(0x191)](_0x43dd4e,_0x152cee);_0x1c8eef['json']({'items':_0x5150e1,'total':_0x5cd499['length']});}),app['post']('/api/admin/backup',async(_0x1cd442,_0x4a2dcb)=>{const _0x3c806d=_0x4f4910,_0x2fc82f={'cLxel':function(_0x406355,_0x5da85f){return _0x406355(_0x5da85f);},'jNgjf':function(_0x4aab4f,_0x3f7f80){return _0x4aab4f(_0x3f7f80);},'gJrEy':function(_0x4f5ea8){return _0x4f5ea8();},'txwps':function(_0x10964c){return _0x10964c();},'RzDFr':function(_0x322998){return _0x322998();},'YWnmB':function(_0x7cad31){return _0x7cad31();},'qDoIf':_0x3c806d(0x20c)};try{const _0x8e2ca8=new Date(),_0x53fbf4=_0x503909=>_0x503909<0xa?'0'+_0x503909:String(_0x503909),_0x530573=_0x3c806d(0x173)+_0x8e2ca8[_0x3c806d(0x1c5)]()+'-'+_0x53fbf4(_0x8e2ca8[_0x3c806d(0x29d)]()+0x1)+'-'+_0x2fc82f[_0x3c806d(0x11a)](_0x53fbf4,_0x8e2ca8[_0x3c806d(0x27d)]())+'_'+_0x53fbf4(_0x8e2ca8['getHours']())+'-'+_0x2fc82f['jNgjf'](_0x53fbf4,_0x8e2ca8['getMinutes']())+'-'+_0x53fbf4(_0x8e2ca8['getSeconds']())+_0x3c806d(0xe8),_0x2ac2bb={'createdAt':_0x8e2ca8['toISOString'](),'annual_work_plans':loadAnnualWorkPlans(),'major_events':loadMajorEvents(),'monthly_progress':_0x2fc82f[_0x3c806d(0x163)](loadMonthlyProgress),'departments':_0x2fc82f[_0x3c806d(0x163)](loadDepartmentsStore),'employees':_0x2fc82f[_0x3c806d(0x13e)](loadEmployeesStore),'action_plans':_0x2fc82f[_0x3c806d(0x13e)](loadActionPlans),'notifications':_0x2fc82f['gJrEy'](loadNotificationsStore),'users':_0x2fc82f['gJrEy'](loadUsersStore),'target_types':loadTargetTypesStore(),'templates':_0x2fc82f[_0x3c806d(0x163)](loadTemplatesStore),'department_targets':_0x2fc82f['RzDFr'](loadDepartmentTargets),'system_settings':loadSystemSettings(),'audit_logs':_0x2fc82f[_0x3c806d(0x2b9)](loadAuditLogs),'company_info':loadCompanyInfoStore()||null},_0x22f24e=_0x472215['join'](BACKUP_DIR,_0x530573);await _0x3aa014['writeFile'](_0x22f24e,JSON['stringify'](_0x2ac2bb,null,0x2),'utf-8'),_0x4a2dcb['json']({'path':_0x22f24e,'name':_0x530573});}catch(_0x316823){_0x4a2dcb[_0x3c806d(0x17b)](0x1f4)[_0x3c806d(0x267)]({'error':_0x2fc82f[_0x3c806d(0x145)]});}}),app['post'](_0x4f4910(0x126),async(_0x483baf,_0x4b2cb4)=>{const _0x2445a4=_0x4f4910,_0x1ff50e={'abzTL':'缺少备份文件名','wpFyN':function(_0x362e4d,_0x2fa065){return _0x362e4d(_0x2fa065);},'Ytdol':'备份恢复失败'};try{const _0x400b46=_0x483baf['body']&&_0x483baf[_0x2445a4(0x1e1)]['name']||'';if(!_0x400b46){_0x4b2cb4['status'](0x190)[_0x2445a4(0x267)]({'error':_0x1ff50e['abzTL']});return;}const _0xe858e3=_0x472215[_0x2445a4(0x142)](BACKUP_DIR,_0x400b46),_0x4c1bdf=await _0x3aa014['readFile'](_0xe858e3,'utf-8'),_0x2b50b9=JSON[_0x2445a4(0x120)](_0x4c1bdf);_0x1ff50e['wpFyN'](applyBackupSnapshot,_0x2b50b9),_0x4b2cb4[_0x2445a4(0x267)]({'success':!![]});}catch(_0x4bc21b){_0x4b2cb4[_0x2445a4(0x17b)](0x1f4)[_0x2445a4(0x267)]({'error':_0x1ff50e['Ytdol']});}}),app['post']('/api/admin/backups/restore-upload',upload['single'](_0x4f4910(0x27a)),async(_0x552096,_0x2e8264)=>{const _0x156952=_0x4f4910,_0x442e02={'EYwjk':_0x156952(0x106),'fQqFp':_0x156952(0x177),'wSsOs':_0x156952(0x244)};try{if(_0x442e02['EYwjk']!==_0x156952(0xf4)){if(!_0x552096['file']||!_0x552096['file']['buffer']){_0x2e8264['status'](0x190)[_0x156952(0x267)]({'error':_0x442e02['fQqFp']});return;}const _0x10415a=_0x552096['file'][_0x156952(0x2ba)][_0x156952(0x24b)](_0x442e02['wSsOs']),_0x161216=JSON[_0x156952(0x120)](_0x10415a);applyBackupSnapshot(_0x161216),_0x2e8264[_0x156952(0x267)]({'success':!![]});}else _0x33780e[_0x156952(0x1f4)]={};}catch(_0x3cf67b){_0x2e8264[_0x156952(0x17b)](0x190)[_0x156952(0x267)]({'error':'备份文件解析失败'});}}),app[_0x4f4910(0x1ae)]('/api/admin/backups/download/:name',async(_0x32132b,_0x359abb)=>{const _0x61ad11=_0x4f4910,_0x4894e5={'yyOck':'缺少备份文件名','oxgRA':'下载备份失败'};try{const _0x3cdc58=_0x32132b['params']&&typeof _0x32132b['params']['name']==='string'?_0x32132b[_0x61ad11(0x26a)]['name']:'',_0x46ff29=decodeURIComponent(_0x3cdc58),_0x2918ba=_0x472215['basename'](_0x46ff29);if(!_0x2918ba){_0x359abb[_0x61ad11(0x17b)](0x190)[_0x61ad11(0x267)]({'error':_0x4894e5[_0x61ad11(0x119)]});return;}const _0x39b7a9=_0x472215['join'](BACKUP_DIR,_0x2918ba);if(!_0x401516['existsSync'](_0x39b7a9)){_0x359abb['status'](0x194)['json']({'error':'备份文件不存在'});return;}_0x359abb[_0x61ad11(0x15c)](_0x61ad11(0x20a),_0x61ad11(0x14a)),_0x359abb['download'](_0x39b7a9,_0x2918ba);}catch(_0x350bfb){_0x359abb['status'](0x1f4)[_0x61ad11(0x267)]({'error':_0x4894e5[_0x61ad11(0x248)]});}}),app['get']('/api/admin/backups/:name',async(_0x2ed46d,_0x40d996)=>{const _0x1aa0e2=_0x4f4910;try{const _0x23056b=decodeURIComponent(_0x2ed46d[_0x1aa0e2(0x26a)]['name']),_0x5c2f09=_0x472215[_0x1aa0e2(0x142)](BACKUP_DIR,_0x23056b);if(!_0x401516['existsSync'](_0x5c2f09)){_0x40d996[_0x1aa0e2(0x17b)](0x194)[_0x1aa0e2(0x267)]({'error':_0x1aa0e2(0x1d5)});return;}await _0x3aa014['unlink'](_0x5c2f09),_0x40d996[_0x1aa0e2(0x267)]({'success':!![]});}catch(_0x4b50d6){_0x40d996[_0x1aa0e2(0x17b)](0x1f4)[_0x1aa0e2(0x267)]({'error':_0x1aa0e2(0x182)});}}),app[_0x4f4910(0x1dc)]('/api/admin/backups/:name',async(_0x2575d0,_0x4ebde7)=>{const _0x534748=_0x4f4910,_0x1d8533={'TfGpp':function(_0x37a624,_0x5b1c1e){return _0x37a624(_0x5b1c1e);},'TAEwG':_0x534748(0x1d5),'GOGLh':'删除备份失败'};try{const _0x3bdb9d=_0x1d8533[_0x534748(0x105)](decodeURIComponent,_0x2575d0['params'][_0x534748(0x19b)]),_0x26f30a=_0x472215['join'](BACKUP_DIR,_0x3bdb9d);if(!_0x401516[_0x534748(0x2df)](_0x26f30a)){_0x4ebde7['status'](0x194)['json']({'error':_0x1d8533['TAEwG']});return;}await _0x3aa014['unlink'](_0x26f30a),_0x4ebde7[_0x534748(0x267)]({'success':!![]});}catch(_0x117dd7){_0x4ebde7['status'](0x1f4)['json']({'error':_0x1d8533['GOGLh']});}}),app['get']('*',(_0x244920,_0x15fe30)=>{const _0x15a967=_0x4f4910;_0x15fe30['sendFile'](_0x472215[_0x15a967(0x142)](__dirname,_0x15a967(0x156)));});let autoBackupInterval=null;function startAutoBackup(){const _0x190f0f=_0x4f4910,_0x3fe62c={'BHiMZ':function(_0x1ac665,_0x1f1ffa){return _0x1ac665(_0x1f1ffa);},'wNwTJ':function(_0x52bee2,_0x52cfda){return _0x52bee2+_0x52cfda;},'fepHF':function(_0x507be1,_0x84d631){return _0x507be1(_0x84d631);},'iMjUQ':function(_0x31cb47,_0xeee37){return _0x31cb47(_0xeee37);},'mJWoe':function(_0x43045d,_0x5318af){return _0x43045d(_0x5318af);},'LWRwm':function(_0x637d67){return _0x637d67();},'wrLKl':function(_0x446c01){return _0x446c01();},'joEcZ':function(_0x55fe89){return _0x55fe89();},'vLEpj':function(_0x57c369,_0x2880c0){return _0x57c369===_0x2880c0;},'eRKWn':function(_0x56539e){return _0x56539e();},'tVMXV':function(_0x2e8a4f,_0x14b5c1){return _0x2e8a4f*_0x14b5c1;},'QGYsq':function(_0x4fd271,_0x44d6c1,_0x20b99e){return _0x4fd271(_0x44d6c1,_0x20b99e);}};try{autoBackupInterval&&(_0x3fe62c[_0x190f0f(0x2ca)](clearInterval,autoBackupInterval),autoBackupInterval=null);const _0x104ed8=_0x3fe62c['eRKWn'](loadSystemSettings);let _0x12ac1d=_0x104ed8['find'](_0x22cd54=>_0x22cd54&&_0x22cd54['key']==='system'),_0xdda6b3=!![],_0x1f9364=0x18;if(_0x12ac1d)_0xdda6b3=_0x12ac1d?.['value']?.['autoBackup']??!![],_0x1f9364=_0x12ac1d?.['value']?.[_0x190f0f(0x2dd)]??0x18;else{const _0x18d87a=new Date()[_0x190f0f(0x2a2)](),_0x26cef7=_0x3fe62c[_0x190f0f(0x146)](getNextId,_0x104ed8);_0x12ac1d={'id':_0x26cef7,'key':'system','value':{'autoBackup':!![],'backupInterval':0x18},'created_at':_0x18d87a},_0x104ed8['push'](_0x12ac1d),_0x3fe62c[_0x190f0f(0x146)](saveSystemSettings,_0x104ed8),console['log']('创建默认系统设置：自动备份已启用，每24小时执行一次');}if(_0xdda6b3){console['log']('自动备份已启用，每\x20'+_0x1f9364+'\x20小时执行一次');const _0x30d982=_0x3fe62c[_0x190f0f(0x15d)](_0x3fe62c[_0x190f0f(0x15d)](_0x1f9364,0x3c),0x3c)*0x3e8;autoBackupInterval=_0x3fe62c[_0x190f0f(0x233)](setInterval,async()=>{const _0x160928=_0x190f0f;try{console[_0x160928(0x1e0)](_0x160928(0x2d2));const _0x6e511d=new Date(),_0x305669=_0x3e85a=>_0x3e85a<0xa?'0'+_0x3e85a:String(_0x3e85a),_0x44f98a='auto-backup-'+_0x6e511d['getFullYear']()+'-'+_0x3fe62c[_0x160928(0x146)](_0x305669,_0x3fe62c['wNwTJ'](_0x6e511d['getMonth'](),0x1))+'-'+_0x3fe62c['fepHF'](_0x305669,_0x6e511d['getDate']())+'_'+_0x3fe62c['iMjUQ'](_0x305669,_0x6e511d[_0x160928(0x117)]())+'-'+_0x305669(_0x6e511d['getMinutes']())+'-'+_0x3fe62c[_0x160928(0x2ca)](_0x305669,_0x6e511d['getSeconds']())+_0x160928(0xe8),_0x3fd71e={'createdAt':_0x6e511d[_0x160928(0x2a2)](),'annual_work_plans':_0x3fe62c['LWRwm'](loadAnnualWorkPlans),'major_events':_0x3fe62c[_0x160928(0x279)](loadMajorEvents),'monthly_progress':loadMonthlyProgress(),'departments':loadDepartmentsStore(),'employees':_0x3fe62c[_0x160928(0x260)](loadEmployeesStore),'action_plans':loadActionPlans(),'notifications':loadNotificationsStore(),'users':loadUsersStore(),'target_types':loadTargetTypesStore(),'templates':loadTemplatesStore(),'department_targets':loadDepartmentTargets(),'system_settings':_0x3fe62c[_0x160928(0x260)](loadSystemSettings),'audit_logs':loadAuditLogs(),'company_info':loadCompanyInfoStore()||null},_0x1e4846=_0x472215[_0x160928(0x142)](BACKUP_DIR,_0x44f98a);await _0x3aa014['writeFile'](_0x1e4846,JSON['stringify'](_0x3fd71e,null,0x2),'utf-8'),console['log']('自动备份成功：'+_0x44f98a);}catch(_0x44f72a){_0x3fe62c['vLEpj'](_0x160928(0x2ec),_0x160928(0x243))?_0x31f31e(_0x3ed190['templates']):console['error'](_0x160928(0x2cb),_0x44f72a);}},_0x30d982);}else console['log'](_0x190f0f(0x2c3));}catch(_0x3fac16){console['error']('初始化自动备份失败：',_0x3fac16);}}!process[_0x4f4910(0x130)]['RUN_DATA_CLEANUP_ONLY']&&server['listen'](PORT,()=>{console['log']('Server\x20running\x20on\x20http://localhost:'+PORT),setTimeout(startAutoBackup,0x1388);});app['post']('/api/admin/backup/reload',(_0x25f224,_0x35c1f5)=>{const _0x414067=_0x4f4910,_0x890c9c={'rhMMw':_0x414067(0x1ef)};try{_0x414067(0x246)===_0x890c9c[_0x414067(0x270)]?_0x591094=typeof _0xe5ad27['value']==='string'?_0x5145d5[_0x414067(0x120)](_0x93aa21[_0x414067(0x1a5)]):_0x213b03['value']||{}:(startAutoBackup(),_0x35c1f5['json']({'success':!![],'message':'自动备份设置已重新加载'}));}catch(_0x14b0bd){_0x35c1f5[_0x414067(0x17b)](0x1f4)[_0x414067(0x267)]({'success':![],'error':_0x414067(0x12a)});}});export{cleanupSystemData};