const _0xcff869=_0x1d17;(function(_0x12fc93,_0x158fc4){const _0x5d4f03=_0x1d17,_0x4dba05=_0x12fc93();while(!![]){try{const _0x4c59f8=-parseInt(_0x5d4f03(0x1e8))/0x1*(parseInt(_0x5d4f03(0x16a))/0x2)+parseInt(_0x5d4f03(0x207))/0x3*(parseInt(_0x5d4f03(0x140))/0x4)+-parseInt(_0x5d4f03(0x1c2))/0x5*(parseInt(_0x5d4f03(0x94))/0x6)+-parseInt(_0x5d4f03(0x234))/0x7*(-parseInt(_0x5d4f03(0x187))/0x8)+-parseInt(_0x5d4f03(0x150))/0x9*(parseInt(_0x5d4f03(0x221))/0xa)+parseInt(_0x5d4f03(0x210))/0xb*(-parseInt(_0x5d4f03(0x160))/0xc)+parseInt(_0x5d4f03(0x1a6))/0xd;if(_0x4c59f8===_0x158fc4)break;else _0x4dba05['push'](_0x4dba05['shift']());}catch(_0x250d34){_0x4dba05['push'](_0x4dba05['shift']());}}}(_0x3adc,0xd2027));import _0x368167 from'express';import _0x2210e1 from'cors';import _0xff515f from'path';function _0x1d17(_0x4049c0,_0x17f676){_0x4049c0=_0x4049c0-0x82;const _0x3adcda=_0x3adc();let _0x1d177c=_0x3adcda[_0x4049c0];return _0x1d177c;}import _0x345456 from'fs';import{promises as _0x378db8}from'fs';import{fileURLToPath}from'url';import{createServer}from'http';import{Server}from'socket.io';import _0x3347fe from'multer';import _0x569044 from'dotenv';import _0x38c9ea from'axios';import _0x2d5148 from'bcryptjs';import _0x261a60 from'jsonwebtoken';const __filename=fileURLToPath(import.meta.url),__dirname=_0xff515f[_0xcff869(0x255)](__filename);_0x569044['config']({'path':_0xff515f['resolve'](__dirname,'../.env')});const app=_0x368167(),server=createServer(app),io=new Server(server,{'cors':{'origin':'*','methods':['GET','POST','PUT','DELETE']}}),BACKUP_DIR=_0xff515f[_0xcff869(0x257)](__dirname,_0xcff869(0x1d7)),UPDATES_DIR=_0xff515f['join'](__dirname,_0xcff869(0xcc)),SYSTEM_SETTINGS_FILE=_0xff515f[_0xcff869(0x257)](__dirname,_0xcff869(0x1f5)),AUDIT_LOG_FILE=_0xff515f['join'](__dirname,_0xcff869(0x233)),DEPARTMENT_TARGETS_FILE=_0xff515f[_0xcff869(0x257)](__dirname,'../temp_store/department_targets.json'),ANNUAL_WORK_PLANS_FILE=_0xff515f['join'](__dirname,'../temp_store/annual_work_plans.json'),MAJOR_EVENTS_FILE=_0xff515f['join'](__dirname,'../temp_store/major_events.json'),MONTHLY_PROGRESS_FILE=_0xff515f[_0xcff869(0x257)](__dirname,_0xcff869(0x14b)),ACTION_PLANS_FILE=_0xff515f['join'](__dirname,'../temp_store/action_plans.json'),DEPARTMENTS_FILE=_0xff515f['join'](__dirname,_0xcff869(0x10a)),EMPLOYEES_FILE=_0xff515f['join'](__dirname,'../temp_store/employees.json'),USERS_FILE=_0xff515f['join'](__dirname,_0xcff869(0x241)),TARGET_TYPES_FILE=_0xff515f['join'](__dirname,'../temp_store/target_types.json'),ROLES_FILE=_0xff515f[_0xcff869(0x257)](__dirname,_0xcff869(0x25a)),TEMPLATES_FILE=_0xff515f[_0xcff869(0x257)](__dirname,'../temp_store/templates.json'),NOTIFICATIONS_FILE=_0xff515f['join'](__dirname,'../temp_store/notifications.json'),COMPANY_INFO_FILE=_0xff515f[_0xcff869(0x257)](__dirname,'../temp_store/company_info.json'),upload=_0x3347fe({'storage':_0x3347fe['memoryStorage']()}),JWT_SECRET=process[_0xcff869(0x109)]['JWT_SECRET']||_0xcff869(0x206),JWT_EXPIRES_IN=process[_0xcff869(0x109)][_0xcff869(0x148)]||'2h',PORT=0x138c;!_0x345456['existsSync'](BACKUP_DIR)&&_0x345456['mkdirSync'](BACKUP_DIR,{'recursive':!![]});!_0x345456['existsSync'](UPDATES_DIR)&&_0x345456[_0xcff869(0x1a0)](UPDATES_DIR,{'recursive':!![]});app[_0xcff869(0x16f)](_0x2210e1()),app[_0xcff869(0x16f)](_0x368167[_0xcff869(0xca)]()),app['use'](_0x368167['urlencoded']({'extended':!![]})),app[_0xcff869(0x16f)](_0x368167['static'](_0xff515f[_0xcff869(0x257)](__dirname,_0xcff869(0xa6)))),app[_0xcff869(0x16f)]('/backups',_0x368167['static'](BACKUP_DIR)),app['use'](_0xcff869(0xa1),_0x368167['static'](UPDATES_DIR)),app['use']((_0x5e1c84,_0x3ade7b,_0x42ce56)=>{const _0x131ec6=_0xcff869,_0x4df8a7={'bSwdu':function(_0x5798ac,_0x52415f){return _0x5798ac-_0x52415f;},'OTxtf':function(_0x53ce5f,_0x5a33ab){return _0x53ce5f(_0x5a33ab);},'jLOQY':function(_0x105f6a){return _0x105f6a();},'zFjvs':'x-user-name','KwHKG':function(_0x32b9e2,_0x1e6bf6){return _0x32b9e2!==_0x1e6bf6;},'rDvxw':'GET','GZGUH':function(_0x405f2a,_0x2e09dc){return _0x405f2a!==_0x2e09dc;},'wDrhM':_0x131ec6(0x1e3),'RywSk':function(_0x50e423,_0xec2215){return _0x50e423===_0xec2215;},'XDJgh':function(_0x4008cc,_0x14876e){return _0x4008cc===_0x14876e;},'rXjGq':'/api/upload'};if(!_0x5e1c84[_0x131ec6(0xaf)]||!_0x5e1c84[_0x131ec6(0xaf)]['startsWith']('/api'))return _0x4df8a7['jLOQY'](_0x42ce56);const _0x1fa1be=Date[_0x131ec6(0x1fb)](),_0xc76381=_0x5e1c84['method']||'',_0x548ebd=_0x5e1c84['ip'],_0x4fe525=_0x5e1c84[_0x131ec6(0x8c)]&&_0x5e1c84[_0x131ec6(0x8c)][_0x131ec6(0xad)]?_0x5e1c84[_0x131ec6(0x8c)]['user-agent']:'',_0x530d49=_0x5e1c84[_0x131ec6(0x8c)]&&(_0x5e1c84[_0x131ec6(0x8c)][_0x4df8a7[_0x131ec6(0xce)]]||_0x5e1c84[_0x131ec6(0x8c)]['x-username'])||'',_0x5ec40d=_0x5e1c84[_0x131ec6(0x8c)]&&(_0x5e1c84['headers']['x-user-role']||_0x5e1c84[_0x131ec6(0x8c)][_0x131ec6(0x1fd)])||'',_0x4792bc=typeof _0x530d49===_0x131ec6(0x1bf)?_0x530d49:'',_0x36228a=typeof _0x5ec40d===_0x131ec6(0x1bf)?_0x5ec40d:'',_0x2b49b4=_0x5e1c84['query']||{};let _0x1c8b7f=null;if(_0x4df8a7[_0x131ec6(0x17d)](_0xc76381,_0x4df8a7['rDvxw'])&&_0x4df8a7['GZGUH'](_0xc76381,_0x4df8a7['wDrhM'])){if(_0x4df8a7[_0x131ec6(0x85)](_0x5e1c84['path'],_0x131ec6(0x19f))){const _0x28b103=_0x5e1c84[_0x131ec6(0x117)]||{};_0x1c8b7f={'username':_0x28b103['username']||''};}else{if(_0x4df8a7[_0x131ec6(0x154)](_0x5e1c84['path'],_0x4df8a7['rXjGq'])){const _0x41d3d3=_0x5e1c84['body']||{};_0x1c8b7f={..._0x41d3d3},_0x1c8b7f[_0x131ec6(0x238)]&&delete _0x1c8b7f['file'];}else _0x1c8b7f=_0x5e1c84[_0x131ec6(0x117)]||{};}}_0x3ade7b['on']('finish',()=>{const _0x1fa607=_0x131ec6;if(_0x3ade7b[_0x1fa607(0x183)]&&_0x3ade7b['locals']['auditLogged'])return;const _0x196ea9=_0x3ade7b[_0x1fa607(0x174)]||0xc8,_0x227c4c=_0x4df8a7['bSwdu'](Date[_0x1fa607(0x1fb)](),_0x1fa1be);_0x4df8a7[_0x1fa607(0x1ef)](appendAuditLog,{'username':_0x4792bc,'role':_0x36228a,'method':_0xc76381,'path':_0x5e1c84[_0x1fa607(0xaf)]||'','status':_0x196ea9,'duration_ms':_0x227c4c,'ip':_0x548ebd,'ua':_0x4fe525,'query':_0x2b49b4,'body':_0x1c8b7f});}),_0x42ce56();});const mockData={'annual_work_plans':[],'major_events':[],'monthly_progress':[],'departments':[{'id':0x1,'name':_0xcff869(0x195),'code':_0xcff869(0xeb),'parent_id':null,'status':_0xcff869(0x129),'created_at':'2025-01-01T00:00:00.000Z'},{'id':0x2,'name':'销售部','code':'SALES','parent_id':null,'status':_0xcff869(0x129),'created_at':'2025-01-01T00:00:00.000Z'},{'id':0x3,'name':'市场部','code':_0xcff869(0x18a),'parent_id':null,'status':'active','created_at':_0xcff869(0x151)},{'id':0x4,'name':'人事部','code':'HR','parent_id':null,'status':'active','created_at':'2025-01-01T00:00:00.000Z'}],'employees':[],'action_plans':[],'notifications':[],'users':[{'id':0x1,'username':_0xcff869(0xab),'password':'$2a$10$jGBUZS.KkPpiXRzsHlNDYOizztF6nrRIcp8aYIeBxZEVVuuqaN2wW','role':'管理员','department':_0xcff869(0x195),'status':'启用','lastLogin':'2025-12-15T00:00:00.000Z'}],'target_types':[],'templates':[],'roles':[]};function getNextId(_0x35acbe){const _0x299579=_0xcff869;if(!Array[_0x299579(0x153)](_0x35acbe)||_0x35acbe['length']===0x0)return 0x1;return _0x35acbe[_0x299579(0xe7)]((_0x4744b0,_0x477d8b)=>_0x477d8b['id']&&_0x477d8b['id']>_0x4744b0?_0x477d8b['id']:_0x4744b0,0x0)+0x1;}function maskSensitive(_0x182e5f){const _0x8125f5=_0xcff869,_0x182753={'AuVUo':'webhook','jgBgt':_0x8125f5(0x244),'Bmuzx':function(_0x1efd2c,_0x116231){return _0x1efd2c===_0x116231;},'nNjdt':'object','OvJGx':function(_0x522e4c,_0x450a88){return _0x522e4c!==_0x450a88;}};if(!_0x182e5f||_0x182753[_0x8125f5(0x8d)](typeof _0x182e5f,_0x8125f5(0x243)))return _0x182e5f;if(Array['isArray'](_0x182e5f))return _0x182e5f[_0x8125f5(0x111)](_0x4d0e43=>maskSensitive(_0x4d0e43));const _0x24e3bd={};return Object[_0x8125f5(0x104)](_0x182e5f)['forEach'](_0x53cc0d=>{const _0x3168d2=_0x8125f5,_0x34af2a=_0x182e5f[_0x53cc0d],_0x3045c3=_0x53cc0d['toLowerCase']();if(_0x3045c3['includes'](_0x3168d2(0x205))||_0x3045c3['includes']('secret')||_0x3045c3['includes']('token')||_0x3045c3['includes'](_0x182753[_0x3168d2(0x13d)])||_0x3045c3[_0x3168d2(0xfe)]('appkey'))_0x24e3bd[_0x53cc0d]=_0x34af2a?_0x182753['jgBgt']:_0x34af2a;else _0x34af2a&&_0x182753[_0x3168d2(0xb3)](typeof _0x34af2a,_0x182753['nNjdt'])?_0x24e3bd[_0x53cc0d]=maskSensitive(_0x34af2a):_0x24e3bd[_0x53cc0d]=_0x34af2a;}),_0x24e3bd;}function sanitizeSystemSettingItem(_0x13405c){const _0x54bf16=_0xcff869,_0x4acbe3={'FnTqi':_0x54bf16(0x243),'EVjUw':function(_0x47c7e8,_0x112040){return _0x47c7e8===_0x112040;},'iHDnQ':function(_0x28ee51,_0x5a59ce){return _0x28ee51===_0x5a59ce;},'XvEbQ':'integration','ymgCy':_0x54bf16(0x226),'HjNtF':function(_0xc1408e,_0x29189f){return _0xc1408e===_0x29189f;},'kskFT':_0x54bf16(0x92),'ZhNjh':_0x54bf16(0x126)};if(!_0x13405c||typeof _0x13405c!==_0x4acbe3['FnTqi'])return _0x13405c;const _0x4983e1={..._0x13405c},_0x4eaeca=_0x4983e1['key'];if(!_0x4eaeca)return _0x4983e1;let _0x506d7a=_0x4983e1[_0x54bf16(0xd1)];if(_0x4acbe3['EVjUw'](typeof _0x506d7a,'string'))try{const _0x273898=JSON[_0x54bf16(0x110)](_0x506d7a);_0x506d7a=_0x273898;}catch(_0x577f0e){}if(_0x506d7a&&typeof _0x506d7a===_0x54bf16(0x243)){if(_0x4acbe3['iHDnQ'](_0x4eaeca,_0x4acbe3[_0x54bf16(0x223)])){const _0x218d0d={..._0x506d7a};if(Object['prototype'][_0x54bf16(0x1dd)]['call'](_0x218d0d,'dingtalkAppKey'))_0x218d0d[_0x54bf16(0x12f)]='';if(Object[_0x54bf16(0x8e)][_0x54bf16(0x1dd)][_0x54bf16(0x231)](_0x218d0d,_0x4acbe3[_0x54bf16(0xdb)]))_0x218d0d[_0x54bf16(0x226)]='';if(Object[_0x54bf16(0x8e)]['hasOwnProperty'][_0x54bf16(0x231)](_0x218d0d,_0x54bf16(0x1c8)))_0x218d0d['emailPassword']='';_0x4983e1[_0x54bf16(0xd1)]=_0x218d0d;}else{if(_0x4acbe3[_0x54bf16(0x1ba)](_0x4eaeca,_0x4acbe3[_0x54bf16(0xc7)])){const _0x28554f={..._0x506d7a};if(Object[_0x54bf16(0x8e)]['hasOwnProperty'][_0x54bf16(0x231)](_0x28554f,_0x4acbe3[_0x54bf16(0x22f)]))_0x28554f[_0x54bf16(0x126)]='';if(Object['prototype'][_0x54bf16(0x1dd)][_0x54bf16(0x231)](_0x28554f,_0x54bf16(0x1fe)))_0x28554f['accessToken']='';if(Object['prototype']['hasOwnProperty']['call'](_0x28554f,_0x54bf16(0x23e)))_0x28554f[_0x54bf16(0x23e)]='';_0x4983e1['value']=_0x28554f;}else _0x4983e1[_0x54bf16(0xd1)]=_0x506d7a;}}return _0x4983e1;}function sanitizeAuditLogItem(_0x1d819d){const _0x3810d0=_0xcff869,_0x3a07fd={'oZYwe':_0x3810d0(0x1bf),'DQpNr':function(_0x49bb29,_0x39fbb2){return _0x49bb29(_0x39fbb2);},'uwmiY':_0x3810d0(0x108),'kBWUM':function(_0x20cba4,_0x164ff2){return _0x20cba4===_0x164ff2;},'cMzKj':function(_0x280f7c,_0x2ca2c5){return _0x280f7c===_0x2ca2c5;},'DyZFX':'object'};if(!_0x1d819d||typeof _0x1d819d!=='object')return _0x1d819d;const _0x3e444c={..._0x1d819d};if(_0x3e444c['body']&&typeof _0x3e444c['body']===_0x3a07fd['oZYwe'])try{const _0x397817=JSON[_0x3810d0(0x110)](_0x3e444c['body']),_0x256f45=_0x3a07fd[_0x3810d0(0x10d)](maskSensitive,_0x397817);_0x3e444c[_0x3810d0(0x117)]=JSON['stringify'](_0x256f45);}catch(_0x43dd6){if(typeof _0x3e444c['path']===_0x3810d0(0x1bf)&&_0x3e444c['path']['indexOf'](_0x3a07fd['uwmiY'])===0x0){if(_0x3a07fd['kBWUM'](_0x3810d0(0xcd),_0x3810d0(0xcd)))_0x3e444c['body']='';else{_0xd12236['status'](0x194)['json']({'success':![],'error':_0x3810d0(0x1c3)});return;}}}else{if(_0x3e444c[_0x3810d0(0x117)]&&_0x3a07fd['cMzKj'](typeof _0x3e444c['body'],_0x3a07fd['DyZFX'])){const _0x483e7c=maskSensitive(_0x3e444c['body']);_0x3e444c['body']=_0x483e7c;}}return _0x3e444c;}function cleanupSystemData(){const _0x58e2ed=_0xcff869,_0x3d1205={'YderS':function(_0x1b2131,_0x58d912){return _0x1b2131===_0x58d912;},'iOWIG':'zvJYp','pBPTB':function(_0x93a488,_0x213047){return _0x93a488===_0x213047;},'vrqxs':function(_0x2b7d8b,_0x364aad){return _0x2b7d8b-_0x364aad;},'gDECo':function(_0x3a5608,_0x589878){return _0x3a5608>_0x589878;},'svWsk':function(_0x2711bf,_0x36be37){return _0x2711bf(_0x36be37);}},_0x3bb115=loadSystemSettings(),_0x33c04e=Array[_0x58e2ed(0x153)](_0x3bb115)?_0x3bb115:[],_0x3cbf76={};_0x33c04e['forEach'](_0x47bc10=>{const _0x56a92e=_0x58e2ed;if(_0x3d1205['iOWIG']===_0x56a92e(0x1b9)){if(!_0x47bc10||typeof _0x47bc10!=='object')return;const _0xd0c84d=_0x47bc10['key'];if(!_0xd0c84d)return;const _0x2888a3=_0x3cbf76[_0xd0c84d];if(!_0x2888a3)_0x3cbf76[_0xd0c84d]=_0x47bc10;else{const _0x12eb28=new Date(_0x2888a3['created_at']||0x0)['getTime'](),_0x28c90f=new Date(_0x47bc10['created_at']||0x0)['getTime']();_0x28c90f>=_0x12eb28&&(_0x3cbf76[_0xd0c84d]=_0x47bc10);}}else{const _0x33e76b=_0xf27b8e[_0x56a92e(0x257)](_0x349d2d,'../config/dingtalk_config.json');if(!_0x443e32[_0x56a92e(0x22b)](_0x33e76b))return{};const _0x8fa3e=_0x59103a[_0x56a92e(0x22a)](_0x33e76b,_0x56a92e(0x138)),_0x2cf393=_0x595fba[_0x56a92e(0x110)](_0x8fa3e);return _0x2cf393&&_0x3d1205[_0x56a92e(0xa5)](typeof _0x2cf393,'object')?_0x2cf393:{};}});const _0x228544=Object[_0x58e2ed(0x96)](_0x3cbf76)[_0x58e2ed(0x111)](_0x29e49f=>sanitizeSystemSettingItem(_0x29e49f));_0x228544['sort']((_0x478722,_0x3fba90)=>{const _0x408d27=_0x58e2ed,_0x1342a6=typeof _0x478722['id']===_0x408d27(0x213)?_0x478722['id']:0x0,_0x3bcc3d=_0x3d1205['pBPTB'](typeof _0x3fba90['id'],'number')?_0x3fba90['id']:0x0;return _0x3d1205['vrqxs'](_0x1342a6,_0x3bcc3d);}),saveSystemSettings(_0x228544);const _0x2391da=loadAuditLogs();if(Array[_0x58e2ed(0x153)](_0x2391da)&&_0x3d1205['gDECo'](_0x2391da['length'],0x0)){const _0xfaf907=_0x2391da[_0x58e2ed(0x111)](_0x4c7ca7=>sanitizeAuditLogItem(_0x4c7ca7));_0x3d1205[_0x58e2ed(0xe8)](saveAuditLogs,_0xfaf907);}}function loadJsonArrayFile(_0x2d2833,_0x2b3059){const _0x56f451=_0xcff869;try{if(!_0x345456[_0x56f451(0x22b)](_0x2d2833)){if(Array[_0x56f451(0x153)](_0x2b3059))return[..._0x2b3059];return[];}const _0x41f647=_0x345456['readFileSync'](_0x2d2833,'utf-8'),_0x3a156a=JSON[_0x56f451(0x110)](_0x41f647);if(Array[_0x56f451(0x153)](_0x3a156a))return _0x3a156a;return[];}catch(_0x20cbd2){if(Array['isArray'](_0x2b3059))return[..._0x2b3059];return[];}}function saveJsonArrayFile(_0x3a8402,_0x21f988){const _0x4a7ad0=_0xcff869,_0xa2e2a2={'INifw':'utf-8'};try{const _0x36adc6=_0xff515f[_0x4a7ad0(0x255)](_0x3a8402);!_0x345456[_0x4a7ad0(0x22b)](_0x36adc6)&&_0x345456[_0x4a7ad0(0x1a0)](_0x36adc6,{'recursive':!![]}),_0x345456[_0x4a7ad0(0x1e6)](_0x3a8402,JSON['stringify'](_0x21f988,null,0x2),_0xa2e2a2['INifw']);}catch(_0x452914){}}function loadSystemSettings(){const _0xd4bc62=_0xcff869;try{if(!_0x345456[_0xd4bc62(0x22b)](SYSTEM_SETTINGS_FILE))return[];const _0x1102bc=_0x345456['readFileSync'](SYSTEM_SETTINGS_FILE,_0xd4bc62(0x138)),_0x1bf704=JSON['parse'](_0x1102bc);return Array[_0xd4bc62(0x153)](_0x1bf704)?_0x1bf704:[];}catch(_0x24bfa1){return[];}}function saveSystemSettings(_0x116f83){const _0xc40b76=_0xcff869;try{const _0x2be336=_0xff515f[_0xc40b76(0x255)](SYSTEM_SETTINGS_FILE);!_0x345456[_0xc40b76(0x22b)](_0x2be336)&&_0x345456[_0xc40b76(0x1a0)](_0x2be336,{'recursive':!![]}),_0x345456[_0xc40b76(0x1e6)](SYSTEM_SETTINGS_FILE,JSON[_0xc40b76(0x1fc)](_0x116f83,null,0x2),_0xc40b76(0x138));}catch(_0x1ce5b7){}}function loadAuditLogs(){const _0x770942=_0xcff869;try{if(!_0x345456[_0x770942(0x22b)](AUDIT_LOG_FILE))return[];const _0x32a217=_0x345456[_0x770942(0x22a)](AUDIT_LOG_FILE,'utf-8'),_0xd68b63=JSON[_0x770942(0x110)](_0x32a217);return Array['isArray'](_0xd68b63)?_0xd68b63:[];}catch(_0xfe3831){return[];}}function saveAuditLogs(_0x458c1d){const _0x5d1587=_0xcff869;try{const _0x56ad39=_0xff515f[_0x5d1587(0x255)](AUDIT_LOG_FILE);!_0x345456['existsSync'](_0x56ad39)&&_0x345456[_0x5d1587(0x1a0)](_0x56ad39,{'recursive':!![]}),_0x345456[_0x5d1587(0x1e6)](AUDIT_LOG_FILE,JSON['stringify'](_0x458c1d,null,0x2),'utf-8');}catch(_0x1ccc34){}}function loadDepartmentTargets(){const _0x494ae0=_0xcff869;try{if(!_0x345456['existsSync'](DEPARTMENT_TARGETS_FILE))return[];const _0x2af04e=_0x345456[_0x494ae0(0x22a)](DEPARTMENT_TARGETS_FILE,'utf-8'),_0x2af2dc=JSON[_0x494ae0(0x110)](_0x2af04e);return Array['isArray'](_0x2af2dc)?_0x2af2dc:[];}catch(_0x4d7905){return[];}}function saveDepartmentTargets(_0x56ee5b){const _0x3f8f75=_0xcff869,_0x2db792={'WHQrz':'示例公司','utYav':function(_0xdee09d,_0x1d6d9a){return _0xdee09d!==_0x1d6d9a;},'SUhZm':'XZExZ'};try{if(_0x2db792['utYav'](_0x2db792['SUhZm'],'XZExZ')){const _0x4b946d=_0x3271c();if(_0x4b946d){_0x3d30b9['json'](_0x4b946d);return;}_0x33df50['json']({'name':_0x2db792[_0x3f8f75(0x256)],'short_name':_0x2db792['WHQrz'],'code':_0x3f8f75(0x189),'address':'','contact':'','phone':'','email':''});}else{const _0x500bb6=_0xff515f[_0x3f8f75(0x255)](DEPARTMENT_TARGETS_FILE);!_0x345456['existsSync'](_0x500bb6)&&_0x345456['mkdirSync'](_0x500bb6,{'recursive':!![]}),_0x345456['writeFileSync'](DEPARTMENT_TARGETS_FILE,JSON[_0x3f8f75(0x1fc)](_0x56ee5b,null,0x2),_0x3f8f75(0x138));}}catch(_0x8b5992){}}function loadAnnualWorkPlans(){const _0x52878b=_0xcff869;try{if(!_0x345456[_0x52878b(0x22b)](ANNUAL_WORK_PLANS_FILE))return[];const _0x154d3f=_0x345456[_0x52878b(0x22a)](ANNUAL_WORK_PLANS_FILE,'utf-8'),_0x2302e2=JSON['parse'](_0x154d3f);return Array[_0x52878b(0x153)](_0x2302e2)?_0x2302e2:[];}catch(_0x372f90){return[];}}function saveAnnualWorkPlans(_0x432172){const _0x183e9f=_0xcff869;try{const _0x55a561=_0xff515f['dirname'](ANNUAL_WORK_PLANS_FILE);!_0x345456[_0x183e9f(0x22b)](_0x55a561)&&_0x345456['mkdirSync'](_0x55a561,{'recursive':!![]}),_0x345456[_0x183e9f(0x1e6)](ANNUAL_WORK_PLANS_FILE,JSON['stringify'](_0x432172,null,0x2),'utf-8');}catch(_0x231743){}}function loadMajorEvents(){const _0xcaa1cc=_0xcff869;try{if(!_0x345456[_0xcaa1cc(0x22b)](MAJOR_EVENTS_FILE))return[];const _0x4899c9=_0x345456['readFileSync'](MAJOR_EVENTS_FILE,_0xcaa1cc(0x138)),_0x3220ba=JSON['parse'](_0x4899c9);return Array['isArray'](_0x3220ba)?_0x3220ba:[];}catch(_0x2f8cab){return[];}}function saveMajorEvents(_0x36fc97){const _0xd9ef00=_0xcff869,_0x3ba593={'TXwIl':_0xd9ef00(0x138)};try{const _0x1a1dea=_0xff515f['dirname'](MAJOR_EVENTS_FILE);!_0x345456['existsSync'](_0x1a1dea)&&_0x345456[_0xd9ef00(0x1a0)](_0x1a1dea,{'recursive':!![]}),_0x345456['writeFileSync'](MAJOR_EVENTS_FILE,JSON['stringify'](_0x36fc97,null,0x2),_0x3ba593[_0xd9ef00(0x1c7)]);}catch(_0xf29b58){}}function loadMonthlyProgress(){const _0x52e933=_0xcff869,_0x2d0320={'Zfdmi':_0x52e933(0x15d),'NRidD':_0x52e933(0x138)};try{if(_0x52e933(0x232)===_0x52e933(0xac))_0x4426a8['status'](0x1f4)[_0x52e933(0xca)]({'success':![],'error':_0x2d0320['Zfdmi']});else{if(!_0x345456[_0x52e933(0x22b)](MONTHLY_PROGRESS_FILE))return[];const _0x39b744=_0x345456['readFileSync'](MONTHLY_PROGRESS_FILE,_0x2d0320['NRidD']),_0x5e4d87=JSON['parse'](_0x39b744);return Array[_0x52e933(0x153)](_0x5e4d87)?_0x5e4d87:[];}}catch(_0x30fedb){return[];}}function saveMonthlyProgress(_0x2764b9){const _0x21b3fb=_0xcff869,_0x251225={'jyjhn':_0x21b3fb(0x138)};try{const _0x1086fa=_0xff515f[_0x21b3fb(0x255)](MONTHLY_PROGRESS_FILE);!_0x345456['existsSync'](_0x1086fa)&&_0x345456['mkdirSync'](_0x1086fa,{'recursive':!![]}),_0x345456['writeFileSync'](MONTHLY_PROGRESS_FILE,JSON[_0x21b3fb(0x1fc)](_0x2764b9,null,0x2),_0x251225[_0x21b3fb(0x122)]);}catch(_0xe5abd2){}}function loadActionPlans(){const _0x508719=_0xcff869,_0x478e8d={'svqjT':'utf-8'};try{if(!_0x345456[_0x508719(0x22b)](ACTION_PLANS_FILE))return[];const _0x26722b=_0x345456['readFileSync'](ACTION_PLANS_FILE,_0x478e8d[_0x508719(0x11c)]),_0xe9d32f=JSON['parse'](_0x26722b);return Array[_0x508719(0x153)](_0xe9d32f)?_0xe9d32f:[];}catch(_0x1b4081){return[];}}function saveActionPlans(_0x6d8d54){const _0x5eb00c=_0xcff869,_0x5c9fe0={'WBTyg':_0x5eb00c(0x138)};try{const _0x197f79=_0xff515f['dirname'](ACTION_PLANS_FILE);!_0x345456['existsSync'](_0x197f79)&&_0x345456[_0x5eb00c(0x1a0)](_0x197f79,{'recursive':!![]}),_0x345456[_0x5eb00c(0x1e6)](ACTION_PLANS_FILE,JSON[_0x5eb00c(0x1fc)](_0x6d8d54,null,0x2),_0x5c9fe0['WBTyg']);}catch(_0x36d680){}}function loadDepartmentsStore(){const _0x606a1c=_0xcff869,_0x53ed8f={'BeqzC':function(_0x5597ec,_0x1773f0,_0x262af8){return _0x5597ec(_0x1773f0,_0x262af8);}};return _0x53ed8f[_0x606a1c(0xc3)](loadJsonArrayFile,DEPARTMENTS_FILE,mockData[_0x606a1c(0x141)]);}function saveDepartmentsStore(_0x511266){saveJsonArrayFile(DEPARTMENTS_FILE,_0x511266);}function loadEmployeesStore(){const _0xe09ab3=_0xcff869;return loadJsonArrayFile(EMPLOYEES_FILE,mockData[_0xe09ab3(0xb7)]);}function saveEmployeesStore(_0x5d943b){saveJsonArrayFile(EMPLOYEES_FILE,_0x5d943b);}function loadUsersStore(){const _0x433b93=_0xcff869,_0x445859={'nmAxF':function(_0x55ca8d,_0x76303a,_0x1611a6){return _0x55ca8d(_0x76303a,_0x1611a6);}};return _0x445859['nmAxF'](loadJsonArrayFile,USERS_FILE,mockData[_0x433b93(0xf2)]);}function saveUsersStore(_0x2f6c98){saveJsonArrayFile(USERS_FILE,_0x2f6c98);}function getUserPermissions(_0x4728c6){const _0x1936c5=_0xcff869,_0x559234={'wkiJU':function(_0x4efc23,_0x449763){return _0x4efc23+_0x449763;},'WEaZs':function(_0x8ea2,_0x52da58){return _0x8ea2!==_0x52da58;},'lyLDw':function(_0x37b972,_0x1683b8){return _0x37b972>_0x1683b8;},'Zxlbn':function(_0x2973fa,_0x19e141){return _0x2973fa===_0x19e141;},'RCnJY':'fBNCe','IXKXc':'gbZtK','ynlYQ':function(_0x5669fd){return _0x5669fd();}};if(!_0x4728c6||_0x559234[_0x1936c5(0xd8)](typeof _0x4728c6,_0x1936c5(0x243)))return[];if(Array['isArray'](_0x4728c6['permissions'])&&_0x559234[_0x1936c5(0x1a9)](_0x4728c6[_0x1936c5(0x1cd)][_0x1936c5(0x16d)],0x0))return _0x4728c6['permissions'];if(_0x559234['Zxlbn'](_0x4728c6[_0x1936c5(0x161)],_0x1936c5(0xab)))return[_0x1936c5(0xab)];if(typeof _0x4728c6['role']===_0x1936c5(0x1bf)){if(_0x559234['RCnJY']===_0x559234['IXKXc']){if(!_0x285458)return;const _0x4374a0=_0x3a6349[_0x1936c5(0x153)](_0x314749['department'])?_0x276be8[_0x1936c5(0xf3)]:[];let _0x363164='';if(_0x4374a0[_0x1936c5(0x16d)]>0x0){const _0x4bc150=_0x17a3bf[_0x1936c5(0xa8)](_0x4374a0[0x0]);_0x4bc150&&_0x4bc150[_0x1936c5(0x1df)]&&(_0x363164=_0x4bc150[_0x1936c5(0x1df)]);}_0x1cd681['push']({'id':_0x559234[_0x1936c5(0x103)](_0x3a9a60,0x1),'name':_0x16b8bf[_0x1936c5(0x1df)]||'','employee_id':_0x1fa781['userid']||_0x46b152[_0x1936c5(0x24e)]||'','department':_0x363164,'position':_0x393dcd[_0x1936c5(0x127)]||'','phone':_0x21a222['mobile']||'','email':_0x3d94fa[_0x1936c5(0xba)]||'','status':_0x31664d['active']===![]?'inactive':'active','created_at':_0x374209});}else{const _0x49e838=_0x4728c6['role'],_0x23657a=_0x559234[_0x1936c5(0xfb)](loadRolesStore),_0x20ce48=Array[_0x1936c5(0x153)](_0x23657a)?_0x23657a[_0x1936c5(0x13c)](_0xcb06f=>_0xcb06f&&(_0xcb06f[_0x1936c5(0x1df)]===_0x49e838||_0xcb06f['code']===_0x49e838)):null;if(_0x20ce48&&Array['isArray'](_0x20ce48['permissions'])&&_0x20ce48[_0x1936c5(0x1cd)][_0x1936c5(0x16d)]>0x0)return _0x20ce48[_0x1936c5(0x1cd)];}}return[];}function generateJwtToken(_0x493dfa){const _0x37577d=_0xcff869,_0x4556f6={'sub':_0x493dfa['id'],'username':_0x493dfa['username'],'role':_0x493dfa['role'],'department':_0x493dfa[_0x37577d(0xf3)],'permissions':getUserPermissions(_0x493dfa)};return _0x261a60['sign'](_0x4556f6,JWT_SECRET,{'expiresIn':JWT_EXPIRES_IN});}function loadTargetTypesStore(){const _0x3ddd5d=_0xcff869;return loadJsonArrayFile(TARGET_TYPES_FILE,mockData[_0x3ddd5d(0x24b)]);}function saveTargetTypesStore(_0x3bcab1){saveJsonArrayFile(TARGET_TYPES_FILE,_0x3bcab1);}function loadRolesStore(){const _0x53a098=_0xcff869;return loadJsonArrayFile(ROLES_FILE,mockData[_0x53a098(0x175)]||[]);}function saveRolesStore(_0x527ad7){const _0x2b52ca=_0xcff869,_0x300a90={'uJgjx':function(_0x20be2f,_0x522e8e,_0x3f5c4d){return _0x20be2f(_0x522e8e,_0x3f5c4d);}};_0x300a90[_0x2b52ca(0x134)](saveJsonArrayFile,ROLES_FILE,_0x527ad7);}function loadTemplatesStore(){const _0xeb3ea2=_0xcff869,_0x5e4170={'PbbdN':function(_0x1f9456,_0x43845b,_0x498e0d){return _0x1f9456(_0x43845b,_0x498e0d);}};return _0x5e4170[_0xeb3ea2(0x152)](loadJsonArrayFile,TEMPLATES_FILE,mockData['templates']);}function saveTemplatesStore(_0x1e34e9){const _0x276f26=_0xcff869,_0x3b721f={'IVuvR':function(_0x2172ea,_0x12625e,_0xb92bad){return _0x2172ea(_0x12625e,_0xb92bad);}};_0x3b721f[_0x276f26(0x193)](saveJsonArrayFile,TEMPLATES_FILE,_0x1e34e9);}function loadNotificationsStore(){const _0x5dd63a=_0xcff869,_0x115d6a={'fySSc':function(_0x4e2fd1,_0xe61ae9,_0x255146){return _0x4e2fd1(_0xe61ae9,_0x255146);}};return _0x115d6a[_0x5dd63a(0x137)](loadJsonArrayFile,NOTIFICATIONS_FILE,mockData['notifications']);}function saveNotificationsStore(_0x493c31){saveJsonArrayFile(NOTIFICATIONS_FILE,_0x493c31);}function loadCompanyInfoStore(){const _0x10e1f0=_0xcff869,_0x5d28f8={'YuMZB':'utf-8'};try{if(!_0x345456[_0x10e1f0(0x22b)](COMPANY_INFO_FILE))return null;const _0x46f2e8=_0x345456['readFileSync'](COMPANY_INFO_FILE,_0x5d28f8[_0x10e1f0(0x13b)]),_0x1b5f48=JSON['parse'](_0x46f2e8);if(_0x1b5f48&&typeof _0x1b5f48==='object')return _0x1b5f48;return null;}catch(_0x3c3631){return null;}}function saveCompanyInfoStore(_0x3c64ea){const _0x33e7a1=_0xcff869,_0x44e31a={'fYJAs':function(_0x48120d,_0x567290){return _0x48120d||_0x567290;}};try{const _0x1165cb=_0xff515f['dirname'](COMPANY_INFO_FILE);!_0x345456['existsSync'](_0x1165cb)&&_0x345456['mkdirSync'](_0x1165cb,{'recursive':!![]}),_0x345456['writeFileSync'](COMPANY_INFO_FILE,JSON['stringify'](_0x44e31a[_0x33e7a1(0x1be)](_0x3c64ea,{}),null,0x2),_0x33e7a1(0x138));}catch(_0x1fd58a){}}function shouldWriteAuditLog(){const _0x24c9da=_0xcff869,_0x5cc39b={'asILq':function(_0x118501){return _0x118501();},'shsHj':'auditLog'},_0x66b43=_0x5cc39b[_0x24c9da(0x209)](loadSystemSettings),_0x552f18=Array[_0x24c9da(0x153)](_0x66b43)?_0x66b43['find'](_0x3db0f8=>_0x3db0f8&&_0x3db0f8[_0x24c9da(0xe2)]==='security'):null;if(!_0x552f18||!_0x552f18['value'])return!![];let _0x317936=_0x552f18['value'];if(typeof _0x317936==='string')try{_0x317936=JSON['parse'](_0x317936);}catch(_0x152e9c){_0x317936={};}if(_0x317936&&Object[_0x24c9da(0x8e)]['hasOwnProperty']['call'](_0x317936,_0x5cc39b[_0x24c9da(0x25b)]))return!!_0x317936['auditLog'];return!![];}function appendAuditLog(_0x11f2c1){const _0x35e5d3=_0xcff869,_0x4195db={'gdFNc':function(_0x4be34b,_0x3b3743){return _0x4be34b===_0x3b3743;},'Oldsx':_0x35e5d3(0x243),'sdgCV':function(_0x2f40f0){return _0x2f40f0();},'YfzYp':_0x35e5d3(0x252),'PxICF':'HLzQF','EvcwP':_0x35e5d3(0xc9),'QvJJh':function(_0x291e07,_0xd1cf74){return _0x291e07(_0xd1cf74);},'jyqQH':_0x35e5d3(0x1bf)};try{if(!shouldWriteAuditLog())return;let _0x5f27a9=_0x11f2c1[_0x35e5d3(0x117)];_0x5f27a9&&_0x4195db[_0x35e5d3(0xfc)](typeof _0x5f27a9,_0x4195db['Oldsx'])&&(_0x5f27a9=maskSensitive(_0x5f27a9));const _0x58a5d1=_0x4195db['sdgCV'](loadAuditLogs),_0x5e5736=getNextId(_0x58a5d1),_0x12689e=new Date()['toISOString']();let _0x8aac22=_0x11f2c1[_0x35e5d3(0x18d)];if(!_0x8aac22){const _0x4984ad=(_0x11f2c1['method']||'')['toUpperCase'](),_0x4449f9=_0x11f2c1[_0x35e5d3(0xaf)]||'';let _0x1a5e6d=_0x4195db['YfzYp'];for(const [_0x2c0e48,_0x3712d0]of Object['entries'](API_PATH_MAPPING)){if(_0x4449f9['startsWith'](_0x2c0e48)){if(_0x35e5d3(0x21b)===_0x4195db[_0x35e5d3(0x179)]){_0x1a5e6d=_0x3712d0[_0x35e5d3(0x145)];break;}else{_0x252f77['status'](0x194)[_0x35e5d3(0xca)]({'error':'Role\x20not\x20found'});return;}}}let _0x3db651='';switch(_0x4984ad){case'GET':_0x3db651='查看';break;case _0x35e5d3(0x82):_0x3db651='创建';break;case _0x4195db['EvcwP']:case _0x35e5d3(0x1ab):_0x3db651='更新';break;case'DELETE':_0x3db651='删除';break;default:_0x3db651='操作';}let _0x3cce5f='';try{const _0x48e191=_0x4195db['gdFNc'](typeof _0x5f27a9,_0x35e5d3(0x1bf))?JSON[_0x35e5d3(0x110)](_0x5f27a9):_0x5f27a9;_0x3cce5f=_0x4195db['QvJJh'](extractKeyInfo,_0x48e191);}catch(_0x52c8c2){}_0x8aac22=''+_0x3db651+_0x1a5e6d+_0x3cce5f;}const _0x1884bb={'id':_0x5e5736,'created_at':_0x11f2c1[_0x35e5d3(0x118)]||_0x12689e,'username':_0x11f2c1['username']||'系统','role':_0x11f2c1[_0x35e5d3(0x157)]||'','method':_0x11f2c1['method']||'','path':_0x11f2c1[_0x35e5d3(0xaf)]||'','status':_0x11f2c1['status']??0xc8,'duration_ms':_0x11f2c1[_0x35e5d3(0x11b)]??0x0,'ip':_0x11f2c1['ip']||'','ua':_0x11f2c1['ua']||'','query':_0x11f2c1[_0x35e5d3(0x197)]?_0x4195db[_0x35e5d3(0xfc)](typeof _0x11f2c1['query'],'string')?_0x11f2c1[_0x35e5d3(0x197)]:JSON[_0x35e5d3(0x1fc)](_0x11f2c1['query']):'{}','body':_0x5f27a9?typeof _0x5f27a9===_0x4195db['jyqQH']?_0x5f27a9:JSON['stringify'](_0x5f27a9):'','details':_0x8aac22};_0x11f2c1[_0x35e5d3(0x196)]&&(_0x1884bb[_0x35e5d3(0x196)]=_0x11f2c1[_0x35e5d3(0x196)]),_0x11f2c1[_0x35e5d3(0x83)]&&(_0x1884bb[_0x35e5d3(0x83)]=_0x11f2c1[_0x35e5d3(0x83)]),_0x58a5d1[_0x35e5d3(0x224)](_0x1884bb),saveAuditLogs(_0x58a5d1);}catch(_0x234fba){}}function loadDingTalkConfigFromFile(){const _0x428155=_0xcff869,_0x445612={'NRuis':'utf-8'};try{const _0x124604=_0xff515f[_0x428155(0x257)](__dirname,_0x428155(0x1d6));if(!_0x345456[_0x428155(0x22b)](_0x124604))return{};const _0x11b89c=_0x345456['readFileSync'](_0x124604,_0x445612[_0x428155(0x132)]),_0x400bd9=JSON[_0x428155(0x110)](_0x11b89c);return _0x400bd9&&typeof _0x400bd9==='object'?_0x400bd9:{};}catch(_0x2ed220){return{};}}function getDingTalkConfig(){const _0x1f0189=_0xcff869,_0x547eaa={'AqiqE':function(_0x544090,_0x525503){return _0x544090(_0x525503);}},_0x7a2f05=loadDingTalkConfigFromFile(),_0x29bacc=loadSystemSettings(),_0x54e277=Array['isArray'](_0x29bacc)?_0x29bacc['find'](_0x3bd91e=>_0x3bd91e&&_0x3bd91e[_0x1f0189(0xe2)]===_0x1f0189(0x1dc)):null;let _0x10499b={};if(_0x54e277&&_0x54e277[_0x1f0189(0xd1)])try{_0x10499b=typeof _0x54e277['value']===_0x1f0189(0x1bf)?JSON[_0x1f0189(0x110)](_0x54e277['value']):_0x54e277['value']||{};}catch(_0x3b3cae){_0x10499b={};}const _0x153b70=String(_0x10499b[_0x1f0189(0x12f)]||process[_0x1f0189(0x109)]['DINGTALK_APP_KEY']||_0x7a2f05['appKey']||'')[_0x1f0189(0x1a5)](),_0x293f65=_0x547eaa[_0x1f0189(0x1a3)](String,_0x10499b[_0x1f0189(0x226)]||process['env'][_0x1f0189(0x219)]||_0x7a2f05['appSecret']||'')['trim'](),_0x56a236=_0x10499b[_0x1f0189(0x1f3)]||process['env']['DINGTALK_ROOT_DEPT_ID']||_0x7a2f05[_0x1f0189(0x88)]||0x1,_0x2d0370=_0x10499b['dingtalkDeptId']||process['env'][_0x1f0189(0xbb)]||_0x7a2f05['defaultDeptId']||_0x56a236||0x1;return{'appKey':_0x153b70,'appSecret':_0x293f65,'rootDeptId':Number(_0x56a236)||0x1,'defaultDeptId':Number(_0x2d0370)||0x1};}async function getDingTalkAccessToken(){const _0x1e4074=_0xcff869,_0xffddcd=getDingTalkConfig();if(!_0xffddcd['appKey']||!_0xffddcd['appSecret'])throw new Error(_0x1e4074(0x259));const _0x4b6ac8=_0x1e4074(0x1cb),_0x260011=await _0x38c9ea[_0x1e4074(0xa8)](_0x4b6ac8,{'params':{'appkey':_0xffddcd['appKey'],'appsecret':_0xffddcd[_0x1e4074(0x168)]}}),_0x307cf4=_0x260011[_0x1e4074(0x139)]||{};if(_0x307cf4['errcode']!==0x0)throw new Error(_0x307cf4[_0x1e4074(0xe3)]||_0x1e4074(0x218));return{'accessToken':_0x307cf4['access_token'],'config':_0xffddcd};}async function fetchDingTalkDepartments(_0x12fac0,_0x56b117){const _0x22fafa=_0xcff869,_0xbebc4b='https://oapi.dingtalk.com/department/list',_0x22be22=await _0x38c9ea['get'](_0xbebc4b,{'params':{'access_token':_0x12fac0,'id':_0x56b117,'fetch_child':!![]}}),_0x9d4322=_0x22be22[_0x22fafa(0x139)]||{};if(_0x9d4322['errcode']!==0x0)throw new Error(_0x9d4322[_0x22fafa(0xe3)]||_0x22fafa(0x247));const _0x43982f=Array['isArray'](_0x9d4322['department'])?_0x9d4322['department']:[];return _0x43982f;}async function fetchDingTalkEmployees(_0x5dbd6d,_0x3f48b8){const _0x387ded=_0xcff869,_0x36fb53={'XWFsS':function(_0x1e534b,_0x36ab47){return _0x1e534b!==_0x36ab47;},'gzQoy':function(_0x20f4b4,_0x1a58b8){return _0x20f4b4!==_0x1a58b8;},'XlwdZ':_0x387ded(0x1d2)},_0x518109='https://oapi.dingtalk.com/user/list',_0x680173=[],_0x95daff=Array['isArray'](_0x3f48b8)?_0x3f48b8:[];for(const _0x4f9005 of _0x95daff){const _0x136c63=_0x4f9005&&_0x36fb53['XWFsS'](typeof _0x4f9005['id'],_0x387ded(0x254))?_0x4f9005['id']:null;if(!_0x136c63)continue;const _0x235dd3=await _0x38c9ea['get'](_0x518109,{'params':{'access_token':_0x5dbd6d,'department_id':_0x136c63,'offset':0x0,'size':0x64}}),_0x5bcaee=_0x235dd3['data']||{};if(_0x36fb53[_0x387ded(0x1d8)](_0x5bcaee['errcode'],0x0))continue;const _0x3b465e=Array['isArray'](_0x5bcaee['userlist'])?_0x5bcaee[_0x387ded(0xa4)]:[];for(const _0x3fa668 of _0x3b465e){_0x36fb53[_0x387ded(0x1b2)]!=='nejrV'?_0x2dd9c2=_0x9e7294['filter'](_0x5003c9=>{const _0xaf3c16=_0x387ded,_0x50f9e2=new _0x5c2c76(_0x5003c9[_0xaf3c16(0x118)]);return!_0x17abbc[_0xaf3c16(0x1ee)](_0x50f9e2[_0xaf3c16(0x1e7)]())&&_0x50f9e2>=_0xbda75c;}):_0x680173['push'](_0x3fa668);}}return _0x680173;}async function listBackupFiles(){const _0x3c4824=_0xcff869,_0x2ed7d6={'azANB':function(_0x5b89a8,_0x5c79b8){return _0x5b89a8(_0x5c79b8);}};try{const _0x36bf93=await _0x378db8[_0x3c4824(0x105)](BACKUP_DIR),_0x52f61c=_0x36bf93[_0x3c4824(0x163)](_0x18a89d=>_0x18a89d[_0x3c4824(0x98)]()[_0x3c4824(0x214)](_0x3c4824(0x1c9))),_0x13efe6=[];for(const _0x51d4d4 of _0x52f61c){const _0x7df7bc=_0xff515f[_0x3c4824(0x257)](BACKUP_DIR,_0x51d4d4),_0x2711e8=await _0x378db8['stat'](_0x7df7bc);_0x13efe6['push']({'name':_0x51d4d4,'size':_0x2711e8['size'],'createdAt':_0x2711e8['mtime']['toISOString'](),'url':_0x3c4824(0xf7)+_0x2ed7d6[_0x3c4824(0x188)](encodeURIComponent,_0x51d4d4)});}return _0x13efe6['sort']((_0x3d036e,_0x40ec60)=>_0x3d036e[_0x3c4824(0x13a)]<_0x40ec60[_0x3c4824(0x13a)]?0x1:-0x1),_0x13efe6;}catch(_0x390630){return[];}}function applyBackupSnapshot(_0x49a689){const _0x426082=_0xcff869,_0x3ef05f={'oCAyz':function(_0x5911d3,_0x1fb0bb){return _0x5911d3(_0x1fb0bb);},'Fdqjf':function(_0x244078,_0x362bb0){return _0x244078(_0x362bb0);},'QXdxv':function(_0x2bd504,_0x38c925){return _0x2bd504(_0x38c925);},'OFaiP':function(_0x32b769,_0x2911e6){return _0x32b769(_0x2911e6);},'FOaPY':_0x426082(0x243),'NYPSg':function(_0x488fd2,_0x3f8e71){return _0x488fd2(_0x3f8e71);}},_0x4770b8=_0x426082(0x1ad)['split']('|');let _0x15523f=0x0;while(!![]){switch(_0x4770b8[_0x15523f++]){case'0':Array['isArray'](_0x49a689['notifications'])&&saveNotificationsStore(_0x49a689['notifications']);continue;case'1':Array[_0x426082(0x153)](_0x49a689[_0x426082(0xb7)])&&saveEmployeesStore(_0x49a689[_0x426082(0xb7)]);continue;case'2':Array['isArray'](_0x49a689['major_events'])&&(mockData['major_events']=_0x49a689['major_events'],saveMajorEvents(_0x49a689['major_events']));continue;case'3':_0x49a689[_0x426082(0x22c)]&&typeof _0x49a689['company_info']==='object'&&_0x3ef05f['oCAyz'](saveCompanyInfoStore,_0x49a689['company_info']);continue;case'4':Array['isArray'](_0x49a689[_0x426082(0x204)])&&(mockData['action_plans']=_0x49a689[_0x426082(0x204)],_0x3ef05f['Fdqjf'](saveActionPlans,_0x49a689[_0x426082(0x204)]));continue;case'5':Array['isArray'](_0x49a689[_0x426082(0x220)])&&saveSystemSettings(_0x49a689[_0x426082(0x220)]);continue;case'6':Array[_0x426082(0x153)](_0x49a689[_0x426082(0x97)])&&_0x3ef05f[_0x426082(0x1c1)](saveAuditLogs,_0x49a689[_0x426082(0x97)]);continue;case'7':Array[_0x426082(0x153)](_0x49a689[_0x426082(0x24b)])&&_0x3ef05f['OFaiP'](saveTargetTypesStore,_0x49a689[_0x426082(0x24b)]);continue;case'8':Array[_0x426082(0x153)](_0x49a689['templates'])&&_0x3ef05f['QXdxv'](saveTemplatesStore,_0x49a689[_0x426082(0x1db)]);continue;case'9':if(!_0x49a689||typeof _0x49a689!==_0x3ef05f['FOaPY'])return;continue;case'10':Array['isArray'](_0x49a689[_0x426082(0x141)])&&_0x3ef05f[_0x426082(0xb2)](saveDepartmentsStore,_0x49a689[_0x426082(0x141)]);continue;case'11':Array[_0x426082(0x153)](_0x49a689['monthly_progress'])&&(mockData['monthly_progress']=_0x49a689['monthly_progress'],saveMonthlyProgress(_0x49a689[_0x426082(0xd5)]));continue;case'12':Array[_0x426082(0x153)](_0x49a689[_0x426082(0xf2)])&&saveUsersStore(_0x49a689[_0x426082(0xf2)]);continue;case'13':Array['isArray'](_0x49a689['department_targets'])&&_0x3ef05f[_0x426082(0x144)](saveDepartmentTargets,_0x49a689[_0x426082(0x229)]);continue;case'14':Array['isArray'](_0x49a689[_0x426082(0xf1)])&&(mockData['annual_work_plans']=_0x49a689['annual_work_plans'],_0x3ef05f[_0x426082(0x208)](saveAnnualWorkPlans,_0x49a689[_0x426082(0xf1)]));continue;}break;}}app['get']('/api/annual-work-plans',(_0x5ab17b,_0x52bd8a)=>{const _0x2c53e2=_0xcff869,_0x44fe15={'JkPwm':function(_0x1eafb9){return _0x1eafb9();},'qwjSl':function(_0x2b708d,_0x195376,_0xd54eae){return _0x2b708d(_0x195376,_0xd54eae);}},{year:_0x2ade56}=_0x5ab17b[_0x2c53e2(0x197)],_0x2a2bea=_0x44fe15[_0x2c53e2(0x9b)](loadAnnualWorkPlans);let _0x3ef366=Array[_0x2c53e2(0x153)](_0x2a2bea)?[..._0x2a2bea]:[];if(_0x2ade56){const _0x4a07aa=_0x44fe15['qwjSl'](parseInt,_0x2ade56,0xa);!Number[_0x2c53e2(0x1ee)](_0x4a07aa)&&(_0x3ef366=_0x3ef366['filter'](_0x58c55f=>Number(_0x58c55f['year'])===_0x4a07aa));}_0x52bd8a['json'](_0x3ef366);}),app['post']('/api/annual-work-plans',(_0x6c5964,_0x51bc26)=>{const _0x15c6e9=_0xcff869,_0x3a4c61={'uaXje':function(_0x87f8cb){return _0x87f8cb();}};try{const _0x4fa0cd=_0x6c5964[_0x15c6e9(0x117)]||{},_0x58bdba=_0x3a4c61['uaXje'](loadAnnualWorkPlans),_0x4d4a96=getNextId(_0x58bdba),_0x232703=new Date()[_0x15c6e9(0x128)](),_0x5205d3={'id':_0x4d4a96,'created_at':_0x232703,..._0x4fa0cd};if(_0x4fa0cd['year']!==undefined&&_0x4fa0cd[_0x15c6e9(0x166)]!==null){const _0x8851ab=parseInt(_0x4fa0cd['year'],0xa);!Number['isNaN'](_0x8851ab)&&(_0x5205d3['year']=_0x8851ab);}_0x58bdba['push'](_0x5205d3),saveAnnualWorkPlans(_0x58bdba),_0x51bc26['json'](_0x5205d3);}catch(_0x45a0fb){_0x51bc26['status'](0x1f4)['json']({'error':'保存年度工作落地规划失败'});}}),app[_0xcff869(0x1da)](_0xcff869(0x24d),(_0x3c5dae,_0x4bb2fc)=>{const _0x6e279a=_0xcff869,_0x187536={'CWQLA':function(_0x4fbaec){return _0x4fbaec();},'YoZSa':_0x6e279a(0xf9),'BUBud':function(_0x4ed43a,_0x2a0e91){return _0x4ed43a!==_0x2a0e91;}};try{const _0x5582af=parseInt(_0x3c5dae[_0x6e279a(0x106)]['id'],0xa),_0x35a81c=_0x3c5dae['body']||{},_0x235380=_0x187536['CWQLA'](loadAnnualWorkPlans),_0x984dbc=_0x235380[_0x6e279a(0xa0)](_0x5b37a4=>_0x5b37a4['id']===_0x5582af);if(_0x984dbc===-0x1){_0x4bb2fc['status'](0x194)['json']({'error':_0x187536['YoZSa']});return;}const _0x5c919f={..._0x235380[_0x984dbc],..._0x35a81c};if(_0x35a81c['year']!==undefined&&_0x187536[_0x6e279a(0x15b)](_0x35a81c['year'],null)){const _0x4c14d1=parseInt(_0x35a81c['year'],0xa);!Number[_0x6e279a(0x1ee)](_0x4c14d1)&&(_0x5c919f[_0x6e279a(0x166)]=_0x4c14d1);}_0x235380[_0x984dbc]=_0x5c919f,saveAnnualWorkPlans(_0x235380),_0x4bb2fc[_0x6e279a(0xca)](_0x5c919f);}catch(_0x2985ed){_0x4bb2fc[_0x6e279a(0x211)](0x1f4)[_0x6e279a(0xca)]({'error':_0x6e279a(0x11d)});}}),app['delete'](_0xcff869(0x24d),(_0x26dccf,_0x3ec46e)=>{const _0x3e1dcc=_0xcff869,_0x443e6d={'wQvEl':_0x3e1dcc(0x119),'FGXcs':function(_0x1392a9,_0x217aaf){return _0x1392a9(_0x217aaf);}};try{const _0x3bdb9e=parseInt(_0x26dccf[_0x3e1dcc(0x106)]['id'],0xa),_0x22666e=loadAnnualWorkPlans(),_0x5a6e5e=_0x22666e[_0x3e1dcc(0x163)](_0x3e4b23=>_0x3e4b23['id']!==_0x3bdb9e),_0x359c10=_0x5a6e5e[_0x3e1dcc(0x16d)]!==_0x22666e[_0x3e1dcc(0x16d)];if(!_0x359c10){if(_0x443e6d[_0x3e1dcc(0x9d)]==='tIISZ')_0x1afb58=_0x4b62e5['filter'](_0x1027cb=>_0x1027cb[_0x3e1dcc(0xf3)]===_0x1e83ee);else{_0x3ec46e[_0x3e1dcc(0x211)](0x194)['json']({'success':![],'error':_0x3e1dcc(0xf9)});return;}}_0x443e6d['FGXcs'](saveAnnualWorkPlans,_0x5a6e5e),_0x3ec46e['json']({'success':!![]});}catch(_0x5afffa){_0x3ec46e['status'](0x1f4)['json']({'success':![],'error':'删除年度工作落地规划记录失败'});}}),app[_0xcff869(0xa8)](_0xcff869(0xcf),(_0x16bdbf,_0xd892e2)=>{const _0x597672=loadTargetTypesStore();_0xd892e2['json'](_0x597672);}),app[_0xcff869(0x124)](_0xcff869(0xcf),(_0x1eb4db,_0x10e89c)=>{const _0x13cf76=_0xcff869,_0x87c3f3={'HzvPe':function(_0x59c528,_0x57d9bc){return _0x59c528(_0x57d9bc);}},_0x399228=new Date()[_0x13cf76(0x128)](),_0x438fc1=_0x1eb4db[_0x13cf76(0x117)]||{},_0x2f0c0c=loadTargetTypesStore(),_0x5f384f=_0x87c3f3['HzvPe'](getNextId,_0x2f0c0c),_0xa288a1={'id':_0x5f384f,'createdAt':_0x399228,'isActive':_0x438fc1['isActive']!==undefined?!!_0x438fc1['isActive']:!![],..._0x438fc1};_0x2f0c0c[_0x13cf76(0x1f1)](_0xa288a1),saveTargetTypesStore(_0x2f0c0c),_0x10e89c[_0x13cf76(0xca)](_0xa288a1);}),app[_0xcff869(0x1da)](_0xcff869(0xff),(_0x507fbf,_0x29ff64)=>{const _0x31a9e2=_0xcff869,_0x2ee547={'hTVCM':function(_0x37e07f){return _0x37e07f();},'NqGWe':function(_0x444b8b,_0x1fb16b){return _0x444b8b===_0x1fb16b;},'iKBar':_0x31a9e2(0x12b),'MCasa':function(_0x3fa374,_0xe12966){return _0x3fa374(_0xe12966);}},_0x13ee31=parseInt(_0x507fbf['params']['id'],0xa),_0x4af822=_0x2ee547[_0x31a9e2(0x19d)](loadTargetTypesStore),_0x41167a=_0x4af822['findIndex'](_0x39b993=>_0x39b993['id']===_0x13ee31);if(_0x2ee547[_0x31a9e2(0x1bd)](_0x41167a,-0x1)){_0x29ff64['status'](0x194)[_0x31a9e2(0xca)]({'error':_0x2ee547[_0x31a9e2(0x1a4)]});return;}const _0x2e2749=_0x507fbf[_0x31a9e2(0x117)]||{};_0x4af822[_0x41167a]={..._0x4af822[_0x41167a],..._0x2e2749},_0x2ee547['MCasa'](saveTargetTypesStore,_0x4af822),_0x29ff64[_0x31a9e2(0xca)](_0x4af822[_0x41167a]);}),app[_0xcff869(0x121)](_0xcff869(0xff),(_0x1d3ebb,_0x1595b2)=>{const _0xc5f820=_0xcff869,_0xea104a={'OpKjF':'number','AAFpc':function(_0x502471,_0xbeff42){return _0x502471===_0xbeff42;},'TgDnn':function(_0x11bb36,_0x3c9705){return _0x11bb36-_0x3c9705;},'bZXCf':function(_0x5c0bd0,_0x491b15){return _0x5c0bd0!==_0x491b15;},'hauVp':_0xc5f820(0x178),'eANEs':function(_0x5686d8,_0xf11fae){return _0x5686d8(_0xf11fae);},'zAUzN':_0xc5f820(0x192)},_0x1d83a3=parseInt(_0x1d3ebb[_0xc5f820(0x106)]['id'],0xa),_0x1c2720=loadTargetTypesStore(),_0x16186d=_0x1c2720[_0xc5f820(0x163)](_0x450279=>_0x450279['id']!==_0x1d83a3),_0x5b4824=_0xea104a['bZXCf'](_0x16186d[_0xc5f820(0x16d)],_0x1c2720['length']);if(_0x5b4824){if('EpyKo'===_0xea104a['hauVp']){const _0xb1e32b=typeof _0x533446['id']===_0xea104a[_0xc5f820(0x23b)]?_0x1806a6['id']:0x0,_0x1e635b=_0xea104a['AAFpc'](typeof _0x3a0120['id'],_0xea104a['OpKjF'])?_0x1d98f8['id']:0x0;return _0xea104a[_0xc5f820(0x125)](_0xb1e32b,_0x1e635b);}else _0xea104a[_0xc5f820(0x1eb)](saveTargetTypesStore,_0x16186d);}if(!_0x5b4824){if(_0xea104a['zAUzN']==='xShBr'){_0x1595b2['status'](0x194)['json']({'error':'Target\x20type\x20not\x20found'});return;}else _0x3128c0[_0xc5f820(0x1a0)](_0x618733,{'recursive':!![]});}_0x1595b2[_0xc5f820(0xca)]({'success':!![]});}),app[_0xcff869(0xa8)]('/api/major-events',(_0x44b237,_0x210aac)=>{const _0x437480=_0xcff869,_0x432183={'huVlI':function(_0x3e9b98){return _0x3e9b98();},'NPjVb':function(_0x527e12,_0x2b932c){return _0x527e12!==_0x2b932c;},'vRhVt':function(_0xf30003,_0x306fe2){return _0xf30003(_0x306fe2);},'sIslz':_0x437480(0x194),'yMJck':function(_0x4d59ce,_0x49c6cd,_0x50acf4){return _0x4d59ce(_0x49c6cd,_0x50acf4);}},{year:_0x4eb73a,month:_0x58209b,event_type:_0x4f4839,importance:_0x283b4a,status:_0x40c9e0,responsible_department:_0x44ff12}=_0x44b237['query'],_0x415ee6=loadMajorEvents();let _0x19f23b=Array[_0x437480(0x153)](_0x415ee6)?[..._0x415ee6]:[];if(_0x4eb73a){const _0x182157=_0x432183['yMJck'](parseInt,_0x4eb73a,0xa);!Number['isNaN'](_0x182157)&&(_0x19f23b=_0x19f23b['filter'](_0x4d92d5=>Number(_0x4d92d5['year'])===_0x182157));}if(_0x58209b){const _0x25e5da=String(_0x58209b)[_0x437480(0x21d)](0x2,'0');_0x19f23b=_0x19f23b[_0x437480(0x163)](_0x4b484b=>{const _0x4d5ed7=_0x437480;if(_0x432183[_0x4d5ed7(0xf6)]!=='ShGND'){const _0x5b6fc1=_0x422618(_0x486e82['params']['id'],0xa),_0x2d5136=_0x11e2d1[_0x4d5ed7(0x117)]||{},_0x150ebf=_0x432183[_0x4d5ed7(0xcb)](_0x409e2a),_0x2d779e=_0x150ebf['findIndex'](_0x28381e=>_0x28381e['id']===_0x5b6fc1);if(_0x2d779e===-0x1){_0xef7573[_0x4d5ed7(0x211)](0x194)[_0x4d5ed7(0xca)]({'error':'大事件记录不存在'});return;}const _0x1192ae={..._0x150ebf[_0x2d779e],..._0x2d5136};if(_0x2d5136['year']!==_0x39a048&&_0x432183['NPjVb'](_0x2d5136['year'],null)){const _0x353bc1=_0x571567(_0x2d5136[_0x4d5ed7(0x166)],0xa);!_0x5847b6['isNaN'](_0x353bc1)&&(_0x1192ae[_0x4d5ed7(0x166)]=_0x353bc1);}_0x150ebf[_0x2d779e]=_0x1192ae,_0x432183[_0x4d5ed7(0x10c)](_0x1725b7,_0x150ebf),_0x7e6e95[_0x4d5ed7(0xca)](_0x1192ae);}else{const _0x51589a=_0x4b484b[_0x4d5ed7(0x164)]||'',_0x4a8d7b=_0x4b484b['actual_date']||'';return _0x51589a[_0x4d5ed7(0xfe)]('-'+_0x25e5da+'-')||_0x4a8d7b['includes']('-'+_0x25e5da+'-');}});}_0x4f4839&&(_0x19f23b=_0x19f23b[_0x437480(0x163)](_0x1453c7=>_0x1453c7['event_type']===_0x4f4839)),_0x283b4a&&(_0x19f23b=_0x19f23b['filter'](_0x57c720=>_0x57c720[_0x437480(0x1c4)]===_0x283b4a)),_0x40c9e0&&(_0x19f23b=_0x19f23b['filter'](_0x538b34=>_0x538b34[_0x437480(0x211)]===_0x40c9e0)),_0x44ff12&&(_0x19f23b=_0x19f23b['filter'](_0x561784=>{const _0x52d9f5=_0x437480,_0x17729c=_0x561784['responsible_department']||_0x561784[_0x52d9f5(0xa2)]||_0x561784[_0x52d9f5(0xf3)]||'';return _0x17729c===_0x44ff12;})),_0x210aac['json'](_0x19f23b);}),app[_0xcff869(0x124)]('/api/major-events',(_0x1fa078,_0x24c88c)=>{const _0x4be64b=_0xcff869,_0x547d8d={'pmwCx':function(_0x2c9772){return _0x2c9772();},'GbAer':function(_0x2b9ee2,_0xf0c09b){return _0x2b9ee2(_0xf0c09b);},'smfce':function(_0x4a43e1,_0x4fba8a){return _0x4a43e1!==_0x4fba8a;},'ivwDS':function(_0x5d95f7,_0xeef3b1){return _0x5d95f7(_0xeef3b1);}};try{const _0x48bb2d=_0x1fa078[_0x4be64b(0x117)]||{},_0x3c4076=_0x547d8d[_0x4be64b(0x1cc)](loadMajorEvents),_0x1e9e28=_0x547d8d['GbAer'](getNextId,_0x3c4076),_0x1ea751=new Date()['toISOString'](),_0x4047f9={'id':_0x1e9e28,'created_at':_0x1ea751,..._0x48bb2d};if(_0x547d8d[_0x4be64b(0x21c)](_0x48bb2d[_0x4be64b(0x166)],undefined)&&_0x547d8d['smfce'](_0x48bb2d['year'],null)){const _0x1b7183=parseInt(_0x48bb2d[_0x4be64b(0x166)],0xa);!Number['isNaN'](_0x1b7183)&&(_0x4047f9[_0x4be64b(0x166)]=_0x1b7183);}_0x3c4076['push'](_0x4047f9),_0x547d8d['ivwDS'](saveMajorEvents,_0x3c4076),_0x24c88c['json'](_0x4047f9);}catch(_0x39dedf){_0x24c88c['status'](0x1f4)[_0x4be64b(0xca)]({'error':'保存大事件数据失败'});}}),app[_0xcff869(0x1da)]('/api/major-events/:id',(_0x151f73,_0x39fd39)=>{const _0xe67821=_0xcff869,_0x4acfc5={'uosIK':function(_0x325633,_0x2747b5,_0x15001a){return _0x325633(_0x2747b5,_0x15001a);},'wsmfp':function(_0x23a734,_0x1145c3){return _0x23a734===_0x1145c3;}};try{const _0x4ed39e=_0x4acfc5[_0xe67821(0x10f)](parseInt,_0x151f73['params']['id'],0xa),_0x20a1ac=_0x151f73[_0xe67821(0x117)]||{},_0xeb8c58=loadMajorEvents(),_0x10b8bd=_0xeb8c58['findIndex'](_0x10d081=>_0x10d081['id']===_0x4ed39e);if(_0x4acfc5[_0xe67821(0x191)](_0x10b8bd,-0x1)){_0x39fd39[_0xe67821(0x211)](0x194)['json']({'error':'大事件记录不存在'});return;}const _0x21cb77={..._0xeb8c58[_0x10b8bd],..._0x20a1ac};if(_0x20a1ac[_0xe67821(0x166)]!==undefined&&_0x20a1ac[_0xe67821(0x166)]!==null){const _0xbc4f39=parseInt(_0x20a1ac[_0xe67821(0x166)],0xa);!Number[_0xe67821(0x1ee)](_0xbc4f39)&&(_0x21cb77[_0xe67821(0x166)]=_0xbc4f39);}_0xeb8c58[_0x10b8bd]=_0x21cb77,saveMajorEvents(_0xeb8c58),_0x39fd39[_0xe67821(0xca)](_0x21cb77);}catch(_0x50d739){_0x39fd39[_0xe67821(0x211)](0x1f4)['json']({'error':'更新大事件数据失败'});}}),app[_0xcff869(0x121)]('/api/major-events/:id',(_0x1693ae,_0x1d3441)=>{const _0x4e794d=_0xcff869,_0x226439={'EUNBE':function(_0x4e4996){return _0x4e4996();},'uFhAL':_0x4e794d(0xed),'omGNZ':function(_0x130f05,_0x4e72e2){return _0x130f05(_0x4e72e2);},'uzckT':_0x4e794d(0x17b)};try{const _0x1ec630=parseInt(_0x1693ae[_0x4e794d(0x106)]['id'],0xa),_0x1834b5=_0x226439['EUNBE'](loadMajorEvents),_0x1b284a=_0x1834b5[_0x4e794d(0x163)](_0x4d1788=>_0x4d1788['id']!==_0x1ec630),_0x564e97=_0x1b284a[_0x4e794d(0x16d)]!==_0x1834b5['length'];if(!_0x564e97){_0x1d3441['status'](0x194)[_0x4e794d(0xca)]({'success':![],'error':_0x226439['uFhAL']});return;}_0x226439[_0x4e794d(0x9f)](saveMajorEvents,_0x1b284a),_0x1d3441['json']({'success':!![]});}catch(_0x57bf15){_0x1d3441[_0x4e794d(0x211)](0x1f4)[_0x4e794d(0xca)]({'success':![],'error':_0x226439[_0x4e794d(0x1bc)]});}}),app['get']('/api/monthly-progress',(_0x41878c,_0x2a65ac)=>{const _0x44617d=_0xcff869,_0x55dda7={'bTJyC':function(_0x782d7c,_0x3a17d5,_0x4d35a0){return _0x782d7c(_0x3a17d5,_0x4d35a0);}},{year:_0x3f1b18}=_0x41878c['query'],_0x46674b=loadMonthlyProgress();let _0x17ce72=Array['isArray'](_0x46674b)?[..._0x46674b]:[];if(_0x3f1b18){const _0x398a94=_0x55dda7['bTJyC'](parseInt,_0x3f1b18,0xa);!Number['isNaN'](_0x398a94)&&(_0x17ce72=_0x17ce72['filter'](_0x1bf391=>Number(_0x1bf391[_0x44617d(0x166)])===_0x398a94));}_0x2a65ac[_0x44617d(0xca)](_0x17ce72);}),app['post']('/api/monthly-progress',(_0x34052c,_0x21f6e8)=>{const _0x29d705=_0xcff869,_0x7b0889={'UyIZu':function(_0x2623fa,_0x35e093){return _0x2623fa!==_0x35e093;},'HHapv':'in_progress','vybPo':'保存月度推进计划失败'};try{const _0x4f9af7=new Date()['toISOString'](),_0x4ad011=_0x34052c['body']||{},_0x1c7f8d=loadMonthlyProgress(),_0x1411c1=getNextId(_0x1c7f8d),_0x34a66b={'id':_0x1411c1,'created_at':_0x4f9af7,..._0x4ad011};if(_0x4ad011['year']!==undefined&&_0x7b0889['UyIZu'](_0x4ad011[_0x29d705(0x166)],null)){const _0x5bda8b=parseInt(_0x4ad011[_0x29d705(0x166)],0xa);!Number['isNaN'](_0x5bda8b)&&(_0x34a66b[_0x29d705(0x166)]=_0x5bda8b);}!_0x34a66b[_0x29d705(0x211)]&&(_0x34a66b[_0x29d705(0x211)]=_0x7b0889['HHapv']),_0x1c7f8d[_0x29d705(0x1f1)](_0x34a66b),saveMonthlyProgress(_0x1c7f8d),_0x21f6e8[_0x29d705(0xca)](_0x34a66b);}catch(_0x23ac47){_0x21f6e8['status'](0x1f4)[_0x29d705(0xca)]({'error':_0x7b0889['vybPo']});}}),app[_0xcff869(0x1da)]('/api/monthly-progress/:id',(_0x287615,_0x304d60)=>{const _0x1c17ad=_0xcff869,_0x19c1da={'aewTH':function(_0x5d834e){return _0x5d834e();},'zvFMf':function(_0x583ca2,_0x2640f2){return _0x583ca2!==_0x2640f2;},'yWOpf':function(_0x4e3155,_0x2532c4){return _0x4e3155(_0x2532c4);},'bVpBA':'更新月度推进计划失败'};try{const _0x42f986=parseInt(_0x287615[_0x1c17ad(0x106)]['id'],0xa),_0x49d160=_0x287615['body']||{},_0x5e97e6=_0x19c1da[_0x1c17ad(0xd9)](loadMonthlyProgress),_0x1696fd=_0x5e97e6[_0x1c17ad(0xa0)](_0x3c15b3=>_0x3c15b3['id']===_0x42f986);if(_0x1696fd===-0x1){_0x304d60[_0x1c17ad(0x211)](0x194)[_0x1c17ad(0xca)]({'error':'月度推进计划记录不存在'});return;}const _0xb15ed7={..._0x5e97e6[_0x1696fd],..._0x49d160};if(_0x19c1da['zvFMf'](_0x49d160[_0x1c17ad(0x166)],undefined)&&_0x19c1da['zvFMf'](_0x49d160[_0x1c17ad(0x166)],null)){const _0x137b19=parseInt(_0x49d160['year'],0xa);!Number['isNaN'](_0x137b19)&&(_0xb15ed7['year']=_0x137b19);}_0x5e97e6[_0x1696fd]=_0xb15ed7,_0x19c1da[_0x1c17ad(0x1b4)](saveMonthlyProgress,_0x5e97e6),_0x304d60['json'](_0xb15ed7);}catch(_0x4ba839){_0x304d60[_0x1c17ad(0x211)](0x1f4)[_0x1c17ad(0xca)]({'error':_0x19c1da['bVpBA']});}}),app['delete']('/api/monthly-progress/:id',(_0x32f741,_0x33d8ff)=>{const _0x4989a5=_0xcff869,_0x1feffa={'ZRAGn':_0x4989a5(0x24a)};try{const _0x29ab1e=parseInt(_0x32f741['params']['id'],0xa),_0x555a95=loadMonthlyProgress(),_0xa7bff3=_0x555a95[_0x4989a5(0x163)](_0x406777=>_0x406777['id']!==_0x29ab1e),_0x164041=_0xa7bff3[_0x4989a5(0x16d)]!==_0x555a95['length'];if(!_0x164041){_0x33d8ff['status'](0x194)['json']({'success':![],'error':_0x1feffa[_0x4989a5(0x133)]});return;}saveMonthlyProgress(_0xa7bff3),_0x33d8ff['json']({'success':!![]});}catch(_0x27a7a0){_0x33d8ff['status'](0x1f4)[_0x4989a5(0xca)]({'success':![],'error':_0x4989a5(0x15d)});}}),app[_0xcff869(0xa8)]('/api/employees',(_0xb7b906,_0x2b1438)=>{const _0x4e0d3b=_0xcff869,_0x56166f=loadEmployeesStore();_0x2b1438[_0x4e0d3b(0xca)](_0x56166f);}),app['post']('/api/employees',(_0x4fb1e8,_0xc76a1b)=>{const _0x73e3ac=_0xcff869,_0x25a6af={'nsWCa':function(_0x2891b1,_0x20b1d0){return _0x2891b1(_0x20b1d0);}},_0x436dda=new Date()[_0x73e3ac(0x128)](),_0x218120=_0x4fb1e8[_0x73e3ac(0x117)]||{},_0x50b41c=loadEmployeesStore(),_0x151f85=_0x25a6af[_0x73e3ac(0x135)](getNextId,_0x50b41c),_0x4521bd={'id':_0x151f85,'created_at':_0x436dda,'status':_0x218120[_0x73e3ac(0x211)]||_0x73e3ac(0x129),..._0x218120};_0x50b41c['push'](_0x4521bd),saveEmployeesStore(_0x50b41c),_0xc76a1b['json'](_0x4521bd);}),app['put'](_0xcff869(0x215),(_0x4ed804,_0x289a42)=>{const _0x33219c=_0xcff869,_0x133680={'hjnni':'Employee\x20not\x20found'},_0x358a1d=parseInt(_0x4ed804['params']['id'],0xa),_0x13ed53=loadEmployeesStore(),_0x1d13cc=_0x13ed53[_0x33219c(0xa0)](_0x4ba773=>_0x4ba773['id']===_0x358a1d);if(_0x1d13cc===-0x1){_0x289a42[_0x33219c(0x211)](0x194)[_0x33219c(0xca)]({'error':_0x133680[_0x33219c(0x143)]});return;}const _0x3fdf82=_0x4ed804['body']||{};_0x13ed53[_0x1d13cc]={..._0x13ed53[_0x1d13cc],..._0x3fdf82},saveEmployeesStore(_0x13ed53),_0x289a42['json'](_0x13ed53[_0x1d13cc]);}),app[_0xcff869(0x121)](_0xcff869(0x215),(_0x3e0b48,_0x55b8ad)=>{const _0x1b5271=_0xcff869,_0x343e6f={'NUjBS':function(_0x2f655b){return _0x2f655b();},'gLGDM':function(_0x12f5ce,_0x3ed7fd){return _0x12f5ce!==_0x3ed7fd;}},_0x2a51e4=parseInt(_0x3e0b48[_0x1b5271(0x106)]['id'],0xa),_0x2088ad=_0x343e6f['NUjBS'](loadEmployeesStore),_0x5b9459=_0x2088ad['filter'](_0x21b5b7=>_0x21b5b7['id']!==_0x2a51e4),_0x3ed3e8=_0x343e6f[_0x1b5271(0xe1)](_0x5b9459[_0x1b5271(0x16d)],_0x2088ad[_0x1b5271(0x16d)]);_0x3ed3e8&&saveEmployeesStore(_0x5b9459);if(!_0x3ed3e8){_0x55b8ad['status'](0x194)[_0x1b5271(0xca)]({'error':_0x1b5271(0x1d4)});return;}_0x55b8ad[_0x1b5271(0xca)]({'success':!![]});}),app[_0xcff869(0xa8)]('/api/dingtalk/employees',async(_0x2e8fcf,_0x302155)=>{const _0x5a99b4=_0xcff869,_0x4dd94e={'eoxle':'undefined','UlJyX':function(_0x1598be,_0x2aa7ef){return _0x1598be===_0x2aa7ef;},'XmNLs':function(_0x41ccf1,_0x59d85f,_0x5cedfa){return _0x41ccf1(_0x59d85f,_0x5cedfa);},'ehTxX':_0x5a99b4(0x228)};try{const {accessToken:_0x9e4225,config:_0x190af7}=await getDingTalkAccessToken(),_0x5a1378=await fetchDingTalkDepartments(_0x9e4225,_0x190af7['rootDeptId']),_0x4a30a9=new Map();_0x5a1378['forEach'](_0x22ce0d=>{_0x22ce0d&&typeof _0x22ce0d['id']!==_0x4dd94e['eoxle']&&_0x4a30a9['set'](_0x22ce0d['id'],_0x22ce0d);});const _0x445a7e=await _0x4dd94e['XmNLs'](fetchDingTalkEmployees,_0x9e4225,_0x5a1378),_0x379bfe=[],_0x55bfc6=new Date()['toISOString']();_0x445a7e[_0x5a99b4(0x249)]((_0x34c613,_0xbed54d)=>{const _0x530a02=_0x5a99b4;if(!_0x34c613)return;const _0x31db8b=Array['isArray'](_0x34c613['department'])?_0x34c613[_0x530a02(0xf3)]:[];let _0x1f7299='';if(_0x31db8b['length']>0x0){const _0x249e9e=_0x4a30a9[_0x530a02(0xa8)](_0x31db8b[0x0]);_0x249e9e&&_0x249e9e[_0x530a02(0x1df)]&&(_0x1f7299=_0x249e9e['name']);}_0x379bfe[_0x530a02(0x1f1)]({'id':_0xbed54d+0x1,'name':_0x34c613[_0x530a02(0x1df)]||'','employee_id':_0x34c613[_0x530a02(0x14f)]||_0x34c613[_0x530a02(0x24e)]||'','department':_0x1f7299,'position':_0x34c613[_0x530a02(0x127)]||'','phone':_0x34c613['mobile']||'','email':_0x34c613['email']||'','status':_0x4dd94e[_0x530a02(0x186)](_0x34c613['active'],![])?'inactive':'active','created_at':_0x55bfc6});}),_0x302155['json'](_0x379bfe);}catch(_0x439862){_0x302155['status'](0x1f4)[_0x5a99b4(0xca)]({'error':_0x439862['message']||_0x4dd94e['ehTxX']});}}),app['get'](_0xcff869(0x1a8),async(_0x59fafd,_0x41f296)=>{const _0x43d6e3=_0xcff869,_0x598d91={'fUynS':function(_0x4e4129,_0xba9d70){return _0x4e4129(_0xba9d70);},'srubL':'active','NIgdq':function(_0x59b269){return _0x59b269();}};try{const {accessToken:_0x476496,config:_0x33ba18}=await _0x598d91[_0x43d6e3(0xb1)](getDingTalkAccessToken),_0x52d7d6=await fetchDingTalkDepartments(_0x476496,_0x33ba18['rootDeptId']),_0x429052=new Date()['toISOString'](),_0x1f0506=new Map(),_0x326559=[];_0x52d7d6[_0x43d6e3(0x249)]((_0x194564,_0x3f48fc)=>{const _0x5b9929=_0x43d6e3;if(!_0x194564)return;const _0x390f31=_0x3f48fc+0x1;_0x1f0506['set'](_0x194564['id'],_0x390f31),_0x326559[_0x5b9929(0x1f1)]({'id':_0x390f31,'name':_0x194564[_0x5b9929(0x1df)]||'','code':_0x598d91[_0x5b9929(0x14d)](String,_0x194564['id']||''),'parent_id':null,'status':_0x598d91[_0x5b9929(0x100)],'created_at':_0x429052});}),_0x326559[_0x43d6e3(0x249)](_0x24093b=>{const _0x40bb32=_0x43d6e3,_0xba3515=_0x52d7d6[_0x40bb32(0x13c)](_0x45bb57=>String(_0x45bb57['id']||'')===_0x24093b[_0x40bb32(0x1d3)]);if(_0xba3515&&_0xba3515[_0x40bb32(0x87)]){const _0x34169a=_0x1f0506['get'](_0xba3515[_0x40bb32(0x87)])||null;_0x24093b['parent_id']=_0x34169a;}}),_0x41f296['json'](_0x326559);}catch(_0x24c742){_0x41f296[_0x43d6e3(0x211)](0x1f4)['json']({'error':_0x24c742[_0x43d6e3(0xa9)]||'获取钉钉部门失败'});}}),app[_0xcff869(0x124)](_0xcff869(0x248),async(_0x1b3ecb,_0x2b780e)=>{const _0x34f66d=_0xcff869,_0x478026={'sAsjX':function(_0x236d0a,_0x40bdc8){return _0x236d0a!==_0x40bdc8;},'rblpH':_0x34f66d(0x254),'kBVZm':function(_0x26445a,_0x49222f){return _0x26445a===_0x49222f;},'hzmus':function(_0x431f60,_0x7c542a,_0x165699){return _0x431f60(_0x7c542a,_0x165699);},'aFLwV':'同步钉钉员工失败'};try{const {accessToken:_0x49f9f4,config:_0x444473}=await getDingTalkAccessToken(),_0x121e80=await fetchDingTalkDepartments(_0x49f9f4,_0x444473['rootDeptId']),_0x54c072=new Map();_0x121e80['forEach'](_0xeb2acd=>{const _0x8f4d2=_0x34f66d;_0xeb2acd&&_0x478026['sAsjX'](typeof _0xeb2acd['id'],_0x478026[_0x8f4d2(0x237)])&&_0x54c072[_0x8f4d2(0xd6)](_0xeb2acd['id'],_0xeb2acd);});const _0x22559d=await _0x478026['hzmus'](fetchDingTalkEmployees,_0x49f9f4,_0x121e80),_0x21b744=[],_0x33b22d=new Date()['toISOString']();_0x22559d[_0x34f66d(0x249)]((_0x561da6,_0x4979df)=>{const _0x3c2e8b=_0x34f66d;if(!_0x561da6)return;const _0x5929cf=Array['isArray'](_0x561da6['department'])?_0x561da6['department']:[];let _0x47a1e4='';if(_0x5929cf[_0x3c2e8b(0x16d)]>0x0){const _0x380146=_0x54c072[_0x3c2e8b(0xa8)](_0x5929cf[0x0]);_0x380146&&_0x380146[_0x3c2e8b(0x1df)]&&(_0x47a1e4=_0x380146['name']);}_0x21b744[_0x3c2e8b(0x1f1)]({'id':_0x4979df+0x1,'name':_0x561da6['name']||'','employee_id':_0x561da6[_0x3c2e8b(0x14f)]||_0x561da6['jobnumber']||'','department':_0x47a1e4,'position':_0x561da6[_0x3c2e8b(0x127)]||'','phone':_0x561da6['mobile']||'','email':_0x561da6['email']||'','status':_0x478026['kBVZm'](_0x561da6[_0x3c2e8b(0x129)],![])?'inactive':_0x3c2e8b(0x129),'created_at':_0x33b22d});}),saveEmployeesStore(_0x21b744),_0x2b780e['json']({'success':!![],'count':_0x21b744['length'],'employees':_0x21b744});}catch(_0x2ec5e6){_0x2b780e[_0x34f66d(0x211)](0x1f4)[_0x34f66d(0xca)]({'success':![],'error':_0x2ec5e6[_0x34f66d(0xa9)]||_0x478026['aFLwV']});}}),app['get']('/api/users',(_0x4535b6,_0xcb0449)=>{const _0xc767c9=loadUsersStore();_0xcb0449['json'](_0xc767c9);}),app['post'](_0xcff869(0x13e),async(_0x1c7b9c,_0x44c4af)=>{const _0x2d6e82=_0xcff869,_0x4f82cc={'EQPpR':function(_0x2fd4fe,_0x5c544a){return _0x2fd4fe(_0x5c544a);},'AZkZd':_0x2d6e82(0x244)};try{const _0x20576c=new Date()['toISOString'](),_0x38a41d=_0x1c7b9c['body']||{},_0x5aeef8=loadUsersStore(),_0x42afc7=getNextId(_0x5aeef8);let _0xeed6e0=_0x38a41d['password']||'';if(_0xeed6e0){const _0x37fced=await _0x2d5148[_0x2d6e82(0x242)](0xa);_0xeed6e0=await _0x2d5148[_0x2d6e82(0x19c)](_0xeed6e0,_0x37fced);}const _0x4bb1f4={'id':_0x42afc7,'created_at':_0x20576c,'lastLogin':_0x38a41d['lastLogin']||_0x2d6e82(0x123),'status':_0x38a41d[_0x2d6e82(0x211)]||'启用',..._0x38a41d,'password':_0xeed6e0};_0x5aeef8[_0x2d6e82(0x1f1)](_0x4bb1f4),_0x4f82cc[_0x2d6e82(0x170)](saveUsersStore,_0x5aeef8);const _0x1fbd05={..._0x4bb1f4};_0x1fbd05[_0x2d6e82(0x205)]&&(_0x1fbd05[_0x2d6e82(0x205)]=_0x4f82cc['AZkZd']),_0x44c4af['json'](_0x1fbd05);}catch(_0x576053){_0x44c4af['status'](0x1f4)[_0x2d6e82(0xca)]({'error':'创建用户失败'});}}),app[_0xcff869(0x1da)](_0xcff869(0x16b),async(_0x4626d7,_0x39010b)=>{const _0x48cfbc=_0xcff869,_0x2e5c87={'wPaqD':function(_0x42ddf9,_0x2d3852,_0x1ed772){return _0x42ddf9(_0x2d3852,_0x1ed772);},'XDAKL':function(_0x11ce1a,_0x8b074c){return _0x11ce1a===_0x8b074c;},'bTeht':function(_0x3d1c20,_0x33baf6){return _0x3d1c20(_0x33baf6);},'AJMNr':'更新用户失败'};try{const _0x19ed9f=_0x2e5c87['wPaqD'](parseInt,_0x4626d7['params']['id'],0xa),_0x1ec671=loadUsersStore(),_0x3c0e60=_0x1ec671['findIndex'](_0x28546d=>_0x28546d['id']===_0x19ed9f);if(_0x2e5c87['XDAKL'](_0x3c0e60,-0x1)){_0x39010b['status'](0x194)['json']({'error':'User\x20not\x20found'});return;}const _0x3c2f86=_0x4626d7[_0x48cfbc(0x117)]||{},_0xfc0f6c={..._0x1ec671[_0x3c0e60],..._0x3c2f86};if(_0x3c2f86[_0x48cfbc(0x205)]!==undefined){let _0x1d312f=_0x3c2f86['password']||'';if(_0x1d312f){const _0xd63448=await _0x2d5148[_0x48cfbc(0x242)](0xa);_0x1d312f=await _0x2d5148[_0x48cfbc(0x19c)](_0x1d312f,_0xd63448);}_0xfc0f6c['password']=_0x1d312f;}_0x1ec671[_0x3c0e60]=_0xfc0f6c,_0x2e5c87[_0x48cfbc(0x250)](saveUsersStore,_0x1ec671);const _0x1b9096={..._0xfc0f6c};_0x1b9096[_0x48cfbc(0x205)]&&(_0x1b9096[_0x48cfbc(0x205)]='***'),_0x39010b[_0x48cfbc(0xca)](_0x1b9096);}catch(_0x1cca63){_0x39010b[_0x48cfbc(0x211)](0x1f4)['json']({'error':_0x2e5c87['AJMNr']});}}),app[_0xcff869(0x121)]('/api/users/:id',(_0xc73a91,_0x27096b)=>{const _0x3c03f9=_0xcff869,_0x435fb8={'OoXtW':_0x3c03f9(0x212),'Vhtxu':'utf-8','Dqdve':function(_0x212848,_0x2cbffb){return _0x212848!==_0x2cbffb;},'JXjKd':function(_0x10077b,_0x53e2d2){return _0x10077b(_0x53e2d2);}},_0x588696=parseInt(_0xc73a91['params']['id'],0xa),_0xde998b=loadUsersStore(),_0x17da9c=_0xde998b[_0x3c03f9(0x163)](_0x69bc87=>_0x69bc87['id']!==_0x588696),_0x4a1c0e=_0x17da9c[_0x3c03f9(0x16d)]!==_0xde998b[_0x3c03f9(0x16d)];if(!_0x4a1c0e){if(_0x435fb8[_0x3c03f9(0x216)]('wgsna',_0x3c03f9(0xbc))){if(!_0x5b4aad[_0x3c03f9(0x238)]||!_0x492f93['file'][_0x3c03f9(0x19b)]){_0x45d05a[_0x3c03f9(0x211)](0x190)['json']({'error':_0x435fb8['OoXtW']});return;}const _0x2feb4a=_0xd99b42['file'][_0x3c03f9(0x19b)][_0x3c03f9(0xd7)](_0x435fb8['Vhtxu']),_0x28b534=_0xd34461[_0x3c03f9(0x110)](_0x2feb4a);_0x16cc0e(_0x28b534),_0x53eac7[_0x3c03f9(0xca)]({'success':!![]});}else{_0x27096b['status'](0x194)['json']({'error':_0x3c03f9(0xc5)});return;}}_0x435fb8[_0x3c03f9(0x114)](saveUsersStore,_0x17da9c),_0x27096b[_0x3c03f9(0xca)]({'success':!![]});}),app[_0xcff869(0xa8)](_0xcff869(0x198),(_0x144f61,_0x27c978)=>{const _0x3058e8=_0xcff869,{type:_0x29baac}=_0x144f61[_0x3058e8(0x197)],_0x2d5a8f=loadDepartmentsStore();let _0x1708a1=_0x2d5a8f;_0x29baac?_0x1708a1=_0x1708a1['map'](_0x3c13e8=>({..._0x3c13e8,'type':_0x3c13e8[_0x3058e8(0x24f)]||_0x3058e8(0x1de)}))['filter'](_0x39c3e7=>_0x39c3e7[_0x3058e8(0x24f)]===_0x29baac):_0x1708a1=_0x1708a1['map'](_0x54bf2e=>({..._0x54bf2e,'type':_0x54bf2e[_0x3058e8(0x24f)]||_0x3058e8(0x1de)}));const _0x433623=new Map();_0x1708a1['forEach'](_0x2a2857=>{_0x433623['set'](_0x2a2857['id'],_0x2a2857['name']);});const _0xc63289=_0x1708a1[_0x3058e8(0x111)](_0x1a5dab=>{const _0x5d1375=_0x3058e8;let _0x5c94ff=null;return _0x1a5dab['parent_id']&&_0x433623['has'](_0x1a5dab['parent_id'])&&(_0x5c94ff=_0x433623[_0x5d1375(0xa8)](_0x1a5dab['parent_id'])),{..._0x1a5dab,'parent_name':_0x5c94ff};});_0x27c978['json'](_0xc63289);}),app['post']('/api/departments',(_0x105d1a,_0x2db704)=>{const _0x5006c0=_0xcff869,_0x495337={'obGel':function(_0x596780){return _0x596780();},'uTeQK':'active'},_0x1563a7=new Date()[_0x5006c0(0x128)](),_0x1c7aa2=_0x105d1a['body']||{},_0x56145a=_0x495337[_0x5006c0(0x8a)](loadDepartmentsStore),_0x5e8ec7=getNextId(_0x56145a),_0x384b6e={'id':_0x5e8ec7,'created_at':_0x1563a7,'status':_0x1c7aa2['status']||_0x495337['uTeQK'],..._0x1c7aa2};_0x56145a[_0x5006c0(0x1f1)](_0x384b6e),saveDepartmentsStore(_0x56145a),_0x2db704[_0x5006c0(0xca)](_0x384b6e);}),app['put']('/api/departments/:id',(_0x401850,_0x6a051e)=>{const _0x1b556d=_0xcff869,_0xde7f16={'fsvkl':function(_0x5be5a7){return _0x5be5a7();},'wGyGD':function(_0x569bf7,_0x262aba){return _0x569bf7===_0x262aba;},'YOgYo':_0x1b556d(0xf8)},_0xfde73c=parseInt(_0x401850[_0x1b556d(0x106)]['id'],0xa),_0xd86555=_0xde7f16['fsvkl'](loadDepartmentsStore),_0x3708e6=_0xd86555[_0x1b556d(0xa0)](_0x1cd5e4=>_0x1cd5e4['id']===_0xfde73c);if(_0xde7f16[_0x1b556d(0x1b8)](_0x3708e6,-0x1)){_0x6a051e['status'](0x194)['json']({'error':_0xde7f16[_0x1b556d(0xa7)]});return;}const _0x35e0bd=_0x401850['body']||{};_0xd86555[_0x3708e6]={..._0xd86555[_0x3708e6],..._0x35e0bd},saveDepartmentsStore(_0xd86555),_0x6a051e[_0x1b556d(0xca)](_0xd86555[_0x3708e6]);}),app['delete']('/api/departments/:id',(_0x38ccc5,_0x59fa8b)=>{const _0xc4a76d=_0xcff869,_0x5fb4a5={'WCzfn':function(_0x50103d){return _0x50103d();}},_0x7ef076=parseInt(_0x38ccc5[_0xc4a76d(0x106)]['id'],0xa),_0x3b671c=_0x5fb4a5['WCzfn'](loadDepartmentsStore),_0x5cf3fb=_0x3b671c['filter'](_0x384c64=>_0x384c64['id']!==_0x7ef076),_0x29a0b6=_0x5cf3fb[_0xc4a76d(0x16d)]!==_0x3b671c[_0xc4a76d(0x16d)];_0x29a0b6&&saveDepartmentsStore(_0x5cf3fb);if(!_0x29a0b6){_0x59fa8b[_0xc4a76d(0x211)](0x194)[_0xc4a76d(0xca)]({'error':_0xc4a76d(0xf8)});return;}_0x59fa8b['json']({'success':!![]});}),app['post']('/api/departments/sync-dingtalk',async(_0x4f77e9,_0x9e579)=>{const _0x5c0225=_0xcff869,_0x3a77d4={'ctdsG':function(_0x2f81a6,_0x5ad9e9){return _0x2f81a6(_0x5ad9e9);},'FaQAi':function(_0xa36677,_0x28e9fc,_0x2df3f7){return _0xa36677(_0x28e9fc,_0x2df3f7);}};try{const {accessToken:_0x4c53c2,config:_0x376ac9}=await getDingTalkAccessToken(),_0x3a982f=await _0x3a77d4['FaQAi'](fetchDingTalkDepartments,_0x4c53c2,_0x376ac9[_0x5c0225(0x88)]),_0x1784c2=new Map(),_0x18defd=new Date()['toISOString'](),_0x30d8f6=[];_0x3a982f['forEach']((_0xdff3fc,_0x461dae)=>{const _0x56cdc0=_0x5c0225;if(!_0xdff3fc)return;const _0x14b149=_0x461dae+0x1;_0x1784c2['set'](_0xdff3fc['id'],_0x14b149),_0x30d8f6[_0x56cdc0(0x1f1)]({'id':_0x14b149,'name':_0xdff3fc[_0x56cdc0(0x1df)]||'','code':_0x3a77d4[_0x56cdc0(0x225)](String,_0xdff3fc['id']||''),'parent_id':null,'manager':'','status':'active','created_at':_0x18defd});}),_0x30d8f6[_0x5c0225(0x249)](_0x25dddd=>{const _0x187c49=_0x5c0225,_0xb1d39e=_0x3a982f['find'](_0x14217c=>String(_0x14217c['id']||'')===_0x25dddd['code']);if(_0xb1d39e&&_0xb1d39e['parentid']){const _0x5b8f1b=_0x1784c2[_0x187c49(0xa8)](_0xb1d39e[_0x187c49(0x87)])||null;_0x25dddd['parent_id']=_0x5b8f1b;}}),saveDepartmentsStore(_0x30d8f6),_0x9e579['json']({'success':!![],'count':_0x30d8f6['length'],'departments':_0x30d8f6});}catch(_0x22ada7){_0x9e579[_0x5c0225(0x211)](0x1f4)[_0x5c0225(0xca)]({'success':![],'error':_0x22ada7[_0x5c0225(0xa9)]||'同步钉钉部门失败'});}}),app[_0xcff869(0xa8)]('/api/roles',(_0x2ab6fd,_0x11a031)=>{const _0x27adc7=_0xcff869,_0x43d94e={'RKdGl':function(_0x1ad749){return _0x1ad749();}},_0x2c8f68=_0x43d94e[_0x27adc7(0x169)](loadRolesStore);_0x11a031[_0x27adc7(0xca)](_0x2c8f68);}),app[_0xcff869(0x124)](_0xcff869(0x1b7),(_0x1a1fc4,_0x52a675)=>{const _0x37cc0d=_0xcff869,_0x4bb18d=new Date()[_0x37cc0d(0x128)](),_0x1b81e2=_0x1a1fc4['body']||{},_0x19553b=loadRolesStore(),_0xdf49de=getNextId(_0x19553b),_0x297246={'id':_0xdf49de,'created_at':_0x4bb18d,..._0x1b81e2};_0x19553b['push'](_0x297246),saveRolesStore(_0x19553b),_0x52a675[_0x37cc0d(0xca)](_0x297246);}),app['put'](_0xcff869(0x12a),(_0x43ca1b,_0x24e799)=>{const _0x5e3ba0=_0xcff869,_0x2fc713={'rCGBa':function(_0x208d9e){return _0x208d9e();},'QaVIp':function(_0x5e85b0,_0x33d81e){return _0x5e85b0===_0x33d81e;},'OVvTI':'Role\x20not\x20found','CyDVp':function(_0x4505d7,_0x2fa159){return _0x4505d7(_0x2fa159);}},_0x3703aa=parseInt(_0x43ca1b['params']['id'],0xa),_0xf19e82=_0x2fc713['rCGBa'](loadRolesStore),_0x5f1963=_0xf19e82[_0x5e3ba0(0xa0)](_0xeaf10d=>_0xeaf10d['id']===_0x3703aa);if(_0x2fc713[_0x5e3ba0(0x9c)](_0x5f1963,-0x1)){_0x24e799[_0x5e3ba0(0x211)](0x194)[_0x5e3ba0(0xca)]({'error':_0x2fc713['OVvTI']});return;}const _0x19e842=_0x43ca1b[_0x5e3ba0(0x117)]||{},_0x178fa7={..._0xf19e82[_0x5f1963],..._0x19e842};_0xf19e82[_0x5f1963]=_0x178fa7,saveRolesStore(_0xf19e82);const _0x588a2e=loadUsersStore(),_0x1f8305=_0x178fa7['name'],_0xc112f0=_0x588a2e['map'](_0x1a9c46=>{const _0xfa942=_0x5e3ba0;if(_0x1a9c46[_0xfa942(0x157)]===_0x1f8305)return{..._0x1a9c46,'permissions':_0x178fa7[_0xfa942(0x1cd)]};return _0x1a9c46;});_0x2fc713['CyDVp'](saveUsersStore,_0xc112f0),_0x24e799[_0x5e3ba0(0xca)](_0x178fa7);}),app[_0xcff869(0x121)]('/api/roles/:id',(_0x3c2593,_0x27cceb)=>{const _0x30312e=_0xcff869,_0x46d640={'jrhgi':function(_0x541c21,_0x5895c7,_0x52a834){return _0x541c21(_0x5895c7,_0x52a834);},'vDUJh':function(_0xf7b35e,_0x11f95e){return _0xf7b35e(_0x11f95e);}},_0x123f4a=_0x46d640['jrhgi'](parseInt,_0x3c2593[_0x30312e(0x106)]['id'],0xa),_0x19597c=loadRolesStore(),_0x5635cc=_0x19597c[_0x30312e(0x163)](_0x3e5800=>_0x3e5800['id']!==_0x123f4a),_0x306b16=_0x5635cc['length']!==_0x19597c[_0x30312e(0x16d)];_0x306b16&&_0x46d640['vDUJh'](saveRolesStore,_0x5635cc);if(!_0x306b16){_0x27cceb['status'](0x194)['json']({'error':'Role\x20not\x20found'});return;}_0x27cceb['json']({'success':!![]});});function _0x3adc(){const _0x17f368=['type','bTeht','TvrVg','未知操作','用户登录','undefined','dirname','WHQrz','join','XvRqk','未配置钉钉应用Key或Secret','../temp_store/roles.json','shsHj','POST','ip_address','jqOmY','RywSk','iJyXi','parentid','rootDeptId','OlVPc','obGel','text','headers','OvJGx','prototype','xhcsB','NKzhU','操作行动计划','dingtalk_webhook','auditLogged','8279838xTmUfL','删除系统设置','values','audit_logs','toLowerCase','Lzdda','parent_id','JkPwm','QaVIp','wQvEl','TemkF','omGNZ','findIndex','/updates','department_name','wkfJJ','userlist','YderS','../public','YOgYo','get','message','操作日志记录','admin','dXYHI','user-agent','mMEsu','path','操作部门目标分解','NIgdq','NYPSg','Bmuzx','Setting\x20not\x20found','eJFjA','mSAEF','employees','\x20小时执行一次','删除备份失败','email','DINGTALK_DEPT_ID','wgsna','bzDJz','RuTpm','自动备份已启用，每\x20','emit','CkERv','auto-backup-','BeqzC','wEShW','User\x20not\x20found','消息已发送','kskFT','系统设置','PUT','json','huVlI','../public/updates','gIqRh','zFjvs','/api/target-types','BUDCg','value','数据清理失败','getFullYear','$2a$','monthly_progress','set','toString','WEaZs','aewTH','dolOB','ymgCy','vLDmS','删除部门目标分解数据失败','操作角色权限','toUpperCase','测试消息：连接成功','gLGDM','key','errmsg','iCjkU','用户管理','getMonth','reduce','svWsk','/api/department-targets/:id','content','TECH','OTSgz','大事件记录不存在','nqPdR','HMVqz','从钉钉同步员工数据','annual_work_plans','users','department','VyyaG','日志不存在','sIslz','/backups/','Department\x20not\x20found','年度工作落地规划记录不存在','消息发送失败','ynlYQ','gdFNc','/api/admin/backup','includes','/api/target-types/:id','srubL','CREATE','slice','wkiJU','keys','readdir','params','success','/api/system-settings','env','../temp_store/departments.json','getSeconds','vRhVt','DQpNr','创建系统备份','uosIK','parse','map','dIcSK','/api/notifications','JXjKd','EwQzM','/api/notifications/:id','body','created_at','IBlZi','system','duration_ms','svqjT','更新年度工作落地规划失败','QhdLg','/api/action-plans/:id','从钉钉同步部门数据','delete','jyjhn','从未登录','post','TgDnn','webhookUrl','position','toISOString','active','/api/roles/:id','Target\x20type\x20not\x20found','getDate','/api/admin/backups','A\x20user\x20connected','dingtalkAppKey','AjIRv','重新加载自动备份设置失败','NRuis','ZRAGn','uJgjx','nsWCa','部门目标分解','fySSc','utf-8','data','createdAt','YuMZB','find','AuVUo','/api/users','uwjwD','593772ViUZpt','departments','glQWr','hjnni','Fdqjf','action','/api/action-plans','JcnNy','JWT_EXPIRES_IN','sort','Server\x20running\x20on\x20http://localhost:','../temp_store/monthly_progress.json','vripP','fUynS','登录失败：用户名或密码错误','userid','5637186ygnwNC','2025-01-01T00:00:00.000Z','PbbdN','isArray','XDJgh','offset','无效的日志ID','role','操作系统通知','用户名或密码错误','vVdzJ','BUBud','开始执行自动备份...','删除月度推进计划记录失败','kJwkQ','connection','20035176TArzKP','username','连接正常','filter','planned_date','target_level','year','JIetB','appSecret','RKdGl','42418KLbgaA','/api/users/:id','operator','length','/api/logs','use','EQPpR','disconnect','自动备份失败：','/api/templates','statusCode','roles','WhYrY','sendFile','rAKxQ','PxICF','MiKKp','删除大事件数据失败','/api/department-targets','KwHKG','操作用户账号','缺少备份文件名','/api/admin/backups/:name','上传文件','eDmun','locals','writeFile','gvWea','UlJyX','738744IknDGs','azANB','DEMO','MARKET','user-online','getHours','details','aYZqE','大事件','fYGbR','wsmfp','xShBr','IVuvR','ShGND','技术部','action_type','query','/api/departments','department_id','/api/admin/backups/restore-upload','buffer','hash','hTVCM','操作月度推进计划','/api/login','mkdirSync','ztiCO','tbIMP','AqiqE','iKBar','trim','37559132IVnzcQ','操作模板','/api/dingtalk/departments','lyLDw','originalname','PATCH','/api/dingtalk/send-message','9|14|2|11|4|10|1|0|12|7|8|13|5|6|3','/api/admin/backup/reload','IXJgp','备份恢复失败','qfDLT','XlwdZ','unit','yWOpf','listen','更新系统设置','/api/roles','wGyGD','zvJYp','HjNtF','FrfNl','uzckT','NqGWe','fYJAs','string','time','QXdxv','5cdmZVg','部门目标分解记录不存在','importance','getMinutes','isFinite','TXwIl','emailPassword','.json','MgAOw','https://oapi.dingtalk.com/gettoken','pmwCx','permissions','../index.html','/api/upload','gHdYl','atpOo','nejrV','code','Employee\x20not\x20found','RKYtD','../config/dingtalk_config.json','../backups','gzQoy','操作系统设置','put','templates','integration','hasOwnProperty','DEPT','name','$2y$','rqQtf','示例公司','HEAD','BOURj','YLtkz','writeFileSync','getTime','62mEumQh','TyuFE','kPsjY','eANEs','KbyfE','unread','isNaN','OTxtf','target_value','push','/api/system-settings/','dingtalkRootDeptId','log','../temp_store/system_settings.json','/api/dingtalk/test-connection','title','年度工作落地规划','/api/integration/status','aAthU','now','stringify','x-role','accessToken','TIEEJ','upOdz','readFile','自动备份成功：','target_type','action_plans','password','dev-secret','30xlBNyU','oCAyz','asILq','Template\x20not\x20found','BiHUN','bnxtZ','自动备份设置已重新加载','unlink','description','11mjUQci','status','未收到备份文件','number','endsWith','/api/employees/:id','Dqdve','缺少有效的Webhook地址','获取钉钉access_token失败','DINGTALK_APP_SECRET','$2b$','HLzQF','smfce','padStart','操作系统备份','缺少Webhook地址','system_settings','10uHscxQ','LSmps','XvEbQ','unshift','ctdsG','dingtalkAppSecret','备份文件解析失败','获取钉钉员工失败','department_targets','readFileSync','existsSync','company_info','method','RRitC','ZhNjh','LBoZK','call','CTPiv','../temp_store/audit_logs.json','112kgcAFr','用户登录系统','VIEW','rblpH','file','error','current_value','OpKjF','/api/logs/:id','month','secret','DELETE','nGREN','../temp_store/users.json','genSalt','object','***','操作公司信息','模板管理','获取钉钉部门列表失败','/api/employees/sync-dingtalk','forEach','月度推进计划记录不存在','target_types','ncUiW','/api/annual-work-plans/:id','jobnumber'];_0x3adc=function(){return _0x17f368;};return _0x3adc();}const API_PATH_MAPPING={'/api/login':{'action':_0xcff869(0x253),'description':_0xcff869(0x235)},'/api/annual-work-plans':{'action':_0xcff869(0x1f8),'description':'操作年度工作落地规划'},'/api/major-events':{'action':_0xcff869(0x18f),'description':'操作大事件'},'/api/monthly-progress':{'action':'月度推进计划','description':_0xcff869(0x19e)},'/api/action-plans':{'action':'行动计划','description':_0xcff869(0x91)},'/api/departments':{'action':'部门管理','description':'操作部门信息'},'/api/employees':{'action':'员工管理','description':'操作员工信息'},'/api/users':{'action':_0xcff869(0xe5),'description':_0xcff869(0x17e)},'/api/roles':{'action':'角色管理','description':_0xcff869(0xde)},'/api/target-types':{'action':'目标类型','description':'操作目标类型'},'/api/department-targets':{'action':_0xcff869(0x136),'description':_0xcff869(0xb0)},'/api/notifications':{'action':'通知管理','description':_0xcff869(0x158)},'/api/system-settings':{'action':_0xcff869(0xc8),'description':_0xcff869(0x1d9)},'/api/company-info':{'action':'公司信息','description':_0xcff869(0x245)},'/api/templates':{'action':_0xcff869(0x246),'description':_0xcff869(0x1a7)},'/api/admin/backups':{'action':'备份管理','description':_0xcff869(0x21e)},'/api/admin/backup':{'action':'创建备份','description':_0xcff869(0x10e)},'/api/admin/cleanup-data':{'action':'数据清理','description':'清理系统数据'},'/api/dingtalk/employees':{'action':'钉钉员工','description':'获取钉钉员工列表'},'/api/departments/sync-dingtalk':{'action':'同步钉钉部门','description':_0xcff869(0x120)},'/api/employees/sync-dingtalk':{'action':'同步钉钉员工','description':_0xcff869(0xf0)},'/api/upload':{'action':'文件上传','description':_0xcff869(0x181)},'/api/logs':{'action':'系统日志','description':_0xcff869(0xaa)}};function extractKeyInfo(_0x2b270f){const _0x6563e1=_0xcff869,_0x168660={'GtqnY':function(_0x455014,_0x2de253){return _0x455014!==_0x2de253;},'gEIRy':'title','wYeMr':_0x6563e1(0x157),'JIetB':function(_0x13f4f8,_0x41014d){return _0x13f4f8!==_0x41014d;},'wEShW':function(_0x45d5bc,_0x1db964){return _0x45d5bc>_0x1db964;}};if(!_0x2b270f||_0x168660['GtqnY'](typeof _0x2b270f,_0x6563e1(0x243)))return'';const _0x59b534=['name',_0x168660['gEIRy'],'username',_0x6563e1(0xf3),_0x168660['wYeMr'],'year','status'],_0xad161b=[];for(const _0xeb9b61 of _0x59b534){_0x2b270f[_0xeb9b61]&&typeof _0x2b270f[_0xeb9b61]===_0x6563e1(0x1bf)&&_0x168660[_0x6563e1(0x167)](_0x2b270f[_0xeb9b61][_0x6563e1(0x1a5)](),'')&&_0xad161b[_0x6563e1(0x1f1)](_0xeb9b61+':\x20'+_0x2b270f[_0xeb9b61]);}return _0x168660[_0x6563e1(0xc4)](_0xad161b['length'],0x0)?'\x20('+_0xad161b['join'](',\x20')+')':'';}function mapAuditRecordToLogView(_0x1bf546){const _0x546ae5=_0xcff869,_0x127160={'mSAEF':function(_0x8a8e5a,_0xdc64e7){return _0x8a8e5a===_0xdc64e7;},'lEiEm':function(_0x3be7db,_0x7c2e7){return _0x3be7db>=_0x7c2e7;},'TemkF':'fail','jZYHD':_0x546ae5(0x236),'fYGbR':function(_0x5dc853,_0xa4391c){return _0x5dc853===_0xa4391c;},'HMVqz':_0x546ae5(0x82),'KeYLL':'PUT','qtxbQ':function(_0x14e1c0,_0x53b164){return _0x14e1c0===_0x53b164;},'XzWkg':'UPDATE','FrfNl':function(_0x355737,_0x123393){return _0x355737===_0x123393;},'gHdYl':'GET','ZjXhN':'DELETE','nGREN':_0x546ae5(0x1bf),'YzgBC':function(_0x173abd,_0x4b95cc){return _0x173abd(_0x4b95cc);}};if(!_0x1bf546||typeof _0x1bf546!=='object')return null;const _0x3428a7=_0x1bf546['created_at']||_0x1bf546[_0x546ae5(0x1c0)]||new Date()[_0x546ae5(0x128)](),_0x19a063=_0x1bf546['username']||'系统',_0x3262d1=_0x1bf546['ip_address']||_0x1bf546['ip']||'',_0x44932d=_0x127160[_0x546ae5(0xb6)](typeof _0x1bf546[_0x546ae5(0x211)],'number')?_0x1bf546['status']:0xc8,_0x7f36d6=_0x127160['lEiEm'](_0x44932d,0xc8)&&_0x44932d<0x12c?_0x546ae5(0x107):_0x127160[_0x546ae5(0x9e)];let _0x10a4f2=_0x1bf546[_0x546ae5(0x196)];if(!_0x10a4f2){const _0x21f27b=(_0x1bf546[_0x546ae5(0x22d)]||'')[_0x546ae5(0xdf)](),_0x26647f=_0x1bf546[_0x546ae5(0xaf)]||'';if(_0x26647f[_0x546ae5(0xfe)]('/login'))_0x10a4f2='LOGIN';else{if(_0x21f27b==='GET')_0x10a4f2=_0x127160['jZYHD'];else{if(_0x127160['fYGbR'](_0x21f27b,_0x127160[_0x546ae5(0xef)]))_0x10a4f2=_0x546ae5(0x101);else{if(_0x127160[_0x546ae5(0x190)](_0x21f27b,_0x127160['KeYLL'])||_0x127160['qtxbQ'](_0x21f27b,_0x546ae5(0x1ab)))_0x10a4f2=_0x127160['XzWkg'];else _0x127160['FrfNl'](_0x21f27b,_0x546ae5(0x23f))?_0x10a4f2='DELETE':_0x10a4f2=_0x21f27b||_0x546ae5(0x236);}}}}let _0x5505d2=_0x1bf546[_0x546ae5(0x18d)];if(!_0x5505d2){const _0xe56b0a=(_0x1bf546['method']||'')[_0x546ae5(0xdf)](),_0x4bc3d3=_0x1bf546['path']||'';let _0x1b9d5b=_0x546ae5(0x252),_0xc7efd0='';for(const [_0x2a69ba,_0x2c7ee9]of Object['entries'](API_PATH_MAPPING)){if(_0x4bc3d3['startsWith'](_0x2a69ba)){_0x1b9d5b=_0x2c7ee9[_0x546ae5(0x145)],_0xc7efd0=_0x2c7ee9['description'];break;}}let _0x2e4452='';switch(_0xe56b0a){case _0x127160[_0x546ae5(0x1d0)]:_0x2e4452='查看';break;case _0x546ae5(0x82):_0x2e4452='创建';break;case _0x546ae5(0xc9):case _0x546ae5(0x1ab):_0x2e4452='更新';break;case _0x127160['ZjXhN']:_0x2e4452='删除';break;default:_0x2e4452='操作';}let _0x1129c4='';try{const _0x52109d=_0x127160[_0x546ae5(0x1bb)](typeof _0x1bf546['body'],_0x127160[_0x546ae5(0x240)])?JSON['parse'](_0x1bf546[_0x546ae5(0x117)]):_0x1bf546[_0x546ae5(0x117)];_0x1129c4=_0x127160['YzgBC'](extractKeyInfo,_0x52109d);}catch(_0x2808d1){}_0x5505d2=''+_0x2e4452+_0x1b9d5b+_0x1129c4;}return{'id':_0x1bf546['id'],'created_at':_0x3428a7,'username':_0x19a063,'ip_address':_0x3262d1,'action_type':_0x10a4f2,'details':_0x5505d2,'status':_0x7f36d6};}app['get']('/api/logs',(_0x216a49,_0x2052c1)=>{const _0x5d5249=_0xcff869,_0x1d6966={'vripP':'BXcIT','qfDLT':function(_0x852b32,_0x300628){return _0x852b32>=_0x300628;},'Lzdda':function(_0x566cf6,_0x2c1c52){return _0x566cf6<=_0x2c1c52;},'lLUum':function(_0x5340dc,_0x31be0d){return _0x5340dc(_0x31be0d);},'lTOIt':function(_0x140f2b,_0x21dc21){return _0x140f2b(_0x21dc21);},'atpOo':function(_0x590595,_0x51fcd6){return _0x590595(_0x51fcd6);},'lYmXs':function(_0x243f17,_0x31387a,_0x2cf311){return _0x243f17(_0x31387a,_0x2cf311);},'MauBX':function(_0x128d20,_0x2486ba){return _0x128d20*_0x2486ba;},'mMEsu':function(_0x41b423,_0x2249fc){return _0x41b423+_0x2249fc;}},{page:_0x3163b0,pageSize:_0x2a1643,username:_0x3fb750,type:_0x23ca08,startDate:_0x554236,endDate:_0x408890}=_0x216a49['query'],_0x1466fa=loadAuditLogs(),_0x389dc9=_0x1466fa['map'](_0x1a088b=>mapAuditRecordToLogView(_0x1a088b))[_0x5d5249(0x163)](_0x15a4ee=>_0x15a4ee&&_0x15a4ee['id']!==undefined);let _0x153230=_0x389dc9;if(_0x3fb750&&_0x1d6966['lLUum'](String,_0x3fb750)['trim']()){const _0x5c8d10=String(_0x3fb750)[_0x5d5249(0x1a5)]()['toLowerCase']();_0x153230=_0x153230['filter'](_0x2c25ae=>String(_0x2c25ae[_0x5d5249(0x161)]||'')['toLowerCase']()[_0x5d5249(0xfe)](_0x5c8d10));}if(_0x23ca08&&_0x1d6966['lTOIt'](String,_0x23ca08)['trim']()){const _0x2851cb=_0x1d6966[_0x5d5249(0x1d1)](String,_0x23ca08)[_0x5d5249(0x1a5)]()[_0x5d5249(0xdf)]();_0x153230=_0x153230[_0x5d5249(0x163)](_0x56b2b3=>String(_0x56b2b3[_0x5d5249(0x196)]||'')[_0x5d5249(0xdf)]()===_0x2851cb);}if(_0x554236){const _0xb7a0d2=new Date(_0x554236);!Number[_0x5d5249(0x1ee)](_0xb7a0d2['getTime']())&&(_0x153230=_0x153230['filter'](_0x1b6e87=>{const _0x1639fe=_0x5d5249;if(_0x1d6966[_0x1639fe(0x14c)]!=='wVDBK'){const _0x37b0fc=new Date(_0x1b6e87['created_at']);return!Number['isNaN'](_0x37b0fc[_0x1639fe(0x1e7)]())&&_0x1d6966[_0x1639fe(0x1b1)](_0x37b0fc,_0xb7a0d2);}else _0x2eae9a(_0x10396a[_0x1639fe(0x24b)]);}));}if(_0x408890){const _0x15e15f=new Date(_0x408890);if(!Number['isNaN'](_0x15e15f['getTime']())){const _0x30f8d2=new Date(_0x15e15f[_0x5d5249(0x1e7)]());_0x30f8d2['setHours'](0x17,0x3b,0x3b,0x3e7),_0x153230=_0x153230[_0x5d5249(0x163)](_0x354a65=>{const _0x533a19=_0x5d5249,_0x408df2=new Date(_0x354a65['created_at']);return!Number[_0x533a19(0x1ee)](_0x408df2['getTime']())&&_0x1d6966[_0x533a19(0x99)](_0x408df2,_0x30f8d2);});}}_0x153230[_0x5d5249(0x149)]((_0x50a37a,_0x27b118)=>{const _0x513ac3=_0x5d5249,_0x4ce2b4=new Date(_0x50a37a[_0x513ac3(0x118)])['getTime'](),_0x1a8fbc=new Date(_0x27b118[_0x513ac3(0x118)])['getTime']();return _0x1a8fbc-_0x4ce2b4;});const _0x551179=_0x1d6966['lYmXs'](parseInt,_0x3163b0,0xa)||0x1,_0x57f19c=_0x1d6966['lYmXs'](parseInt,_0x2a1643,0xa)||0x14,_0x44cf2e=_0x153230[_0x5d5249(0x16d)],_0x321953=_0x1d6966['MauBX'](_0x551179-0x1,_0x57f19c),_0x2f94b7=_0x1d6966[_0x5d5249(0xae)](_0x321953,_0x57f19c),_0x4f297a=_0x153230[_0x5d5249(0x102)](_0x321953,_0x2f94b7);_0x2052c1['json']({'data':_0x4f297a,'total':_0x44cf2e,'page':_0x551179,'pageSize':_0x57f19c});}),app['delete'](_0xcff869(0x23c),(_0x28f3c5,_0x21d74f)=>{const _0x420558=_0xcff869,_0x83f59b=parseInt(_0x28f3c5[_0x420558(0x106)]['id'],0xa);if(!_0x83f59b){_0x21d74f['status'](0x190)['json']({'success':![],'error':_0x420558(0x156)});return;}const _0x403cec=loadAuditLogs(),_0x4f680c=_0x403cec['filter'](_0x1345c8=>_0x1345c8['id']!==_0x83f59b),_0x137f5a=_0x4f680c['length']!==_0x403cec['length'];if(!_0x137f5a){_0x21d74f['status'](0x194)['json']({'success':![],'error':_0x420558(0xf5)});return;}saveAuditLogs(_0x4f680c),_0x21d74f['json']({'success':!![]});}),app[_0xcff869(0x121)](_0xcff869(0x16e),(_0xd0bf2e,_0x5aa92f)=>{const _0x1f315f={'Ahfuv':function(_0x1bc0c4,_0x1e954a){return _0x1bc0c4(_0x1e954a);}};_0x1f315f['Ahfuv'](saveAuditLogs,[]),_0x5aa92f['json']({'success':!![]});}),app[_0xcff869(0xa8)](_0xcff869(0x146),(_0x22e264,_0xc43282)=>{const _0x32c37b=_0xcff869,_0x171d09={'VsgMS':function(_0x201bc0,_0x4a6807,_0x36f9c1){return _0x201bc0(_0x4a6807,_0x36f9c1);},'KMXaz':function(_0x4a4aa0){return _0x4a4aa0();}},{year:_0x3fa3a7,department:_0x1f4af6,status:_0x7100e1}=_0x22e264[_0x32c37b(0x197)],_0x9f00b7=_0x171d09['KMXaz'](loadActionPlans);let _0x4196cd=Array['isArray'](_0x9f00b7)?[..._0x9f00b7]:[];if(_0x3fa3a7){const _0x14f320=parseInt(_0x3fa3a7,0xa);!Number['isNaN'](_0x14f320)&&(_0x4196cd=_0x4196cd['filter'](_0x8098ca=>Number(_0x8098ca[_0x32c37b(0x166)])===_0x14f320));}if(_0x1f4af6){if('fjNoT'==='ztdzM'){const _0x1fbae6=_0x171d09['VsgMS'](_0x5ef0a7,_0x304683,0xa);!_0x565b44[_0x32c37b(0x1ee)](_0x1fbae6)&&(_0x3d4f49=_0x42af0d[_0x32c37b(0x163)](_0xce2ccd=>_0x3575e9(_0xce2ccd['year'])===_0x1fbae6));}else _0x4196cd=_0x4196cd[_0x32c37b(0x163)](_0x4bf500=>_0x4bf500['department']===_0x1f4af6);}if(_0x7100e1){if(_0x32c37b(0xec)!=='fivEw')_0x4196cd=_0x4196cd[_0x32c37b(0x163)](_0x52b8f0=>_0x52b8f0['status']===_0x7100e1);else{if(!_0x7db3d2||typeof _0x4233b2!==_0x32c37b(0x243))return;const _0x3150b1=_0x44ddf4['key'];if(!_0x3150b1)return;const _0x28b45a=_0x33ee4f[_0x3150b1];if(!_0x28b45a)_0x3fe27e[_0x3150b1]=_0x2ed598;else{const _0x4c73ae=new _0x5afbac(_0x28b45a[_0x32c37b(0x118)]||0x0)[_0x32c37b(0x1e7)](),_0x2bd85b=new _0x37fb05(_0x2749de[_0x32c37b(0x118)]||0x0)[_0x32c37b(0x1e7)]();_0x2bd85b>=_0x4c73ae&&(_0x23560e[_0x3150b1]=_0x4ecac7);}}}_0xc43282[_0x32c37b(0xca)](_0x4196cd);}),app[_0xcff869(0x124)](_0xcff869(0x146),(_0x2d28b0,_0x4d4f89)=>{const _0x431b90=_0xcff869,_0x599e61={'upOdz':function(_0x1bedcf){return _0x1bedcf();},'etOVX':function(_0x333f98,_0x4a9ac8){return _0x333f98!==_0x4a9ac8;}};try{const _0x33aaca=new Date()['toISOString'](),_0x43e2c7=_0x2d28b0['body']||{},_0x451178=_0x599e61[_0x431b90(0x200)](loadActionPlans),_0x28134f=getNextId(_0x451178),_0xf98d50={'id':_0x28134f,'created_at':_0x33aaca,..._0x43e2c7};if(_0x43e2c7['year']!==undefined&&_0x599e61['etOVX'](_0x43e2c7[_0x431b90(0x166)],null)){const _0xed5839=parseInt(_0x43e2c7[_0x431b90(0x166)],0xa);!Number[_0x431b90(0x1ee)](_0xed5839)&&(_0xf98d50[_0x431b90(0x166)]=_0xed5839);}_0x451178[_0x431b90(0x1f1)](_0xf98d50),saveActionPlans(_0x451178),_0x4d4f89['json'](_0xf98d50);}catch(_0x2b4028){_0x4d4f89['status'](0x1f4)[_0x431b90(0xca)]({'error':'保存行动计划失败'});}}),app[_0xcff869(0x1da)]('/api/action-plans/:id',(_0x45ec24,_0x53c870)=>{const _0x58baa6=_0xcff869,_0x44c689={'vVdzJ':function(_0x59a8b,_0x1c2560){return _0x59a8b+_0x1c2560;},'hXPOp':function(_0x412485,_0x3d8179,_0xf2622b){return _0x412485(_0x3d8179,_0xf2622b);},'IVkOQ':'BoanQ','TyuFE':function(_0x41124b,_0x127496){return _0x41124b!==_0x127496;},'uALfA':function(_0x2664d3,_0x206921){return _0x2664d3!==_0x206921;},'BiJfk':'更新行动计划失败'};try{const _0x4a5153=_0x44c689['hXPOp'](parseInt,_0x45ec24[_0x58baa6(0x106)]['id'],0xa),_0x299dd0=_0x45ec24[_0x58baa6(0x117)]||{},_0x2b7d7f=loadActionPlans(),_0x246664=_0x2b7d7f[_0x58baa6(0xa0)](_0x22195e=>_0x22195e['id']===_0x4a5153);if(_0x246664===-0x1){if(_0x44c689['IVkOQ']!=='ifasC'){_0x53c870[_0x58baa6(0x211)](0x194)[_0x58baa6(0xca)]({'error':'行动计划不存在'});return;}else _0xc3bf93[_0x58baa6(0xd1)]=_0x26b8b6;}const _0x3111a5={..._0x2b7d7f[_0x246664],..._0x299dd0};if(_0x44c689[_0x58baa6(0x1e9)](_0x299dd0[_0x58baa6(0x166)],undefined)&&_0x44c689['uALfA'](_0x299dd0['year'],null)){const _0x11165a=parseInt(_0x299dd0[_0x58baa6(0x166)],0xa);if(!Number['isNaN'](_0x11165a)){if(_0x58baa6(0x222)==='LKrZp'){const _0x20c31d=_0x25b624(),_0x58fd6b={'id':_0x44c689[_0x58baa6(0x15a)](_0x20c31d[_0x58baa6(0x16d)],0x1),..._0x41ad39[_0x58baa6(0x117)],'created_at':new _0x763a51()[_0x58baa6(0x128)]()};_0x20c31d[_0x58baa6(0x1f1)](_0x58fd6b),_0x3f00f6(_0x20c31d),_0x55da7a['json'](_0x58fd6b);}else _0x3111a5[_0x58baa6(0x166)]=_0x11165a;}}_0x2b7d7f[_0x246664]=_0x3111a5,saveActionPlans(_0x2b7d7f),_0x53c870['json'](_0x3111a5);}catch(_0x4d5fbc){_0x53c870['status'](0x1f4)['json']({'error':_0x44c689['BiJfk']});}}),app[_0xcff869(0x121)](_0xcff869(0x11f),(_0x1febe9,_0x34e6fe)=>{const _0x2c57e8=_0xcff869,_0x1ae339={'tbIMP':function(_0x4b437b){return _0x4b437b();},'gvWea':function(_0x2129f9,_0x186a8e){return _0x2129f9(_0x186a8e);}};try{const _0x5020ed=parseInt(_0x1febe9['params']['id'],0xa),_0x49ac47=_0x1ae339[_0x2c57e8(0x1a2)](loadActionPlans),_0x167630=_0x49ac47[_0x2c57e8(0x163)](_0x10edea=>_0x10edea['id']!==_0x5020ed),_0x5cd1f2=_0x167630['length']!==_0x49ac47[_0x2c57e8(0x16d)];if(!_0x5cd1f2){_0x34e6fe[_0x2c57e8(0x211)](0x194)['json']({'success':![],'error':'行动计划不存在'});return;}_0x1ae339[_0x2c57e8(0x185)](saveActionPlans,_0x167630),_0x34e6fe[_0x2c57e8(0xca)]({'success':!![]});}catch(_0x431042){_0x34e6fe[_0x2c57e8(0x211)](0x1f4)[_0x2c57e8(0xca)]({'success':![],'error':'删除行动计划失败'});}}),app['get'](_0xcff869(0x108),(_0x3457db,_0xf9196e)=>{const _0x1bf3e={'VwjiJ':function(_0x506b82){return _0x506b82();}},_0x29dc34=_0x1bf3e['VwjiJ'](loadSystemSettings);_0xf9196e['json'](_0x29dc34);}),app['post']('/api/system-settings',(_0x3e62f1,_0x4ca1c3)=>{const _0x52af46=_0xcff869,_0x501510={'YAWSJ':function(_0x4b9e8a,_0x10d318){return _0x4b9e8a!==_0x10d318;},'OlVPc':'user-agent','QLFsK':'CREATE','RKYtD':'新增系统设置'},_0x5bc0fc=loadSystemSettings(),_0x5020e8=_0x3e62f1[_0x52af46(0x117)]||{},_0x4d6057=new Date()[_0x52af46(0x128)](),_0x1de385=_0x5020e8['key'];let _0xee75cb=null;if(_0x1de385){const _0x54ca26=_0x5bc0fc[_0x52af46(0xa0)](_0x35349f=>_0x35349f&&_0x35349f[_0x52af46(0xe2)]===_0x1de385);if(_0x501510['YAWSJ'](_0x54ca26,-0x1)){const _0x2a44a2=_0x5bc0fc[_0x54ca26],_0x1947c7={..._0x2a44a2,..._0x5020e8};_0x1947c7['id']=_0x2a44a2['id'],_0x1947c7[_0x52af46(0x118)]=_0x2a44a2[_0x52af46(0x118)]||_0x4d6057,_0x5bc0fc[_0x54ca26]=_0x1947c7,_0xee75cb=_0x1947c7;}}if(!_0xee75cb){const _0x4959b5=getNextId(_0x5bc0fc);_0xee75cb={'id':_0x4959b5,'created_at':_0x4d6057,..._0x5020e8},_0x5bc0fc[_0x52af46(0x1f1)](_0xee75cb);}saveSystemSettings(_0x5bc0fc),appendAuditLog({'username':_0x5020e8[_0x52af46(0x16c)]||'','role':_0x5020e8['role']||'','method':_0x52af46(0x82),'path':'/api/system-settings','status':0xc9,'ip':_0x3e62f1['ip'],'ua':_0x3e62f1[_0x52af46(0x8c)][_0x501510[_0x52af46(0x89)]]||'','query':_0x3e62f1[_0x52af46(0x197)]||{},'body':_0x5020e8,'action_type':_0x501510['QLFsK'],'details':_0x501510[_0x52af46(0x1d5)]}),!_0x4ca1c3[_0x52af46(0x183)]&&(_0x4ca1c3['locals']={}),_0x4ca1c3[_0x52af46(0x183)][_0x52af46(0x93)]=!![],_0x4ca1c3['status'](0xc9)['json'](_0xee75cb);}),app['put']('/api/system-settings/:id',(_0x1b9b8c,_0x24d11e)=>{const _0x530ff9=_0xcff869,_0x378237={'RuTpm':function(_0x3a14e9,_0x5cbb27,_0x23c19e){return _0x3a14e9(_0x5cbb27,_0x23c19e);},'dolOB':function(_0x63eec6,_0x59fd9f){return _0x63eec6===_0x59fd9f;},'WhYrY':_0x530ff9(0xb4),'eDmun':function(_0x50c872,_0x281a19){return _0x50c872(_0x281a19);},'XvRqk':'user-agent','nfXdh':'UPDATE'},_0x5babe1=loadSystemSettings(),_0x6d4ba5=_0x378237[_0x530ff9(0xbe)](parseInt,_0x1b9b8c['params']['id'],0xa),_0x143f18=_0x5babe1['findIndex'](_0x3010b0=>_0x3010b0['id']===_0x6d4ba5);if(_0x378237[_0x530ff9(0xda)](_0x143f18,-0x1)){_0x24d11e[_0x530ff9(0x211)](0x194)[_0x530ff9(0xca)]({'error':_0x378237[_0x530ff9(0x176)]});return;}const _0x110b82=_0x1b9b8c[_0x530ff9(0x117)]||{};_0x5babe1[_0x143f18]={..._0x5babe1[_0x143f18],..._0x110b82},_0x378237['eDmun'](saveSystemSettings,_0x5babe1),_0x378237[_0x530ff9(0x182)](appendAuditLog,{'username':_0x110b82[_0x530ff9(0x16c)]||'','role':_0x110b82[_0x530ff9(0x157)]||'','method':'PUT','path':_0x530ff9(0x1f2)+_0x6d4ba5,'status':0xc8,'ip':_0x1b9b8c['ip'],'ua':_0x1b9b8c[_0x530ff9(0x8c)][_0x378237[_0x530ff9(0x258)]]||'','query':_0x1b9b8c[_0x530ff9(0x197)]||{},'body':_0x110b82,'action_type':_0x378237['nfXdh'],'details':_0x530ff9(0x1b6)}),!_0x24d11e['locals']&&(_0x24d11e[_0x530ff9(0x183)]={}),_0x24d11e[_0x530ff9(0x183)][_0x530ff9(0x93)]=!![],_0x24d11e['json'](_0x5babe1[_0x143f18]);}),app[_0xcff869(0x121)]('/api/system-settings/:id',(_0x4d4d9f,_0x5ef547)=>{const _0xc8f656=_0xcff869,_0x21da47={'SxuCS':'大事件记录不存在','uNztY':function(_0x335ffa,_0x4895e0){return _0x335ffa!==_0x4895e0;},'QSMIr':_0xc8f656(0x1fa),'YWyFK':function(_0x11b352,_0x5d9cf5){return _0x11b352(_0x5d9cf5);},'AmUVH':function(_0x275775,_0x230384){return _0x275775===_0x230384;},'JHBfW':'xexXq'},_0x418c4a=loadSystemSettings(),_0x3768f5=parseInt(_0x4d4d9f['params']['id'],0xa),_0x513834=_0x418c4a['filter'](_0x4dd336=>_0x4dd336['id']!==_0x3768f5),_0x46acee=_0x21da47['uNztY'](_0x513834['length'],_0x418c4a[_0xc8f656(0x16d)]);if(!_0x46acee){if(_0xc8f656(0x1a1)!==_0x21da47['QSMIr']){_0x5ef547['status'](0x194)[_0xc8f656(0xca)]({'error':'Setting\x20not\x20found'});return;}else{_0x345ee4['status'](0x194)['json']({'error':_0x21da47['SxuCS']});return;}}_0x21da47['YWyFK'](saveSystemSettings,_0x513834),appendAuditLog({'username':'','role':'','method':_0xc8f656(0x23f),'path':_0xc8f656(0x1f2)+_0x3768f5,'status':0xc8,'ip':_0x4d4d9f['ip'],'ua':_0x4d4d9f[_0xc8f656(0x8c)][_0xc8f656(0xad)]||'','query':_0x4d4d9f[_0xc8f656(0x197)]||{},'body':{},'action_type':_0xc8f656(0x23f),'details':_0xc8f656(0x95)}),!_0x5ef547['locals']&&(_0x21da47['AmUVH']('xexXq',_0x21da47['JHBfW'])?_0x5ef547[_0xc8f656(0x183)]={}:_0x281043[_0xc8f656(0x1b5)](_0x4692b9,()=>{const _0x114f54=_0xc8f656;_0x582e47[_0x114f54(0x1f4)]('Server\x20running\x20on\x20http://localhost:'+_0x5a8716),_0x31934e(_0x58fbb5,0x1388);})),_0x5ef547['locals']['auditLogged']=!![],_0x5ef547['json']({'success':!![]});}),app['get']('/api/department-targets',(_0x3c4fe4,_0xe42fea)=>{const _0x4c94ef=_0xcff869,_0x253c14={'TIEEJ':function(_0x458889,_0x51e9bc,_0x2e4e06){return _0x458889(_0x51e9bc,_0x2e4e06);}};try{const _0x1a5c22=loadDepartmentTargets();let _0x280645=Array['isArray'](_0x1a5c22)?[..._0x1a5c22]:[];const {year:_0x3a47d4,department:_0x39ca3d,targetType:_0x1181d7,target_level:_0x109d7c}=_0x3c4fe4['query']||{};if(_0x3a47d4){const _0x419be3=_0x253c14[_0x4c94ef(0x1ff)](parseInt,_0x3a47d4,0xa);!Number['isNaN'](_0x419be3)&&(_0x280645=_0x280645['filter'](_0x5ed8ae=>Number(_0x5ed8ae[_0x4c94ef(0x166)])===_0x419be3));}_0x39ca3d&&(_0x280645=_0x280645['filter'](_0x302350=>{const _0x306396=_0x4c94ef,_0x307d12=_0x302350['department']||_0x302350[_0x306396(0xa2)]||'';return _0x307d12===_0x39ca3d;})),_0x1181d7&&(_0x280645=_0x280645[_0x4c94ef(0x163)](_0x100a46=>_0x100a46[_0x4c94ef(0x203)]===_0x1181d7)),_0x109d7c&&(_0x280645=_0x280645['filter'](_0x4794e8=>_0x4794e8[_0x4c94ef(0x165)]===_0x109d7c)),_0xe42fea['json'](_0x280645);}catch(_0x2c66b3){_0xe42fea[_0x4c94ef(0x211)](0x1f4)['json']({'error':'加载部门目标分解数据失败'});}}),app[_0xcff869(0x124)](_0xcff869(0x17c),(_0xc59fe0,_0x482622)=>{const _0x4e3617=_0xcff869,_0x156002={'obFAt':function(_0x109fc2){return _0x109fc2();},'BOURj':function(_0x222809,_0x53eff1){return _0x222809!==_0x53eff1;},'QhdLg':function(_0x34a4d0,_0x555e04){return _0x34a4d0(_0x555e04);},'EwQzM':'保存部门目标分解数据失败'};try{const _0x1f6339=_0xc59fe0['body']||{},_0x5d0042=_0x156002['obFAt'](loadDepartmentTargets),_0x394e1f=getNextId(_0x5d0042),_0x43a18d=new Date()[_0x4e3617(0x128)](),_0x17c15c=loadDepartmentsStore();let _0x4e10cb=_0x1f6339['department']||'';if(!_0x4e10cb&&_0x1f6339['department_id']&&Array[_0x4e3617(0x153)](_0x17c15c)){const _0x3daadb=_0x17c15c['find'](_0x30f581=>_0x30f581['id']===_0x1f6339[_0x4e3617(0x199)]);_0x3daadb&&_0x3daadb['name']&&(_0x4e10cb=_0x3daadb[_0x4e3617(0x1df)]);}const _0x985ac={'id':_0x394e1f,'created_at':_0x43a18d,'year':_0x1f6339['year']?parseInt(_0x1f6339[_0x4e3617(0x166)],0xa):null,'department_id':_0x1f6339[_0x4e3617(0x199)]||null,'department':_0x4e10cb,'department_name':_0x4e10cb,'target_level':_0x1f6339[_0x4e3617(0x165)]||'','target_type':_0x1f6339['target_type']||'','target_name':_0x1f6339['target_name']||'','target_value':_0x1f6339['target_value']!==undefined&&_0x1f6339['target_value']!==null?Number(_0x1f6339[_0x4e3617(0x1f0)]):null,'unit':_0x1f6339[_0x4e3617(0x1b3)]||'','month':_0x156002[_0x4e3617(0x1e4)](_0x1f6339['month'],undefined)&&_0x156002[_0x4e3617(0x1e4)](_0x1f6339['month'],null)?Number(_0x1f6339['month']):null,'quarter':_0x1f6339['quarter']||'','current_value':_0x1f6339[_0x4e3617(0x23a)]!==undefined&&_0x1f6339['current_value']!==null?_0x156002[_0x4e3617(0x11e)](Number,_0x1f6339[_0x4e3617(0x23a)]):null,'status':_0x1f6339['status']||'','completion_rate':_0x1f6339['completion_rate']||'','responsible_person':_0x1f6339['responsible_person']||'','description':_0x1f6339[_0x4e3617(0x20f)]||''};_0x5d0042['push'](_0x985ac),saveDepartmentTargets(_0x5d0042),_0x482622['json'](_0x985ac);}catch(_0x9abbc0){_0x482622['status'](0x1f4)['json']({'error':_0x156002[_0x4e3617(0x115)]});}}),app['put'](_0xcff869(0xe9),(_0xa79f3,_0x2d6782)=>{const _0x450f11=_0xcff869,_0x4e800b={'qzzCX':function(_0x35dd6e,_0x2439d0,_0x3c6731){return _0x35dd6e(_0x2439d0,_0x3c6731);},'bzDJz':function(_0x32595d,_0x14e22b){return _0x32595d!==_0x14e22b;},'iJyXi':function(_0x58ed01,_0x4ca915){return _0x58ed01!==_0x4ca915;},'RRitC':function(_0x2ed107,_0x3202b4){return _0x2ed107(_0x3202b4);},'BiHUN':function(_0x116516,_0x18ff71){return _0x116516!==_0x18ff71;},'nJHMW':function(_0x1990d0,_0x1a59a1){return _0x1990d0===_0x1a59a1;}};try{const _0x5165c3=_0x4e800b['qzzCX'](parseInt,_0xa79f3[_0x450f11(0x106)]['id'],0xa),_0x449cfa=_0xa79f3['body']||{},_0x1f8ad1=loadDepartmentTargets(),_0x4d821b=_0x1f8ad1[_0x450f11(0xa0)](_0x3cc284=>_0x3cc284['id']===_0x5165c3);if(_0x4d821b===-0x1){_0x2d6782[_0x450f11(0x211)](0x194)['json']({'error':_0x450f11(0x1c3)});return;}const _0x5635d1=loadDepartmentsStore();let _0xa6e24c=_0x449cfa['department']||_0x1f8ad1[_0x4d821b]['department']||'';if(!_0xa6e24c&&_0x449cfa[_0x450f11(0x199)]&&Array['isArray'](_0x5635d1)){const _0x1a1f07=_0x5635d1[_0x450f11(0x13c)](_0x14b5d7=>_0x14b5d7['id']===_0x449cfa[_0x450f11(0x199)]);_0x1a1f07&&_0x1a1f07['name']&&(_0xa6e24c=_0x1a1f07['name']);}const _0xadb517={..._0x1f8ad1[_0x4d821b],..._0x449cfa,'year':_0x4e800b[_0x450f11(0xbd)](_0x449cfa[_0x450f11(0x166)],undefined)&&_0x449cfa['year']!==null?parseInt(_0x449cfa[_0x450f11(0x166)],0xa):_0x1f8ad1[_0x4d821b][_0x450f11(0x166)],'department_id':_0x449cfa['department_id']!==undefined?_0x449cfa[_0x450f11(0x199)]:_0x1f8ad1[_0x4d821b]['department_id']||null,'department':_0xa6e24c||_0x1f8ad1[_0x4d821b][_0x450f11(0xf3)]||'','department_name':_0xa6e24c||_0x1f8ad1[_0x4d821b]['department_name']||'','target_value':_0x449cfa['target_value']!==undefined&&_0x4e800b['iJyXi'](_0x449cfa[_0x450f11(0x1f0)],null)?_0x4e800b['RRitC'](Number,_0x449cfa[_0x450f11(0x1f0)]):_0x1f8ad1[_0x4d821b][_0x450f11(0x1f0)],'month':_0x4e800b[_0x450f11(0x86)](_0x449cfa[_0x450f11(0x23d)],undefined)&&_0x449cfa['month']!==null?_0x4e800b['RRitC'](Number,_0x449cfa[_0x450f11(0x23d)]):_0x1f8ad1[_0x4d821b]['month'],'current_value':_0x449cfa['current_value']!==undefined&&_0x4e800b[_0x450f11(0x20b)](_0x449cfa[_0x450f11(0x23a)],null)?Number(_0x449cfa['current_value']):_0x1f8ad1[_0x4d821b]['current_value']};_0x1f8ad1[_0x4d821b]=_0xadb517,_0x4e800b[_0x450f11(0x22e)](saveDepartmentTargets,_0x1f8ad1),_0x2d6782['json'](_0xadb517);}catch(_0x392c64){_0x4e800b['nJHMW']('NVTKH','NVTKH')?_0x2d6782[_0x450f11(0x211)](0x1f4)[_0x450f11(0xca)]({'error':'更新部门目标分解数据失败'}):_0x2c45cb[_0x450f11(0x177)](_0x32bc68['join'](_0x180610,_0x450f11(0x1ce)));}}),app[_0xcff869(0x121)](_0xcff869(0xe9),(_0x2af930,_0x5bc231)=>{const _0x2db465=_0xcff869,_0x5cf2f7={'TvrVg':function(_0x296f64,_0x5e0316){return _0x296f64===_0x5e0316;},'kJwkQ':'AZEQz','BUDCg':function(_0x2351e0,_0x3e1f81){return _0x2351e0(_0x3e1f81);},'YLtkz':_0x2db465(0xdd)};try{if(_0x5cf2f7[_0x2db465(0x251)](_0x5cf2f7[_0x2db465(0x15e)],_0x2db465(0x18e)))return[];else{const _0x433bc0=parseInt(_0x2af930['params']['id'],0xa),_0x475e06=loadDepartmentTargets(),_0x575993=_0x475e06[_0x2db465(0x163)](_0xe1628=>_0xe1628['id']!==_0x433bc0),_0xf93d50=_0x575993[_0x2db465(0x16d)]!==_0x475e06['length'];if(!_0xf93d50){_0x5bc231['status'](0x194)['json']({'success':![],'error':'部门目标分解记录不存在'});return;}_0x5cf2f7[_0x2db465(0xd0)](saveDepartmentTargets,_0x575993),_0x5bc231[_0x2db465(0xca)]({'success':!![]});}}catch(_0x6698bd){_0x5bc231[_0x2db465(0x211)](0x1f4)['json']({'success':![],'error':_0x5cf2f7[_0x2db465(0x1e5)]});}}),app['get'](_0xcff869(0x113),(_0x1286ff,_0x47db52)=>{const _0x2afe22=_0xcff869,_0x17ddec=loadNotificationsStore();_0x47db52[_0x2afe22(0xca)](_0x17ddec);}),app[_0xcff869(0x124)](_0xcff869(0x113),(_0x293fc6,_0x465923)=>{const _0x112654=_0xcff869,_0x479128={'glQWr':function(_0x428e73,_0x3afbd0){return _0x428e73(_0x3afbd0);}},_0x5115a1=loadNotificationsStore(),_0x1a23e5={'id':_0x5115a1[_0x112654(0x16d)]+0x1,..._0x293fc6['body'],'created_at':new Date()['toISOString']()};_0x5115a1['push'](_0x1a23e5),_0x479128[_0x112654(0x142)](saveNotificationsStore,_0x5115a1),_0x465923[_0x112654(0xca)](_0x1a23e5);}),app['put'](_0xcff869(0x116),(_0x10d78f,_0x408091)=>{const _0x5cb094=_0xcff869,_0x115971={'NKzhU':function(_0xedc94,_0x4681aa){return _0xedc94(_0x4681aa);},'WDiRu':function(_0x173144){return _0x173144();}},_0x5ecf51=_0x115971[_0x5cb094(0x90)](parseInt,_0x10d78f[_0x5cb094(0x106)]['id']),_0xb72fb0=_0x115971['WDiRu'](loadNotificationsStore),_0x120f37=_0xb72fb0['findIndex'](_0x42fca6=>_0x42fca6['id']===_0x5ecf51);_0x120f37!==-0x1?(_0xb72fb0[_0x120f37]={..._0xb72fb0[_0x120f37],..._0x10d78f[_0x5cb094(0x117)]},saveNotificationsStore(_0xb72fb0),_0x408091[_0x5cb094(0xca)](_0xb72fb0[_0x120f37])):_0x408091[_0x5cb094(0x211)](0x194)['json']({'error':'Notification\x20not\x20found'});}),app['delete']('/api/notifications/:id',(_0x542a5d,_0x17ada7)=>{const _0x5a338a=_0xcff869,_0x52e585={'IXJgp':function(_0x20fbff){return _0x20fbff();},'wCGWP':function(_0x1b4cfd,_0x26c350){return _0x1b4cfd!==_0x26c350;},'oyxUU':function(_0x4d9001,_0x3a53df){return _0x4d9001(_0x3a53df);}},_0x56ba0e=parseInt(_0x542a5d['params']['id']),_0x35222c=_0x52e585[_0x5a338a(0x1af)](loadNotificationsStore),_0x2d334a=_0x35222c['filter'](_0x534f70=>_0x534f70['id']!==_0x56ba0e),_0x16e82d=_0x52e585['wCGWP'](_0x2d334a[_0x5a338a(0x16d)],_0x35222c[_0x5a338a(0x16d)]);_0x16e82d&&_0x52e585['oyxUU'](saveNotificationsStore,_0x2d334a),_0x17ada7['json']({'success':!![]});}),app['post']('/api/notifications/send',(_0x358658,_0x5b03bd)=>{const _0x4850c4=_0xcff869,_0x14c53b={'bnxtZ':_0x4850c4(0x1ed),'dLQNd':function(_0x5ccf17,_0x469a08){return _0x5ccf17(_0x469a08);}},_0x5b33e0=loadNotificationsStore(),_0x3733d6={'id':_0x5b33e0['length']+0x1,..._0x358658[_0x4850c4(0x117)],'status':_0x14c53b[_0x4850c4(0x20c)],'created_at':new Date()['toISOString']()};_0x5b33e0[_0x4850c4(0x1f1)](_0x3733d6),_0x14c53b['dLQNd'](saveNotificationsStore,_0x5b33e0),_0x5b03bd[_0x4850c4(0xca)](_0x3733d6);}),app['post'](_0xcff869(0x1f6),async(_0x41f909,_0x342d94)=>{const _0x4cc2fe=_0xcff869,_0x2b0022={'rVfqO':_0x4cc2fe(0x21f),'dIcSK':_0x4cc2fe(0x162)},_0xc1caed=_0x41f909['body']||{},_0x462b7e=_0xc1caed['webhookUrl']||'';if(!_0x462b7e||typeof _0x462b7e!=='string'){_0x342d94[_0x4cc2fe(0x211)](0x190)[_0x4cc2fe(0xca)]({'success':![],'message':'缺少有效的Webhook地址','error':_0x2b0022['rVfqO']});return;}try{const _0x430561=await _0x38c9ea['post'](_0x462b7e,{'msgtype':'text','text':{'content':_0x4cc2fe(0xe0)}});_0x342d94['json']({'success':!![],'message':_0x2b0022[_0x4cc2fe(0x112)],'response':_0x430561['data']});}catch(_0x197c76){console[_0x4cc2fe(0x239)]('DingTalk\x20connection\x20test\x20failed:',_0x197c76),_0x342d94['status'](0x1f4)[_0x4cc2fe(0xca)]({'success':![],'message':'连接失败','error':_0x197c76[_0x4cc2fe(0xa9)]});}}),app['post'](_0xcff869(0x1ac),async(_0x27ca2e,_0x50daa7)=>{const _0x12a90c=_0xcff869,_0x548bc2={'LBoZK':_0x12a90c(0x217),'OpghI':function(_0x1bb171,_0x55717a){return _0x1bb171===_0x55717a;},'ncUiW':_0x12a90c(0x8b),'QwTlS':'DingTalk\x20message\x20send\x20failed:','HrGFf':_0x12a90c(0xfa)},_0x9307e3=_0x27ca2e[_0x12a90c(0x117)]||{},_0x411c49=_0x9307e3['webhookUrl']||'',_0x22dc0e=_0x9307e3['msgtype']||'text';if(!_0x411c49||typeof _0x411c49!==_0x12a90c(0x1bf)){_0x50daa7['status'](0x190)['json']({'success':![],'message':_0x548bc2[_0x12a90c(0x230)],'error':_0x12a90c(0x21f)});return;}try{let _0x1cd26f;if(_0x548bc2['OpghI'](_0x22dc0e,_0x12a90c(0x8b))){if(_0x9307e3[_0x12a90c(0x1f7)]&&_0x9307e3['content'])_0x1cd26f={'msgtype':_0x548bc2['ncUiW'],'text':{'content':_0x9307e3['title']+'\x0a'+_0x9307e3[_0x12a90c(0xea)]}};else{const _0x4260df=_0x9307e3[_0x12a90c(0xea)]||'测试消息';_0x1cd26f={'msgtype':_0x548bc2[_0x12a90c(0x24c)],'text':{'content':_0x4260df}};}}else _0x1cd26f={'msgtype':_0x22dc0e,..._0x9307e3};const _0x4d0960=await _0x38c9ea[_0x12a90c(0x124)](_0x411c49,_0x1cd26f);_0x50daa7[_0x12a90c(0xca)]({'success':!![],'message':_0x12a90c(0xc6),'response':_0x4d0960[_0x12a90c(0x139)]});}catch(_0x45b6bc){console[_0x12a90c(0x239)](_0x548bc2['QwTlS'],_0x45b6bc),_0x50daa7[_0x12a90c(0x211)](0x1f4)['json']({'success':![],'message':_0x548bc2['HrGFf'],'error':_0x45b6bc[_0x12a90c(0xa9)]});}}),app[_0xcff869(0x124)](_0xcff869(0x1cf),upload['single']('file'),async(_0x13c70a,_0x8fdd4e)=>{const _0x2e0aa5=_0xcff869,_0x5a3b83={'meerW':'未收到文件'};try{if(!_0x13c70a[_0x2e0aa5(0x238)]||!_0x13c70a[_0x2e0aa5(0x238)]['buffer'])return _0x8fdd4e['status'](0x190)['json']({'error':_0x5a3b83['meerW']});const _0x2e3939={'filename':_0x13c70a[_0x2e0aa5(0x238)][_0x2e0aa5(0x1aa)],'size':_0x13c70a[_0x2e0aa5(0x238)]['size'],'mimetype':_0x13c70a['file']['mimetype'],'uploadedAt':new Date()['toISOString']()};_0x8fdd4e['json']({'success':!![],'file':_0x2e3939});}catch(_0x328bde){_0x8fdd4e[_0x2e0aa5(0x211)](0x1f4)['json']({'error':'文件上传失败'});}}),app[_0xcff869(0x124)]('/api/login',async(_0x259919,_0x5ada78)=>{const _0x17e2b1=_0xcff869,_0x396101={'aHYoi':_0x17e2b1(0x82),'MCnyi':'登录失败：缺少用户名或密码','QBOFQ':'用户名和密码不能为空','VyyaG':'/api/login','iCjkU':'user-agent','kPsjY':'LOGIN','rqQtf':_0x17e2b1(0x14e)},{username:_0x2e1100,password:_0x408fbe}=_0x259919[_0x17e2b1(0x117)];if(!_0x2e1100||!_0x408fbe)return appendAuditLog({'username':_0x2e1100||'','role':'','method':_0x396101['aHYoi'],'path':_0x17e2b1(0x19f),'status':0x190,'ip':_0x259919['ip'],'ua':_0x259919['headers'][_0x17e2b1(0xad)]||'','query':_0x259919['query']||{},'body':{'username':_0x2e1100},'action_type':'LOGIN','details':_0x396101['MCnyi']}),!_0x5ada78[_0x17e2b1(0x183)]&&(_0x5ada78['locals']={}),_0x5ada78['locals'][_0x17e2b1(0x93)]=!![],_0x5ada78[_0x17e2b1(0x211)](0x190)[_0x17e2b1(0xca)]({'error':_0x396101['QBOFQ']});const _0x5ea737=loadUsersStore(),_0x26c1c6=_0x5ea737['find'](_0x392329=>_0x392329[_0x17e2b1(0x161)]===_0x2e1100);if(!_0x26c1c6)return appendAuditLog({'username':_0x2e1100,'role':'','method':'POST','path':_0x396101[_0x17e2b1(0xf4)],'status':0x191,'ip':_0x259919['ip'],'ua':_0x259919['headers'][_0x396101['iCjkU']]||'','query':_0x259919[_0x17e2b1(0x197)]||{},'body':{'username':_0x2e1100},'action_type':_0x396101[_0x17e2b1(0x1ea)],'details':_0x396101['rqQtf']}),!_0x5ada78['locals']&&(_0x5ada78[_0x17e2b1(0x183)]={}),_0x5ada78[_0x17e2b1(0x183)]['auditLogged']=!![],_0x5ada78['status'](0x191)[_0x17e2b1(0xca)]({'error':_0x17e2b1(0x159)});let _0x1025aa=![];const _0x9e588=_0x26c1c6['password']||'';if(_0x9e588&&(_0x9e588['startsWith'](_0x17e2b1(0xd4))||_0x9e588['startsWith'](_0x17e2b1(0x21a))||_0x9e588['startsWith'](_0x17e2b1(0x1e0))))try{_0x1025aa=await _0x2d5148['compare'](_0x408fbe,_0x9e588);}catch(_0x4afdd4){_0x1025aa=![];}else _0x1025aa=_0x408fbe===_0x9e588;if(!_0x1025aa)return appendAuditLog({'username':_0x2e1100,'role':'','method':_0x396101['aHYoi'],'path':_0x17e2b1(0x19f),'status':0x191,'ip':_0x259919['ip'],'ua':_0x259919[_0x17e2b1(0x8c)][_0x396101[_0x17e2b1(0xe4)]]||'','query':_0x259919['query']||{},'body':{'username':_0x2e1100},'action_type':_0x396101['kPsjY'],'details':_0x396101[_0x17e2b1(0x1e1)]}),!_0x5ada78[_0x17e2b1(0x183)]&&(_0x5ada78[_0x17e2b1(0x183)]={}),_0x5ada78['locals']['auditLogged']=!![],_0x5ada78[_0x17e2b1(0x211)](0x191)['json']({'error':_0x17e2b1(0x159)});const _0x20db65=generateJwtToken(_0x26c1c6),_0x2de008=getUserPermissions(_0x26c1c6),_0x3eb028={'token':_0x20db65,'user':{'id':_0x26c1c6['id'],'username':_0x26c1c6[_0x17e2b1(0x161)],'role':_0x26c1c6[_0x17e2b1(0x157)],'department':_0x26c1c6[_0x17e2b1(0xf3)],'permissions':_0x2de008}};appendAuditLog({'username':_0x26c1c6[_0x17e2b1(0x161)],'role':_0x26c1c6[_0x17e2b1(0x157)],'method':_0x17e2b1(0x82),'path':_0x396101['VyyaG'],'status':0xc8,'ip':_0x259919['ip'],'ua':_0x259919['headers']['user-agent']||'','query':_0x259919['query']||{},'body':{'username':_0x26c1c6['username']},'action_type':'LOGIN','details':_0x17e2b1(0x235)}),!_0x5ada78['locals']&&(_0x5ada78['locals']={}),_0x5ada78[_0x17e2b1(0x183)]['auditLogged']=!![],_0x5ada78['json'](_0x3eb028);});let onlineUsers=[];io['on'](_0xcff869(0x15f),_0x1e9519=>{const _0x212c96=_0xcff869,_0xc873d={'SJvsZ':_0x212c96(0x18b),'NILTw':_0x212c96(0x171)};console['log'](_0x212c96(0x12e)),onlineUsers[_0x212c96(0x1f1)](_0x1e9519['id']),io[_0x212c96(0xc0)](_0xc873d['SJvsZ'],onlineUsers),_0x1e9519['on'](_0xc873d['NILTw'],()=>{const _0x1b3ef8=_0x212c96;console['log']('User\x20disconnected'),onlineUsers=onlineUsers[_0x1b3ef8(0x163)](_0x15da26=>_0x15da26!==_0x1e9519['id']),io['emit'](_0x1b3ef8(0x18b),onlineUsers);});}),app['get']('/api/health',(_0x3d80c3,_0xc92dde)=>{_0xc92dde['json']({'status':'ok','timestamp':Date['now']()});}),app['get']('/api/company-info',(_0x467466,_0xb4117c)=>{const _0x17735f=_0xcff869,_0x3e8695={'SRyqS':'示例公司','eJFjA':'DEMO'},_0x3e22ac=loadCompanyInfoStore();if(_0x3e22ac){_0xb4117c[_0x17735f(0xca)](_0x3e22ac);return;}_0xb4117c['json']({'name':_0x17735f(0x1e2),'short_name':_0x3e8695['SRyqS'],'code':_0x3e8695[_0x17735f(0xb5)],'address':'','contact':'','phone':'','email':''});}),app[_0xcff869(0x1da)]('/api/company-info',(_0x17c05a,_0x408c27)=>{const _0x831f39=_0x17c05a['body']||{};saveCompanyInfoStore(_0x831f39),_0x408c27['json'](_0x831f39);}),app['get'](_0xcff869(0x1f9),(_0x5f1892,_0x4165be)=>{_0x4165be['json']({'dingtalkConfigured':![],'dingtalkEnabled':![]});}),app[_0xcff869(0xa8)]('/api/organization/tree',(_0x20b9d0,_0x5c6a25)=>{const _0x76d7d0=_0xcff869,_0x4b6d72=loadDepartmentsStore(),_0x20492c=_0x4b6d72[_0x76d7d0(0x111)](_0x70ec=>({'id':_0x70ec['id'],'name':_0x70ec[_0x76d7d0(0x1df)],'code':_0x70ec[_0x76d7d0(0x1d3)],'parent_id':_0x70ec['parent_id']||null,'type':(_0x70ec[_0x76d7d0(0x24f)]||'DEPT')['toUpperCase'](),'manager':_0x70ec['manager']||'','status':_0x70ec[_0x76d7d0(0x211)]||'active','created_at':_0x70ec['created_at']})),_0x27cc00={},_0x561ae8=[];for(const _0x2586c7 of _0x20492c){_0x27cc00[_0x2586c7['id']]={..._0x2586c7,'children':[]};}for(const _0x4e4376 of _0x20492c){const _0x339c1f=_0x4e4376[_0x76d7d0(0x9a)];_0x339c1f&&_0x27cc00[_0x339c1f]?_0x27cc00[_0x339c1f]['children']['push'](_0x27cc00[_0x4e4376['id']]):_0x561ae8['push'](_0x27cc00[_0x4e4376['id']]);}_0x5c6a25['json'](_0x561ae8);}),app[_0xcff869(0xa8)]('/api/templates',(_0x1dcd6d,_0x440914)=>{const _0x2922a1={'oGeCs':function(_0x34d2df){return _0x34d2df();}},_0x43e254=_0x2922a1['oGeCs'](loadTemplatesStore);_0x440914['json'](_0x43e254);}),app['post'](_0xcff869(0x173),(_0x4dd312,_0x2040a)=>{const _0x252454=_0xcff869,_0x51e360=new Date()[_0x252454(0x128)](),_0x3344be=_0x4dd312[_0x252454(0x117)]||{},_0x4493e0=loadTemplatesStore(),_0x1dd874=getNextId(_0x4493e0),_0x249de8={'id':_0x1dd874,'created_at':_0x51e360,'updated_at':_0x51e360,..._0x3344be};_0x4493e0[_0x252454(0x1f1)](_0x249de8),saveTemplatesStore(_0x4493e0),_0x2040a[_0x252454(0xca)](_0x249de8);}),app[_0xcff869(0x1da)]('/api/templates/:id',(_0xca3790,_0x4057a9)=>{const _0x297032=_0xcff869,_0x3a6b43={'dRCWN':function(_0x201e52,_0x410b5d,_0x519fe3){return _0x201e52(_0x410b5d,_0x519fe3);},'zRivU':function(_0x2b7acb){return _0x2b7acb();},'xhcsB':function(_0x5411ea,_0x40d195){return _0x5411ea===_0x40d195;}},_0xb75b98=_0x3a6b43['dRCWN'](parseInt,_0xca3790['params']['id'],0xa),_0xb6f925=_0x3a6b43['zRivU'](loadTemplatesStore),_0xab4bdc=_0xb6f925[_0x297032(0xa0)](_0x181d9c=>_0x181d9c['id']===_0xb75b98);if(_0x3a6b43[_0x297032(0x8f)](_0xab4bdc,-0x1)){_0x4057a9['status'](0x194)[_0x297032(0xca)]({'error':'Template\x20not\x20found'});return;}const _0x3d2e3d=_0xca3790['body']||{};_0xb6f925[_0xab4bdc]={..._0xb6f925[_0xab4bdc],..._0x3d2e3d,'updated_at':new Date()['toISOString']()},saveTemplatesStore(_0xb6f925),_0x4057a9['json'](_0xb6f925[_0xab4bdc]);}),app[_0xcff869(0x121)]('/api/templates/:id',(_0x4b8654,_0x16e594)=>{const _0x42f3a3=_0xcff869,_0x1cf733={'sPUBi':function(_0x136f1c,_0x2677c9,_0x15b18b){return _0x136f1c(_0x2677c9,_0x15b18b);},'JcnNy':function(_0x4524b1){return _0x4524b1();},'WPJbU':function(_0x2c5b98,_0x5c42d2){return _0x2c5b98(_0x5c42d2);}},_0x425131=_0x1cf733['sPUBi'](parseInt,_0x4b8654['params']['id'],0xa),_0x353ad2=_0x1cf733[_0x42f3a3(0x147)](loadTemplatesStore),_0x1695da=_0x353ad2[_0x42f3a3(0x163)](_0x398224=>_0x398224['id']!==_0x425131),_0x5b1e17=_0x1695da['length']!==_0x353ad2['length'];_0x5b1e17&&_0x1cf733['WPJbU'](saveTemplatesStore,_0x1695da);if(!_0x5b1e17){_0x16e594['status'](0x194)['json']({'error':_0x42f3a3(0x20a)});return;}_0x16e594[_0x42f3a3(0xca)]({'success':!![]});}),app['post']('/api/admin/cleanup-data',(_0x5745b6,_0x1bc8a6)=>{const _0x57e213=_0xcff869,_0x57cdcb={'uYOjt':function(_0xf50684){return _0xf50684();},'KQSDx':_0x57e213(0xd2)};try{_0x57cdcb['uYOjt'](cleanupSystemData),_0x1bc8a6['json']({'success':!![]});}catch(_0x5881c9){_0x1bc8a6['status'](0x1f4)[_0x57e213(0xca)]({'error':_0x57cdcb['KQSDx']});}}),app[_0xcff869(0xa8)](_0xcff869(0x12d),async(_0x143425,_0x373175)=>{const _0x19cf30=_0xcff869,_0x47089c={'XKOSG':function(_0x31b28c){return _0x31b28c();},'KbyfE':function(_0x1e7c22,_0x2331c7){return _0x1e7c22>_0x2331c7;}},_0x2dee61=parseInt(_0x143425['query']['limit'],0xa),_0x1d6a44=parseInt(_0x143425[_0x19cf30(0x197)][_0x19cf30(0x155)],0xa),_0x1c754d=await _0x47089c['XKOSG'](listBackupFiles),_0x80631b=Number[_0x19cf30(0x1c6)](_0x1d6a44)&&_0x1d6a44>0x0?_0x1d6a44:0x0,_0x390e82=Number['isFinite'](_0x2dee61)&&_0x47089c[_0x19cf30(0x1ec)](_0x2dee61,0x0)?_0x80631b+_0x2dee61:undefined,_0x407257=_0x1c754d['slice'](_0x80631b,_0x390e82);_0x373175[_0x19cf30(0xca)]({'items':_0x407257,'total':_0x1c754d['length']});}),app['post'](_0xcff869(0xfd),async(_0x35d323,_0x5e42c5)=>{const _0xb720cf=_0xcff869,_0x5dd473={'pFXKg':function(_0x59310c,_0xa7f03e){return _0x59310c(_0xa7f03e);},'UmzUM':function(_0xfe6a9e){return _0xfe6a9e();}};try{const _0x29088b=new Date(),_0x6841be=_0x1ff5fb=>_0x1ff5fb<0xa?'0'+_0x1ff5fb:String(_0x1ff5fb),_0x2ca2c1='system-backup-'+_0x29088b[_0xb720cf(0xd3)]()+'-'+_0x5dd473['pFXKg'](_0x6841be,_0x29088b[_0xb720cf(0xe6)]()+0x1)+'-'+_0x6841be(_0x29088b[_0xb720cf(0x12c)]())+'_'+_0x6841be(_0x29088b[_0xb720cf(0x18c)]())+'-'+_0x6841be(_0x29088b['getMinutes']())+'-'+_0x6841be(_0x29088b[_0xb720cf(0x10b)]())+'.json',_0x2e4873={'createdAt':_0x29088b[_0xb720cf(0x128)](),'annual_work_plans':loadAnnualWorkPlans(),'major_events':loadMajorEvents(),'monthly_progress':loadMonthlyProgress(),'departments':loadDepartmentsStore(),'employees':loadEmployeesStore(),'action_plans':loadActionPlans(),'notifications':loadNotificationsStore(),'users':_0x5dd473['UmzUM'](loadUsersStore),'target_types':loadTargetTypesStore(),'templates':loadTemplatesStore(),'department_targets':loadDepartmentTargets(),'system_settings':loadSystemSettings(),'audit_logs':loadAuditLogs(),'company_info':loadCompanyInfoStore()||null},_0x5f55c4=_0xff515f['join'](BACKUP_DIR,_0x2ca2c1);await _0x378db8[_0xb720cf(0x184)](_0x5f55c4,JSON['stringify'](_0x2e4873,null,0x2),'utf-8'),_0x5e42c5[_0xb720cf(0xca)]({'path':_0x5f55c4,'name':_0x2ca2c1});}catch(_0x383d02){_0x5e42c5['status'](0x1f4)[_0xb720cf(0xca)]({'error':'备份失败'});}}),app[_0xcff869(0x124)]('/api/admin/backups/restore',async(_0x3c9d82,_0x31591b)=>{const _0x247816=_0xcff869,_0x17dc3c={'jqOmY':_0x247816(0x17f),'lHHsn':_0x247816(0x1b0)};try{const _0x4bb1f1=_0x3c9d82[_0x247816(0x117)]&&_0x3c9d82[_0x247816(0x117)][_0x247816(0x1df)]||'';if(!_0x4bb1f1){_0x31591b[_0x247816(0x211)](0x190)[_0x247816(0xca)]({'error':_0x17dc3c[_0x247816(0x84)]});return;}const _0x2d1a5f=_0xff515f[_0x247816(0x257)](BACKUP_DIR,_0x4bb1f1),_0x249020=await _0x378db8[_0x247816(0x201)](_0x2d1a5f,'utf-8'),_0x568bd8=JSON['parse'](_0x249020);applyBackupSnapshot(_0x568bd8),_0x31591b[_0x247816(0xca)]({'success':!![]});}catch(_0x33247b){_0x31591b[_0x247816(0x211)](0x1f4)['json']({'error':_0x17dc3c['lHHsn']});}}),app[_0xcff869(0x124)](_0xcff869(0x19a),upload['single']('file'),async(_0x3b16dd,_0x4be77f)=>{const _0x54eb6a=_0xcff869,_0x2b9dcd={'wkfJJ':'utf-8','gFlrJ':_0x54eb6a(0x227)};try{if(!_0x3b16dd[_0x54eb6a(0x238)]||!_0x3b16dd[_0x54eb6a(0x238)]['buffer']){_0x4be77f['status'](0x190)[_0x54eb6a(0xca)]({'error':'未收到备份文件'});return;}const _0x103b50=_0x3b16dd['file'][_0x54eb6a(0x19b)][_0x54eb6a(0xd7)](_0x2b9dcd[_0x54eb6a(0xa3)]),_0x75c3d8=JSON[_0x54eb6a(0x110)](_0x103b50);applyBackupSnapshot(_0x75c3d8),_0x4be77f['json']({'success':!![]});}catch(_0x1b6b0e){_0x4be77f[_0x54eb6a(0x211)](0x190)[_0x54eb6a(0xca)]({'error':_0x2b9dcd['gFlrJ']});}}),app[_0xcff869(0xa8)](_0xcff869(0x180),async(_0x27f942,_0x45efdf)=>{const _0x5c14ca=_0xcff869;try{const _0x1078c4=decodeURIComponent(_0x27f942['params']['name']),_0x5b7096=_0xff515f['join'](BACKUP_DIR,_0x1078c4);if(!_0x345456['existsSync'](_0x5b7096)){_0x45efdf[_0x5c14ca(0x211)](0x194)['json']({'error':'备份文件不存在'});return;}await _0x378db8['unlink'](_0x5b7096),_0x45efdf['json']({'success':!![]});}catch(_0x4df8e9){_0x45efdf['status'](0x1f4)['json']({'error':_0x5c14ca(0xb9)});}}),app['delete'](_0xcff869(0x180),async(_0x217582,_0x38a769)=>{const _0x2bfde7=_0xcff869,_0x12863b={'vLDmS':'备份文件不存在'};try{const _0x36026c=decodeURIComponent(_0x217582['params'][_0x2bfde7(0x1df)]),_0x386339=_0xff515f['join'](BACKUP_DIR,_0x36026c);if(!_0x345456[_0x2bfde7(0x22b)](_0x386339)){_0x38a769['status'](0x194)[_0x2bfde7(0xca)]({'error':_0x12863b[_0x2bfde7(0xdc)]});return;}await _0x378db8[_0x2bfde7(0x20e)](_0x386339),_0x38a769['json']({'success':!![]});}catch(_0x11919a){_0x38a769[_0x2bfde7(0x211)](0x1f4)[_0x2bfde7(0xca)]({'error':'删除备份失败'});}}),app['get']('*',(_0x1c57ea,_0x421f92)=>{const _0xab1ad9=_0xcff869;_0x421f92['sendFile'](_0xff515f[_0xab1ad9(0x257)](__dirname,'../index.html'));});let autoBackupInterval=null;function startAutoBackup(){const _0x2a3891=_0xcff869,_0x13712f={'POPBn':function(_0x1e64f1,_0x5c9051){return _0x1e64f1+_0x5c9051;},'AjIRv':function(_0xc4fa02,_0xc270e5){return _0xc4fa02(_0xc270e5);},'uwjwD':function(_0xb5cbc4){return _0xb5cbc4();},'PElCP':function(_0x5e8694){return _0x5e8694();},'nqPdR':function(_0x3cf37c){return _0x3cf37c();},'MiKKp':function(_0x432dea){return _0x432dea();},'VMGaQ':function(_0x51430d){return _0x51430d();},'bYoaY':function(_0x5e531c){return _0x5e531c();},'TRgEZ':function(_0x5a2e8b,_0x10c062){return _0x5a2e8b*_0x10c062;}};try{autoBackupInterval&&(clearInterval(autoBackupInterval),autoBackupInterval=null);const _0x1ff025=_0x13712f[_0x2a3891(0x13f)](loadSystemSettings),_0x2bdb3b=_0x1ff025[_0x2a3891(0x13c)](_0x133dc8=>_0x133dc8&&_0x133dc8[_0x2a3891(0xe2)]===_0x2a3891(0x11a)),_0x5eb6ba=_0x2bdb3b?.['value']?.['autoBackup']??![],_0x4419bd=_0x2bdb3b?.[_0x2a3891(0xd1)]?.['backupInterval']??0x18;if(_0x5eb6ba){console['log'](_0x2a3891(0xbf)+_0x4419bd+_0x2a3891(0xb8));const _0x20469d=_0x13712f['TRgEZ'](_0x13712f['TRgEZ'](_0x4419bd,0x3c)*0x3c,0x3e8);autoBackupInterval=setInterval(async()=>{const _0x235720=_0x2a3891;try{console[_0x235720(0x1f4)](_0x235720(0x15c));const _0x7d59d9=new Date(),_0xa9ef2c=_0x4cafe2=>_0x4cafe2<0xa?'0'+_0x4cafe2:String(_0x4cafe2),_0x38bfe1=_0x235720(0xc2)+_0x7d59d9[_0x235720(0xd3)]()+'-'+_0xa9ef2c(_0x13712f['POPBn'](_0x7d59d9['getMonth'](),0x1))+'-'+_0xa9ef2c(_0x7d59d9['getDate']())+'_'+_0x13712f[_0x235720(0x130)](_0xa9ef2c,_0x7d59d9['getHours']())+'-'+_0xa9ef2c(_0x7d59d9[_0x235720(0x1c5)]())+'-'+_0x13712f[_0x235720(0x130)](_0xa9ef2c,_0x7d59d9['getSeconds']())+_0x235720(0x1c9),_0x378570={'createdAt':_0x7d59d9['toISOString'](),'annual_work_plans':_0x13712f[_0x235720(0x13f)](loadAnnualWorkPlans),'major_events':loadMajorEvents(),'monthly_progress':_0x13712f['PElCP'](loadMonthlyProgress),'departments':_0x13712f['PElCP'](loadDepartmentsStore),'employees':loadEmployeesStore(),'action_plans':_0x13712f[_0x235720(0xee)](loadActionPlans),'notifications':_0x13712f[_0x235720(0xee)](loadNotificationsStore),'users':loadUsersStore(),'target_types':_0x13712f[_0x235720(0x13f)](loadTargetTypesStore),'templates':_0x13712f[_0x235720(0x17a)](loadTemplatesStore),'department_targets':_0x13712f['VMGaQ'](loadDepartmentTargets),'system_settings':_0x13712f['bYoaY'](loadSystemSettings),'audit_logs':loadAuditLogs(),'company_info':loadCompanyInfoStore()||null},_0x4c3ad1=_0xff515f[_0x235720(0x257)](BACKUP_DIR,_0x38bfe1);await _0x378db8[_0x235720(0x184)](_0x4c3ad1,JSON[_0x235720(0x1fc)](_0x378570,null,0x2),'utf-8'),console[_0x235720(0x1f4)](_0x235720(0x202)+_0x38bfe1);}catch(_0x220c7d){console['error'](_0x235720(0x172),_0x220c7d);}},_0x20469d);}else console[_0x2a3891(0x1f4)]('自动备份已禁用');}catch(_0x3efc3d){console[_0x2a3891(0x239)]('初始化自动备份失败：',_0x3efc3d);}}!process['env']['RUN_DATA_CLEANUP_ONLY']&&server[_0xcff869(0x1b5)](PORT,()=>{const _0x41fcf3=_0xcff869;console[_0x41fcf3(0x1f4)](_0x41fcf3(0x14a)+PORT),setTimeout(startAutoBackup,0x1388);});app[_0xcff869(0x124)](_0xcff869(0x1ae),(_0x41ac58,_0x978b0b)=>{const _0x3a40dd=_0xcff869,_0x145859={'MgAOw':_0x3a40dd(0x20d),'CkERv':_0x3a40dd(0x131)};try{startAutoBackup(),_0x978b0b['json']({'success':!![],'message':_0x145859[_0x3a40dd(0x1ca)]});}catch(_0x384244){_0x978b0b['status'](0x1f4)['json']({'success':![],'error':_0x145859[_0x3a40dd(0xc1)]});}});export{cleanupSystemData};