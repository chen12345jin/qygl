import{a as e,b as t,j as r}from"./index-ByQWdRVi.js";import{r as a}from"./charts--DrkC4h1.js";import{T as s}from"./TableManager-CI9BWYWi.js";import{e as l}from"./export-9Rbd0ORM.js";import{r as n,u as i}from"./utils-d68qSfg_.js";import{c as d,m as o,n as c,R as x,o as m,D as u,p,q as b,r as g,T as h,C as v}from"./ui-CyUNfsEX.js";import"./vendor-De9qiMg1.js";import"./router-BWTJJsff.js";import"./pdf-60kGjG4V.js";import"./DeleteConfirmDialog-CRlob68K.js";import"./InlineAlert-ConnvRud.js";const y=()=>{const{getDepartmentTargets:y,addDepartmentTarget:j,updateDepartmentTarget:f,deleteDepartmentTarget:N,getDepartments:w}=e(),{getRequiredFields:_,validateForm:k,errors:C,clearAllErrors:D}=t(),[z,T]=a.useState([]),[A,q]=a.useState([]),[E,S]=a.useState(null),[B,F]=a.useState("list"),[$,Q]=a.useState({year:(new Date).getFullYear(),department:"",targetType:""}),[I,V]=a.useState(!1),L=_("departmentTargets");a.useEffect(()=>{O(),R()},[$]);const O=async()=>{const e=await y($);e.success&&T(e.data||[])},R=async()=>{const e=await w();e.success&&q(e.data||[])},Y=async e=>{if(!k(e,"departmentTargets").isValid)return!1;return!!(await j({...e,year:$.year})).success&&(O(),D(),!0)},M=[{key:"department_id",label:"部门",type:"select",options:A.map(e=>({value:e.id,label:e.name})),required:L.includes("department"),hint:"选择目标所属的部门"},{key:"target_level",label:"级别",type:"select",options:[{value:"A",label:"A - 保底"},{value:"B",label:"B - 平衡"},{value:"C",label:"C - 突破"},{value:"D",label:"D - 冲刺"}],required:L.includes("targetLevel"),hint:"目标难度级别：A保底、B平衡、C突破、D冲刺"},{key:"target_type",label:"目标类型",type:"select",options:[{value:"sales",label:"销售目标"},{value:"profit",label:"利润目标"},{value:"project",label:"项目目标"},{value:"efficiency",label:"效率目标"},{value:"quality",label:"质量目标"},{value:"cost",label:"成本目标"}],required:L.includes("targetType"),hint:"选择目标的业务类型",onChange:(e,t,r)=>{t({...r,target_type:e,target_name:{sales:"销售目标",profit:"利润目标",project:"项目目标",efficiency:"效率目标",quality:"质量目标",cost:"成本目标"}[e]||""})}},{key:"target_name",label:"目标名称",required:L.includes("targetName"),hint:"具体的目标名称描述"},{key:"target_value",label:"目标值",type:"number",required:L.includes("targetValue"),hint:"目标的具体数值"},{key:"unit",label:"单位",hint:"目标值的计量单位，如：万元、个、%等"},{key:"quarter",label:"季度",type:"select",options:[{value:"Q1",label:"第一季度"},{value:"Q2",label:"第二季度"},{value:"Q3",label:"第三季度"},{value:"Q4",label:"第四季度"}],hint:"目标所属的季度"},{key:"month",label:"月份",type:"select",options:Array.from({length:12},(e,t)=>({value:t+1,label:`${t+1}月`})),hint:"目标所属的月份"},{key:"current_value",label:"当前值",type:"number",hint:"目标的当前完成数值"},{key:"completion_rate",label:"完成率",render:(e,t)=>{const a=t.current_value&&t.target_value?(t.current_value/t.target_value*100).toFixed(1):0;return r.jsxs("span",{className:"px-2 py-1 rounded-full text-xs "+(a>=100?"bg-green-100 text-green-800":a>=80?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[a,"%"]})}},{key:"responsible_person",label:"负责人",required:L.includes("responsible"),hint:"目标的主要负责人"},{key:"description",label:"描述",type:"textarea",hint:"目标的详细描述和说明（选填）"}],G=(()=>{const e={departments:[...new Set(z.map(e=>e.department))],levels:["A","B","C","D"],months:Array.from({length:12},(e,t)=>t+1),data:{}};return e.departments.forEach(t=>{e.data[t]={},e.levels.forEach(r=>{e.data[t][r]={},e.months.forEach(a=>{e.data[t][r][a]=[]})})}),z.forEach(t=>{const r=t.department,a=t.target_level||"A",s=t.month||1;e.data[r]&&e.data[r][a]&&(e.data[r][a][s]||(e.data[r][a][s]=[]),e.data[r][a][s].push(t))}),e})(),H={A:"保底",B:"平衡",C:"突破",D:"冲刺"};return r.jsxs("div",{className:"space-y-6 p-6 relative",children:[r.jsxs("div",{className:"relative bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-700 rounded-2xl shadow-2xl p-8 text-white overflow-hidden",children:[r.jsxs("div",{className:"absolute top-0 left-0 w-full h-full opacity-10",children:[r.jsx("div",{className:"absolute top-10 left-10 w-32 h-32 bg-white rounded-full animate-blob"}),r.jsx("div",{className:"absolute bottom-10 right-10 w-24 h-24 bg-white rounded-full animate-blob animation-delay-2000"}),r.jsx("div",{className:"absolute top-1/2 left-1/2 w-20 h-20 bg-white rounded-full animate-blob animation-delay-4000"})]}),r.jsxs("div",{className:"relative z-10",children:[r.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[r.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl shadow-lg",children:r.jsx(d,{size:28,className:"text-white"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent",children:"部门目标分解"}),r.jsx("p",{className:"text-blue-100 text-lg font-medium",children:"管理和跟踪各部门的年度目标设定与执行情况"})]})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-6",children:[r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-blue-100 shadow-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600",children:A.length}),r.jsx("div",{className:"text-sm text-gray-600",children:"参与部门"})]}),r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-green-100 shadow-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-green-600",children:z.length}),r.jsx("div",{className:"text-sm text-gray-600",children:"目标总数"})]}),r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-purple-100 shadow-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-purple-600",children:z.filter(e=>e.current_value&&e.target_value&&e.current_value>=e.target_value).length}),r.jsx("div",{className:"text-sm text-gray-600",children:"已完成目标"})]})]})]})]}),!1,r.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-lg border border-gray-100 p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg",children:r.jsx(o,{size:24,className:"text-white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"数据视图"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"选择最适合您的数据查看方式"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsxs("button",{className:"px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg hover:from-blue-600 hover:to-purple-700",onClick:()=>V(e=>!e),children:[r.jsx(c,{className:"mr-2",size:18}),"筛选"]}),r.jsxs("button",{className:"px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center bg-white/80 text-gray-700 hover:bg-gray-100 border border-gray-300",onClick:()=>{Q({year:(new Date).getFullYear(),department:"",targetType:""}),O()},children:[r.jsx(x,{className:"mr-2",size:18}),"重置"]}),r.jsxs("div",{className:"flex space-x-3 bg-white/80 backdrop-blur-sm rounded-2xl p-2 border border-gray-100 shadow-lg",children:[r.jsxs("button",{className:"px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center "+("list"===B?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg transform scale-105":"bg-white/50 text-gray-600 hover:bg-gray-50/80 hover:text-gray-800"),onClick:()=>F("list"),children:[r.jsx(m,{className:"mr-2",size:18}),"列表视图"]}),r.jsxs("button",{className:"px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center "+("table"===B?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg transform scale-105":"bg-white/50 text-gray-600 hover:bg-gray-50/80 hover:text-gray-800"),onClick:()=>F("table"),children:[r.jsx(o,{className:"mr-2",size:18}),"表格视图"]})]})]})]})}),I&&r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-3xl p-6 border border-gray-200 shadow-xl",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"年份"}),r.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all duration-200 text-sm",value:$.year,onChange:e=>Q({...$,year:parseInt(e.target.value)}),children:[r.jsx("option",{value:"2024",children:"2024"}),r.jsx("option",{value:"2025",children:"2025"}),r.jsx("option",{value:"2026",children:"2026"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"部门"}),r.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white transition-all duration-200 text-sm",value:$.department,onChange:e=>Q({...$,department:e.target.value}),children:[r.jsx("option",{value:"",children:"全部部门"}),A.map(e=>r.jsx("option",{value:e.name,children:e.name},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"类型"}),r.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white transition-all duration-200 text-sm",value:$.targetType,onChange:e=>Q({...$,targetType:e.target.value}),children:[r.jsx("option",{value:"",children:"全部类型"}),r.jsx("option",{value:"sales",children:"销售"}),r.jsx("option",{value:"profit",children:"利润"}),r.jsx("option",{value:"project",children:"项目"}),r.jsx("option",{value:"efficiency",children:"效率"}),r.jsx("option",{value:"quality",children:"质量"}),r.jsx("option",{value:"cost",children:"成本"})]})]})]}),r.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[r.jsx("button",{className:"h-9 px-3 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-100 transition-all text-sm",onClick:()=>V(!1),children:"关闭"}),r.jsx("button",{className:"h-9 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all text-sm",onClick:()=>{O(),V(!1)},children:"应用筛选"})]})]}),"list"===B&&r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-3xl border border-gray-100 shadow-xl overflow-hidden",children:[r.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border-b border-gray-200 p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(m,{size:24,className:"text-blue-600"}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"目标列表"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"按部门和时间维度展示目标详情"})]})]}),r.jsxs("div",{className:"text-sm text-gray-500",children:["共 ",z.length," 条记录"]})]})}),r.jsx("div",{className:"p-1",children:r.jsx(s,{title:`${$.year}年度目标分解`,data:z,columns:M,onAdd:Y,onEdit:async(e,t)=>{if(!k(t,"departmentTargets").isValid)return!1;return!!(await f(e,t)).success&&(O(),S(null),D(),!0)},onDelete:async e=>!!(await N(e)).success&&(O(),!0),onCopy:e=>{const t={...e};delete t.id,Y(t)},editingId:E,onEditingChange:S,showActions:!0,pagination:!0,pageSize:10,className:"rounded-2xl overflow-hidden"})})]}),"table"===B&&r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-3xl border border-gray-100 shadow-xl overflow-hidden",children:[r.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border-b border-gray-200 p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(o,{size:24,className:"text-purple-600"}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"目标分解详情"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"各部门月度目标分解情况"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-teal-600 text-white px-6 py-3 rounded-xl hover:from-green-600 hover:to-teal-700 transition-all duration-200 flex items-center space-x-2 shadow-lg hover:shadow-xl",onClick:()=>{try{const e=z.map(e=>({year:e.year,department:e.department,target_level:e.target_level,target_type:e.target_type,target_name:e.target_name,target_value:e.target_value,unit:e.unit,month:e.month,current_value:e.current_value,completion_rate:e.current_value&&e.target_value?(e.current_value/e.target_value*100).toFixed(1)+"%":"0%",responsible_person:e.responsible_person,description:e.description,created_at:e.created_at}));l(e,`部门目标分解_${$.year}年`,"部门目标","departmentTargets")}catch(e){console.error("导出Excel失败:",e),alert("导出失败，请稍后重试")}},children:[r.jsx(u,{size:18}),r.jsx("span",{children:"导出Excel"})]}),r.jsxs("label",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 flex items-center space-x-2 shadow-lg hover:shadow-xl cursor-pointer",children:[r.jsx(p,{size:18}),r.jsx("span",{children:"导入Excel"}),r.jsx("input",{type:"file",accept:".xlsx,.xls",className:"hidden",onChange:e=>e.target.files[0]&&(async t=>{try{const e=await t.arrayBuffer(),r=n(e),a=r.SheetNames[0],s=r.Sheets[a],l=i.sheet_to_json(s);for(const t of l){const e=A.find(e=>e.name===(t["部门"]||t["部门名称"])),r={year:Number(t["年度"]||$.year),department_id:e?e.id:void 0,target_level:t["级别"]||"A",target_type:t["目标类型"]||"",target_name:t["目标名称"]||"",target_value:t["目标值"]?Number(t["目标值"]):null,unit:t["单位"]||"",month:t["月份"]?Number(t["月份"]):null,current_value:t["当前值"]?Number(t["当前值"]):0,responsible_person:t["负责人"]||"",description:t["描述"]||""};await j(r)}await O(),alert("导入完成")}catch(e){console.error("导入失败:",e),alert("导入失败，请检查文件格式")}})(e.target.files[0])})]})]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-blue-50",children:[r.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(b,{size:16,className:"mr-2 text-blue-500"}),"部门"]})}),r.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(g,{size:16,className:"mr-2 text-green-500"}),"级别"]})}),r.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(h,{size:16,className:"mr-2 text-purple-500"}),"目标类型"]})}),r.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(v,{size:16,className:"mr-2 text-orange-500"}),"年度目标"]})}),Array.from({length:12},(e,t)=>t+1).map(e=>r.jsx("th",{className:"px-4 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsxs("span",{className:"text-xs text-gray-500",children:[e,"月"]}),r.jsx("div",{className:"w-8 h-1 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full mt-1"})]})},e))]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:G.departments.map((e,t)=>G.levels.map((a,s)=>G.months.some(t=>G.data[e]&&G.data[e][a]&&G.data[e][a][t]&&G.data[e][a][t].length>0)?r.jsxs("tr",{className:"hover:bg-gradient-to-r from-blue-50/30 to-purple-50/30 transition-all duration-200 group",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900 border-b border-gray-100 group-hover:border-blue-100",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),e]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 border-b border-gray-100 group-hover:border-green-100",children:r.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:H[a]||a})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 border-b border-gray-100 group-hover:border-purple-100",children:G.data[e]&&G.data[e][a]&&Object.values(G.data[e][a]).flat().map(e=>e.target_type).filter(Boolean)[0]||"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-blue-600 border-b border-gray-100 group-hover:border-orange-100",children:G.data[e]&&G.data[e][a]&&Object.values(G.data[e][a]).flat().reduce((e,t)=>e+(t.target_value||0),0)||"-"}),Array.from({length:12},(e,t)=>t+1).map(t=>{const s=G.data[e]&&G.data[e][a]&&G.data[e][a][t],l=s?s.reduce((e,t)=>e+(t.target_value||0),0):0;return r.jsx("td",{className:"px-4 py-4 text-center text-sm text-gray-600 border-b border-gray-100 group-hover:border-gray-200",children:r.jsx("div",{className:"inline-flex items-center px-2 py-1 rounded-lg "+(l>0?"bg-blue-50 text-blue-700 border border-blue-200":"bg-gray-50 text-gray-500 border border-gray-200"),children:l>0?l:"-"})},t)})]},`${t}-${s}`):null)).filter(Boolean)})]})}),r.jsx("div",{className:"bg-gray-50 border-t border-gray-200 p-4",children:r.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),r.jsx("span",{children:"部门目标"})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),r.jsx("span",{children:"级别标识"})]})]}),r.jsxs("div",{children:["共 ",z.length," 条记录 • 更新时间: ",(new Date).toLocaleString()]})]})})]})]})};export{y as default};
