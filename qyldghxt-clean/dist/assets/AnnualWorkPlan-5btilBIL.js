import{a as e,j as t}from"./index-ByQWdRVi.js";import{r as a}from"./charts--DrkC4h1.js";import{T as l}from"./TableManager-CI9BWYWi.js";import{r as n,u as s}from"./utils-d68qSfg_.js";import{e as r}from"./export-9Rbd0ORM.js";import{C as o}from"./ui-CyUNfsEX.js";import"./vendor-De9qiMg1.js";import"./router-BWTJJsff.js";import"./pdf-60kGjG4V.js";import"./DeleteConfirmDialog-CRlob68K.js";import"./InlineAlert-ConnvRud.js";const i=()=>{const{getAnnualWorkPlans:i,addAnnualWorkPlan:p,updateAnnualWorkPlan:d,deleteAnnualWorkPlan:u,getDepartments:c}=e(),[m,x]=a.useState([]),[h,v]=a.useState([]),[y,g]=a.useState(null),[b,j]=a.useState({year:(new Date).getFullYear(),department:"",category:"",status:"",month:""});a.useEffect(()=>{_(),f()},[b]);const _=async()=>{const e=await i(b);e.success&&x(e.data||[])},f=async()=>{const e=await c();e.success&&v(e.data||[])},k=async e=>{const t=h.find(t=>t.name===e.department),a={...e,year:b.year,department_id:t?t.id:null,department_name:e.department,month:e.month||null,description:e.expected_outcome||"",target_value:e.budget?parseFloat(e.budget):null,target_level:"A",progress:0,sheet_type:"planning",department:void 0,expected_outcome:void 0,remarks:void 0};return!!(await p(a)).success&&(_(),!0)},N=[{key:"year",label:"年份",type:"select",options:[{value:2024,label:"2024年"},{value:2025,label:"2025年"},{value:2026,label:"2026年"}],required:!0},{key:"plan_name",label:"计划名称",required:!0},{key:"month",label:"月份",type:"select",options:[{value:1,label:"1月"},{value:2,label:"2月"},{value:3,label:"3月"},{value:4,label:"4月"},{value:5,label:"5月"},{value:6,label:"6月"},{value:7,label:"7月"},{value:8,label:"8月"},{value:9,label:"9月"},{value:10,label:"10月"},{value:11,label:"11月"},{value:12,label:"12月"}]},{key:"department",label:"负责部门",type:"select",options:h.map(e=>({value:e.name,label:e.name})),required:!0},{key:"category",label:"类别",type:"select",options:[{value:"strategic",label:"战略性工作"},{value:"operational",label:"运营性工作"},{value:"project",label:"项目性工作"},{value:"improvement",label:"改进性工作"}],required:!0},{key:"priority",label:"优先级",type:"select",options:[{value:"high",label:"高"},{value:"medium",label:"中"},{value:"low",label:"低"}],render:e=>t.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+("high"===e?"bg-red-100 text-red-800":"medium"===e?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:"high"===e?"高":"medium"===e?"中":"低"})},{key:"start_date",label:"开始日期",type:"date"},{key:"end_date",label:"结束日期",type:"date"},{key:"budget",label:"预算（万元）",type:"number"},{key:"responsible_person",label:"负责人"},{key:"status",label:"状态",type:"select",options:[{value:"planning",label:"规划中"},{value:"in_progress",label:"进行中"},{value:"completed",label:"已完成"},{value:"suspended",label:"已暂停"}],render:e=>t.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+("completed"===e?"bg-green-100 text-green-800":"in_progress"===e?"bg-blue-100 text-blue-800":"suspended"===e?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"completed"===e?"已完成":"in_progress"===e?"进行中":"suspended"===e?"已暂停":"规划中"})},{key:"expected_outcome",label:"预期成果",type:"textarea"},{key:"remarks",label:"备注",type:"textarea"}];return t.jsxs("div",{className:"space-y-6 relative",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[t.jsx(o,{className:"mr-2"}),"年度工作落地规划"]}),t.jsx("p",{className:"text-gray-600",children:"制定和管理企业年度工作计划的具体落地实施方案"})]}),t.jsx("div",{className:"bg-white rounded-lg shadow p-3 absolute top-4 right-4 z-10",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("select",{value:b.year,onChange:e=>j({...b,year:parseInt(e.target.value)}),className:"form-select text-sm px-2 py-1",children:[t.jsx("option",{value:"2024",children:"2024"}),t.jsx("option",{value:"2025",children:"2025"}),t.jsx("option",{value:"2026",children:"2026"})]}),t.jsxs("select",{value:b.department,onChange:e=>j({...b,department:e.target.value}),className:"form-select text-sm px-2 py-1",children:[t.jsx("option",{value:"",children:"全部部门"}),h.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))]}),t.jsxs("select",{value:b.category,onChange:e=>j({...b,category:e.target.value}),className:"form-select text-sm px-2 py-1",children:[t.jsx("option",{value:"",children:"全部类别"}),t.jsx("option",{value:"strategic",children:"战略"}),t.jsx("option",{value:"operational",children:"运营"}),t.jsx("option",{value:"project",children:"项目"}),t.jsx("option",{value:"improvement",children:"改进"})]}),t.jsxs("select",{value:b.status,onChange:e=>j({...b,status:e.target.value}),className:"form-select text-sm px-2 py-1",children:[t.jsx("option",{value:"",children:"全部状态"}),t.jsx("option",{value:"planning",children:"规划中"}),t.jsx("option",{value:"in_progress",children:"进行中"}),t.jsx("option",{value:"completed",children:"已完成"}),t.jsx("option",{value:"suspended",children:"已暂停"})]}),t.jsxs("select",{value:b.month,onChange:e=>j({...b,month:e.target.value}),className:"form-select text-sm px-2 py-1",children:[t.jsx("option",{value:"",children:"全部月份"}),t.jsx("option",{value:"1",children:"1月"}),t.jsx("option",{value:"2",children:"2月"}),t.jsx("option",{value:"3",children:"3月"}),t.jsx("option",{value:"4",children:"4月"}),t.jsx("option",{value:"5",children:"5月"}),t.jsx("option",{value:"6",children:"6月"}),t.jsx("option",{value:"7",children:"7月"}),t.jsx("option",{value:"8",children:"8月"}),t.jsx("option",{value:"9",children:"9月"}),t.jsx("option",{value:"10",children:"10月"}),t.jsx("option",{value:"11",children:"11月"}),t.jsx("option",{value:"12",children:"12月"})]}),t.jsx("button",{className:"bg-blue-500 text-white px-2 py-1 rounded text-sm",onClick:()=>j({year:(new Date).getFullYear(),department:"",category:"",status:"",month:""}),children:"重置"}),t.jsx("button",{className:"bg-green-600 text-white px-2 py-1 rounded text-sm",onClick:()=>{try{const e=m.map(e=>({year:e.year,department:e.department_name||e.department,plan_name:e.plan_name,month:e.month,category:e.category,priority:e.priority,start_date:e.start_date,end_date:e.end_date,budget:e.budget,status:e.status,responsible_person:e.responsible_person}));r(e,`年度工作规划_${b.year}年`,"年度工作规划","annualWorkPlans")}catch(e){console.error("导出Excel失败:",e),alert("导出失败，请稍后重试")}},children:"导出Excel"}),t.jsxs("label",{className:"bg-purple-600 text-white px-2 py-1 rounded text-sm cursor-pointer",children:["导入Excel",t.jsx("input",{type:"file",accept:".xlsx,.xls",className:"hidden",onChange:e=>e.target.files[0]&&(async t=>{try{const e=await t.arrayBuffer(),a=n(e),l=a.SheetNames[0],r=a.Sheets[l],o=s.sheet_to_json(r);for(const t of o){const e={year:Number(t["年度"]||b.year),department:t["部门"]||"",plan_name:t["计划名称"]||"",month:t["月份"]?Number(t["月份"]):null,category:t["类别"]||"",priority:t["优先级"]||"",start_date:t["开始日期"]||"",end_date:t["结束日期"]||"",budget:t["预算（万元）"]?Number(t["预算（万元）"]):null,status:t["状态"]||"",responsible_person:t["负责人"]||""};await p(e)}await _(),alert("导入完成")}catch(e){console.error("导入失败:",e),alert("导入失败，请检查文件格式")}})(e.target.files[0])})]})]})}),t.jsx(l,{title:`${b.year}年度工作计划`,data:m,columns:N,onAdd:k,onEdit:async(e,t)=>{const a=h.find(e=>e.name===t.department),l={...t,department_id:a?a.id:null,department_name:t.department,month:t.month||null,description:t.expected_outcome||"",target_value:t.budget?parseFloat(t.budget):null,target_level:t.target_level||"A",progress:t.progress||0,sheet_type:t.sheet_type||"planning",department:void 0,expected_outcome:void 0,remarks:void 0};return!!(await d(e,l)).success&&(_(),g(null),!0)},onDelete:async e=>!!(await u(e)).success&&(_(),!0),onCopy:e=>{const t={...e};delete t.id,t.plan_name=`${t.plan_name}_副本`,t.year=b.year,k(t)},editingId:y,onEditingChange:g})]})};export{i as default};
