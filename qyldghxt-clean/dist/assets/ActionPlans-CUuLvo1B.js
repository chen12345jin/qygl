import{a as e,j as s}from"./index-ByQWdRVi.js";import{r as t}from"./charts--DrkC4h1.js";import{T as r}from"./TableManager-CI9BWYWi.js";import{e as a}from"./export-9Rbd0ORM.js";import{r as l,u as i}from"./utils-d68qSfg_.js";import{d as o,n,D as d,p as c,R as x,T as h,F as u,h as m,C as p,Y as g,S as b,Z as j}from"./ui-CyUNfsEX.js";import"./vendor-De9qiMg1.js";import"./router-BWTJJsff.js";import"./pdf-60kGjG4V.js";import"./DeleteConfirmDialog-CRlob68K.js";import"./InlineAlert-ConnvRud.js";const y=()=>{const{getActionPlans:y,addActionPlan:w,updateActionPlan:v,deleteActionPlan:N,getDepartments:f}=e(),[k,W]=t.useState([]),[_,z]=t.useState([]),[C,H]=t.useState(null),[S,q]=t.useState({year:(new Date).getFullYear(),department:"",status:"",priority:""}),[D,A]=t.useState(!1);t.useEffect(()=>{E(),P()},[S]);const E=async()=>{const e=await y(S);e.success&&W(e.data||[])},P=async()=>{const e=await f();e.success&&z(e.data||[])},M=async e=>{const s={...e,year:S.year};return!!(await w(s)).success&&(E(),!0)},F=[{key:"year",label:"年份",type:"select",options:[{value:2024,label:"2024年"},{value:2025,label:"2025年"},{value:2026,label:"2026年"}],required:!0},{key:"what",label:"What（做什么）",required:!0,type:"textarea",hint:"明确要做的具体事项"},{key:"why",label:"Why（为什么做）",required:!0,type:"textarea",hint:"说明目的与预期价值"},{key:"who",label:"Who（谁来做）",required:!0,hint:"填写负责人或团队"},{key:"when",label:"When（什么时候做）",type:"date",required:!0,hint:"选择时间节点或截止日期"},{key:"where",label:"Where（在哪里做）",hint:"发生地点或执行场所"},{key:"how",label:"How（如何做）",type:"textarea",hint:"关键步骤与方法"},{key:"how_much",label:"How Much（多少成本）",type:"number",hint:"预算或资源投入"},{key:"department",label:"负责部门",type:"select",options:_.map(e=>({value:e.name,label:e.name})),required:!0},{key:"priority",label:"优先级",type:"select",options:[{value:"high",label:"高"},{value:"medium",label:"中"},{value:"low",label:"低"}],required:!0,render:e=>s.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+("high"===e?"bg-red-100 text-red-800":"medium"===e?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:"high"===e?"高":"medium"===e?"中":"低"})},{key:"status",label:"状态",type:"select",options:[{value:"not_started",label:"未开始"},{value:"in_progress",label:"进行中"},{value:"completed",label:"已完成"},{value:"delayed",label:"延期"}],render:e=>s.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+("completed"===e?"bg-green-100 text-green-800":"in_progress"===e?"bg-blue-100 text-blue-800":"delayed"===e?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"completed"===e?"已完成":"in_progress"===e?"进行中":"delayed"===e?"延期":"未开始"})},{key:"progress",label:"进度（%）",type:"number"},{key:"expected_result",label:"预期结果",type:"textarea"},{key:"actual_result",label:"实际结果",type:"textarea"},{key:"remarks",label:"备注",type:"textarea"}];return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"relative bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 rounded-3xl shadow-2xl overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"}),s.jsx("div",{className:"relative z-10 p-8",children:s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsx("div",{className:"bg-gradient-to-br from-white/20 to-white/10 p-4 rounded-2xl shadow-xl",children:s.jsx(o,{size:32,className:"text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-white mb-2 bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent",children:"5W2H行动计划"}),s.jsx("p",{className:"text-blue-100 text-lg",children:"运用5W2H方法制定具体的行动计划，确保目标达成"})]})]})})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2 z-10",children:[s.jsxs("button",{className:"h-10 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg flex items-center justify-center text-sm gap-2",onClick:()=>A(e=>!e),children:[s.jsx(n,{size:16}),s.jsx("span",{children:"筛选"})]}),s.jsxs("button",{className:"h-10 px-4 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-xl font-medium hover:from-green-600 hover:to-teal-700 transition-all duration-200 shadow-lg flex items-center justify-center text-sm gap-2",onClick:()=>{try{const e=k.map(e=>({year:e.year,department:e.department,what:e.what,why:e.why,who:e.who,when:e.when,where:e.where,how:e.how,how_much:e.how_much,priority:e.priority,status:e.status,progress:e.progress}));a(e,`5W2H行动计划_${S.year}年`,"行动计划","actionPlans")}catch(e){console.error("导出Excel失败:",e),alert("导出失败，请稍后重试")}},children:[s.jsx(d,{size:16}),s.jsx("span",{children:"导出Excel"})]}),s.jsxs("label",{className:"h-10 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg flex items-center justify-center text-sm gap-2 cursor-pointer",children:[s.jsx(c,{size:16}),s.jsx("span",{children:"导入Excel"}),s.jsx("input",{type:"file",accept:".xlsx,.xls",className:"hidden",onChange:e=>e.target.files[0]&&(async s=>{try{const e=await s.arrayBuffer(),t=l(e),r=t.SheetNames[0],a=t.Sheets[r],o=i.sheet_to_json(a);for(const s of o){const e={year:Number(s["年度"]||S.year),department:s["部门"]||"",what:s["做什么"]||s["What（做什么）"]||"",why:s["为什么"]||s["Why（为什么做）"]||"",who:s["谁来做"]||s["Who（谁来做）"]||"",when:s["什么时候"]||s["When（什么时候做）"]||"",where:s["在哪里"]||s["Where（在哪里做）"]||"",how:s["怎么做"]||s["How（如何做）"]||"",how_much:s["多少钱"]||s["How Much（多少成本）"]||null,priority:s["优先级"]||"",status:s["状态"]||"",progress:s["进度（%）"]?Number(s["进度（%）"]):0};await w(e)}await E(),alert("导入完成")}catch(e){console.error("导入失败:",e),alert("导入失败，请检查文件格式")}})(e.target.files[0])})]})]}),D&&s.jsxs("div",{className:"absolute top-16 right-4 w-96 bg-white border border-gray-200 rounded-xl shadow-xl p-4",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"年度"}),s.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all duration-200 text-sm",value:S.year,onChange:e=>q({...S,year:parseInt(e.target.value)}),children:[s.jsx("option",{value:"2024",children:"2024"}),s.jsx("option",{value:"2025",children:"2025"}),s.jsx("option",{value:"2026",children:"2026"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"部门"}),s.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white transition-all duration-200 text-sm",value:S.department,onChange:e=>q({...S,department:e.target.value}),children:[s.jsx("option",{value:"",children:"全部部门"}),_.map(e=>s.jsx("option",{value:e.name,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"状态"}),s.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white transition-all duration-200 text-sm",value:S.status,onChange:e=>q({...S,status:e.target.value}),children:[s.jsx("option",{value:"",children:"全部状态"}),s.jsx("option",{value:"not_started",children:"未开始"}),s.jsx("option",{value:"in_progress",children:"进行中"}),s.jsx("option",{value:"completed",children:"已完成"}),s.jsx("option",{value:"delayed",children:"延期"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"优先级"}),s.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white transition-all duration-200 text-sm",value:S.priority,onChange:e=>q({...S,priority:e.target.value}),children:[s.jsx("option",{value:"",children:"全部优先级"}),s.jsx("option",{value:"high",children:"高"}),s.jsx("option",{value:"medium",children:"中"}),s.jsx("option",{value:"low",children:"低"})]})]})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[s.jsx("button",{className:"h-9 px-3 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-100 transition-all text-sm",onClick:()=>A(!1),children:"关闭"}),s.jsx("button",{className:"h-9 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all text-sm",onClick:()=>{E(),A(!1)},children:"应用筛选"}),s.jsxs("button",{className:"h-9 px-3 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-100 transition-all text-sm",onClick:()=>q({year:(new Date).getFullYear(),department:"",status:"",priority:""}),children:[s.jsx(x,{size:14,className:"inline mr-1"}),"重置"]})]})]})]}),s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 via-purple-50 to-indigo-50 rounded-3xl shadow-2xl p-8 border border-white/50",children:[s.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[s.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-xl shadow-lg",children:s.jsx(h,{size:24,className:"text-white"})}),s.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"5W2H分析法说明"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-blue-100 hover:shadow-xl transition-all duration-300",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:s.jsx(u,{size:16,className:"text-blue-600"})}),s.jsx("strong",{className:"text-blue-700",children:"What（做什么）"})]}),s.jsx("p",{className:"text-gray-700 text-sm",children:"明确要做的具体事情"})]}),s.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-green-100 hover:shadow-xl transition-all duration-300",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx("div",{className:"bg-green-100 p-2 rounded-lg",children:s.jsx(h,{size:16,className:"text-green-600"})}),s.jsx("strong",{className:"text-green-700",children:"Why（为什么做）"})]}),s.jsx("p",{className:"text-gray-700 text-sm",children:"明确做这件事的目的和意义"})]}),s.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-purple-100 hover:shadow-xl transition-all duration-300",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx("div",{className:"bg-purple-100 p-2 rounded-lg",children:s.jsx(m,{size:16,className:"text-purple-600"})}),s.jsx("strong",{className:"text-purple-700",children:"Who（谁来做）"})]}),s.jsx("p",{className:"text-gray-700 text-sm",children:"明确负责人和参与者"})]}),s.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-red-100 hover:shadow-xl transition-all duration-300",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx("div",{className:"bg-red-100 p-2 rounded-lg",children:s.jsx(p,{size:16,className:"text-red-600"})}),s.jsx("strong",{className:"text-red-700",children:"When（什么时候做）"})]}),s.jsx("p",{className:"text-gray-700 text-sm",children:"明确时间节点和期限"})]}),s.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-orange-100 hover:shadow-xl transition-all duration-300",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx("div",{className:"bg-orange-100 p-2 rounded-lg",children:s.jsx(g,{size:16,className:"text-orange-600"})}),s.jsx("strong",{className:"text-orange-700",children:"Where（在哪里做）"})]}),s.jsx("p",{className:"text-gray-700 text-sm",children:"明确地点和场所"})]}),s.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-indigo-100 hover:shadow-xl transition-all duration-300",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx("div",{className:"bg-indigo-100 p-2 rounded-lg",children:s.jsx(b,{size:16,className:"text-indigo-600"})}),s.jsx("strong",{className:"text-indigo-700",children:"How（如何做）"})]}),s.jsx("p",{className:"text-gray-700 text-sm",children:"明确实施方法和步骤"})]}),s.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-teal-100 hover:shadow-xl transition-all duration-300",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx("div",{className:"bg-teal-100 p-2 rounded-lg",children:s.jsx(j,{size:16,className:"text-teal-600"})}),s.jsx("strong",{className:"text-teal-700",children:"How Much（多少成本）"})]}),s.jsx("p",{className:"text-gray-700 text-sm",children:"明确所需资源和成本"})]})]})]}),s.jsx(r,{title:`${S.year}年度5W2H行动计划表`,data:k,columns:F,onAdd:M,onEdit:async(e,s)=>!!(await v(e,s)).success&&(E(),H(null),!0),onDelete:async e=>!!(await N(e)).success&&(E(),!0),onCopy:e=>{const s={...e};delete s.id,s.what=`${s.what}_副本`,s.year=S.year,M(s)},editingId:C,onEditingChange:H})]})};export{y as default};
