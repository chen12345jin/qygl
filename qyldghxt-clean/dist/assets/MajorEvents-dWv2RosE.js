import{a as e,j as t}from"./index-ByQWdRVi.js";import{r as a}from"./charts--DrkC4h1.js";import{T as l}from"./TableManager-CI9BWYWi.js";import{e as s}from"./export-9Rbd0ORM.js";import{A as r,n,D as i,R as o}from"./ui-CyUNfsEX.js";import"./vendor-De9qiMg1.js";import"./router-BWTJJsff.js";import"./pdf-60kGjG4V.js";import"./utils-d68qSfg_.js";import"./DeleteConfirmDialog-CRlob68K.js";import"./InlineAlert-ConnvRud.js";const c=()=>{const{getMajorEvents:c,addMajorEvent:d,updateMajorEvent:u,deleteMajorEvent:p,getDepartments:x}=e(),[m,b]=a.useState([]),[g,h]=a.useState([]),[y,v]=a.useState(null),[j,f]=a.useState({year:(new Date).getFullYear(),event_type:"",importance:"",status:""}),[_,N]=a.useState(!1);a.useEffect(()=>{w(),k()},[j]);const w=async()=>{const e=await c(j);e.success&&b(e.data||[])},k=async()=>{const e=await x();e.success&&h(e.data||[])},C=async e=>{const t=g.find(t=>t.name===e.responsible_department);if(!t)return alert("请选择负责部门"),!1;const a={...e,year:j.year,department_id:t.id,responsible_department:void 0};return!!(await d(a)).success&&(w(),!0)},E=[{key:"year",label:"年份",type:"select",options:[{value:2024,label:"2024年"},{value:2025,label:"2025年"},{value:2026,label:"2026年"}],required:!0},{key:"event_name",label:"事件名称",required:!0},{key:"event_type",label:"事件类型",type:"select",options:[{value:"strategic",label:"战略性事件"},{value:"operational",label:"运营性事件"},{value:"risk",label:"风险性事件"},{value:"opportunity",label:"机会性事件"}],required:!0},{key:"importance",label:"重要性",type:"select",options:[{value:"critical",label:"非常重要"},{value:"high",label:"重要"},{value:"medium",label:"一般"},{value:"low",label:"较低"}],render:e=>t.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+("critical"===e?"bg-red-100 text-red-800":"high"===e?"bg-orange-100 text-orange-800":"medium"===e?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:"critical"===e?"非常重要":"high"===e?"重要":"medium"===e?"一般":"较低"})},{key:"planned_date",label:"计划日期",type:"date"},{key:"actual_date",label:"实际日期",type:"date"},{key:"responsible_department",label:"负责部门",type:"select",options:g.map(e=>({value:e.name,label:e.name})),required:!0},{key:"responsible_person",label:"负责人"},{key:"status",label:"状态",type:"select",options:[{value:"planning",label:"规划中"},{value:"preparing",label:"准备中"},{value:"executing",label:"执行中"},{value:"completed",label:"已完成"},{value:"cancelled",label:"已取消"}],render:e=>t.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+("completed"===e?"bg-green-100 text-green-800":"executing"===e?"bg-blue-100 text-blue-800":"cancelled"===e?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"completed"===e?"已完成":"executing"===e?"执行中":"preparing"===e?"准备中":"cancelled"===e?"已取消":"规划中"})},{key:"budget",label:"预算（万元）",type:"number"},{key:"actual_cost",label:"实际成本（万元）",type:"number"},{key:"description",label:"事件描述",type:"textarea"},{key:"key_points",label:"关键要点",type:"textarea"},{key:"success_criteria",label:"成功标准",type:"textarea"},{key:"risks",label:"风险因素",type:"textarea"},{key:"lessons_learned",label:"经验教训",type:"textarea"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[t.jsx(r,{className:"mr-2"}),"大事件提炼"]}),t.jsx("p",{className:"text-gray-600",children:"识别、记录和管理企业年度重大事件，形成经验积累"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2 z-10",children:[t.jsxs("button",{className:"h-10 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg flex items-center justify-center text-sm gap-2",onClick:()=>N(e=>!e),children:[t.jsx(n,{size:16}),t.jsx("span",{children:"筛选"})]}),t.jsxs("button",{className:"h-10 px-4 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-xl font-medium hover:from-green-600 hover:to-teal-700 transition-all duration-200 shadow-lg flex items-center justify-center text-sm gap-2",onClick:()=>{try{const e=m.map(e=>({year:e.year,event_name:e.event_name,event_type:e.event_type,importance:e.importance,planned_date:e.planned_date,actual_date:e.actual_date,responsible_department:e.responsible_department,responsible_person:e.responsible_person,status:e.status,budget:e.budget,actual_cost:e.actual_cost,description:e.description}));s(e,`大事件提炼_${j.year}年`,"大事件","majorEvents")}catch(e){console.error("导出Excel失败:",e),alert("导出失败，请稍后重试")}},children:[t.jsx(i,{size:16}),t.jsx("span",{children:"导出Excel"})]})]}),_&&t.jsxs("div",{className:"absolute top-16 right-4 w-96 bg-white border border-gray-200 rounded-xl shadow-xl p-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"年度"}),t.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all duration-200 text-sm",value:j.year,onChange:e=>f({...j,year:parseInt(e.target.value)}),children:[t.jsx("option",{value:"2024",children:"2024"}),t.jsx("option",{value:"2025",children:"2025"}),t.jsx("option",{value:"2026",children:"2026"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"事件类型"}),t.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white transition-all duration-200 text-sm",value:j.event_type,onChange:e=>f({...j,event_type:e.target.value}),children:[t.jsx("option",{value:"",children:"全部类型"}),t.jsx("option",{value:"strategic",children:"战略性事件"}),t.jsx("option",{value:"operational",children:"运营性事件"}),t.jsx("option",{value:"risk",children:"风险性事件"}),t.jsx("option",{value:"opportunity",children:"机会性事件"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"重要性"}),t.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white transition-all duration-200 text-sm",value:j.importance,onChange:e=>f({...j,importance:e.target.value}),children:[t.jsx("option",{value:"",children:"全部重要性"}),t.jsx("option",{value:"critical",children:"非常重要"}),t.jsx("option",{value:"high",children:"重要"}),t.jsx("option",{value:"medium",children:"一般"}),t.jsx("option",{value:"low",children:"较低"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"状态"}),t.jsxs("select",{className:"w-full h-10 px-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 bg-white transition-all duration-200 text-sm",value:j.status,onChange:e=>f({...j,status:e.target.value}),children:[t.jsx("option",{value:"",children:"全部状态"}),t.jsx("option",{value:"planning",children:"规划中"}),t.jsx("option",{value:"preparing",children:"准备中"}),t.jsx("option",{value:"executing",children:"执行中"}),t.jsx("option",{value:"completed",children:"已完成"}),t.jsx("option",{value:"cancelled",children:"已取消"})]})]})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[t.jsx("button",{className:"h-9 px-3 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-100 transition-all text-sm",onClick:()=>N(!1),children:"关闭"}),t.jsx("button",{className:"h-9 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all text-sm",onClick:()=>{w(),N(!1)},children:"应用筛选"}),t.jsxs("button",{className:"h-9 px-3 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-100 transition-all text-sm",onClick:()=>f({year:(new Date).getFullYear(),event_type:"",importance:"",status:""}),children:[t.jsx(o,{size:14,className:"inline mr-1"}),"重置"]})]})]})]}),t.jsxs("div",{className:"bg-amber-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-amber-800 mb-2",children:"大事件分类说明"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("strong",{className:"text-amber-700",children:"战略性事件"}),t.jsx("p",{className:"text-gray-700",children:"影响企业长远发展的重大决策"})]}),t.jsxs("div",{children:[t.jsx("strong",{className:"text-amber-700",children:"运营性事件"}),t.jsx("p",{className:"text-gray-700",children:"日常运营中的重要里程碑"})]}),t.jsxs("div",{children:[t.jsx("strong",{className:"text-amber-700",children:"风险性事件"}),t.jsx("p",{className:"text-gray-700",children:"可能带来负面影响的事件"})]}),t.jsxs("div",{children:[t.jsx("strong",{className:"text-amber-700",children:"机会性事件"}),t.jsx("p",{className:"text-gray-700",children:"可以把握的发展机遇"})]})]})]}),t.jsx(l,{title:`${j.year}年度大事件记录`,data:m,columns:E,onAdd:C,onEdit:async(e,t)=>{const a=g.find(e=>e.name===t.responsible_department);if(!a)return alert("请选择负责部门"),!1;const l={...t,department_id:a.id,responsible_department:void 0};return!!(await u(e,l)).success&&(w(),v(null),!0)},onDelete:async e=>!!(await p(e)).success&&(w(),!0),onCopy:e=>{const t={...e};delete t.id,t.event_name=`${t.event_name}_副本`,t.year=j.year,C(t)},editingId:y,onEditingChange:v,showActions:!0})]})};export{c as default};
