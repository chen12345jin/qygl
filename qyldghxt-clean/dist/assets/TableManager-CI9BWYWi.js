import{j as e}from"./index-ByQWdRVi.js";import{r}from"./charts--DrkC4h1.js";import{_ as s,S as t,O as a,u as o,X as l,$ as n,a0 as i,Q as d,a1 as c}from"./ui-CyUNfsEX.js";import{D as m}from"./DeleteConfirmDialog-CRlob68K.js";import{I as u}from"./InlineAlert-ConnvRud.js";const h=({label:t,name:a,type:o="text",value:l,onChange:n,required:i=!1,placeholder:d="",error:c="",disabled:m=!1,options:u=[],className:h="",hint:p=""})=>{const[x,b]=r.useState(!1),[g,y]=r.useState(!1),f=()=>{b(!0),p&&y(!0)},j=()=>{b(!1),p&&!c&&y(!1)},v=`\n    w-full px-3 py-2 border rounded-md transition-all duration-200\n    ${x?"ring-2 ring-blue-500 border-blue-500":"border-gray-300"}\n    ${c?"border-red-500 ring-2 ring-red-200":""}\n    ${m?"bg-gray-100 cursor-not-allowed":"bg-white hover:border-gray-400"}\n    focus:outline-none\n  `;return e.jsxs("div",{className:"form-field-container",children:[e.jsxs("label",{className:"form-field-label",children:[t,i&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"form-field-input-wrapper",children:[(()=>{switch(o){case"select":return e.jsxs("select",{name:a,value:l,onChange:e=>n(e.target.value),onFocus:f,onBlur:j,disabled:m,className:v,children:[e.jsx("option",{value:"",children:d||"请选择..."}),u.map((r,s)=>e.jsx("option",{value:r.value,children:r.label},`${r.value}-${s}`))]});case"textarea":return e.jsx("textarea",{name:a,value:l,onChange:e=>n(e.target.value),onFocus:f,onBlur:j,placeholder:d,disabled:m,rows:4,className:v});default:return e.jsx("input",{type:o,name:a,value:l,onChange:e=>n(e.target.value),onFocus:f,onBlur:j,placeholder:d,disabled:m,className:v})}})(),p&&e.jsxs("div",{className:"form-field-hint-wrapper",children:[e.jsx(s,{size:16,className:"form-field-hint-icon",onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1)}),g&&e.jsx("div",{className:"form-field-hint-text",children:p})]})]}),c&&e.jsx("div",{className:"form-field-error",children:c})]})},p=({title:s,data:p,columns:x,onAdd:b,onEdit:g,onDelete:y,onCopy:f,editingId:j,onEditingChange:v,showActions:w=!0,children:N})=>{const[k,C]=r.useState(!1),[$,S]=r.useState({}),[O,I]=r.useState({}),[z,D]=r.useState({show:!1,message:"",type:"info"}),[q,E]=r.useState({isOpen:!1,itemId:null,itemName:""}),[T,_]=r.useState(null);r.useEffect(()=>()=>{T&&clearTimeout(T)},[T]);const A=(e,r="success")=>{T&&clearTimeout(T),D({show:!0,message:e,type:r});const s=setTimeout(()=>{D({show:!1,message:"",type:"info"}),_(null)},3e3);_(s)},B=()=>{S({}),I({}),C(!1),D({show:!1,message:"",type:"info"}),v&&v(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card-header bg-gradient-to-br from-white/80 to-blue-50/80 backdrop-blur-sm rounded-3xl shadow-2xl p-6 border border-white/20",children:[e.jsxs("div",{className:"icon-text",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-2xl shadow-xl",children:e.jsx(t,{className:"w-6 h-6 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:s})]}),w&&e.jsx("div",{className:"button-group",children:e.jsxs("button",{onClick:()=>C(!0),className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 hover:shadow-xl shadow-lg flex items-center space-x-2 font-semibold",children:[e.jsx(a,{size:18}),e.jsxs("span",{children:["新增",s.replace("管理","").replace("设置","")]})]})})]}),k&&e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),e.stopPropagation(),e.target.checkValidity()||console.log("HTML5 validation failed");if((()=>{const e={};return x.forEach(r=>{if(r.required){const s=$[r.key];s&&""!==s.toString().trim()&&0!==s||(e[r.key]=`${r.label}不能为空`)}if(r.key.includes("email")&&$[r.key]&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($[r.key])||(e[r.key]="请输入有效的邮箱地址")),(r.key.includes("phone")||r.key.includes("电话"))&&$[r.key]&&(/^[\d\s\-\+\(\)]+$/.test($[r.key])||(e[r.key]="请输入有效的电话号码")),"number"===r.type&&$[r.key]){const s=Number($[r.key]);isNaN(s)&&(e[r.key]=`${r.label}必须是数字`)}"select"===r.type&&$[r.key]&&""===$[r.key]&&r.required&&(e[r.key]=`请选择${r.label}`)}),I(e),Object.keys(e).length>0&&A(`请检查表单，共有${Object.keys(e).length}个字段需要修正`,"error"),0===Object.keys(e).length})())try{j?(await g(j,$),c.success("更新成功")):(await b($),c.success("添加成功")),B()}catch(r){c.error("操作失败"),A("操作失败，请重试","error")}},noValidate:!0,className:"bg-gradient-to-br from-white/80 to-blue-50/80 backdrop-blur-sm rounded-3xl shadow-2xl p-8 border border-white/20",children:[z.show&&e.jsx(u,{message:z.message,type:z.type,onClose:()=>D({...z,show:!1}),className:"mb-6"}),e.jsx("div",{className:"form-grid",children:x.map(r=>e.jsx(h,{name:r.key,label:r.label,type:r.type||"text",value:$[r.key]||"",onChange:e=>{r.onChange?r.onChange(e,S,$):S({...$,[r.key]:e}),O[r.key]&&I({...O,[r.key]:""})},required:r.required,options:r.options,error:O[r.key],hint:r.hint,rows:"textarea"===r.type?3:void 0,step:"number"===r.type?"0.01":void 0},r.key))}),e.jsxs("div",{className:"button-group mt-8",children:[e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 hover:shadow-xl shadow-lg flex items-center space-x-2 font-semibold",children:[e.jsx(o,{size:18}),e.jsx("span",{children:j?`更新${s.replace("管理","").replace("设置","")}`:`保存${s.replace("管理","").replace("设置","")}`})]}),e.jsxs("button",{type:"button",onClick:B,className:"px-6 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-xl hover:from-gray-600 hover:to-gray-700 transition-all duration-300 transform hover:scale-105 hover:shadow-xl shadow-lg flex items-center space-x-2 font-semibold",children:[e.jsx(l,{size:18}),e.jsx("span",{children:"取消"})]})]})]}),N,p&&p.length>0&&e.jsx("div",{className:"bg-gradient-to-br from-white/80 to-blue-50/80 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 overflow-hidden",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[x.map(r=>e.jsx("th",{className:"px-6 py-5 text-left text-sm font-bold text-white bg-gradient-to-r from-blue-600 to-purple-600 border-b border-white/30",children:r.label},r.key)),w&&e.jsx("th",{className:"px-6 py-5 text-right text-sm font-bold text-white bg-gradient-to-r from-blue-600 to-purple-600 border-b border-white/30",children:"操作"})]})}),e.jsx("tbody",{children:p.map((r,s)=>e.jsxs("tr",{className:"group hover:bg-gradient-to-r hover:from-blue-50/80 hover:to-purple-50/80 transition-all duration-300 border-b border-gray-100/50",children:[x.map(s=>e.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 border-r border-gray-100/50 last:border-r-0",children:e.jsx("div",{className:s.key.includes("name")||s.key.includes("title")?"text-ellipsis":"text-break",children:s.render?s.render(r[s.key],r):r[s.key]})},s.key)),w&&e.jsx("td",{className:"px-6 py-4 text-right border-r border-gray-100/50 last:border-r-0",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>(e=>{S(e),C(!0),I({}),D({show:!1,message:"",type:"info"}),v&&v(e.id)})(r),className:"text-blue-600 hover:text-blue-800 transition-all duration-300 transform hover:scale-110 group-hover:bg-blue-50/50 p-2 rounded-lg",title:"编辑",children:e.jsx(n,{size:18})}),e.jsx("button",{onClick:()=>(e=>{f&&(f(e),c.success("已复制"))})(r),className:"text-green-600 hover:text-green-800 transition-all duration-300 transform hover:scale-110 group-hover:bg-green-50/50 p-2 rounded-lg",title:"复制",children:e.jsx(i,{size:18})}),e.jsx("button",{onClick:()=>(e=>{const r=e.name||e.event_name||e.plan_name||e.progress_name||e.what||e.username||`ID: ${e.id}`;E({isOpen:!0,itemId:e.id,itemName:r})})(r),className:"text-red-600 hover:text-red-800 transition-all duration-300 transform hover:scale-110 group-hover:bg-red-50/50 p-2 rounded-lg",title:"删除",children:e.jsx(d,{size:18})})]})})]},r.id||s))})]})})}),e.jsx(m,{isOpen:q.isOpen,onClose:()=>{E({isOpen:!1,itemId:null,itemName:""})},onConfirm:async()=>{try{await y(q.itemId),c.success("删除成功"),A("删除成功","success")}catch(e){c.error("删除失败"),A("删除失败，请重试","error")}},itemName:q.itemName})]})};export{p as T};
