import{a as e,j as t}from"./index-ByQWdRVi.js";import{r as a}from"./charts--DrkC4h1.js";import{F as r,p as l,O as s,u as i,$ as o,D as n,Q as d,a1 as c}from"./ui-CyUNfsEX.js";import{D as p}from"./DeleteConfirmDialog-CRlob68K.js";import"./vendor-De9qiMg1.js";import"./router-BWTJJsff.js";import"./pdf-60kGjG4V.js";import"./utils-d68qSfg_.js";const m=()=>{const{getTemplates:m,addTemplate:x,updateTemplate:u,deleteTemplate:b,loading:h}=e(),[y,g]=a.useState([]),[f,v]=a.useState(null),[j,w]=a.useState(!1),[N,k]=a.useState({isOpen:!1,itemId:null,itemName:""}),[_,q]=a.useState({name:"",type:"department_target",description:"",fields:[]}),C={department_target:[{key:"department",label:"部门",type:"text",required:!0},{key:"target_type",label:"目标类型",type:"select",required:!0,options:[{value:"sales",label:"销售目标"},{value:"profit",label:"利润目标"},{value:"cost",label:"成本目标"}]},{key:"target_value",label:"目标值",type:"number",required:!0},{key:"unit",label:"单位",type:"text",required:!0},{key:"description",label:"描述",type:"textarea",required:!1}],annual_work_plan:[{key:"title",label:"计划标题",type:"text",required:!0},{key:"department",label:"责任部门",type:"text",required:!0},{key:"start_date",label:"开始日期",type:"date",required:!0},{key:"end_date",label:"结束日期",type:"date",required:!0},{key:"description",label:"计划描述",type:"textarea",required:!0},{key:"priority",label:"优先级",type:"select",required:!0,options:[{value:"high",label:"高"},{value:"medium",label:"中"},{value:"low",label:"低"}]}],major_event:[{key:"event_name",label:"事件名称",type:"text",required:!0},{key:"event_type",label:"事件类型",type:"select",required:!0,options:[{value:"strategic",label:"战略性事件"},{value:"operational",label:"运营性事件"},{value:"market",label:"市场性事件"}]},{key:"impact_level",label:"影响程度",type:"select",required:!0,options:[{value:"high",label:"高"},{value:"medium",label:"中"},{value:"low",label:"低"}]},{key:"planned_date",label:"计划日期",type:"date",required:!0},{key:"description",label:"事件描述",type:"textarea",required:!0}],monthly_progress:[{key:"month",label:"月份",type:"select",required:!0,options:[{value:"1",label:"1月"},{value:"2",label:"2月"},{value:"3",label:"3月"},{value:"4",label:"4月"},{value:"5",label:"5月"},{value:"6",label:"6月"},{value:"7",label:"7月"},{value:"8",label:"8月"},{value:"9",label:"9月"},{value:"10",label:"10月"},{value:"11",label:"11月"},{value:"12",label:"12月"}]},{key:"progress_rate",label:"完成率",type:"number",required:!0},{key:"target_amount",label:"目标金额",type:"number",required:!0},{key:"actual_amount",label:"实际金额",type:"number",required:!0},{key:"notes",label:"备注",type:"textarea",required:!1}],action_plan:[{key:"what",label:"What (做什么)",type:"text",required:!0},{key:"why",label:"Why (为什么)",type:"textarea",required:!0},{key:"when",label:"When (什么时候)",type:"date",required:!0},{key:"where",label:"Where (在哪里)",type:"text",required:!0},{key:"who",label:"Who (谁来做)",type:"text",required:!0},{key:"how",label:"How (怎么做)",type:"textarea",required:!0},{key:"how_much",label:"How Much (多少钱)",type:"number",required:!0}]},O=[{value:"department_target",label:"部门目标分解"},{value:"annual_work_plan",label:"年度工作规划"},{value:"major_event",label:"大事件提炼"},{value:"monthly_progress",label:"月度推进计划"},{value:"action_plan",label:"5W2H行动计划"}];a.useEffect(()=>{S()},[]);const S=async()=>{try{const e=await m();e.success?g(e.data||[]):(console.error("加载模板失败:",e.message),g([]))}catch(e){console.error("加载模板失败:",e),g([])}},z=()=>{q({name:"",type:"department_target",description:"",fields:[]}),v(null),w(!1)};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 p-6 rounded-xl shadow-lg border border-white/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl shadow-lg",children:t.jsx(r,{size:32,className:"text-white"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"模板设置"}),t.jsx("p",{className:"text-gray-600",children:"管理系统模板配置和字段定义"})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsxs("label",{className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 cursor-pointer",children:[t.jsx(l,{size:18}),t.jsx("span",{children:"导入模板"}),t.jsx("input",{type:"file",accept:".json",onChange:e=>{const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=async e=>{try{const t={...JSON.parse(e.target.result),is_default:!1},a=await x(t);a.success?(c.success("模板导入成功"),S()):c.error(a.message||"导入失败")}catch(t){console.error("导入失败:",t),c.error("导入失败，请检查文件格式")}},a.readAsText(t),e.target.value=""},className:"hidden"})]}),t.jsxs("button",{onClick:()=>w(!0),className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:[t.jsx(s,{size:18}),t.jsx("span",{children:"新建模板"})]})]})]})}),j&&t.jsxs("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-xl shadow-lg border border-white/50 p-6",children:[t.jsx("div",{className:"mb-6",children:t.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:f?"编辑模板":"新建模板"})}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),_.name&&_.type)try{const e={..._,fields:C[_.type]||[],updated_at:(new Date).toISOString()};if(f){const t=await u(f.id,e);t.success?(c.success("模板更新成功"),S()):c.error(t.message||"更新失败")}else{const t=await x(e);t.success?(c.success("模板创建成功"),S()):c.error(t.message||"创建失败")}z()}catch(t){console.error("保存模板失败:",t),c.error("操作失败")}else c.error("请填写完整信息")},className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"模板名称 *"}),t.jsx("input",{type:"text",value:_.name,onChange:e=>q({..._,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"模板类型 *"}),t.jsx("select",{value:_.type,onChange:e=>q({..._,type:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",required:!0,children:O.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"模板描述"}),t.jsx("textarea",{value:_.description,onChange:e=>q({..._,description:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",rows:"3"})]}),_.type&&C[_.type]&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-3",children:"模板字段预览"}),t.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 p-4 rounded-xl border border-white/50",children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:C[_.type].map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200",children:[t.jsx("span",{className:"text-sm font-semibold text-gray-800",children:e.label}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-100 rounded",children:e.type}),e.required&&t.jsx("span",{className:"text-xs text-red-500 px-2 py-1 bg-red-100 rounded",children:"必填"})]})]},a))})})]}),t.jsxs("div",{className:"flex items-center space-x-3 pt-6 border-t border-gray-200",children:[t.jsxs("button",{type:"submit",className:"flex items-center space-x-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:[t.jsx(i,{size:18}),t.jsx("span",{children:f?"更新":"创建"})]}),t.jsx("button",{type:"button",onClick:z,className:"flex items-center space-x-2 px-6 py-3 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:"取消"})]})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-xl shadow-lg border border-white/50 p-6",children:[t.jsx("div",{className:"mb-6",children:t.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"模板列表"})}),t.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 shadow-lg",children:t.jsxs("table",{className:"min-w-full bg-white",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gradient-to-r from-blue-500 to-purple-600",children:[t.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider",children:"模板名称"}),t.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider",children:"类型"}),t.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider",children:"字段数量"}),t.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider",children:"创建时间"}),t.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider",children:"状态"}),t.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider",children:"操作"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-100",children:y.map(e=>t.jsxs("tr",{className:"hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-200",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(r,{size:16,className:"text-gray-400"}),t.jsx("span",{className:"text-sm font-semibold text-gray-800",children:e.name})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:O.find(t=>t.value===e.type)?.label||e.type}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:[e.fields?.length||0," 个字段"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full "+(e.is_default?"bg-gradient-to-r from-blue-500 to-purple-600 text-white":"bg-gradient-to-r from-green-500 to-green-600 text-white"),children:e.is_default?"系统默认":"自定义"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>(e=>{q({name:e.name,type:e.type,description:e.description,fields:e.fields||[]}),v(e),w(!0)})(e),className:"text-blue-600 hover:text-blue-800 transition-colors duration-200",title:"编辑",children:t.jsx(o,{size:18})}),t.jsx("button",{onClick:()=>(e=>{try{const t=JSON.stringify(e,null,2),a=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=`${e.name}.json`,l.click(),URL.revokeObjectURL(r),c.success("模板导出成功")}catch(t){console.error("导出失败:",t),c.error("导出失败")}})(e),className:"text-green-600 hover:text-green-800 transition-colors duration-200",title:"导出",children:t.jsx(n,{size:18})}),!e.is_default&&t.jsx("button",{onClick:()=>(e=>{k({isOpen:!0,itemId:e.id,itemName:e.name})})(e),className:"text-red-600 hover:text-red-800 transition-colors duration-200",title:"删除",children:t.jsx(d,{size:18})})]})})]},e.id))})]})})]}),t.jsx(p,{isOpen:N.isOpen,onClose:()=>{k({isOpen:!1,itemId:null,itemName:""})},onConfirm:async()=>{try{const e=await b(N.itemId);e.success?(c.success("模板删除成功"),S()):c.error(e.message||"删除失败")}catch(e){console.error("删除模板失败:",e),c.error("删除失败")}k({isOpen:!1,itemId:null,itemName:""})},itemName:N.itemName,title:"确认删除模板",message:"确定要删除这个模板吗？此操作不可恢复！"})]})};export{m as default};
